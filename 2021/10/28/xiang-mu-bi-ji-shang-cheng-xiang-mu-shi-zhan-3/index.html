<!DOCTYPE html>
<html lang="zh-CN">
<head hexo-theme='https://github.com/volantis-x/hexo-theme-volantis/tree/4.3.1'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://cdn.jsdelivr.net'>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <link rel="preload" href="/css/first.css" as="style">
  

  <!-- 页面元数据 -->
  
  <title>【项目笔记】商城项目实战3 - Reria&#39;s BLOG</title>
  
    <meta name="keywords" content="SpringBoot,Vue,项目,SpringCloud,redis,微服务">
  

  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  
    <link rel="shortcut icon" type='image/x-icon' href="https://cdn.jsdelivr.net/gh/mayanming696/CDN/image/sun.svg">
  

  <!-- import link -->
  
  
  <link rel="stylesheet" href="/css/iconfont.css">
  <link rel="stylesheet" href="/css/myIconColor.css">
  <link rel="stylesheet" href="/css/myStyle.css">
  

  
    
<link rel="stylesheet" href="/css/first.css">

  

  
  <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all';this.onload=null">
  <noscript><link rel="stylesheet" href="/css/style.css"></noscript>
  

  <script id="loadcss"></script>

  
<script>
if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode))
    document.write(
	'<style>'+
		'html{'+
			'overflow-x: hidden !important;'+
			'overflow-y: hidden !important;'+
		'}'+
		'.kill-ie{'+
			'text-align:center;'+
			'height: 100%;'+
			'margin-top: 15%;'+
			'margin-bottom: 5500%;'+
		'}'+
	'</style>'+
    '<div class="kill-ie">'+
        '<h1><b>抱歉，您的浏览器无法访问本站</b></h1>'+
        '<h3>微软已经于2016年终止了对 Internet Explorer (IE) 10 及更早版本的支持，<br/>'+
        '继续使用存在极大的安全隐患，请使用当代主流的浏览器进行访问。</h3><br/>'+
        '<a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-cn/WindowsForBusiness/End-of-IE-support"><strong>了解详情 ></strong></a>'+
    '</div>');
</script>


<noscript>
	<style>
		html{
			overflow-x: hidden !important;
			overflow-y: hidden !important;
		}
		.kill-noscript{
			text-align:center;
			height: 100%;
			margin-top: 15%;
			margin-bottom: 5500%;
		}
	</style>
    <div class="kill-noscript">
        <h1><b>抱歉，您的浏览器无法访问本站</b></h1>
        <h3>本页面需要浏览器支持（启用）JavaScript</h3><br/>
        <a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=启用JavaScript"><strong>了解详情 ></strong></a>
    </div>
</noscript>

</head>


  <body>
    

  <header id="l_header"
    class="l_header auto shadow floatable "
    style='opacity: 0' >
    <div class='container'>
      <div id='wrapper'>
        <div class='nav-sub'>
          <p class="title"></p>
          <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
            <li><a id="s-comment" class="fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
            
              <li><a id="s-toc" class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
              
          </ul>
        </div>
        <div class="nav-main">
          
            
              <a class="title flat-box" target="_self" href='/'>
                
                  <img no-lazy class='logo' src='https://gitee.com/ReRia/images/raw/master/img/58.png' />
                  
                    
                        
              </a>
              

                <div class='menu navigation'>
                  <ul class='nav-list-h m-pc'>
                    
                      
                                  
                                    
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/
                                  
                                        
                                              
                                                id="home"
                                                  >
                                                    <i class='fas fa-fan fa-spin fa-fw'></i>
                                                      
                                                        主页
                                </a>
                                
                              </li>
                              
                                
                                      
                                    
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" 
                                  
                                        
                                              >
                                                    <i class='fas fa-paper-plane fa-fw'></i>
                                                      
                                                        博文
                                </a>
                                
                                  <ul class="list-v">
                                    
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                                  
                                        
                                              
                                                id="categories"
                                                  >
                                                    <i class='fas fa-folder-open fa-fw'></i>
                                                      
                                                        分类
                                </a>
                                
                              </li>
                              
                                
                                        
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                                  
                                        
                                              
                                                id="tags"
                                                  >
                                                    <i class='fas fa-tags fa-fw'></i>
                                                      
                                                        标签
                                </a>
                                
                              </li>
                              
                                
                                        
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                                  
                                        
                                              
                                                id="archives"
                                                  >
                                                    <i class='fas fa-archive fa-fw'></i>
                                                      
                                                        归档
                                </a>
                                
                              </li>
                              
                                
                                        
                                  </ul>
                                  
                              </li>
                              
                                
                                      
                                    
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" 
                                  
                                        
                                              >
                                                    <i class='fas fa-map-signs fa-fw'></i>
                                                      
                                                        导航
                                </a>
                                
                                  <ul class="list-v">
                                    
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/artitalk/
                                  
                                        
                                              
                                                id="artitalk"
                                                  >
                                                    <i class='fas fa-comment-dots fa-fw'></i>
                                                      
                                                        说说
                                </a>
                                
                              </li>
                              
                                
                                        
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/bb/
                                  
                                        
                                              
                                                id="bb"
                                                  >
                                                    <i class='iconfont icon-27shijianxian fa-fw'></i>
                                                      
                                                        时间线
                                </a>
                                
                              </li>
                              
                                
                                        
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/bangumis/
                                  
                                        
                                              
                                                id="bangumis"
                                                  >
                                                    <i class='iconfont icon-bilibili fa-fw'></i>
                                                      
                                                        追番
                                </a>
                                
                              </li>
                              
                                
                                        
                                  </ul>
                                  
                              </li>
                              
                                
                                      
                                    
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" 
                                  
                                        
                                              >
                                                    <i class='fas fa-train fa-fw'></i>
                                                      
                                                        开往
                                </a>
                                
                                  <ul class="list-v">
                                    
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/friends/
                                  
                                        
                                              
                                                id="friends"
                                                  >
                                                    <i class='fas fa-link fa-fw'></i>
                                                      
                                                        友链
                                </a>
                                
                              </li>
                              
                                
                                        
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                                  
                                        
                                              
                                                id="about"
                                                  >
                                                    <i class='fas fa-info-circle fa-fw'></i>
                                                      
                                                        关于
                                </a>
                                
                              </li>
                              
                                
                                        
                                  </ul>
                                  
                              </li>
                              
                                
                                      
                                    
                        
                                
                            <li>
                              <a class="menuitem flat-box">
                                <i class='fas fa-compact-disc fa-spin fa-fw music'></i>
                                音乐
                              </a>
                              <ul class="list-v">
                                <li>
                                  <div class="aplayer-container">
                                    

  
    <meting-js
      theme='#1BCDFC'
      autoplay='false'
      volume='0.5'
      loop='all'
      order='list'
      fixed='false'
      list-max-height='320px'
      server='tencent'
      type='playlist'
      id='8119036336'
      list-folded='true'>
    </meting-js>
  


                                  </div>
                                </li>
                              </ul>
                            <li>
                              
                                
                                
                                      
                                    
                        
                            <li>
                              <a class="menuitem flat-box header toggle-mode-btn">
                                <i class='fas fa-moon fa-fw'></i>
                                开/关灯
                              </a>
                            <li>
                              
                                
                                      
                  </ul>
                </div>

                <div id="weather"></div>
                <script src="/js/weather.js"></script>


                <div class="m_search">
                  <form name="searchform" class="form u-search-form">
                    <i class="icon fas fa-search fa-fw"></i>
                    <input type="text" class="input u-search-input"
                      placeholder="要搜什么呢？" />
                  </form>
                </div>

                <ul class='switcher nav-list-h m-phone'>
                  
                    <li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
                    
                      <li>
                        <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
                        <ul class="menu-phone list-v navigation white-box">
                          
                            
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/
                                  
                                        
                                              
                                                id="home"
                                                  >
                                                    <i class='fas fa-fan fa-spin fa-fw'></i>
                                                      
                                                        主页
                                </a>
                                
                              </li>
                              
                                
                              
                            
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" 
                                  
                                        
                                              >
                                                    <i class='fas fa-paper-plane fa-fw'></i>
                                                      
                                                        博文
                                </a>
                                
                                  <ul class="list-v">
                                    
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                                  
                                        
                                              
                                                id="categories"
                                                  >
                                                    <i class='fas fa-folder-open fa-fw'></i>
                                                      
                                                        分类
                                </a>
                                
                              </li>
                              
                                
                                        
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                                  
                                        
                                              
                                                id="tags"
                                                  >
                                                    <i class='fas fa-tags fa-fw'></i>
                                                      
                                                        标签
                                </a>
                                
                              </li>
                              
                                
                                        
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                                  
                                        
                                              
                                                id="archives"
                                                  >
                                                    <i class='fas fa-archive fa-fw'></i>
                                                      
                                                        归档
                                </a>
                                
                              </li>
                              
                                
                                        
                                  </ul>
                                  
                              </li>
                              
                                
                              
                            
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" 
                                  
                                        
                                              >
                                                    <i class='fas fa-map-signs fa-fw'></i>
                                                      
                                                        导航
                                </a>
                                
                                  <ul class="list-v">
                                    
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/artitalk/
                                  
                                        
                                              
                                                id="artitalk"
                                                  >
                                                    <i class='fas fa-comment-dots fa-fw'></i>
                                                      
                                                        说说
                                </a>
                                
                              </li>
                              
                                
                                        
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/bb/
                                  
                                        
                                              
                                                id="bb"
                                                  >
                                                    <i class='iconfont icon-27shijianxian fa-fw'></i>
                                                      
                                                        时间线
                                </a>
                                
                              </li>
                              
                                
                                        
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/bangumis/
                                  
                                        
                                              
                                                id="bangumis"
                                                  >
                                                    <i class='iconfont icon-bilibili fa-fw'></i>
                                                      
                                                        追番
                                </a>
                                
                              </li>
                              
                                
                                        
                                  </ul>
                                  
                              </li>
                              
                                
                              
                            
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" 
                                  
                                        
                                              >
                                                    <i class='fas fa-train fa-fw'></i>
                                                      
                                                        开往
                                </a>
                                
                                  <ul class="list-v">
                                    
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/friends/
                                  
                                        
                                              
                                                id="friends"
                                                  >
                                                    <i class='fas fa-link fa-fw'></i>
                                                      
                                                        友链
                                </a>
                                
                              </li>
                              
                                
                                        
                                      
                        
                              <li>
                                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                                  
                                        
                                              
                                                id="about"
                                                  >
                                                    <i class='fas fa-info-circle fa-fw'></i>
                                                      
                                                        关于
                                </a>
                                
                              </li>
                              
                                
                                        
                                  </ul>
                                  
                              </li>
                              
                                
                              
                            
                        
                                
                                
                                
                              
                            
                        
                            <li>
                              <a class="menuitem flat-box header toggle-mode-btn">
                                <i class='fas fa-moon fa-fw'></i>
                                开/关灯
                              </a>
                            <li>
                              
                                
                              
                        </ul>
                      </li>
                </ul>
        </div>
      </div>
    </div>
  </header>
      <div id="l_body">
        <div id="l_cover">
  
    
        <div id="half" class='cover-wrapper post search' style="display: ;">
          
            <div id='cover-backstretch'></div>
          
          <div class='cover-body'>
  <div class='top'>
    
    
      <p class="title">Hello world!</p>
    
    
    <!-- 自定义封面滚动字体 -->
    <div id="binft"></div>
    <script>
      var binft = function (r) {
        function t() {
          return b[Math.floor(Math.random() * b.length)]
        }
        function e() {
          return String.fromCharCode(94 * Math.random() + 33)
        }
        function n(r) {
          for (var n = document.createDocumentFragment(), i = 0; r > i; i++) {
            var l = document.createElement("span");
            l.textContent = e(), l.style.color = t(), n.appendChild(l)
          }
          return n
        }
        function i() {
          var t = o[c.skillI];
          c.step ? c.step-- : (c.step = g, c.prefixP < l.length ? (c.prefixP >= 0 && (c.text += l[c.prefixP]), c.prefixP++) : "forward" === c.direction ? c.skillP < t.length ? (c.text += t[c.skillP], c.skillP++) : c.delay ? c.delay-- : (c.direction = "backward", c.delay = a) : c.skillP > 0 ? (c.text = c.text.slice(0, -1), c.skillP--) : (c.skillI = (c.skillI + 1) % o.length, c.direction = "forward")), r.textContent = c.text, r.appendChild(n(c.prefixP < l.length ? Math.min(s, s + c.prefixP) : Math.min(s, t.length - c.skillP))), setTimeout(i, d)
        }
        var l = "",
          o = ["山有木兮木有枝，心悦君兮君不知。", "人生若只如初见，何事秋风悲画扇。", "十年生死两茫茫，不思量，自难忘。", "曾经沧海难为水，除却巫山不是云。", "洛中何郁郁，冠带自相索。", "只愿君心似我心，定不负相思意。", "愿得一心人，白头不相离。", "入我相思门，知我相思苦。"].map(function (r) {
            return r + ""
          }),
          a = 2,
          g = 1,
          s = 5,
          d = 75,
          b = ["rgb(110,64,170)", "rgb(150,61,179)", "rgb(191,60,175)", "rgb(228,65,157)", "rgb(254,75,131)", "rgb(255,94,99)", "rgb(255,120,71)", "rgb(251,150,51)", "rgb(226,183,47)", "rgb(198,214,60)", "rgb(175,240,91)", "rgb(127,246,88)", "rgb(82,246,103)", "rgb(48,239,130)", "rgb(29,223,163)", "rgb(26,199,194)", "rgb(35,171,216)", "rgb(54,140,225)", "rgb(76,110,219)", "rgb(96,84,200)"],
          c = {
            text: "",
            prefixP: -s,
            skillI: 0,
            skillP: 0,
            direction: "forward",
            delay: a,
            step: g
          };
        i()
      };
      binft(document.getElementById('binft'));
    </script>
  </div>
  <div class='bottom'>
    
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <input type="text" class="input u-search-input" placeholder="☜(ﾟヮﾟ☜)在这里输入你要查找的内容哦" />
          <i class="icon fas fa-search fa-fw"></i>
        </form>
      </div>
    
    <div class='menu navigation'>
      <div class='list-h'>
        
          
            <a href="/"
              
              
              id="home">
              <p>主页</p>
            </a>
          
            <a href="/categories/"
              
              
              id="categories">
              <p>分类</p>
            </a>
          
            <a href="/tags/"
              
              
              id="tags">
              <p>标签</p>
            </a>
          
            <a href="/archives/"
              
              
              id="archives">
              <p>归档</p>
            </a>
          
        
      </div>
    </div>
  </div>
</div>

          <div id="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
        </div>
    
  
  </div>

          <div id="safearea">
            <div class="body-wrapper" id="pjax-container">
              

<div class='l_main'>
  <article class="article post white-box reveal md shadow floatable article-type-post" id="post" itemscope itemprop="blogPost">
  


  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title">
        【项目笔记】商城项目实战3
      </h1>
      <div class='new-meta-box'>
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2021年10月28日</p>
  </a>
</div>

          
        
          
            
  <div class='new-meta-item category'>
    <a class='notlink'>
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <a class="category-link" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a>
    </a>
  </div>


          
        
          
            
  <div class="new-meta-item wordcount">
    <a class='notlink'>
      <i class="fas fa-keyboard fa-fw" aria-hidden="true"></i>
      <p>字数：6.4k字</p>
    </a>
  </div>
  <div class="new-meta-item readtime">
    <a class='notlink'>
      <i class="fas fa-hourglass-half fa-fw" aria-hidden="true"></i>
      <p>时长：33分钟</p>
    </a>
  </div>


          
        
          
            
  <div class="new-meta-item browse leancloud">
    <a class='notlink'>
      
      <div id="lc-pv" data-title="【项目笔记】商城项目实战3" data-path="/2021/10/28/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-3/">
        <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
        <span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
        次浏览
      </div>
    </a>
  </div>


          
        
      </div>
    
  </div>


  
  
  <h2 id="Controller三个注释（获取值）"><a href="#Controller三个注释（获取值）" class="headerlink" title="Controller三个注释（获取值）"></a>Controller三个注释（获取值）</h2><blockquote>
<ol>
<li>@RequestBody请求体中的JSON</li>
<li>@RequestParam是url?后跟的键值对</li>
<li>@PathVariable是REST风格url中的{}变量</li>
</ol>
</blockquote>
<h2 id="Object划分"><a href="#Object划分" class="headerlink" title="Object划分"></a>Object划分</h2><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131128469.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131128469.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211028131128469"></p>
<p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131145962.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131145962.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211028131145962"></p>
<p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131152946.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131152946.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211028131152946"></p>
<p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131204191.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131204191.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211028131204191"></p>
<h2 id="配置服务内存"><a href="#配置服务内存" class="headerlink" title="配置服务内存"></a>配置服务内存</h2><blockquote>
<p>终于你也有今天啊老师，内存终于不够了吧</p>
<p>RunConfigurations -&gt; xxx application -&gt; environment -&gt; Vm opinion -&gt; 设置-Xmx100m，最大100m</p>
</blockquote>
<h2 id="平台属性—规格参数（后端）"><a href="#平台属性—规格参数（后端）" class="headerlink" title="平台属性—规格参数（后端）"></a>平台属性—规格参数（后端）</h2><h3 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h3><h4 id="AttrRequestVo"><a href="#AttrRequestVo" class="headerlink" title="AttrRequestVo"></a>AttrRequestVo</h4><blockquote>
<p>使用自定义的VO对象用于封装数据</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.gulimall.product.vo;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于封装请求数据和响应数据</span></span><br><span class="line"><span class="comment"> * 不需要添加上与sql相关的注解</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrVo</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 属性id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long attrId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 属性名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String attrName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否需要检索[0-不需要，1-需要]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer searchType;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 属性图标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String icon;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 可选值列表[用逗号分隔]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String valueSelect;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 属性类型[0-销售属性，1-基本属性，2-既是销售属性又是基本属性]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer attrType;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启用状态[0 - 禁用，1 - 启用]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long enable;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 所属分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long catelogId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 快速展示【是否展示在介绍上；0-否 1-是】，在sku中仍然可以调整</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer showDesc;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分组ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long attrGroupId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrController"><a href="#AttrController" class="headerlink" title="AttrController"></a>AttrController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrService attrService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存,这里使用自定义的Vo对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:attr:save&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(<span class="meta">@RequestBody</span> AttrVo attr)</span> </span>&#123;</span><br><span class="line">        attrService.saveAttr(attr);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrServiceImpl"><a href="#AttrServiceImpl" class="headerlink" title="AttrServiceImpl"></a>AttrServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;attrService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">AttrDao</span>, <span class="title">AttrEntity</span>&gt; <span class="keyword">implements</span> <span class="title">AttrService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AttrAttrgroupRelationDao relationDao;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存规格参数，连表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>  <span class="comment">// 事务</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveAttr</span><span class="params">(AttrVo attr)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1、保存到attr表</span></span><br><span class="line">        AttrEntity attrEntity = <span class="keyword">new</span> AttrEntity();</span><br><span class="line">        <span class="comment">// 使用BeanUtil封装对应属性</span></span><br><span class="line">        BeanUtils.copyProperties(attr, attrEntity);</span><br><span class="line">        <span class="keyword">this</span>.save(attrEntity);</span><br><span class="line">        <span class="comment">// 2、保存到relation表</span></span><br><span class="line">        AttrAttrgroupRelationEntity relationEntity = <span class="keyword">new</span> AttrAttrgroupRelationEntity();</span><br><span class="line">        relationEntity.setAttrId(attrEntity.getAttrId());<span class="comment">// 注意这里要使用attrEntity，因为使用attr是没有id的（没有添加mybatis的注解，所以没有自动生成id）</span></span><br><span class="line">        relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">        relationDao.insert(relationEntity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询分页"><a href="#查询分页" class="headerlink" title="查询分页"></a>查询分页</h3><h4 id="AttrResponseVo"><a href="#AttrResponseVo" class="headerlink" title="AttrResponseVo"></a>AttrResponseVo</h4><blockquote>
<p>原来可以使用继承的写法，学到了</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrResponseVo</span> <span class="keyword">extends</span> <span class="title">AttrEntity</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分类名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String catelogName;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分组名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String groupName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrController-1"><a href="#AttrController-1" class="headerlink" title="AttrController"></a>AttrController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrService attrService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/base/list/&#123;catelogId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">baseAttrList</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params, <span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId)</span> </span>&#123;</span><br><span class="line">        PageUtils page = attrService.queryBaseAttrPage(params, catelogId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrServiceImpl-1"><a href="#AttrServiceImpl-1" class="headerlink" title="AttrServiceImpl"></a>AttrServiceImpl</h4><blockquote>
<p>带新增的两个属性</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;attrService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">AttrDao</span>, <span class="title">AttrEntity</span>&gt; <span class="keyword">implements</span> <span class="title">AttrService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AttrAttrgroupRelationDao relationDao;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询attr表分页</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> catelogId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryBaseAttrPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId)</span> </span>&#123;</span><br><span class="line">   QueryWrapper&lt;AttrEntity&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (catelogId != <span class="number">0</span>) &#123;</span><br><span class="line">            queryWrapper.eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId);</span><br><span class="line">        &#125;</span><br><span class="line">        String key = (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">            <span class="comment">// and拼接，因为可能id为0所以已经含有了一个eq条件</span></span><br><span class="line">            queryWrapper.and((wrapper) -&gt; &#123;</span><br><span class="line">                wrapper.eq(<span class="string">&quot;attr_id&quot;</span>, key).or().like(<span class="string">&quot;attr_name&quot;</span>, key);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获得分页对象</span></span><br><span class="line">        IPage&lt;AttrEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">                <span class="keyword">new</span> Query&lt;AttrEntity&gt;().getPage(params),</span><br><span class="line">                queryWrapper</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// 同时还要添加上attrResponseVo中多的两个属性</span></span><br><span class="line">        <span class="comment">// 但是不能直接连表查询，数据量太大了。（两表叉乘笛卡尔积）</span></span><br><span class="line">        <span class="comment">// 所以先获取到分页后获取查询到的数据,再重新处理</span></span><br><span class="line">        PageUtils pageUtils = <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">        List&lt;AttrEntity&gt; records = page.getRecords();</span><br><span class="line">        List&lt;AttrResponseVo&gt; responseVoList = records.stream().map((attrEntity) -&gt; &#123;</span><br><span class="line">            AttrResponseVo responseVo = <span class="keyword">new</span> AttrResponseVo();</span><br><span class="line">            <span class="comment">// 先复制基本属性</span></span><br><span class="line">            BeanUtils.copyProperties(attrEntity, responseVo);</span><br><span class="line">            <span class="comment">// 再加入新的两个属性</span></span><br><span class="line">            CategoryEntity categoryEntity = categoryDao.selectById(attrEntity.getCatelogId());</span><br><span class="line">            <span class="keyword">if</span> (categoryEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">                responseVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">            &#125;</span><br><span class="line">            AttrAttrgroupRelationEntity relationEntity = relationDao.selectOne(<span class="keyword">new</span> QueryWrapper&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attrEntity.getAttrId()));</span><br><span class="line">            <span class="keyword">if</span> (relationEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">                responseVo.setGroupName(attrGroupDao.selectById(relationEntity.getAttrGroupId()).getAttrGroupName());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> responseVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">// 重新设置结果集</span></span><br><span class="line">        pageUtils.setList(responseVoList);</span><br><span class="line">        <span class="keyword">return</span> pageUtils;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询回显"><a href="#查询回显" class="headerlink" title="查询回显"></a>查询回显</h3><h4 id="AttrResoponseVo"><a href="#AttrResoponseVo" class="headerlink" title="AttrResoponseVo"></a>AttrResoponseVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrResponseVo</span> <span class="keyword">extends</span> <span class="title">AttrEntity</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分类名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String catelogName;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分组名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String groupName;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分类完整路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long[] catelogPath;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分组ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long attrGroupId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrController-2"><a href="#AttrController-2" class="headerlink" title="AttrController"></a>AttrController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrService attrService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 信息,返回AttrResponseVo对象属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/info/&#123;attrId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">attrResponseInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;attrId&quot;)</span> Long attrId)</span> </span>&#123;</span><br><span class="line">        AttrResponseVo attr = attrService.getResponseAttrInfo(attrId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;attr&quot;</span>, attr);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrServiceImpl-2"><a href="#AttrServiceImpl-2" class="headerlink" title="AttrServiceImpl"></a>AttrServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;attrService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">AttrDao</span>, <span class="title">AttrEntity</span>&gt; <span class="keyword">implements</span> <span class="title">AttrService</span> </span>&#123;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取信息,返回AttrResponseVo对象属性，带catelogPath完整路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AttrResponseVo <span class="title">getResponseAttrInfo</span><span class="params">(Long attrId)</span> </span>&#123;</span><br><span class="line">        AttrResponseVo responseVo = <span class="keyword">new</span> AttrResponseVo();</span><br><span class="line">        AttrEntity attrEntity = <span class="keyword">this</span>.getById(attrId);</span><br><span class="line">        BeanUtils.copyProperties(attrEntity, responseVo);</span><br><span class="line">        <span class="comment">// 额外的属性</span></span><br><span class="line">        <span class="comment">// 设置GroupName需要从relation表中查出groupid</span></span><br><span class="line">        AttrAttrgroupRelationEntity relationEntity = relationDao.selectOne(<span class="keyword">new</span> QueryWrapper&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attrEntity.getAttrId()));</span><br><span class="line">        <span class="keyword">if</span> (relationEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">            responseVo.setAttrGroupId(relationEntity.getAttrGroupId());</span><br><span class="line">            <span class="comment">// 设置GroupName属性</span></span><br><span class="line">            AttrGroupEntity attrGroupEntity = attrGroupDao.selectById(relationEntity.getAttrGroupId());</span><br><span class="line">            <span class="keyword">if</span> (attrGroupEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">                responseVo.setGroupName(attrGroupEntity.getAttrGroupName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 设置CatelogPath属性,直接从分类服务中拿方法</span></span><br><span class="line">        Long[] categoryPath = categoryService.findCategoryPath(attrEntity.getCatelogId());</span><br><span class="line">        responseVo.setCatelogPath(categoryPath);</span><br><span class="line">        <span class="comment">// 设置CatelogName属性</span></span><br><span class="line">        CategoryEntity categoryEntity = categoryDao.selectById(attrEntity.getCatelogId());</span><br><span class="line">        <span class="keyword">if</span> (categoryEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">            responseVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> responseVo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><h4 id="AttrController-3"><a href="#AttrController-3" class="headerlink" title="AttrController"></a>AttrController</h4><blockquote>
<p>需要用AttrRequestVo</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/update&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">update</span><span class="params">(<span class="meta">@RequestBody</span> AttrRequestVo attr)</span> </span>&#123;</span><br><span class="line">    attrService.updateAttr(attr);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrServiceImpl-3"><a href="#AttrServiceImpl-3" class="headerlink" title="AttrServiceImpl"></a>AttrServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改,使用AttrRequestVo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateAttr</span><span class="params">(AttrRequestVo attr)</span> </span>&#123;</span><br><span class="line"> <span class="comment">// 修改基本表</span></span><br><span class="line">        AttrEntity attrEntity = <span class="keyword">new</span> AttrEntity();</span><br><span class="line">        BeanUtils.copyProperties(attr, attrEntity);</span><br><span class="line">        <span class="keyword">this</span>.updateById(attrEntity);</span><br><span class="line">        <span class="comment">// 修改/新增relation表</span></span><br><span class="line">        AttrAttrgroupRelationEntity relationEntity = <span class="keyword">new</span> AttrAttrgroupRelationEntity();</span><br><span class="line">        relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">        relationEntity.setAttrId(attr.getAttrId());</span><br><span class="line">        <span class="comment">// 这里主要判断relation表中是否存在对应attr属性id的数据（即表中是否存入对应属性对应分组，如果没有对应分组，那么需要执行插入语句而不是修改语句）</span></span><br><span class="line">        Integer count = relationDao.selectCount(<span class="keyword">new</span> QueryWrapper&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attr.getAttrId()));</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            relationDao.update(relationEntity, <span class="keyword">new</span> UpdateWrapper&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attr.getAttrId()));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            relationDao.insert(relationEntity);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="平台属性—销售属性（后端）"><a href="#平台属性—销售属性（后端）" class="headerlink" title="平台属性—销售属性（后端）"></a>平台属性—销售属性（后端）</h2><blockquote>
<p>规格参数和销售属性其实就是attr属性中attrType的不同，所以controller还是同一个，只是请求地址中片段不同，只需要在requestMapping中获得参数判断一下即可，</p>
</blockquote>
<h4 id="常量类"><a href="#常量类" class="headerlink" title="常量类"></a>常量类</h4><blockquote>
<p>在common模块中写一个类，里面写各种枚举</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductConstant</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">AttrEnum</span> </span>&#123;</span><br><span class="line">        ATTR_TYPE_BASE(<span class="number">1</span>, <span class="string">&quot;基本属性&quot;</span>), ATTR_TYPE_SALE(<span class="number">0</span>, <span class="string">&quot;销售属性&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String msg;</span><br><span class="line">        AttrEnum(<span class="keyword">int</span> code, String msg) &#123;</span><br><span class="line">            <span class="keyword">this</span>.code = code;</span><br><span class="line">            <span class="keyword">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrController-4"><a href="#AttrController-4" class="headerlink" title="AttrController"></a>AttrController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrService attrService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 信息,返回AttrResponseVo对象属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/info/&#123;attrId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">attrResponseInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;attrId&quot;)</span> Long attrId)</span> </span>&#123;</span><br><span class="line">        AttrResponseVo attr = attrService.getResponseAttrInfo(attrId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;attr&quot;</span>, attr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 条件查询分页列表,返回AttrResponseVo对象属性</span></span><br><span class="line"><span class="comment">     * attrType 用于判断是销售属性还是基本属性（详见文档）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;attrType&#125;/list/&#123;catelogId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">attrResponseList</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="meta">@PathVariable(&quot;attrType&quot;)</span> String attrType,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId)</span> </span>&#123;</span><br><span class="line">        PageUtils page = attrService.queryBaseAttrPage(params, catelogId,attrType);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrService"><a href="#AttrService" class="headerlink" title="AttrService"></a>AttrService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 条件查询attr表分页</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> catelogId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> attrType</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryBaseAttrPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId, String attrType)</span> </span>&#123;</span><br><span class="line"> <span class="comment">// 这里判断attrType，用于查询是规格参数还是销售属性</span></span><br><span class="line">        QueryWrapper&lt;AttrEntity&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;AttrEntity&gt;().eq(<span class="string">&quot;attr_type&quot;</span>, <span class="string">&quot;base&quot;</span>.equalsIgnoreCase(attrType) ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (catelogId != <span class="number">0</span>) &#123;</span><br><span class="line">            queryWrapper.eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存规格参数，连表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>  <span class="comment">// 事务</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveAttr</span><span class="params">(AttrRequestVo attr)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1、保存到attr表</span></span><br><span class="line">        AttrEntity attrEntity = <span class="keyword">new</span> AttrEntity();</span><br><span class="line">        <span class="comment">// 使用BeanUtil封装对应属性</span></span><br><span class="line">        BeanUtils.copyProperties(attr, attrEntity);</span><br><span class="line">        <span class="keyword">this</span>.save(attrEntity);</span><br><span class="line">        <span class="comment">// 2、保存到relation表</span></span><br><span class="line">        <span class="comment">// 判断是否是销售属性，如果不是那么不需要添加到relation表</span></span><br><span class="line">        <span class="keyword">if</span> (attr.getAttrType() == ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode()) &#123;</span><br><span class="line">            AttrAttrgroupRelationEntity relationEntity = <span class="keyword">new</span> AttrAttrgroupRelationEntity();</span><br><span class="line">            relationEntity.setAttrId(attrEntity.getAttrId()); <span class="comment">// 注意这里要使用attrEntity，因为使用attr是没有id的（没有添加mybatis的注解，所以没有自动生成id）</span></span><br><span class="line">            relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">            relationDao.insert(relationEntity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="平台属性—属性分组（后端）"><a href="#平台属性—属性分组（后端）" class="headerlink" title="平台属性—属性分组（后端）"></a>平台属性—属性分组（后端）</h2><h3 id="查询关联"><a href="#查询关联" class="headerlink" title="查询关联"></a>查询关联</h3><blockquote>
<p>分组和属性多对多，需要关联表</p>
</blockquote>
<h4 id="AttrGroupController"><a href="#AttrGroupController" class="headerlink" title="AttrGroupController"></a>AttrGroupController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attrgroup&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrGroupController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrGroupService attrGroupService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrService attrService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得对应分组Id的属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> attrgroupId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;attrgroupId&#125;/attr/relation&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">attrRelationList</span><span class="params">(<span class="meta">@PathVariable(&quot;attrgroupId&quot;)</span> String attrgroupId)</span> </span>&#123;</span><br><span class="line">        List&lt;AttrEntity&gt; list = attrService.getRelationAttr(attrgroupId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrService-1"><a href="#AttrService-1" class="headerlink" title="AttrService"></a>AttrService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获得对应分组Id的基本属性（规格参数）</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> attrgroupId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;AttrEntity&gt; <span class="title">getRelationAttr</span><span class="params">(String attrgroupId)</span> </span>&#123;</span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; relationList = relationDao.selectList(<span class="keyword">new</span> QueryWrapper&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_group_id&quot;</span>, attrgroupId));</span><br><span class="line">    List&lt;Long&gt; idList = relationList.stream().map((relationEntity) -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> relationEntity.getAttrId();</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    Collection&lt;AttrEntity&gt; attrEntities = <span class="keyword">this</span>.listByIds(idList);</span><br><span class="line">    <span class="keyword">return</span> (List&lt;AttrEntity&gt;) attrEntities;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除关联"><a href="#删除关联" class="headerlink" title="删除关联"></a>删除关联</h3><h4 id="AttrGroupRelationVo"><a href="#AttrGroupRelationVo" class="headerlink" title="AttrGroupRelationVo"></a>AttrGroupRelationVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrGroupRelationVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long attrId;</span><br><span class="line">    <span class="keyword">private</span> Long attrGroupId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrGroupController-1"><a href="#AttrGroupController-1" class="headerlink" title="AttrGroupController"></a>AttrGroupController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除关联</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/attr/relation/delete&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">deleteRelation</span><span class="params">(AttrGroupRelationVo[] vos)</span> </span>&#123;</span><br><span class="line">    attrService.deleteRelation(vos);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrGroupService"><a href="#AttrGroupService" class="headerlink" title="AttrGroupService"></a>AttrGroupService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除关联</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> vos</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteRelation</span><span class="params">(AttrGroupRelationVo[] vos)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// relationDao.delete(new QueryWrapper&lt;&gt;().eq(&quot;attr_id&quot;, attrId).eq(&quot;attr_group_id&quot;, groupId))</span></span><br><span class="line">    <span class="comment">// Vos-&gt;relation对象集合</span></span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; collect = Arrays.asList(vos).stream().map((vo) -&gt; &#123;</span><br><span class="line">        AttrAttrgroupRelationEntity relationEntity = <span class="keyword">new</span> AttrAttrgroupRelationEntity();</span><br><span class="line">        BeanUtils.copyProperties(vo, relationEntity);</span><br><span class="line">        <span class="keyword">return</span> relationEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    relationDao.deleteBatchRelation(collect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrAttrGroupRelationDao"><a href="#AttrAttrGroupRelationDao" class="headerlink" title="AttrAttrGroupRelationDao"></a>AttrAttrGroupRelationDao</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AttrAttrgroupRelationDao</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">AttrAttrgroupRelationEntity</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteBatchRelation</span><span class="params">(<span class="meta">@Param(&quot;entities&quot;)</span> List&lt;AttrAttrgroupRelationEntity&gt; entities)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBatchRelation&quot;</span>&gt;</span></span><br><span class="line">    DELETE</span><br><span class="line">    FROM gulimall_pms.pms_attr_attrgroup_relation</span><br><span class="line">    WHERE</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;entities&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot; OR &quot;</span>&gt;</span></span><br><span class="line">        (attr_id = #&#123;item.attrId&#125; AND attr_group_id = #&#123;item.attrGroupId&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="查询未关联属性"><a href="#查询未关联属性" class="headerlink" title="查询未关联属性"></a>查询未关联属性</h3><h4 id="AttrGroupController-2"><a href="#AttrGroupController-2" class="headerlink" title="AttrGroupController"></a>AttrGroupController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获得对应分组Id没有关联的属性</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> attrgroupId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;attrgroupId&#125;/noattr/relation&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">attrNoRelationList</span><span class="params">(<span class="meta">@PathVariable(&quot;attrgroupId&quot;)</span> String attrgroupId, <span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">    PageUtils pageUtils = attrService.getNoRelationAttr(params, attrgroupId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, pageUtils);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrService-2"><a href="#AttrService-2" class="headerlink" title="AttrService"></a>AttrService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获得对应分组Id没有关联的属性</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> attrgroupId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageUtils <span class="title">getNoRelationAttr</span><span class="params">(Map&lt;String, Object&gt; params, String attrgroupId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 当前分组只能关联自己所属分类里面的属性</span></span><br><span class="line">    AttrGroupEntity attrGroupEntity = attrGroupDao.selectById(attrgroupId);</span><br><span class="line">    Long catelogId = attrGroupEntity.getCatelogId();</span><br><span class="line">    <span class="comment">// 当前分组只能关联没有被别的分组引用的属性</span></span><br><span class="line">    <span class="comment">// 获得当前分类下的其他分组</span></span><br><span class="line">    List&lt;AttrGroupEntity&gt; groupEntities = attrGroupDao.selectList(<span class="keyword">new</span> QueryWrapper&lt;AttrGroupEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId).ne(<span class="string">&quot;attr_group_id&quot;</span>, attrgroupId));</span><br><span class="line">    List&lt;Long&gt; groupIdList = groupEntities.stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> item.getAttrGroupId();</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 获得其他分组中对应的属性id</span></span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; relationEntities = relationDao.selectList(<span class="keyword">new</span> QueryWrapper&lt;AttrAttrgroupRelationEntity&gt;().in(<span class="string">&quot;attr_group_id&quot;</span>, groupIdList));</span><br><span class="line">    List&lt;Long&gt; attrIdList = relationEntities.stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> item.getAttrId();</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 从当前分类的所有属性中取出上述属性</span></span><br><span class="line">    QueryWrapper&lt;AttrEntity&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;AttrEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId).notIn(<span class="string">&quot;attr_id&quot;</span>, attrIdList);</span><br><span class="line">    <span class="comment">// 模糊查询判断</span></span><br><span class="line">    String key = (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        queryWrapper.and((wrapper) -&gt; &#123;</span><br><span class="line">            wrapper.eq(<span class="string">&quot;attr_id&quot;</span>, key).or().like(<span class="string">&quot;attr_name&quot;</span>, key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    IPage&lt;AttrEntity&gt; iPage = <span class="keyword">this</span>.page(<span class="keyword">new</span> Query&lt;AttrEntity&gt;().getPage(params), queryWrapper);</span><br><span class="line">    PageUtils pageUtils = <span class="keyword">new</span> PageUtils(iPage);</span><br><span class="line">    <span class="keyword">return</span> pageUtils;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>TODO：这里有个很奇怪的地方，我修改一下关联的话，属性中的所属分组也会改变？</p>
<p>哦我傻了，这俩个就是对应的功能</p>
</blockquote>
<h3 id="添加关联"><a href="#添加关联" class="headerlink" title="添加关联"></a>添加关联</h3><h4 id="AttrGroupController-3"><a href="#AttrGroupController-3" class="headerlink" title="AttrGroupController"></a>AttrGroupController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新建关联</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> vos</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/attr/relation&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">addRelation</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;AttrGroupRelationVo&gt; vos)</span> </span>&#123;</span><br><span class="line">    relationService.saveBatch(vos);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrGroupService-1"><a href="#AttrGroupService-1" class="headerlink" title="AttrGroupService"></a>AttrGroupService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 批量保存</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> vos</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveBatch</span><span class="params">(List&lt;AttrGroupRelationVo&gt; vos)</span> </span>&#123;</span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; relationEntityList = vos.stream().map((vo) -&gt; &#123;</span><br><span class="line">        AttrAttrgroupRelationEntity relationEntity = <span class="keyword">new</span> AttrAttrgroupRelationEntity();</span><br><span class="line">        BeanUtils.copyProperties(vo, relationEntity);</span><br><span class="line">        <span class="keyword">return</span> relationEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">this</span>.saveBatch(relationEntityList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="商品维护—发布商品（后端）"><a href="#商品维护—发布商品（后端）" class="headerlink" title="商品维护—发布商品（后端）"></a>商品维护—发布商品（后端）</h2><h3 id="获取用户等级"><a href="#获取用户等级" class="headerlink" title="获取用户等级"></a>获取用户等级</h3><h4 id="配置网关application-yml"><a href="#配置网关application-yml" class="headerlink" title="配置网关application.yml"></a>配置网关application.yml</h4><blockquote>
<p>详见文档，需要member模块中的功能，之前还没有配过该模块的网关配置，配置一下即可</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="comment"># member会员配置</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">member_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://gulimall-member</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/member/**</span></span><br><span class="line">          <span class="comment"># 实现转发</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="页面模板"><a href="#页面模板" class="headerlink" title="页面模板"></a>页面模板</h4><blockquote>
<p>原本renren-generator生成的时候就有了，直接复制到前端src文件夹下即可</p>
</blockquote>
<blockquote>
<p>然后就好了，基本的增删改查</p>
</blockquote>
<h3 id="获得分类关联的品牌"><a href="#获得分类关联的品牌" class="headerlink" title="获得分类关联的品牌"></a>获得分类关联的品牌</h3><h4 id="BrandVo"><a href="#BrandVo" class="headerlink" title="BrandVo"></a>BrandVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line">    <span class="keyword">private</span> String brandName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="CategoryBrandRelationController"><a href="#CategoryBrandRelationController" class="headerlink" title="CategoryBrandRelationController"></a>CategoryBrandRelationController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/categorybrandrelation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryBrandRelationController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryBrandRelationService relationService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取分类关联的所有品牌列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/brand/list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">relationListByBrand</span><span class="params">(<span class="meta">@RequestParam(&quot;catId&quot;)</span> Long catId)</span> </span>&#123;</span><br><span class="line">        List&lt;BrandEntity&gt; brandEntities = relationService.getBrandsByCatId(catId);</span><br><span class="line">        <span class="comment">// 先获得brandEntity，在转换成Vo</span></span><br><span class="line">        List&lt;BrandVo&gt; list = brandEntities.stream().map((item) -&gt; &#123;</span><br><span class="line">            BrandVo brandVo = <span class="keyword">new</span> BrandVo();</span><br><span class="line">            <span class="comment">// 这里属性名没有对应，所以需要手动设置</span></span><br><span class="line">            brandVo.setBrandId(item.getBrandId());</span><br><span class="line">            brandVo.setBrandName(item.getName());</span><br><span class="line">            <span class="keyword">return</span> brandVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>为什么这里不直接使用relation对象的原因是，为了重用，如果后面还有业务需要获得更多的brand信息，需要用到brandEntity</p>
</blockquote>
<h4 id="CategoryBrandRelationServiceImpl"><a href="#CategoryBrandRelationServiceImpl" class="headerlink" title="CategoryBrandRelationServiceImpl"></a>CategoryBrandRelationServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据catId查询关联的所有品牌的所有信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> catId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;BrandEntity&gt; <span class="title">getBrandsByCatId</span><span class="params">(Long catId)</span> </span>&#123;</span><br><span class="line">    List&lt;CategoryBrandRelationEntity&gt; relationList = baseMapper.selectList(<span class="keyword">new</span> QueryWrapper&lt;CategoryBrandRelationEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catId));</span><br><span class="line">    List&lt;BrandEntity&gt; collect = relationList.stream().map(relationEntity -&gt; &#123;</span><br><span class="line">        Long brandId = relationEntity.getBrandId();</span><br><span class="line">        <span class="keyword">return</span> brandService.getById(brandId);</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> collect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取分类关联的分组和属性"><a href="#获取分类关联的分组和属性" class="headerlink" title="获取分类关联的分组和属性"></a>获取分类关联的分组和属性</h3><blockquote>
<ol>
<li>分类：手机手表……</li>
<li>分组：主体，基本信息，其他信息</li>
<li>属性：尺寸，颜色</li>
</ol>
<p>属性从属于分组，分组从属于分类（多对一），分类和品牌多对多</p>
</blockquote>
<h4 id="AttrGroupWithAttrsVo"><a href="#AttrGroupWithAttrsVo" class="headerlink" title="AttrGroupWithAttrsVo"></a>AttrGroupWithAttrsVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrGroupWithAttrsVo</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分组id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long attrGroupId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String attrGroupName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 描述</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String descript;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组图标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String icon;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 所属分类id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long catelogId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该分组下的所有属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;AttrEntity&gt; attrs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrGroupController-4"><a href="#AttrGroupController-4" class="headerlink" title="AttrGroupController"></a>AttrGroupController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrGroupController</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得对应分类Id关联的分组和属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;catelogId&#125;/withattr&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getAttrGroupWithAttr</span><span class="params">(<span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId, <span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 查出分组</span></span><br><span class="line">        <span class="comment">// 查出属性</span></span><br><span class="line">        List&lt;AttrGroupWithAttrsVo&gt; list = attrGroupService.getWithAttrByCatelogId(catelogId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, list);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="AttrGroupService-2"><a href="#AttrGroupService-2" class="headerlink" title="AttrGroupService"></a>AttrGroupService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获得对应分类Id关联的分组和属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;AttrGroupWithAttrsVo&gt; <span class="title">getWithAttrByCatelogId</span><span class="params">(Long catelogId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查询分组</span></span><br><span class="line">    List&lt;AttrGroupEntity&gt; attrGroupList = <span class="keyword">this</span>.list(<span class="keyword">new</span> QueryWrapper&lt;AttrGroupEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId));</span><br><span class="line">    List&lt;AttrGroupWithAttrsVo&gt; collect = attrGroupList.stream().map(attrGroupEntity -&gt; &#123;</span><br><span class="line">        AttrGroupWithAttrsVo attrGroupWithAttrsVo = <span class="keyword">new</span> AttrGroupWithAttrsVo();</span><br><span class="line">        BeanUtils.copyProperties(attrGroupEntity, attrGroupWithAttrsVo);</span><br><span class="line">        <span class="comment">// 查询所有属性</span></span><br><span class="line">        List&lt;AttrEntity&gt; attrList = attrService.getRelationAttr(attrGroupEntity.getAttrGroupId());</span><br><span class="line">        attrGroupWithAttrsVo.setAttrs(attrList);</span><br><span class="line">        <span class="keyword">return</span> attrGroupWithAttrsVo;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> collect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增商品"><a href="#新增商品" class="headerlink" title="新增商品"></a>新增商品</h3><h4 id="Vo"><a href="#Vo" class="headerlink" title="Vo"></a>Vo</h4><blockquote>
<p>准备一个Vo接收JSON数据，使用BEJSON网站下的转java实体类工具，然后下载即可</p>
<p>真不戳！</p>
</blockquote>
<h4 id="SpuInfoController"><a href="#SpuInfoController" class="headerlink" title="SpuInfoController"></a>SpuInfoController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/spuinfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuInfoController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SpuInfoService spuInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:spuinfo:save&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(<span class="meta">@RequestBody</span> SpuSaveVo spuSaveVo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// spuInfoService.save(spuInfo);</span></span><br><span class="line">        spuInfoService.saveSpuVo(spuSaveVo);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="远程服务"><a href="#远程服务" class="headerlink" title="远程服务"></a>远程服务</h4><blockquote>
<p>因为涉及到coupon模块，需要远程调用</p>
<ol>
<li><p>开启服务</p>
<p>@EnableDiscoveryClient    // 被调用服务application上，开启nacos注册<br>@EnableFeignClients(basePackages = “com.atguigu.gulimall.product.feign”)     //feign</p>
</li>
<li><p>TO : 由于两个服务之间需要公用一种对象，使用TO传输对象，可以写在common公共模块中</p>
</li>
<li><p>编写接口</p>
</li>
</ol>
</blockquote>
<h4 id="远程服务接口"><a href="#远程服务接口" class="headerlink" title="远程服务接口"></a>远程服务接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;gulimall-coupon&quot;)</span>    <span class="comment">// 声明调用的服务</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CouponFeignService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1 先将远程电调用服务方法的对象转为JSON</span></span><br><span class="line"><span class="comment">     * 2 请求coupon服务中的save请求，JSON存放在请求体中</span></span><br><span class="line"><span class="comment">     * 3 收到请求，将请求体中的JSON转为请求方法的参数</span></span><br><span class="line"><span class="comment">     * （<span class="doctag">@ResponseBody</span>方JSON和对象能够互相转换）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/coupon/spubounds/save&quot;)</span></span><br><span class="line">    <span class="function">R <span class="title">saveSpuBound</span><span class="params">(<span class="meta">@RequestBody</span> SpuBoundTo spuBoundTo)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SpuInfoServiceImpl"><a href="#SpuInfoServiceImpl" class="headerlink" title="SpuInfoServiceImpl"></a>SpuInfoServiceImpl</h4><blockquote>
<p>因为这个商品Vo涉及表众多，还有关联到远程调用，所以代码量较长。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;spuInfoService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuInfoServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SpuInfoDao</span>, <span class="title">SpuInfoEntity</span>&gt; <span class="keyword">implements</span> <span class="title">SpuInfoService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SpuInfoDescService spuInfoDescService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SpuImagesService spuImagesService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductAttrValueService productAttrValueService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AttrService attrService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SkuInfoService skuInfoService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SkuImagesService skuImagesService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SkuSaleAttrValueService skuSaleAttrValueService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CouponFeignService couponFeignService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存saveSpuVoInfo，前端接收的一个对象，涉及多个表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spuSaveVo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSpuVoInfo</span><span class="params">(SpuSaveVo spuSaveVo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 保存spu info: spu_info</span></span><br><span class="line">        SpuInfoEntity spuInfoEntity = <span class="keyword">new</span> SpuInfoEntity();</span><br><span class="line">        BeanUtils.copyProperties(spuSaveVo, spuInfoEntity);</span><br><span class="line">        spuInfoEntity.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        spuInfoEntity.setUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">this</span>.save(spuInfoEntity);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存spu info_desc: spu_info_desc</span></span><br><span class="line">        List&lt;String&gt; decrypts = spuSaveVo.getDecript();</span><br><span class="line">        SpuInfoDescEntity spuInfoDescEntity = <span class="keyword">new</span> SpuInfoDescEntity();</span><br><span class="line">        spuInfoDescEntity.setSpuId(spuInfoEntity.getId()); <span class="comment">// 保存之后会将id自动封装到infoEntity</span></span><br><span class="line">        spuInfoDescEntity.setDecript(String.join(<span class="string">&quot;,&quot;</span>, decrypts));   <span class="comment">// 使用，拼接</span></span><br><span class="line">        spuInfoDescService.save(spuInfoDescEntity);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存spu images: spu_images</span></span><br><span class="line">        List&lt;String&gt; images = spuSaveVo.getImages();</span><br><span class="line">        List&lt;SpuImagesEntity&gt; spuImagesList = images.stream().map(image -&gt; &#123;</span><br><span class="line">            SpuImagesEntity spuImagesEntity = <span class="keyword">new</span> SpuImagesEntity();</span><br><span class="line">            spuImagesEntity.setSpuId(spuInfoEntity.getId());</span><br><span class="line">            spuImagesEntity.setImgUrl(image);</span><br><span class="line">            <span class="keyword">return</span> spuImagesEntity;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        spuImagesService.saveBatch(spuImagesList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存spu product_attr_value: product_attr_valu</span></span><br><span class="line">        List&lt;BaseAttrs&gt; baseAttrs = spuSaveVo.getBaseAttrs();</span><br><span class="line">        List&lt;ProductAttrValueEntity&gt; collect = baseAttrs.stream().map(attr -&gt; &#123;</span><br><span class="line">            ProductAttrValueEntity attrValueEntity = <span class="keyword">new</span> ProductAttrValueEntity();</span><br><span class="line">            attrValueEntity.setAttrId(attr.getAttrId());</span><br><span class="line">            attrValueEntity.setSpuId(spuInfoEntity.getId());</span><br><span class="line">            attrValueEntity.setAttrName(attrService.getById(attr.getAttrId()).getAttrName());</span><br><span class="line">            attrValueEntity.setAttrValue(attr.getAttrValues());</span><br><span class="line">            attrValueEntity.setQuickShow(attr.getShowDesc());</span><br><span class="line">            <span class="keyword">return</span> attrValueEntity;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        productAttrValueService.saveBatch(collect);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存spu 积分信息: sms_spu_bounds</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存sku对应sku_info: sku_info、sku_images、sku_sale_attr_value、sms_sku_ladder、sms_sku_full_reduction、sms_member_price</span></span><br><span class="line">        List&lt;Skus&gt; skus = spuSaveVo.getSkus();</span><br><span class="line">        <span class="keyword">if</span> (skus != <span class="keyword">null</span> &amp;&amp; skus.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            skus.forEach(sku -&gt; &#123;</span><br><span class="line">                <span class="comment">// 1 保存基本信息</span></span><br><span class="line">                SkuInfoEntity skuInfoEntity = <span class="keyword">new</span> SkuInfoEntity();</span><br><span class="line">                BeanUtils.copyProperties(sku, skuInfoEntity);</span><br><span class="line">                skuInfoEntity.setBrandId(spuInfoEntity.getBrandId());</span><br><span class="line">                skuInfoEntity.setCatalogId(spuInfoEntity.getCatalogId());</span><br><span class="line">                skuInfoEntity.setSaleCount(<span class="number">0L</span>);</span><br><span class="line">                skuInfoEntity.setSpuId(spuInfoEntity.getId());</span><br><span class="line">                String defaultImg = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                <span class="keyword">for</span> (Images img : sku.getImages()) &#123;   <span class="comment">// 这里用for而不是foreach，注意看报错的原因，lamda表达式中的变量要final</span></span><br><span class="line">                    <span class="keyword">if</span> (img.getDefaultImg() == <span class="number">1</span>) &#123;</span><br><span class="line">                        defaultImg = img.getImgUrl();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                skuInfoEntity.setSkuDefaultImg(defaultImg);</span><br><span class="line">                skuInfoService.save(skuInfoEntity);</span><br><span class="line">                Long skuId = skuInfoEntity.getSkuId();  <span class="comment">// 必须是保存完之后才能获得</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 2 保存图片</span></span><br><span class="line">                List&lt;SkuImagesEntity&gt; skuImagesList = sku.getImages().stream().map(img -&gt; &#123;</span><br><span class="line">                    SkuImagesEntity skuImagesEntity = <span class="keyword">new</span> SkuImagesEntity();</span><br><span class="line">                    skuImagesEntity.setSkuId(skuId);</span><br><span class="line">                    skuImagesEntity.setImgUrl(img.getImgUrl());</span><br><span class="line">                    skuImagesEntity.setDefaultImg(img.getDefaultImg());</span><br><span class="line">                    <span class="keyword">return</span> skuImagesEntity;</span><br><span class="line">                &#125;).collect(Collectors.toList());</span><br><span class="line">                skuImagesService.saveBatch(skuImagesList);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 3 保存属性</span></span><br><span class="line">                List&lt;Attr&gt; attrList = sku.getAttr();</span><br><span class="line">                List&lt;SkuSaleAttrValueEntity&gt; skuSaleAttrValueList = attrList.stream().map(attr -&gt; &#123;</span><br><span class="line">                    SkuSaleAttrValueEntity skuSaleAttrValueEntity = <span class="keyword">new</span> SkuSaleAttrValueEntity();</span><br><span class="line">                    BeanUtils.copyProperties(attr, skuSaleAttrValueEntity);</span><br><span class="line">                    skuSaleAttrValueEntity.setSkuId(skuId);</span><br><span class="line">                    <span class="keyword">return</span> skuSaleAttrValueEntity;</span><br><span class="line">                &#125;).collect(Collectors.toList());</span><br><span class="line">                skuSaleAttrValueService.saveBatch(skuSaleAttrValueList);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 以下需要远程服务</span></span><br><span class="line">                <span class="comment">// 4 保存优惠</span></span><br><span class="line">                Bounds bounds = spuSaveVo.getBounds();</span><br><span class="line">                SpuBoundTo spuBoundTo = <span class="keyword">new</span> SpuBoundTo();</span><br><span class="line">                BeanUtils.copyProperties(bounds, spuBoundTo);</span><br><span class="line">                spuBoundTo.setSpuId(spuInfoEntity.getId());</span><br><span class="line">                R saveSpuBound = couponFeignService.saveSpuBound(spuBoundTo);</span><br><span class="line">                <span class="keyword">if</span> (saveSpuBound.getCode() != <span class="number">0</span>) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;远程保存spu积分信息失败&quot;</span>);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 5 保存满减</span></span><br><span class="line">                SkuReductionTo skuReductionTo = <span class="keyword">new</span> SkuReductionTo();</span><br><span class="line">                BeanUtils.copyProperties(sku, skuReductionTo);</span><br><span class="line">                skuReductionTo.setSkuId(skuId);</span><br><span class="line">                R saveSkuReduction = couponFeignService.saveSkuReduction(skuReductionTo);</span><br><span class="line">                <span class="keyword">if</span> (saveSkuReduction.getCode() != <span class="number">0</span>) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;远程保存spu积满减信息失败&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SkuFullReductionServiceImpl"><a href="#SkuFullReductionServiceImpl" class="headerlink" title="SkuFullReductionServiceImpl"></a>SkuFullReductionServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;skuFullReductionService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkuFullReductionServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SkuFullReductionDao</span>, <span class="title">SkuFullReductionEntity</span>&gt; <span class="keyword">implements</span> <span class="title">SkuFullReductionService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SkuLadderService skuLadderService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MemberPriceService memberPriceService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSkuReduction</span><span class="params">(SkuReductionTo skuReductionTo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 保存ladder</span></span><br><span class="line">        SkuLadderEntity skuLadderEntity = <span class="keyword">new</span> SkuLadderEntity();</span><br><span class="line">        skuLadderEntity.setSkuId(skuReductionTo.getSkuId());</span><br><span class="line">        skuLadderEntity.setFullCount(skuReductionTo.getFullCount());</span><br><span class="line">        skuLadderEntity.setDiscount(skuReductionTo.getDiscount());</span><br><span class="line">        skuLadderEntity.setAddOther(skuReductionTo.getCountStatus());</span><br><span class="line">        skuLadderService.save(skuLadderEntity);</span><br><span class="line">        <span class="comment">// 保存满减</span></span><br><span class="line">        SkuFullReductionEntity skuFullReductionEntity = <span class="keyword">new</span> SkuFullReductionEntity();</span><br><span class="line">        BeanUtils.copyProperties(skuReductionTo, skuFullReductionEntity);</span><br><span class="line">        <span class="keyword">this</span>.save(skuFullReductionEntity);</span><br><span class="line">        <span class="comment">// 保存会员价格</span></span><br><span class="line">        List&lt;MemberPriceTo&gt; memberPriceToList = skuReductionTo.getMemberPrice();</span><br><span class="line">        List&lt;MemberPriceEntity&gt; memberPriceList = memberPriceToList.stream().map(memberPriceTo -&gt; &#123;</span><br><span class="line">            MemberPriceEntity memberPriceEntity = <span class="keyword">new</span> MemberPriceEntity();</span><br><span class="line">            memberPriceEntity.setSkuId(skuReductionTo.getSkuId());</span><br><span class="line">            memberPriceEntity.setMemberLevelId(memberPriceTo.getId());</span><br><span class="line">            memberPriceEntity.setMemberLevelName(memberPriceTo.getName());</span><br><span class="line">            memberPriceEntity.setMemberPrice(memberPriceTo.getPrice());</span><br><span class="line">            memberPriceEntity.setAddOther(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> memberPriceEntity;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        memberPriceService.saveBatch(memberPriceList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="debug-amp-test"><a href="#debug-amp-test" class="headerlink" title="debug &amp; test"></a>debug &amp; test</h4><blockquote>
<p>妈耶一次成功有点开心</p>
<p>TODO: 失败的情况没有编写</p>
</blockquote>
<h2 id="商品维护—SPU管理（后端）"><a href="#商品维护—SPU管理（后端）" class="headerlink" title="商品维护—SPU管理（后端）"></a>商品维护—SPU管理（后端）</h2><h3 id="时间戳格式化"><a href="#时间戳格式化" class="headerlink" title="时间戳格式化"></a>时间戳格式化</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="comment">#    时间戳格式化</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure>

<h3 id="SPU待条件检索"><a href="#SPU待条件检索" class="headerlink" title="SPU待条件检索"></a>SPU待条件检索</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="comment">//@RequiresPermissions(&quot;product:spuinfo:list&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">list</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">    PageUtils page = spuInfoService.queryPageByCondition(params); </span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *待条件查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryPageByCondition</span><span class="params">(Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;SpuInfoEntity&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    String key = (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        wrapper.and((w) -&gt; &#123;</span><br><span class="line">            w.eq(<span class="string">&quot;id&quot;</span>, key).or().like(<span class="string">&quot;spu_name&quot;</span>, key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    String status = (String) params.get(<span class="string">&quot;status&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(status)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;publish_status&quot;</span>, status);</span><br><span class="line">    &#125;</span><br><span class="line">    String brandId = (String) params.get(<span class="string">&quot;brandId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(brandId)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;brand_id&quot;</span>, brandId);</span><br><span class="line">    &#125;</span><br><span class="line">    String catelogId = (String) params.get(<span class="string">&quot;catelogId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(catelogId)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;catalog_id&quot;</span>, catelogId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IPage&lt;SpuInfoEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> Query&lt;SpuInfoEntity&gt;().getPage(params),</span><br><span class="line">            wrapper</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SKU检索"><a href="#SKU检索" class="headerlink" title="SKU检索"></a>SKU检索</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/skuinfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkuInfoController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SkuInfoService skuInfoService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:skuinfo:list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">list</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">        PageUtils page = skuInfoService.queryPageByCondition(params);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryPageByCondition</span><span class="params">(Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;SkuInfoEntity&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    String key = (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        wrapper.and((w) -&gt; &#123;</span><br><span class="line">            w.eq(<span class="string">&quot;sku_id&quot;</span>, key).or().like(<span class="string">&quot;sku_name&quot;</span>, key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    String brandId = (String) params.get(<span class="string">&quot;brandId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(brandId)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;brand_id&quot;</span>, brandId);</span><br><span class="line">    &#125;</span><br><span class="line">    String catelogId = (String) params.get(<span class="string">&quot;catelogId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(catelogId)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;catalog_id&quot;</span>, catelogId);</span><br><span class="line">    &#125;</span><br><span class="line">    String min = (String) params.get(<span class="string">&quot;min&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(min)) &#123;</span><br><span class="line">        wrapper.ge(<span class="string">&quot;price&quot;</span>, min);</span><br><span class="line">    &#125;</span><br><span class="line">    String max = (String) params.get(<span class="string">&quot;max&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(max)) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            BigDecimal bigDecimal = <span class="keyword">new</span> BigDecimal(max);</span><br><span class="line">            <span class="keyword">if</span> (bigDecimal.compareTo(<span class="keyword">new</span> BigDecimal(<span class="number">0</span>)) == <span class="number">1</span>) &#123;</span><br><span class="line">                wrapper.le(<span class="string">&quot;price&quot;</span>, max);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IPage&lt;SkuInfoEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> Query&lt;SkuInfoEntity&gt;().getPage(params),</span><br><span class="line">            wrapper</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="库存系统—仓库维护（后端）"><a href="#库存系统—仓库维护（后端）" class="headerlink" title="库存系统—仓库维护（后端）"></a>库存系统—仓库维护（后端）</h2><blockquote>
<p>仓库相关表：gulimall_wms_xxx</p>
<p>服务：ware</p>
</blockquote>
<h3 id="服务基础搭建"><a href="#服务基础搭建" class="headerlink" title="服务基础搭建"></a>服务基础搭建</h3><blockquote>
<ol>
<li><p>application.yml中配置nacos、application name</p>
</li>
<li><p>注解开启nacos（@EnableDiscoveryClient）（com.alibaba.nacos.api.exception.NacosException: java.lang.reflect.InvocationTargetException这个报错是因为没有配置bootstrap）</p>
</li>
<li><p>配置日志</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用于输出日志</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.atguigu:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置网关</p>
</li>
<li><p>配置mybatis分页插件</p>
</li>
</ol>
</blockquote>
<h3 id="获得仓库列表带条件"><a href="#获得仓库列表带条件" class="headerlink" title="获得仓库列表带条件"></a>获得仓库列表带条件</h3><blockquote>
<p>修改一下原来的queryPage即可，添加上condition</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模糊查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryPageByCondition</span><span class="params">(Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;WareInfoEntity&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    String key = (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        <span class="comment">// and拼接，因为可能id为0所以已经含有了一个eq条件</span></span><br><span class="line">        wrapper.eq(<span class="string">&quot;id&quot;</span>, key).or().like(<span class="string">&quot;name&quot;</span>, key).or().like(<span class="string">&quot;address&quot;</span>, key);</span><br><span class="line">    &#125;</span><br><span class="line">    IPage&lt;WareInfoEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> Query&lt;WareInfoEntity&gt;().getPage(params),</span><br><span class="line">            wrapper</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="库存系统—商品库存（后端）"><a href="#库存系统—商品库存（后端）" class="headerlink" title="库存系统—商品库存（后端）"></a>库存系统—商品库存（后端）</h2><h3 id="获得库存列表带条件"><a href="#获得库存列表带条件" class="headerlink" title="获得库存列表带条件"></a>获得库存列表带条件</h3><blockquote>
<p>同样</p>
</blockquote>
<h2 id="库存系统—采购需求（后端）"><a href="#库存系统—采购需求（后端）" class="headerlink" title="库存系统—采购需求（后端）"></a>库存系统—采购需求（后端）</h2><h3 id="获得需求列表带条件"><a href="#获得需求列表带条件" class="headerlink" title="获得需求列表带条件"></a>获得需求列表带条件</h3><blockquote>
<p>同样</p>
</blockquote>
<h3 id="获得未领取的采购单列表"><a href="#获得未领取的采购单列表" class="headerlink" title="获得未领取的采购单列表"></a>获得未领取的采购单列表</h3><blockquote>
<p>将多个采购需求合并到一个采购单当中（并且该采购单未被领取）</p>
</blockquote>
<h4 id="PurchaseController"><a href="#PurchaseController" class="headerlink" title="PurchaseController"></a>PurchaseController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;ware/purchase&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PurchaseService purchaseService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有未被领取（或新建）的采购单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/unreceive/list&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;ware:purchase:list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">unreceiveList</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">        PageUtils page = purchaseService.queryPageUnreceive(params);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="PurchaseServiceImpl"><a href="#PurchaseServiceImpl" class="headerlink" title="PurchaseServiceImpl"></a>PurchaseServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;purchaseService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">PurchaseDao</span>, <span class="title">PurchaseEntity</span>&gt; <span class="keyword">implements</span> <span class="title">PurchaseService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有未被领取（或新建）的采购单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryPageUnreceive</span><span class="params">(Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">        QueryWrapper&lt;PurchaseEntity&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;status&quot;</span>, <span class="number">0</span>).or().eq(<span class="string">&quot;status&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        IPage&lt;PurchaseEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">                <span class="keyword">new</span> Query&lt;PurchaseEntity&gt;().getPage(params),</span><br><span class="line">                queryWrapper</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="合并采购单"><a href="#合并采购单" class="headerlink" title="合并采购单"></a>合并采购单</h3><blockquote>
<p>如果前端没有传递采购单的id那么就新建一个采购单</p>
</blockquote>
<h4 id="WareConstant"><a href="#WareConstant" class="headerlink" title="WareConstant"></a>WareConstant</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WareConstant</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">PurchaseStatusEnum</span> </span>&#123;</span><br><span class="line">        CREATED(<span class="number">0</span>, <span class="string">&quot;新建&quot;</span>), ASSIGN(<span class="number">1</span>, <span class="string">&quot;已分配&quot;</span>), RECEIVE(<span class="number">2</span>, <span class="string">&quot;已领取&quot;</span>), FINISHED(<span class="number">3</span>, <span class="string">&quot;已完成&quot;</span>), HASERROR(<span class="number">4</span>, <span class="string">&quot;异常&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String msg;</span><br><span class="line">        PurchaseStatusEnum(<span class="keyword">int</span> code, String msg) &#123;</span><br><span class="line">            <span class="keyword">this</span>.code = code;</span><br><span class="line">            <span class="keyword">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">PurchaseDetailStatusEnum</span> </span>&#123;</span><br><span class="line">        CREATED(<span class="number">0</span>, <span class="string">&quot;新建&quot;</span>), ASSIGN(<span class="number">1</span>, <span class="string">&quot;已分配&quot;</span>), BUYYING(<span class="number">2</span>, <span class="string">&quot;正在采购&quot;</span>), FINISHED(<span class="number">3</span>, <span class="string">&quot;已完成&quot;</span>), HASERROR(<span class="number">4</span>, <span class="string">&quot;异常&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">        PurchaseDetailStatusEnum(<span class="keyword">int</span> code, String msg) &#123;</span><br><span class="line">            <span class="keyword">this</span>.code = code;</span><br><span class="line">            <span class="keyword">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="MergeVo"><a href="#MergeVo" class="headerlink" title="MergeVo"></a>MergeVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 合并采购单请求对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MergeVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long purchaseId;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; items;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="PurchaseController-1"><a href="#PurchaseController-1" class="headerlink" title="PurchaseController"></a>PurchaseController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;ware/purchase&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PurchaseService purchaseService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 合并采购单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/merge&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">merge</span><span class="params">(<span class="meta">@RequestBody</span> MergeVo mergeVo)</span> </span>&#123;  <span class="comment">//@RequestBody请求体中的JSON，@RequestParam是url?后跟的键值对，@PathVariable是REST风格url中的&#123;&#125;变量</span></span><br><span class="line">        purchaseService.mergePurchase(mergeVo);</span><br><span class="line">        <span class="keyword">return</span> R.ok()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="PurchaseServiceImpl-1"><a href="#PurchaseServiceImpl-1" class="headerlink" title="PurchaseServiceImpl"></a>PurchaseServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 合并采购单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mergePurchase</span><span class="params">(MergeVo mergeVo)</span> </span>&#123;</span><br><span class="line">    Long purchaseId = mergeVo.getPurchaseId();</span><br><span class="line">    <span class="keyword">if</span> (purchaseId == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 没有采购单id，那么需要新建</span></span><br><span class="line">        PurchaseEntity purchaseEntity = <span class="keyword">new</span> PurchaseEntity();</span><br><span class="line">        purchaseEntity.setStatus(WareConstant.PurchaseStatusEnum.CREATED.getCode());</span><br><span class="line">        <span class="keyword">this</span>.save(purchaseEntity);</span><br><span class="line">        purchaseId = purchaseEntity.getId();</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;Long&gt; items = mergeVo.getItems();</span><br><span class="line">    Long finalPurchaseId = purchaseId;</span><br><span class="line">    <span class="comment">// 将采购需求id集合对应对象修改状态和采购单id</span></span><br><span class="line">    List&lt;PurchaseDetailEntity&gt; detailEntities = items.stream().map(detailId -&gt; &#123;</span><br><span class="line">        PurchaseDetailEntity detailEntity = <span class="keyword">new</span> PurchaseDetailEntity();</span><br><span class="line">        detailEntity.setId(detailId);</span><br><span class="line">        detailEntity.setPurchaseId(finalPurchaseId);</span><br><span class="line">        detailEntity.setStatus(WareConstant.PurchaseDetailStatusEnum.ASSIGN.getCode());</span><br><span class="line">        <span class="keyword">return</span> detailEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    detailService.updateBatchById(detailEntities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="领取采购单"><a href="#领取采购单" class="headerlink" title="领取采购单"></a>领取采购单</h3><h4 id="PurchaseController-2"><a href="#PurchaseController-2" class="headerlink" title="PurchaseController"></a>PurchaseController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;ware/purchase&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PurchaseService purchaseService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 领取采购单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/received&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">received</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;Long&gt; ids)</span> </span>&#123;</span><br><span class="line">        purchaseService.receivedByIds(ids);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="PurchaseServiceImpl-2"><a href="#PurchaseServiceImpl-2" class="headerlink" title="PurchaseServiceImpl"></a>PurchaseServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 领取采购单</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receivedByIds</span><span class="params">(List&lt;Long&gt; ids)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 判断是否为新建或者已分配（给当前用户，但是这里涉及权限）</span></span><br><span class="line">      <span class="comment">// 改变采购单状态</span></span><br><span class="line">      List&lt;PurchaseEntity&gt; purchaseEntityList = ids.stream().map(id -&gt; &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">this</span>.getById(id);</span><br><span class="line">      &#125;).filter(item -&gt; &#123;</span><br><span class="line">          Integer status = item.getStatus();</span><br><span class="line">          <span class="keyword">return</span> (status == WareConstant.PurchaseStatusEnum.ASSIGN.getCode()) || status == WareConstant.PurchaseStatusEnum.CREATED.getCode();</span><br><span class="line">      &#125;).map(purchaseEntity -&gt; &#123;</span><br><span class="line">          purchaseEntity.setStatus(WareConstant.PurchaseStatusEnum.RECEIVE.getCode());</span><br><span class="line">          <span class="keyword">return</span> purchaseEntity;</span><br><span class="line">      &#125;).collect(Collectors.toList());</span><br><span class="line">      <span class="keyword">this</span>.updateBatchById(purchaseEntityList);</span><br><span class="line">      <span class="comment">// 改变采购项状态</span></span><br><span class="line">      purchaseEntityList.forEach(purchaseEntity -&gt; &#123;</span><br><span class="line">          List&lt;PurchaseDetailEntity&gt; detailEntityList = detailService.list(<span class="keyword">new</span> QueryWrapper&lt;PurchaseDetailEntity&gt;().eq(<span class="string">&quot;purchase_id&quot;</span>, purchaseEntity.getId()));</span><br><span class="line">          List&lt;PurchaseDetailEntity&gt; list = detailEntityList.stream().map(detail -&gt; &#123;</span><br><span class="line">              PurchaseDetailEntity detailEntity = <span class="keyword">new</span> PurchaseDetailEntity();</span><br><span class="line">              detailEntity.setId(detail.getId());</span><br><span class="line">              detailEntity.setStatus(WareConstant.PurchaseDetailStatusEnum.ASSIGN.getCode());</span><br><span class="line">              <span class="keyword">return</span> detailEntity;</span><br><span class="line">          &#125;).collect(Collectors.toList());</span><br><span class="line">          detailService.updateBatchById(list);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="完成采购"><a href="#完成采购" class="headerlink" title="完成采购"></a>完成采购</h3><blockquote>
<p>自动修改对应采购内容的库存数</p>
</blockquote>
<h4 id="PurchaseDoneItemVo"><a href="#PurchaseDoneItemVo" class="headerlink" title="PurchaseDoneItemVo"></a>PurchaseDoneItemVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成采购单的请求item</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseDoneItemVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long itemId;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="keyword">private</span> String reason;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="PurchaseFinishedVo"><a href="#PurchaseFinishedVo" class="headerlink" title="PurchaseFinishedVo"></a>PurchaseFinishedVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseFinishedVo</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *采购单id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *采购项</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;PurchaseDoneItemVo&gt; items;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="PurchaseController-3"><a href="#PurchaseController-3" class="headerlink" title="PurchaseController"></a>PurchaseController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;ware/purchase&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PurchaseService purchaseService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 完成采购单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/done&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">finish</span><span class="params">(<span class="meta">@RequestBody</span> PurchaseFinishedVo finishedVo)</span> </span>&#123;</span><br><span class="line">        purchaseService.finishPurchase(finishedVo);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="PurchaseServiceImpl-3"><a href="#PurchaseServiceImpl-3" class="headerlink" title="PurchaseServiceImpl"></a>PurchaseServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成采购单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finishPurchase</span><span class="params">(PurchaseFinishedVo finishedVo)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1 改变采购项状态</span></span><br><span class="line">    <span class="keyword">boolean</span> purchaseFinished = <span class="keyword">true</span>;</span><br><span class="line">    List&lt;PurchaseDetailEntity&gt; updatedDetailList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    List&lt;PurchaseDoneItemVo&gt; doneItemVoList = finishedVo.getItems();</span><br><span class="line">    <span class="keyword">for</span> (PurchaseDoneItemVo doneItemVo : doneItemVoList) &#123;</span><br><span class="line">        PurchaseDetailEntity detailEntity = <span class="keyword">new</span> PurchaseDetailEntity();</span><br><span class="line">        <span class="keyword">if</span> (doneItemVo.getStatus() == WareConstant.PurchaseDetailStatusEnum.HASERROR.getCode()) &#123;</span><br><span class="line">            <span class="comment">// 如果有一个采购项异常，则采购单状态未完成</span></span><br><span class="line">            purchaseFinished = <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 3 将成功采购的采购项修改库存信息</span></span><br><span class="line">            PurchaseDetailEntity detail = detailService.getById(doneItemVo.getItemId());</span><br><span class="line">            wareSkuService.addStock(detail.getSkuId(), detail.getWareId(), detail.getSkuNum());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// TODO 判断采购数是否完成</span></span><br><span class="line">        detailEntity.setStatus(doneItemVo.getStatus());</span><br><span class="line">        detailEntity.setId(doneItemVo.getItemId());</span><br><span class="line">        updatedDetailList.add(detailEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    detailService.updateBatchById(updatedDetailList);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2 改变采购单状态(所有采购项都完成后才可完成，否则为异常)</span></span><br><span class="line">    PurchaseEntity purchaseEntity = <span class="keyword">new</span> PurchaseEntity();</span><br><span class="line">    purchaseEntity.setId(finishedVo.getId());</span><br><span class="line">    <span class="keyword">if</span> (purchaseFinished) &#123;</span><br><span class="line">        purchaseEntity.setStatus(WareConstant.PurchaseStatusEnum.FINISHED.getCode());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        purchaseEntity.setStatus(WareConstant.PurchaseStatusEnum.HASERROR.getCode());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.updateById(purchaseEntity);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="WareSkuServiceImpl"><a href="#WareSkuServiceImpl" class="headerlink" title="WareSkuServiceImpl"></a>WareSkuServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *将成功采购的采购项修改库存信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addStock</span><span class="params">(Long skuId, Long wareId, Integer skuNum)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 判断是否有该库存，没有则新增</span></span><br><span class="line">    Integer count = baseMapper.selectCount(<span class="keyword">new</span> QueryWrapper&lt;WareSkuEntity&gt;().eq(<span class="string">&quot;sku_id&quot;</span>, skuId).eq(<span class="string">&quot;ware_id&quot;</span>, wareId));</span><br><span class="line">    <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">        WareSkuEntity wareSkuEntity = <span class="keyword">new</span> WareSkuEntity();</span><br><span class="line">        wareSkuEntity.setSkuId(skuId);</span><br><span class="line">        wareSkuEntity.setWareId(wareId);</span><br><span class="line">        wareSkuEntity.setStock(skuNum);</span><br><span class="line">        baseMapper.insert(wareSkuEntity);</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">        baseMapper.addStock(skuId, wareId, skuNum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="WareSkuDao"><a href="#WareSkuDao" class="headerlink" title="WareSkuDao"></a>WareSkuDao</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 将成功采购的采购项修改库存信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;addStock&quot;</span>&gt;</span></span><br><span class="line">    UPDATE gulimall_wms.wms_ware_sku</span><br><span class="line">    SET stock = stock + #&#123;skuNum&#125;</span><br><span class="line">    WHERE sku_id = #&#123;skuId&#125;</span><br><span class="line">      AND ware_id = #&#123;wareId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="商品维护—SKU规格维护（后端）"><a href="#商品维护—SKU规格维护（后端）" class="headerlink" title="商品维护—SKU规格维护（后端）"></a>商品维护—SKU规格维护（后端）</h2><blockquote>
<p>这是一个按钮触发的页面，具体解决方案如下</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/nio-nio/p/13740598.html">谷粒商城踩坑汇总（分布式基础（全栈开发篇）） - 大厨无盐煮 - 博客园 (cnblogs.com)</a></p>
</blockquote>
<h3 id="获取"><a href="#获取" class="headerlink" title="获取"></a>获取</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrService attrService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductAttrValueService valueService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查出商品的规格属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/base/listforspu/&#123;spuId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">baseAttrListForSpu</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span> Long spuId)</span> </span>&#123;</span><br><span class="line">        List&lt;ProductAttrValueEntity&gt; data = valueService.baseAttrListForSpu(spuId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, data);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;productAttrValueService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductAttrValueServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">ProductAttrValueDao</span>, <span class="title">ProductAttrValueEntity</span>&gt; <span class="keyword">implements</span> <span class="title">ProductAttrValueService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductAttrValueEntity&gt; <span class="title">baseAttrListForSpu</span><span class="params">(Long spuId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> baseMapper.selectList(<span class="keyword">new</span> QueryWrapper&lt;ProductAttrValueEntity&gt;().eq(<span class="string">&quot;spu_id&quot;</span>, spuId));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改-1"><a href="#修改-1" class="headerlink" title="修改"></a>修改</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrController</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改,使用AttrRequestVo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/update/&#123;spuId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">updateSpuAttr</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span> String spuId,</span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="meta">@RequestBody</span> List&lt;ProductAttrValueEntity&gt; entities)</span> </span>&#123;</span><br><span class="line">        valueService.updateSpuAttr(spuId, entities);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改SPU的ATTr</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateSpuAttr</span><span class="params">(Long spuId, List&lt;ProductAttrValueEntity&gt; entities)</span> </span>&#123;</span><br><span class="line">    baseMapper.delete(<span class="keyword">new</span> QueryWrapper&lt;ProductAttrValueEntity&gt;().eq(<span class="string">&quot;spu_id&quot;</span>, spuId));</span><br><span class="line">    List&lt;ProductAttrValueEntity&gt; collect = entities.stream().map(item -&gt; &#123;</span><br><span class="line">        item.setSpuId(spuId);</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">this</span>.saveBatch(collect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分布式基础篇—完结撒花🎉"><a href="#分布式基础篇—完结撒花🎉" class="headerlink" title="分布式基础篇—完结撒花🎉"></a>分布式基础篇—完结撒花🎉</h2><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031153716835.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031153716835.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211031153716835"></p>

  
  
    
    <div class='footer'>
      
      
      
      
    </div>
  
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2022-06-16T19:51:34+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：2022年6月16日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/SpringBoot/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>SpringBoot</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Vue/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>Vue</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E9%A1%B9%E7%9B%AE/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>项目</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/SpringCloud/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>SpringCloud</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/redis/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>redis</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>微服务</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://example.com/2021/10/28/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-3/&title=【项目笔记】商城项目实战3 - Reria's BLOG&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://example.com/2021/10/28/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-3/&title=【项目笔记】商城项目实战3 - Reria's BLOG&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://service.weibo.com/share/share.php?url=http://example.com/2021/10/28/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-3/&title=【项目笔记】商城项目实战3 - Reria's BLOG&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png">
          
        </a>
      
    
      
    
      
    
  </div>
</div>



        
      
    </div>
  </div>


  
  

  
    <div class="prev-next">
      
        <a class='prev' href='/2021/10/31/xue-xi-bi-ji-elasticsearch/'>
          <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>【学习笔记】ElasticSearch</p>
          <p class='content'>ES基础概念
[Elasticsearch Guide 7.15] | Elastic 文档
Elasticsearch 是一个分布式、RESTful 风格的搜索和数据分析引擎，是目前全文搜索引...</p>
        </a>
      
      
        <a class='next' href='/2021/10/16/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-2/'>
          <p class='title'>【项目笔记】商城项目实战2<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'>品牌管理（后台）
商品系统下的品牌管理，数据库表对应product-brand

使用逆向工程

先使用人人快速开发平台，系统管理—&gt;菜单管理—&gt;添加菜单
使用renren-gene...</p>
        </a>
      
    </div>
  
</article>


  

  <article class="post white-box reveal shadow floatable" id="comments">
    <p ct><i class='fas fa-comments'></i> 评论</p>
    
    <div id="valine_container" class="valine_thread">
  <i class="fas fa-cog fa-spin fa-fw fa-2x"></i>
</div>

  </article>






</div>
<aside class='l_side'>
  
  
    
    

<section class="widget page shadow floatable desktop">
  
  <header>
    
      <i class="fas fa-bullhorn fa-fw" aria-hidden="true"></i><span class='name'>公告</span>
    
  </header>


  <div class='content'>
    
      
        <article id="page" class="post article-type-page" itemscope itemprop="blogPost">
          <section class="article typo">
            <div class="article-entry" itemprop="articleBody">
              
                <p>本站默认替换了右键菜单，<br>如需唤醒原系统菜单请使用：<br>        <kbd>ctrl</kbd> + <kbd>右键</kbd></p>

              
            </div>
          </section>
        </article>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  </div>
</section>

  

  
    
    



  <section class="widget toc-wrapper shadow floatable desktop mobile" id="toc-div" >
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Controller%E4%B8%89%E4%B8%AA%E6%B3%A8%E9%87%8A%EF%BC%88%E8%8E%B7%E5%8F%96%E5%80%BC%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">Controller三个注释（获取值）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Object%E5%88%92%E5%88%86"><span class="toc-number">2.</span> <span class="toc-text">Object划分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%86%85%E5%AD%98"><span class="toc-number">3.</span> <span class="toc-text">配置服务内存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B3%E5%8F%B0%E5%B1%9E%E6%80%A7%E2%80%94%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">平台属性—规格参数（后端）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E"><span class="toc-number">4.1.</span> <span class="toc-text">新增</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrRequestVo"><span class="toc-number">4.1.1.</span> <span class="toc-text">AttrRequestVo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrController"><span class="toc-number">4.1.2.</span> <span class="toc-text">AttrController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrServiceImpl"><span class="toc-number">4.1.3.</span> <span class="toc-text">AttrServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%88%86%E9%A1%B5"><span class="toc-number">4.2.</span> <span class="toc-text">查询分页</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrResponseVo"><span class="toc-number">4.2.1.</span> <span class="toc-text">AttrResponseVo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrController-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">AttrController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrServiceImpl-1"><span class="toc-number">4.2.3.</span> <span class="toc-text">AttrServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%9B%9E%E6%98%BE"><span class="toc-number">4.3.</span> <span class="toc-text">查询回显</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrResoponseVo"><span class="toc-number">4.3.1.</span> <span class="toc-text">AttrResoponseVo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrController-2"><span class="toc-number">4.3.2.</span> <span class="toc-text">AttrController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrServiceImpl-2"><span class="toc-number">4.3.3.</span> <span class="toc-text">AttrServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9"><span class="toc-number">4.4.</span> <span class="toc-text">修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrController-3"><span class="toc-number">4.4.1.</span> <span class="toc-text">AttrController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrServiceImpl-3"><span class="toc-number">4.4.2.</span> <span class="toc-text">AttrServiceImpl</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B3%E5%8F%B0%E5%B1%9E%E6%80%A7%E2%80%94%E9%94%80%E5%94%AE%E5%B1%9E%E6%80%A7%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">平台属性—销售属性（后端）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F%E7%B1%BB"><span class="toc-number">5.0.1.</span> <span class="toc-text">常量类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrController-4"><span class="toc-number">5.0.2.</span> <span class="toc-text">AttrController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrService"><span class="toc-number">5.0.3.</span> <span class="toc-text">AttrService</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B3%E5%8F%B0%E5%B1%9E%E6%80%A7%E2%80%94%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">平台属性—属性分组（后端）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%85%B3%E8%81%94"><span class="toc-number">6.1.</span> <span class="toc-text">查询关联</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrGroupController"><span class="toc-number">6.1.1.</span> <span class="toc-text">AttrGroupController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrService-1"><span class="toc-number">6.1.2.</span> <span class="toc-text">AttrService</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%85%B3%E8%81%94"><span class="toc-number">6.2.</span> <span class="toc-text">删除关联</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrGroupRelationVo"><span class="toc-number">6.2.1.</span> <span class="toc-text">AttrGroupRelationVo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrGroupController-1"><span class="toc-number">6.2.2.</span> <span class="toc-text">AttrGroupController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrGroupService"><span class="toc-number">6.2.3.</span> <span class="toc-text">AttrGroupService</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrAttrGroupRelationDao"><span class="toc-number">6.2.4.</span> <span class="toc-text">AttrAttrGroupRelationDao</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%9C%AA%E5%85%B3%E8%81%94%E5%B1%9E%E6%80%A7"><span class="toc-number">6.3.</span> <span class="toc-text">查询未关联属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrGroupController-2"><span class="toc-number">6.3.1.</span> <span class="toc-text">AttrGroupController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrService-2"><span class="toc-number">6.3.2.</span> <span class="toc-text">AttrService</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%85%B3%E8%81%94"><span class="toc-number">6.4.</span> <span class="toc-text">添加关联</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrGroupController-3"><span class="toc-number">6.4.1.</span> <span class="toc-text">AttrGroupController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrGroupService-1"><span class="toc-number">6.4.2.</span> <span class="toc-text">AttrGroupService</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E7%BB%B4%E6%8A%A4%E2%80%94%E5%8F%91%E5%B8%83%E5%95%86%E5%93%81%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">商品维护—发布商品（后端）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E7%AD%89%E7%BA%A7"><span class="toc-number">7.1.</span> <span class="toc-text">获取用户等级</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%BD%91%E5%85%B3application-yml"><span class="toc-number">7.1.1.</span> <span class="toc-text">配置网关application.yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E6%A8%A1%E6%9D%BF"><span class="toc-number">7.1.2.</span> <span class="toc-text">页面模板</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%BE%97%E5%88%86%E7%B1%BB%E5%85%B3%E8%81%94%E7%9A%84%E5%93%81%E7%89%8C"><span class="toc-number">7.2.</span> <span class="toc-text">获得分类关联的品牌</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BrandVo"><span class="toc-number">7.2.1.</span> <span class="toc-text">BrandVo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CategoryBrandRelationController"><span class="toc-number">7.2.2.</span> <span class="toc-text">CategoryBrandRelationController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CategoryBrandRelationServiceImpl"><span class="toc-number">7.2.3.</span> <span class="toc-text">CategoryBrandRelationServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%88%86%E7%B1%BB%E5%85%B3%E8%81%94%E7%9A%84%E5%88%86%E7%BB%84%E5%92%8C%E5%B1%9E%E6%80%A7"><span class="toc-number">7.3.</span> <span class="toc-text">获取分类关联的分组和属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrGroupWithAttrsVo"><span class="toc-number">7.3.1.</span> <span class="toc-text">AttrGroupWithAttrsVo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrGroupController-4"><span class="toc-number">7.3.2.</span> <span class="toc-text">AttrGroupController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AttrGroupService-2"><span class="toc-number">7.3.3.</span> <span class="toc-text">AttrGroupService</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%95%86%E5%93%81"><span class="toc-number">7.4.</span> <span class="toc-text">新增商品</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Vo"><span class="toc-number">7.4.1.</span> <span class="toc-text">Vo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SpuInfoController"><span class="toc-number">7.4.2.</span> <span class="toc-text">SpuInfoController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1"><span class="toc-number">7.4.3.</span> <span class="toc-text">远程服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="toc-number">7.4.4.</span> <span class="toc-text">远程服务接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SpuInfoServiceImpl"><span class="toc-number">7.4.5.</span> <span class="toc-text">SpuInfoServiceImpl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SkuFullReductionServiceImpl"><span class="toc-number">7.4.6.</span> <span class="toc-text">SkuFullReductionServiceImpl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#debug-amp-test"><span class="toc-number">7.4.7.</span> <span class="toc-text">debug &amp; test</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E7%BB%B4%E6%8A%A4%E2%80%94SPU%E7%AE%A1%E7%90%86%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89"><span class="toc-number">8.</span> <span class="toc-text">商品维护—SPU管理（后端）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">8.1.</span> <span class="toc-text">时间戳格式化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SPU%E5%BE%85%E6%9D%A1%E4%BB%B6%E6%A3%80%E7%B4%A2"><span class="toc-number">8.2.</span> <span class="toc-text">SPU待条件检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SKU%E6%A3%80%E7%B4%A2"><span class="toc-number">8.3.</span> <span class="toc-text">SKU检索</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%93%E5%AD%98%E7%B3%BB%E7%BB%9F%E2%80%94%E4%BB%93%E5%BA%93%E7%BB%B4%E6%8A%A4%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89"><span class="toc-number">9.</span> <span class="toc-text">库存系统—仓库维护（后端）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%9F%BA%E7%A1%80%E6%90%AD%E5%BB%BA"><span class="toc-number">9.1.</span> <span class="toc-text">服务基础搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%BE%97%E4%BB%93%E5%BA%93%E5%88%97%E8%A1%A8%E5%B8%A6%E6%9D%A1%E4%BB%B6"><span class="toc-number">9.2.</span> <span class="toc-text">获得仓库列表带条件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%93%E5%AD%98%E7%B3%BB%E7%BB%9F%E2%80%94%E5%95%86%E5%93%81%E5%BA%93%E5%AD%98%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89"><span class="toc-number">10.</span> <span class="toc-text">库存系统—商品库存（后端）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%BE%97%E5%BA%93%E5%AD%98%E5%88%97%E8%A1%A8%E5%B8%A6%E6%9D%A1%E4%BB%B6"><span class="toc-number">10.1.</span> <span class="toc-text">获得库存列表带条件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%93%E5%AD%98%E7%B3%BB%E7%BB%9F%E2%80%94%E9%87%87%E8%B4%AD%E9%9C%80%E6%B1%82%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89"><span class="toc-number">11.</span> <span class="toc-text">库存系统—采购需求（后端）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%BE%97%E9%9C%80%E6%B1%82%E5%88%97%E8%A1%A8%E5%B8%A6%E6%9D%A1%E4%BB%B6"><span class="toc-number">11.1.</span> <span class="toc-text">获得需求列表带条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%BE%97%E6%9C%AA%E9%A2%86%E5%8F%96%E7%9A%84%E9%87%87%E8%B4%AD%E5%8D%95%E5%88%97%E8%A1%A8"><span class="toc-number">11.2.</span> <span class="toc-text">获得未领取的采购单列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PurchaseController"><span class="toc-number">11.2.1.</span> <span class="toc-text">PurchaseController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PurchaseServiceImpl"><span class="toc-number">11.2.2.</span> <span class="toc-text">PurchaseServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E9%87%87%E8%B4%AD%E5%8D%95"><span class="toc-number">11.3.</span> <span class="toc-text">合并采购单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WareConstant"><span class="toc-number">11.3.1.</span> <span class="toc-text">WareConstant</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MergeVo"><span class="toc-number">11.3.2.</span> <span class="toc-text">MergeVo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PurchaseController-1"><span class="toc-number">11.3.3.</span> <span class="toc-text">PurchaseController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PurchaseServiceImpl-1"><span class="toc-number">11.3.4.</span> <span class="toc-text">PurchaseServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%86%E5%8F%96%E9%87%87%E8%B4%AD%E5%8D%95"><span class="toc-number">11.4.</span> <span class="toc-text">领取采购单</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PurchaseController-2"><span class="toc-number">11.4.1.</span> <span class="toc-text">PurchaseController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PurchaseServiceImpl-2"><span class="toc-number">11.4.2.</span> <span class="toc-text">PurchaseServiceImpl</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E9%87%87%E8%B4%AD"><span class="toc-number">11.5.</span> <span class="toc-text">完成采购</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PurchaseDoneItemVo"><span class="toc-number">11.5.1.</span> <span class="toc-text">PurchaseDoneItemVo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PurchaseFinishedVo"><span class="toc-number">11.5.2.</span> <span class="toc-text">PurchaseFinishedVo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PurchaseController-3"><span class="toc-number">11.5.3.</span> <span class="toc-text">PurchaseController</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PurchaseServiceImpl-3"><span class="toc-number">11.5.4.</span> <span class="toc-text">PurchaseServiceImpl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WareSkuServiceImpl"><span class="toc-number">11.5.5.</span> <span class="toc-text">WareSkuServiceImpl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WareSkuDao"><span class="toc-number">11.5.6.</span> <span class="toc-text">WareSkuDao</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E7%BB%B4%E6%8A%A4%E2%80%94SKU%E8%A7%84%E6%A0%BC%E7%BB%B4%E6%8A%A4%EF%BC%88%E5%90%8E%E7%AB%AF%EF%BC%89"><span class="toc-number">12.</span> <span class="toc-text">商品维护—SKU规格维护（后端）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96"><span class="toc-number">12.1.</span> <span class="toc-text">获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-1"><span class="toc-number">12.2.</span> <span class="toc-text">修改</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80%E7%AF%87%E2%80%94%E5%AE%8C%E7%BB%93%E6%92%92%E8%8A%B1%F0%9F%8E%89"><span class="toc-number">13.</span> <span class="toc-text">分布式基础篇—完结撒花🎉</span></a></li></ol>
    </div>
  </section>


  


</aside>



                
                      <!--此文件用来存放一些不方便取值的变量-->
<!--思路大概是将值藏到重加载的区域内-->

<script>
  window.pdata={}
  pdata.ispage=true;
  pdata.postTitle="【项目笔记】商城项目实战3";
  pdata.commentPath="";
  pdata.commentPlaceholder="";
  // header 这里无论是否开启pjax都需要
  var l_header=document.getElementById("l_header");
  
  l_header.classList.remove("show");
  
  
    // cover
    var cover_wrapper=document.querySelector('.cover-wrapper');
    
    cover_wrapper.id="half";
    cover_wrapper.style.display="";
    
  
</script>

            </div>
            
  
  <footer class="footer clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    <meting-js
      theme='#1BCDFC'
      autoplay='false'
      volume='0.5'
      loop='all'
      order='list'
      fixed='false'
      list-max-height='320px'
      server='tencent'
      type='playlist'
      id='8119036336'
      list-folded='true'>
    </meting-js>
  


        </div>
      
    
      
        
          <div><p><br>🧡💛💚💙💜🖤🤍</p>
</div>
        
      
    
  </footer>


              <a id="s-top" class="fas fa-arrow-up fa-fw" href="javascript:void(0)"></a>
          </div>
      </div>
      <div>
        <script>
/************这个文件存放不需要重载的全局变量和全局函数*********/
window.volantis={};
window.volantis.loadcss=document.getElementById("loadcss");
/******************** Pjax ********************************/
function VPjax(){
	this.list=[] // 存放回调函数
	this.start=()=>{
	  for(var i=0;i<this.list.length;i++){
		this.list[i].run();
	  }
	}
	this.push=(fn,name)=>{
		var f=new PjaxItem(fn,name);
		this.list.push(f);
	}
	// 构造一个可以run的对象
	function PjaxItem(fn,name){
		// 函数名称
		this.name = name || fn.name
		// run方法
		this.run=()=>{
			fn()
		}
	}
}
volantis.pjax={}
volantis.pjax.method={
	complete: new VPjax(),
	error: new VPjax(),
	send: new VPjax()
}
volantis.pjax={
	...volantis.pjax,
	push: volantis.pjax.method.complete.push,
	error: volantis.pjax.method.error.push,
	send: volantis.pjax.method.send.push
}
/********************脚本懒加载函数********************************/
// 已经加入了setTimeout
function loadScript(src, cb) {
	setTimeout(function() {
		var HEAD = document.getElementsByTagName('head')[0] || document.documentElement;
		var script = document.createElement('script');
		script.setAttribute('type','text/javascript');
		if (cb) script.onload = cb;
		script.setAttribute('src', src);
		HEAD.appendChild(script);
	});
}
//https://github.com/filamentgroup/loadCSS
var loadCSS = function( href, before, media, attributes ){
	var doc = window.document;
	var ss = doc.createElement( "link" );
	var ref;
	if( before ){
		ref = before;
	}
	else {
		var refs = ( doc.body || doc.getElementsByTagName( "head" )[ 0 ] ).childNodes;
		ref = refs[ refs.length - 1];
	}
	var sheets = doc.styleSheets;
	if( attributes ){
		for( var attributeName in attributes ){
			if( attributes.hasOwnProperty( attributeName ) ){
				ss.setAttribute( attributeName, attributes[attributeName] );
			}
		}
	}
	ss.rel = "stylesheet";
	ss.href = href;
	ss.media = "only x";
	function ready( cb ){
		if( doc.body ){
			return cb();
		}
		setTimeout(function(){
			ready( cb );
		});
	}
	ready( function(){
		ref.parentNode.insertBefore( ss, ( before ? ref : ref.nextSibling ) );
	});
	var onloadcssdefined = function( cb ){
		var resolvedHref = ss.href;
		var i = sheets.length;
		while( i-- ){
			if( sheets[ i ].href === resolvedHref ){
				return cb();
			}
		}
		setTimeout(function() {
			onloadcssdefined( cb );
		});
	};
	function loadCB(){
		if( ss.addEventListener ){
			ss.removeEventListener( "load", loadCB );
		}
		ss.media = media || "all";
	}
	if( ss.addEventListener ){
		ss.addEventListener( "load", loadCB);
	}
	ss.onloadcssdefined = onloadcssdefined;
	onloadcssdefined( loadCB );
	return ss;
};
</script>
<script>
  
  loadCSS("https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14/css/all.min.css", window.volantis.loadcss);
  
  
  loadCSS("https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css", window.volantis.loadcss);
  
  
  
</script>
<!-- required -->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script>

<script>
  function pjax_fancybox() {
    $(".md .gallery").find("img").each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".md .gallery").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  function SCload_fancybox() {
    if ($(".md .gallery").find("img").length == 0) return;
    loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css", document.getElementById("loadcss"));
    loadScript('https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', pjax_fancybox)
  };
  $(function () {
    SCload_fancybox();
  });
  function Pjax_SCload_fancybox(){
	if (typeof $.fancybox == "undefined") {
	 SCload_fancybox();
    } else {
	 pjax_fancybox();
    }
  }
  volantis.pjax.push(Pjax_SCload_fancybox)
  volantis.pjax.send(()=>{
      if (typeof $.fancybox != "undefined") {
        $.fancybox.close();    // 关闭弹窗
      }
  },'fancybox')
</script>


<!-- internal -->

  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
        var imgs=["https://bing.ioliu.cn/v1/rand?w=1920&h=1200"];
        if ('false' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
	  function Pjax_backstretch(){
        
          $.backstretch(
            imgs,
          {
            duration: "10000",
            fade: "1500"
          });
        
	  }
	  loadScript("https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js",Pjax_backstretch)
    </script>
  



  
  

  <div id="rightmenu-wrapper">
    <ul class="list-v rightmenu" id="rightmenu-content">
      <li class='option'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-text' onclick="document.execCommand('copy')"><i class='fa fa-copy fa-fw'></i>复制文本</a>
        <hr id='hr-text'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-href'><i class='fa fa-link fa-fw'></i>复制链接</a>
        <a class='vlts-menu opt fix-cursor-default' id='menu-open-href'><i class='fa fa-external-link-square-alt fa-fw'></i>在新标签页打开</a>
        <hr id='hr-href'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-src'><i class='fa fa-image fa-fw'></i>复制图片地址</a>
        <hr id='hr-src'>
      </li>
      
        <li class='navigation'>
          <a class='nav icon-only fix-cursor-default' onclick='history.back()'><i class='fa fa-arrow-left fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' onclick='history.forward()'><i class='fa fa-arrow-right fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' onclick='window.location.reload()'><i class='fa fa-redo fa-fw'></i></a>
          <a class='nav icon-only fix-cursor-default' href='/'><i class='fa fa-home fa-fw'></i></a>
        </li>
      
      <hr>
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default ' href=/categories/
        
        
        
        
          id="categories"
        >
        <i class='fas fa-folder-open fa-fw'></i> 所有分类
      </a>
    </li>
  
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default ' href=/tags/
        
        
        
        
          id="tags"
        >
        <i class='fas fa-tags fa-fw'></i> 所有标签
      </a>
    </li>
  
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default ' href=/archives/
        
        
        
        
          id="archives"
        >
        <i class='fas fa-archive fa-fw'></i> 归档
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default toggle-mode-btn' 
        
        
        
        >
        <i class='fas fa-moon fa-fw'></i> 开/关灯
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          <li class='music name'>
            <p class='nav music-title fix-cursor-default'></p>
          </li>
          <li class='music ctrl'>
            <a class='nav icon-only backward fix-cursor-default' onclick='aplayerBackward()'><i class='fa fa-step-backward fa-fw'></i></a>
            <a class='nav icon-only toggle fix-cursor-default' onclick='aplayerToggle()'><i class='fa fa-play fa-fw'></i></a>
            <a class='nav icon-only forward fix-cursor-default' onclick='aplayerForward()'><i class='fa fa-step-forward fa-fw'></i></a>
          </li>
          <li class='music volume'>
            <a class='nav volume'>
              <div class="aplayer-volume-bar-wrap">
                <div class="aplayer-volume-bar fix-cursor-pointer">
                  <div class="aplayer-volume"></div>
                  <i class='left fa fa-volume-off fa-fw'></i>
                  <i class='right fa fa-volume-up fa-fw'></i>
                </div>
              </div>
            </a>
          </li>
        
      
    </ul>
  </div>

  <script>
    window.document.oncontextmenu = function (event) {
      if (event.ctrlKey) return true;
      if (/Android|webOS|BlackBerry/i.test(navigator.userAgent)) return true;
      return popMenu(event);
    };
    document.addEventListener("click", function (event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      mymenu.style.display = "none";
    });
    function popMenu(event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      var menuContent = document.getElementById('rightmenu-content');
      var screenWidth = document.documentElement.clientWidth || document.body.clientWidth;
      var screenHeight = document.documentElement.clientHeight || document.body.clientHeight;
      mymenu.style.left = event.clientX + "px"; // 获取鼠标位置
      mymenu.style.top = event.clientY + "px";
      mymenu.style.display = 'block';
      if (event.clientX * 2 > screenWidth) {
        menuContent.classList.add('left');
      } else {
        menuContent.classList.remove('left');
      }
      if (event.clientY * 2 > screenHeight) {
        menuContent.classList.add('top');
      } else {
        menuContent.classList.remove('top');
      }

      let hrText = document.getElementById('hr-text');
      let hrSrc = document.getElementById('hr-src');
      let hrHref = document.getElementById('hr-href');

      // 选中图片
      let copySrc = document.getElementById('menu-copy-src');
      if (copySrc != undefined) {
        if (event.target.currentSrc) {
          copySrc.style.display = 'block';
          copySrc.addEventListener("click", function (e) {
            copyString(event.target.currentSrc);
          },{once: true});
          hrSrc.style.display = 'block';
        } else {
          copySrc.style.display = 'none';
          hrSrc.style.display = 'none';
        }
      }

      // 选中按钮
      // 判断是不是按钮
      let href = '';
      if (event.path) {
        for (i = 0; i < event.path.length; i++) {
          if (event.path[i].href != undefined && event.path[i].href.length > 0) {
            href = event.path[i].href;
          }
        }
      }

      let copyText = document.getElementById('menu-copy-text');
      copyText.style.display = 'none';
      hrText.style.display = 'none';
      if (href.length == 0) {
        // 选中文本
        if (window.getSelection().toString()) {
          if ('true' == 'true') {
            copyText.style.display = 'block';
            hrText.style.display = 'block';
          }
        }
      }

      // 在新标签页打开
      let openHref = document.getElementById('menu-open-href');
      if (openHref != undefined) {
        if (href.length > 0) {
          openHref.style.display = 'block';
          openHref.addEventListener("click", function (e) {
            window.open(href);
          },{once: true});
          hrHref.style.display = 'block';
        } else {
          openHref.style.display = 'none';
          hrHref.style.display = 'none';
        }
      }
      // 复制链接
      let copyHref = document.getElementById('menu-copy-href');
      if (copyHref != undefined) {
        if (href.length > 0) {
          copyHref.style.display = 'block';
          copyHref.addEventListener("click", function (e) {
            copyString(href);
          },{once: true});
        } else {
          copyHref.style.display = 'none';
        }
      }
      // 有音乐播放器 see: layout/_third-party/aplayer/script.ejs
      
      if(volantis.APlayerLoaded){ // APlayer加载完成？
        // 如果有aplayer，初始化一下
        checkAPlayer();
      }
      
      return false; // 该行代码确保系统自带的右键菜单不会被调出
    }
    function hideMenu() {
      document.getElementById('rightmenu-wrapper').style.display = 'none';
    }
    function copyString(str) {
      const input = document.createElement('input');
      input.setAttribute('readonly', 'readonly');
      document.body.appendChild(input);
      input.setAttribute('value', str);
      input.select();
      document.execCommand('copy');
      document.body.removeChild(input);
    }
    document.execCommand('click');
  </script>




<script>
  function loadIssuesJS() {
    if ($(".md").find(".issues-api").length == 0) return;
	
	  loadScript('/js/issues.js');
	
  };
  $(function () {
    loadIssuesJS();
  });
  volantis.pjax.push(()=>{
	if (typeof IssuesAPI == "undefined") {
	  loadIssuesJS();
	}
  },"IssuesJS")
</script>



  <script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>




  

<script>
  window.FPConfig = {
	delay: 0,
	ignoreKeywords: [],
	maxRPS: 5,
	hoverDelay: 25
  };
</script>
<script defer src="https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"></script>





  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
    var clipboard = new ClipboardJS('.btn-copy', {
        target: function (trigger) {
            return trigger.nextElementSibling
        }
    });
    function wait(callback, seconds) {
        var timelag = null;
        timelag = window.setTimeout(callback, seconds)
    }
    function pjax_initCopyCode() {
		if($(".highlight .code pre").length+$(".article pre code").length==0)return;
        var copyHtml = '';
        copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
        copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
        copyHtml += '</button>';
        $(".highlight .code pre").before(copyHtml);
        $(".article pre code").before(copyHtml);
        clipboard.off('success').on('success', function (e) {
            let $btn = $(e.trigger);
            $btn.addClass('copied');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-check-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPIED';
            wait(function () {
                $icon.removeClass('fa-check-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        });
        clipboard.off('error').on('error', function (e) {
            e.clearSelection();
            let $btn = $(e.trigger);
            $btn.addClass('copy-failed');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-times-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPY FAILED';
            wait(function () {
                $icon.removeClass('fa-times-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        })
    }
    $(function () {
        pjax_initCopyCode()
    });
	volantis.pjax.push(pjax_initCopyCode)
</script>




   <script type="text/javascript">
  loadScript("https://cdn.jsdelivr.net/npm/scrollreveal@4.0.6/dist/scrollreveal.min.js")
  function pjax_scrollrebeal() {
    ScrollReveal().reveal('.l_main .reveal', {
      distance: '32px',
      duration: '800',
      interval: '20',
      scale: '1',
      easing: 'ease-out'
    });
  }
  $(function () {
  var checkScrollReveal = setInterval(function () {
    if ($("#safearea").css("display")!="block") return
    if (typeof ScrollReveal=="undefined") return
    clearInterval(checkScrollReveal)
	pjax_scrollrebeal();
  }, 100)
  });
  volantis.pjax.push(pjax_scrollrebeal)
</script>




  <script>
  let APlayerController = new Object();
  APlayerController.id = '8119036336';  // 设定全局音乐播放ID
  APlayerController.volume = '0.5';
  loadCSS("https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css", window.volantis.loadcss);
  // APlayer 需要在  MetingJS 之前加载
  loadScript("https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js")
  window.volantis.APlayerLoaded=0 // APlayer加载完成状态
  var checkAPlayer = setInterval(function () {
    if (!window.APlayer) return // APlayer加载完成？
	  if ($("#safearea").css("display")!="block") return // 文章内容加载完成？ see: source/css/first.styl
    clearInterval(checkAPlayer)
	  if (!window.volantis.APlayerLoaded&&!window.MetingJSElement){ // APlayer只能加载一次
      window.volantis.APlayerLoaded=1 // APlayer加载完成
      loadScript("https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js") // 加载 MetingJS
	  }
  }, 2500) // 按照网速调节差分2.5s
  // rightmenu see: layout/_partial/rightmenu.ejs

  
    loadScript("/js/aplayer.js")
  

</script>




  
  
<script src="https://cdn.jsdelivr.net/npm/valine@1.4/dist/Valine.min.js"></script>


<script>
  function emoji(path, idx, ext) {
    return path + "/" + path + "-" + idx + "." + ext;
  }
  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }
  function pjax_valine() {
    if(!document.querySelectorAll("#valine_container")[0])return;
    let pagePlaceholder = pdata.commentPlaceholder || "在这里写评论哦~";
    let path = pdata.commentPath;
    if (path.length == 0) {
      let defaultPath = '';
      path = defaultPath || decodeURI(window.location.pathname);
    }
    var valine = new Valine();
    valine.init(Object.assign({"path":null,"placeholder":"在这里写评论哦~","appId":"hDBihxHSDX3Dq2XdPVRwIrGp-MdYXbMMI","appKey":"1oBqjeOHf3of5LJw7B2BrE2f","meta":["nick","mail","link"],"requiredFields":["nick","mail"],"enableQQ":true,"recordIP":false,"avatar":"mp","pageSize":10,"lang":"zh-cn","highlight":true,"mathJax":false,"js":"https://cdn.jsdelivr.net/npm/valine@1.4/dist/Valine.min.js"}, {
      el: '#valine_container',
      path: path,
      placeholder: pagePlaceholder,
      emojiCDN: 'https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/',
      emojiMaps: emojiMaps,
    }))
  }
  $(function () {
    pjax_valine();
  });
  volantis.pjax.push(pjax_valine);
</script>






  
<script src="/js/app.js"></script>



<!-- optional -->

  <script>
const SearchServiceimagePath="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@master/img/";
const ROOT =  ("/" || "/").endsWith('/') ? ("/" || "/") : ("//" || "/" );

$('.input.u-search-input').one('focus',function(){
	
		loadScript('/js/search/hexo.js',setSearchService);
	
})

function listenSearch(){
  
    customSearch = new HexoSearch({
      imagePath: SearchServiceimagePath
    });
  
}
function setSearchService() {
	listenSearch();
	
		document.addEventListener("pjax:success", listenSearch);
	
}
</script>







  
<script src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@2/js/comment_typing.js"></script>






  <script defer>

  const LCCounter = {
    app_id: 'yzv0f6bIu6hXwO0xqrI358Js-gzGzoHsz',
    app_key: 'dJh5SEjH7EoUIgUcd2VxqUun',
    custom_api_server: '',

    // 查询存储的记录
    getRecord(Counter, url, title) {
      return new Promise(function (resolve, reject) {
        Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({url})))
          .then(resp => resp.json())
          .then(({results, code, error}) => {
            if (code === 401) {
              throw error;
            }
            if (results && results.length > 0) {
              var record = results[0];
              resolve(record);
            } else {
              Counter('post', '/classes/Counter', {url, title: title, times: 0})
                .then(resp => resp.json())
                .then((record, error) => {
                  if (error) {
                    throw error;
                  }
                  resolve(record);
                }).catch(error => {
                console.error('Failed to create', error);
                reject(error);
              });
            }
          }).catch((error) => {
          console.error('LeanCloud Counter Error:', error);
          reject(error);
        });
      })
    },

    // 发起自增请求
    increment(Counter, incrArr) {
      return new Promise(function (resolve, reject) {
        Counter('post', '/batch', {
          "requests": incrArr
        }).then((res) => {
          res = res.json();
          if (res.error) {
            throw res.error;
          }
          resolve(res);
        }).catch((error) => {
          console.error('Failed to save visitor count', error);
          reject(error);
        });
      });
    },

    // 构建自增请求体
    buildIncrement(objectId) {
      return {
        "method": "PUT",
        "path": `/1.1/classes/Counter/${ objectId }`,
        "body": {
          "times": {
            '__op': 'Increment',
            'amount': 1
          }
        }
      }
    },

    // 校验是否为有效的 UV
    validUV() {
      var key = 'LeanCloudUVTimestamp';
      var flag = localStorage.getItem(key);
      if (flag) {
        // 距离标记小于 24 小时则不计为 UV
        if (new Date().getTime() - parseInt(flag) <= 86400000) {
          return false;
        }
      }
      localStorage.setItem(key, new Date().getTime().toString());
      return true;
    },

    addCount(Counter) {
      var enableIncr = '' === 'true' && window.location.hostname !== 'localhost';
      enableIncr = true;
      var getterArr = [];
      var incrArr = [];
      // 请求 PV 并自增
      var pvCtn = document.querySelector('#lc-sv');
      if (pvCtn || enableIncr) {
        var pvGetter = this.getRecord(Counter, 'http://example.com' + '/#lc-sv', 'Visits').then((record) => {
          incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-sv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + 1;
              if (pvCtn) {
                pvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(pvGetter);
      }

      // 请求 UV 并自增
      var uvCtn = document.querySelector('#lc-uv');
      if (uvCtn || enableIncr) {
        var uvGetter = this.getRecord(Counter, 'http://example.com' + '/#lc-uv', 'Visitors').then((record) => {
          var vuv = this.validUV();
          vuv && incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-uv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + (vuv ? 1 : 0);
              if (uvCtn) {
                uvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(uvGetter);
      }

      // 请求文章的浏览数，如果是当前页面就自增
      var allPV = document.querySelectorAll('#lc-pv');
      if (allPV.length > 0 || enableIncr) {
        for (i = 0; i < allPV.length; i++) {
          let pv = allPV[i];
          let title = pv.getAttribute('data-title');
          var url = 'http://example.com' + pv.getAttribute('data-path');
          if (url) {
            var viewGetter = this.getRecord(Counter, url, title).then((record) => {
              // 是当前页面就自增
              let curPath = window.location.pathname;
              if (curPath.includes('index.html')) {
                curPath = curPath.substring(0, curPath.lastIndexOf('index.html'));
              }
              if (pv.getAttribute('data-path') == curPath) {
                incrArr.push(this.buildIncrement(record.objectId));
              }
              if (pv) {
                var ele = pv.querySelector('#lc-pv #number');
                if (ele) {
                  if (pv.getAttribute('data-path') == curPath) {
                    ele.innerText = (record.times || 0) + 1;
                  } else {
                    ele.innerText = record.times || 0;
                  }
                  pv.style.display = 'inline';
                }
              }
            });
            getterArr.push(viewGetter);
          }
        }
      }

      // 如果启动计数自增，批量发起自增请求
      if (enableIncr) {
        Promise.all(getterArr).then(() => {
          incrArr.length > 0 && this.increment(Counter, incrArr);
        })
      }

    },


    fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${ api_server }/1.1${ url }`, {
          method,
          headers: {
            'X-LC-Id': this.app_id,
            'X-LC-Key': this.app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      this.addCount(Counter);
    },

    refreshCounter() {
      var api_server = this.app_id.slice(-9) !== '-MdYXbMMI' ? this.custom_api_server : `https://${ this.app_id.slice(0, 8).toLowerCase() }.api.lncldglobal.com`;
      if (api_server) {
        this.fetchData(api_server);
      } else {
        fetch('https://app-router.leancloud.cn/2/route?appId=' + this.app_id)
          .then(resp => resp.json())
          .then(({api_server}) => {
            this.fetchData('https://' + api_server);
          });
      }
    }

  };

  LCCounter.refreshCounter();

  document.addEventListener('pjax:complete', function () {
    LCCounter.refreshCounter();
  });
</script>




  <script>
const rootElement = document.documentElement;
const darkModeStorageKey = "user-color-scheme";
const rootElementDarkModeAttributeName = "data-user-color-scheme";

const setLS = (k, v) => {
    localStorage.setItem(k, v);
};

const removeLS = (k) => {
    localStorage.removeItem(k);
};

const getLS = (k) => {
    return localStorage.getItem(k);
};

const getModeFromCSSMediaQuery = () => {
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};

const resetRootDarkModeAttributeAndLS = () => {
  rootElement.removeAttribute(rootElementDarkModeAttributeName);
  removeLS(darkModeStorageKey);
};

const validColorModeKeys = {
  dark: true,
  light: true,
};

const applyCustomDarkModeSettings = (mode) => {
  const currentSetting = mode || getLS(darkModeStorageKey);

  if (currentSetting === getModeFromCSSMediaQuery()) {
    resetRootDarkModeAttributeAndLS();
  } else if (validColorModeKeys[currentSetting]) {
    rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);
  } else {
    resetRootDarkModeAttributeAndLS();
  }
};

const invertDarkModeObj = {
  dark: "light",
  light: "dark",
};

/**
 * get target mode
 */
const toggleCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);

  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  setLS(darkModeStorageKey, currentSetting);
  return currentSetting;
};

/**
 * bind click event for toggle button
 */
var btn=$("#wrapper .toggle-mode-btn,#rightmenu-wrapper .toggle-mode-btn");
function bindToggleButton() {
    btn.on('click',(e) => {
      const mode = toggleCustomDarkMode();
      applyCustomDarkModeSettings(mode);
    });
}

applyCustomDarkModeSettings();
document.addEventListener("DOMContentLoaded", bindToggleButton);
volantis.pjax.push(bindToggleButton);
volantis.pjax.send(()=>{
	btn.unbind('click');
},'toggle-mode-btn-unbind');
</script>








<script>
function listennSidebarTOC() {
  const navItems = document.querySelectorAll(".toc li");
  if (!navItems.length) return;
  const sections = [...navItems].map((element) => {
    const link = element.querySelector(".toc-link");
    const target = document.getElementById(
      decodeURI(link.getAttribute("href")).replace("#", "")
    );
    link.addEventListener("click", (event) => {
      event.preventDefault();
      window.scrollTo({
		top: target.offsetTop + 100,
		
		behavior: "smooth"
		
	  });
    });
    return target;
  });

  function activateNavByIndex(target) {
    if (target.classList.contains("active-current")) return;

    document.querySelectorAll(".toc .active").forEach((element) => {
      element.classList.remove("active", "active-current");
    });
    target.classList.add("active", "active-current");
    let parent = target.parentNode;
    while (!parent.matches(".toc")) {
      if (parent.matches("li")) parent.classList.add("active");
      parent = parent.parentNode;
    }
  }

  function findIndex(entries) {
    let index = 0;
    let entry = entries[index];
    if (entry.boundingClientRect.top > 0) {
      index = sections.indexOf(entry.target);
      return index === 0 ? 0 : index - 1;
    }
    for (; index < entries.length; index++) {
      if (entries[index].boundingClientRect.top <= 0) {
        entry = entries[index];
      } else {
        return sections.indexOf(entry.target);
      }
    }
    return sections.indexOf(entry.target);
  }

  function createIntersectionObserver(marginTop) {
    marginTop = Math.floor(marginTop + 10000);
    let intersectionObserver = new IntersectionObserver(
      (entries, observe) => {
        let scrollHeight = document.documentElement.scrollHeight + 100;
        if (scrollHeight > marginTop) {
          observe.disconnect();
          createIntersectionObserver(scrollHeight);
          return;
        }
        let index = findIndex(entries);
        activateNavByIndex(navItems[index]);
      },
      {
        rootMargin: marginTop + "px 0px -100% 0px",
        threshold: 0,
      }
    );
    sections.forEach((element) => {
      element && intersectionObserver.observe(element);
    });
  }
  createIntersectionObserver(document.documentElement.scrollHeight);
}

document.addEventListener("DOMContentLoaded", listennSidebarTOC);
document.addEventListener("pjax:success", listennSidebarTOC);
</script>

<!-- more -->


          
            


<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>


<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = ["/artitalk/", "/bb/", "/bangumis/"];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）

      volantis.$switcher.removeClass('active'); // 关闭移动端激活的搜索框
      volantis.$header.removeClass('z_search-open'); // 关闭移动端激活的搜索框
      volantis.$wrapper.removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      volantis.$topBtn.unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
	  // 使用 volantis.pjax.send 方法传入pjax:send回调函数 参见layout/_partial/scripts/global.ejs
	  volantis.pjax.method.send.start();
    });

    document.addEventListener('pjax:complete', function () {
      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
      try{
		// 使用 volantis.pjax.push 方法传入重载函数 参见layout/_partial/scripts/global.ejs
		volantis.pjax.method.complete.start();
      } catch (e) {
        console.log(e);
      }
    });

    document.addEventListener('pjax:error', function (e) {
	  // 使用 volantis.pjax.error 方法传入pjax:error回调函数 参见layout/_partial/scripts/global.ejs
	  volantis.pjax.method.error.start();
      window.location.href = e.triggerElement.href;
    });
</script>

              
      </div>
  <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1.5,"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","left":36,"width":150,"height":230,"hOffset":0,"vOffset":-20},"mobile":{"show":false},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false});</script></body>

</html>


<!-- 浏览器搞笑标题 -->
<script type="text/javascript" src="/js/FunnyTitle.js"></script>

<!-- 单击显示文字 -->
<!-- <script type="text/javascript" src="/js/click_show_text.js"></script> -->

<!-- 单击显示特效 -->
<script src="https://cdn.jsdelivr.net/gh/zyoushuo/Blog/hexo/js/mouse_click.js"></script>