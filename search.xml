<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>【项目笔记】商城项目实战7</title>
      <link href="/2021/11/21/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-7/"/>
      <url>/2021/11/21/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-7/</url>
      
        <content type="html"><![CDATA[<h2 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h2><h3 id="异步处理、应用解耦、流量削峰"><a href="#异步处理、应用解耦、流量削峰" class="headerlink" title="异步处理、应用解耦、流量削峰"></a>异步处理、应用解耦、流量削峰</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121110402937.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121110402937.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121110402937"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121110657527.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121110657527.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121110657527"></p><h3 id="消息中间件"><a href="#消息中间件" class="headerlink" title="消息中间件"></a>消息中间件</h3><blockquote><ol><li><p>大多应用中，可通过消息服务中间件来提升系统异步通信、扩展解耦能力</p></li><li><p>消息服务中两个重要概念： 消息代理（message broker）和目的地（destination）</p><ul><li>当消息发送者发送消息以后，将由消息代理（安装了消息中间件的服务器）接管，消息代理保证消息传递到指定目的地。</li></ul></li><li><p>消息队列主要有两种形式的目的地</p><ul><li>队列（queue）：点对点消息通信（point-to-point）</li><li>主题（topic）：发布（publish）/订阅（subscribe）消息通信</li></ul></li><li><p>点对点式 ：</p><ul><li>消息发送者发送消息，消息代理将其放入一个队列中，消息接收者从队列中获取消息内容，消息读取后被移出队列</li><li>消息只有唯一的发送者和接受者，但并不是说只能有一个接收者</li></ul></li><li><p>发布订阅式：</p><ul><li>发送者（发布者）发送消息到主题，多个接收者（订阅者）监听（订阅）这个主题，那么就会在消息到达时同时收到消息  </li></ul></li><li><p>JMS（Java Message Service）JAVA消息服务：</p><ul><li>基于JVM消息代理的规范。ActiveMQ、HornetMQ是JMS实现</li></ul></li><li><p>AMQP（Advanced Message Queuing Protocol）</p><ul><li>高级消息队列协议，也是一个消息代理的规范，兼容JMS</li><li>RabbitMQ是AMQP的实现</li></ul></li></ol></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121111651609.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121111651609.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121111651609"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121112256879.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121112256879.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121112256879"></p><h3 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><blockquote><p>RabbitMQ是一个由erlang开发的AMQP(Advanved Message Queue Protocol)的开源实现  </p><ol><li><p>Message</p><p>消息，消息是不具名的，它由消息头和消息体组成。消息体是不透明的，而消息头则由一系列的可选属性组成，这些属性包括routing-key（路由键）、priority（相对于其他消息的优先权）、delivery-mode（指出该消息可能需要持久性存储）等。  </p></li><li><p>Publisher<br>消息的生产者，也是一个向交换器发布消息的客户端应用程序  </p></li><li><p>Exchange</p><p>交换器，用来接收生产者发送的消息并将这些消息路由给服务器中的队列。Exchange有4种类型：direct(默认)，fanout, topic, 和headers，不同类型的Exchange转发消息的策略有所区别  </p></li><li><p>Queue</p><p>消息队列，用来保存消息直到发送给消费者。它是消息的容器，也是消息的终点。一个消息可投入一个或多个队列。消息一直在队列里面，等待消费者连接到这个队列将其取走  </p></li><li><p>Binding</p><p>绑定，用于消息队列和交换器之间的关联。一个绑定就是基于路由键将交换器和消息队列连接起来的路由规则，所以可以将交换器理解成一个由绑定构成的路由表。Exchange 和Queue的绑定可以是多对多的关系</p></li><li><p>Connection<br>网络连接，比如一个TCP连接。</p></li><li><p>Channel<br>信道，多路复用连接中的一条独立的双向数据流通道。信道是建立在真实的TCP连接内的虚拟连接，AMQP 命令都是通过信道发出去的，不管是发布消息、订阅队列还是接收消息，这些动作都是通过信道完成。因为对于操作系统来说建立和销毁 TCP 都是非常昂贵的开销，所以引入了信道的概念，以复用一条 TCP 连接。</p></li><li><p>Consumer<br>消息的消费者，表示一个从消息队列中取得消息的客户端应用程序。</p></li><li><p>Virtual Host<br>虚拟主机，表示一批交换器、消息队列和相关对象。虚拟主机是共享相同的身份认证和加密环境的独立服务器域。每个 vhost 本质上就是一个 mini 版的 RabbitMQ 服务器，拥有自己的队列、交换器、绑定和权限机制。vhost 是 AMQP 概念的基础，必须在连接时指定，RabbitMQ 默认的 vhost 是 / 。</p></li><li><p>Broker<br>  表示消息队列服务器实体</p></li></ol></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121121330065.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121121330065.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121121330065"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121120230895.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121120230895.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121120230895"></p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><blockquote><p><a href="https://www.rabbitmq.com/networking.html">https://www.rabbitmq.com/networking.html</a>  </p><p>docker run -d –name rabbitmq -p 5671:5671 -p 5672:5672 -p 4369:4369 -p 25672:25672 -p 15671:15671 -p 15672:15672 rabbitmq:management</p><p>docker update rabbitmq –restart=always</p><p>4369, 25672 (Erlang发现&amp;集群端口)<br>5672, 5671 (AMQP端口)<br>15672 (web管理后台端口)<br>61613, 61614 (STOMP协议端口)<br>1883, 8883 (MQTT协议端口)  </p></blockquote><h4 id="Exchange类型"><a href="#Exchange类型" class="headerlink" title="Exchange类型"></a>Exchange类型</h4><blockquote><p>Exchange分发消息时根据类型的不同分发策略有区别，目前共四种类型：direct、fanout、topic、headers 。headers 匹配 AMQP 消息的 header 而不是路由键，headers 交换器和 direct 交换器完全一致，但性能差很多，目前几乎用不到了</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121123352595.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121123352595.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121123352595"></p><blockquote><p>消息中的路由键（routing key）如果和Binding 中的 binding key 一致， 交换器就将消息发到对应的队列中。路由键与队列名完全匹配，如果一个队列绑定到交换机要求路由键为“dog”，则只转发 routingkey 标记为“dog”的消息，不会转发“dog.puppy”，也不会转发“dog.guard”等等。它是完全匹配、单播的模式。  </p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121123425049.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121123425049.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121123425049"></p><blockquote><p>每个发到 fanout 类型交换器的消息都会分到所有绑定的队列上去。fanout 交换器不处理路由键，只是简单的将队列绑定到交换器上，每个发送到交换器的消息都会被转发到与该交换器绑定的所有队列上。很像子网广播，每台子网内的主机都获得了一份复制的消息。fanout 类型转发消息是最快的。  </p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121123429493.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121123429493.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121123429493"></p><blockquote><p>topic 交换器通过模式匹配分配消息的路由键属性，将路由键和某个模式进行匹配，此时队列需要绑定到一个模式上。它将路由键和绑定键的字符串切分成单词，这些单词之间用点隔开。它同样也会识别两个通配符：符号“#”和符号“<em>”。#匹配0个或多个单词，</em>匹配一个单词。  </p></blockquote><h3 id="spring整合"><a href="#spring整合" class="headerlink" title="spring整合"></a>spring整合</h3><h4 id="依赖、配置"><a href="#依赖、配置" class="headerlink" title="依赖、配置"></a>依赖、配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  rabbitMQ  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableRabbit</span>   <span class="comment">// 开启rabbit</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">rabbitmq:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.128</span><span class="number">.129</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">  <span class="attr">virtual-host:</span> <span class="string">/</span></span><br><span class="line">  <span class="comment"># 其他</span></span><br></pre></td></tr></table></figure><h4 id="AmqpAdmin"><a href="#AmqpAdmin" class="headerlink" title="AmqpAdmin"></a>AmqpAdmin</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallOrderApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AmqpAdmin amqpAdmin;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DirectExchange directExchange = <span class="keyword">new</span> DirectExchange(<span class="string">&quot;test-direct&quot;</span>, <span class="keyword">true</span>, <span class="keyword">false</span>);</span><br><span class="line">        amqpAdmin.declareExchange(directExchange);</span><br><span class="line">        log.debug(<span class="string">&quot;Exchange[&#123;&#125;]创建成功&quot;</span>, directExchange.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Queue queue = <span class="keyword">new</span> Queue(<span class="string">&quot;test-hello&quot;</span>);</span><br><span class="line">        amqpAdmin.declareQueue(queue);</span><br><span class="line">        log.debug(<span class="string">&quot;Queue[&#123;&#125;]创建成功&quot;</span>, queue.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">binding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Binding binding = <span class="keyword">new</span> Binding(<span class="string">&quot;test-hello&quot;</span>, Binding.DestinationType.QUEUE, <span class="string">&quot;test-direct&quot;</span>, <span class="string">&quot;test-hello&quot;</span>, <span class="keyword">new</span> HashMap&lt;&gt;());</span><br><span class="line">        amqpAdmin.declareBinding(binding);</span><br><span class="line">        log.debug(<span class="string">&quot;Binding创建成功,目的地[&#123;&#125;]&quot;</span>, binding.getDestination());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RabbitTemplate"><a href="#RabbitTemplate" class="headerlink" title="RabbitTemplate"></a>RabbitTemplate</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    OrderEntity orderEntity = <span class="keyword">new</span> OrderEntity();</span><br><span class="line">    orderEntity.setCouponId(<span class="number">1L</span>);</span><br><span class="line">    <span class="comment">// 如果消息内容是对象，默认序列化转换，所以对象类要求实现序列化</span></span><br><span class="line">    <span class="comment">// 也可以配置默认转为JSON</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;test-direct&quot;</span>, <span class="string">&quot;test-hello&quot;</span>, orderEntity);</span><br><span class="line">    log.debug(<span class="string">&quot;消息发送成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderRabbitConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 配置默认MessageConverter为Jackson2JsonMessageConverter（转为JSON）</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MessageConverter <span class="title">messageConverter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Jackson2JsonMessageConverter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RabbitListener、RabbitHandler"><a href="#RabbitListener、RabbitHandler" class="headerlink" title="RabbitListener、RabbitHandler"></a>RabbitListener、RabbitHandler</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听队列</span></span><br><span class="line"><span class="meta">@RabbitListener(queues = &#123;&quot;test-hello&quot;&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testListener</span><span class="params">(Message msg, OrderEntity content, Channel channel)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// msg 包括头+体</span></span><br><span class="line">    <span class="comment">// content 可以使用具体类型接收内容</span></span><br><span class="line">    <span class="comment">// channel 传输数据通道</span></span><br><span class="line">    log.debug(<span class="string">&quot;监听到了消息:&quot;</span> + msg + <span class="string">&quot;; 内容为:&quot;</span> + content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ol><li>订单服务启动多个的话，同一个消息只有一个客户端可以收到</li><li>只有一个消息完全处理完之后，才能接收下一个消息</li></ol></blockquote><blockquote><ol><li>RabbitListener注解可以标在类、方法上（一般类上）</li><li>RabbitHandler注解可以标在方法上，可以自动判断方法参数的内容类型（重载，不过方法名不需要一样）</li></ol></blockquote><h4 id="可靠投递"><a href="#可靠投递" class="headerlink" title="可靠投递"></a>可靠投递</h4><blockquote><p>保证消息不丢失，可靠抵达，可以使用事务消息，但是性能会下降，为此引入确认机制</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121141708505.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121141708505.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121141708505"></p><p><strong>ConfirmCallback</strong></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121141957310.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121141957310.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121141957310"></p><p><strong>ReturnCallback</strong>  </p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121142049440.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121142049440.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121142049440"></p><p><strong>Ack消息确认机制</strong> </p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121142119941.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121142119941.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121142119941"></p><h2 id="订单服务"><a href="#订单服务" class="headerlink" title="订单服务"></a>订单服务</h2><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121155213384.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211121155213384.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211121155213384"></p><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><blockquote><p>老生常谈</p></blockquote><h3 id="订单登录拦截"><a href="#订单登录拦截" class="headerlink" title="订单登录拦截"></a>订单登录拦截</h3><h4 id="OrderWebConfig"><a href="#OrderWebConfig" class="headerlink" title="OrderWebConfig"></a>OrderWebConfig</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderWebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OrderLoginUserInterceptor loginInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 添加拦截器</span></span><br><span class="line"><span class="comment">     * 配置拦截地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(loginInterceptor).addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="OrderLoginUserInterceptor"><a href="#OrderLoginUserInterceptor" class="headerlink" title="OrderLoginUserInterceptor"></a>OrderLoginUserInterceptor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 登录拦截</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderLoginUserInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;MemberEntityVo&gt; loginUser = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 在方法执行之前拦截</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        MemberEntityVo attribute = (MemberEntityVo) request.getSession().getAttribute(AuthServerConstant.LOGIN_USER);</span><br><span class="line">        <span class="keyword">if</span> (attribute != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//  已登录</span></span><br><span class="line">            loginUser.set(attribute);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            request.getSession().setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;请先登录&quot;</span>);</span><br><span class="line">            response.sendRedirect(<span class="string">&quot;http://auth.gulimall.com/login.html&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="DEBUG"><a href="#DEBUG" class="headerlink" title="DEBUG"></a>DEBUG</h4><blockquote><p>OrderLoginUserInterceptor需写成如下，加入loginUser判断，否则会有cannot get session的问题</p><p>debug的时候会进入两次interceptor，然后第二次拿不到session所以就会报错</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 登录拦截</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderLoginUserInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;MemberEntityVo&gt; loginUser = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 在方法执行之前拦截</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//  /order/order/status/2948294820984028420</span></span><br><span class="line">        String uri = request.getRequestURI();</span><br><span class="line">        AntPathMatcher antPathMatcher = <span class="keyword">new</span> AntPathMatcher();</span><br><span class="line">        <span class="keyword">boolean</span> match = antPathMatcher.match(<span class="string">&quot;/order/order/status/**&quot;</span>, uri);</span><br><span class="line">        <span class="keyword">boolean</span> match1 = antPathMatcher.match(<span class="string">&quot;/payed/notify&quot;</span>, uri);</span><br><span class="line">        <span class="keyword">if</span> (match || match1) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (loginUser.get() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            MemberEntityVo attribute = (MemberEntityVo) request.getSession().getAttribute(AuthServerConstant.LOGIN_USER);</span><br><span class="line">            <span class="keyword">if</span> (attribute != <span class="keyword">null</span>) &#123;</span><br><span class="line">                loginUser.set(attribute);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//没登录就去登录</span></span><br><span class="line">                request.getSession().setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;请先进行登录&quot;</span>);</span><br><span class="line">                response.sendRedirect(<span class="string">&quot;http://auth.gulimall.com/login.html&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="订单服务-确认页"><a href="#订单服务-确认页" class="headerlink" title="订单服务 - 确认页"></a>订单服务 - 确认页</h2><h3 id="Feign远程调用丢失请求头"><a href="#Feign远程调用丢失请求头" class="headerlink" title="Feign远程调用丢失请求头"></a>Feign远程调用丢失请求头</h3><h4 id="丢失请求头"><a href="#丢失请求头" class="headerlink" title="丢失请求头"></a>丢失请求头</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211122102421314.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211122102421314.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211122102421314"></p><h4 id="MyFeignConfig"><a href="#MyFeignConfig" class="headerlink" title="MyFeignConfig"></a>MyFeignConfig</h4><blockquote><p>题外话，跟着雷神学我现在也习惯点进源码看一看，而且不会啥也看不懂了，真不戳</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 配置feign</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFeignConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 配置请求拦截器，防止头丢失</span></span><br><span class="line">    <span class="comment">// 默认request拦截器是空,存入一个即可</span></span><br><span class="line">    <span class="meta">@Bean(&quot;requestInterceptor&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RequestInterceptor <span class="title">requestInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RequestInterceptor() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(RequestTemplate requestTemplate)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// RequestContextHolder利用了ThreadLocal，存放了请求内容</span></span><br><span class="line">                ServletRequestAttributes requestAttributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">                <span class="comment">// 获得request （原请求）</span></span><br><span class="line">                HttpServletRequest request = requestAttributes.getRequest();</span><br><span class="line">                <span class="comment">// 获得cookie 并存入新请求</span></span><br><span class="line">                requestTemplate.header(<span class="string">&quot;Cookie&quot;</span>, request.getHeader(<span class="string">&quot;Cookie&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="异步情况下丢失上下文"><a href="#异步情况下丢失上下文" class="headerlink" title="异步情况下丢失上下文"></a>异步情况下丢失上下文</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211122105832624.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211122105832624.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211122105832624"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RequestAttributes requestAttributes = RequestContextHolder.getRequestAttributes();</span><br><span class="line"> CompletableFuture&lt;Void&gt; addressFuture = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line"> <span class="comment">// 在异步请求中共享之前的请求数据</span></span><br><span class="line">            RequestContextHolder.setRequestAttributes(requestAttributes);</span><br><span class="line">&#125;, executor);</span><br></pre></td></tr></table></figure><h3 id="Order模块"><a href="#Order模块" class="headerlink" title="Order模块"></a>Order模块</h3><h4 id="OrderConfirmVo"><a href="#OrderConfirmVo" class="headerlink" title="OrderConfirmVo"></a>OrderConfirmVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单确认页模型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderConfirmVo</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 订单防重复令牌</span></span><br><span class="line">    <span class="keyword">private</span> String orderToken;</span><br><span class="line">    <span class="comment">// 收货地址表</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;MemberAddressVo&gt; address;</span><br><span class="line">    <span class="comment">// 订单商品</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderItemVo&gt; items;</span><br><span class="line">    <span class="comment">// 发票</span></span><br><span class="line">    <span class="comment">// 优惠</span></span><br><span class="line">    <span class="keyword">private</span> Integer integration;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal total;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal payPrice;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">getPayPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> total.subtract(<span class="keyword">new</span> BigDecimal(integration));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">getTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (OrderItemVo item : items) &#123;</span><br><span class="line">            total = total.add(item.getTotalPrice());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="OrderItemVo"><a href="#OrderItemVo" class="headerlink" title="OrderItemVo"></a>OrderItemVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderItemVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long skuId;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; skuAttr;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal totalPrice;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">getTotalPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.price.multiply(<span class="keyword">new</span> BigDecimal(<span class="keyword">this</span>.count));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="OrderWebController"><a href="#OrderWebController" class="headerlink" title="OrderWebController"></a>OrderWebController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 前往订单确认页</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/toTrade&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toConfirmPage</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">    OrderConfirmVo orderConfirmVo = orderService.confirmOrder();</span><br><span class="line">    model.addAttribute(<span class="string">&quot;orderConfirmData&quot;</span>, orderConfirmVo);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;confirm&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="OrderServiceImpl"><a href="#OrderServiceImpl" class="headerlink" title="OrderServiceImpl"></a>OrderServiceImpl</h4><blockquote><p>feign远程调用和页面进入不同，后者会带cookie，前者没有带header所有没有cookie</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 确认订单的信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> OrderConfirmVo <span class="title">confirmOrder</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    OrderConfirmVo orderConfirmVo = <span class="keyword">new</span> OrderConfirmVo();</span><br><span class="line">    <span class="comment">// TODO 设置防重复令牌</span></span><br><span class="line">    <span class="comment">// orderConfirmVo.setOrderToken();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置收货地址 (用户id可以从拦截器中的ThreadLocal的loginUser中查找)</span></span><br><span class="line">    CompletableFuture&lt;Void&gt; addressFuture = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">        R r = memberFeignService.getAddressListByMemberId(OrderLoginUserInterceptor.loginUser.get().getId());</span><br><span class="line">        <span class="keyword">if</span> (r.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">            List&lt;MemberAddressVo&gt; memberAddressVoList = r.getData(<span class="string">&quot;data&quot;</span>, <span class="keyword">new</span> TypeReference&lt;List&lt;MemberAddressVo&gt;&gt;() &#123;</span><br><span class="line">            &#125;);</span><br><span class="line">            orderConfirmVo.setAddress(memberAddressVoList);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.error(<span class="string">&quot;member远程调用失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, executor);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置购物项 （从redis中获取）</span></span><br><span class="line">    CompletableFuture&lt;Void&gt; itemFuture = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">        List&lt;OrderItemVo&gt; checkedCartItems = cartFeignService.getCheckedCartItems();</span><br><span class="line">        orderConfirmVo.setItems(checkedCartItems);</span><br><span class="line">    &#125;, executor);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置总价格 (get方法已经写好了)</span></span><br><span class="line">    <span class="comment">// 设置优惠价</span></span><br><span class="line">    orderConfirmVo.setIntegration(OrderLoginUserInterceptor.loginUser.get().getIntegration());</span><br><span class="line">    <span class="comment">// 设置支付价 (get方法已经写好了)</span></span><br><span class="line"></span><br><span class="line">    CompletableFuture.allOf(itemFuture, addressFuture).get();</span><br><span class="line">    <span class="keyword">return</span> orderConfirmVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="MemberFeignService"><a href="#MemberFeignService" class="headerlink" title="MemberFeignService"></a>MemberFeignService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;gulimall-member&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MemberFeignService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取对应会员的所有收货地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/member/memberreceiveaddress/&#123;memberId&#125;/list&quot;)</span></span><br><span class="line">    <span class="function">R <span class="title">getAddressListByMemberId</span><span class="params">(<span class="meta">@PathVariable(&quot;memberId&quot;)</span> Long memberId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CartFeignService"><a href="#CartFeignService" class="headerlink" title="CartFeignService"></a>CartFeignService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;gulimall-cart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CartFeignService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 获得购物车商品</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/checkItems&quot;)</span></span><br><span class="line">    <span class="function">List&lt;OrderItemVo&gt; <span class="title">getCheckedCartItems</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Member模块"><a href="#Member模块" class="headerlink" title="Member模块"></a>Member模块</h3><h4 id="MemberReceiveAddressController"><a href="#MemberReceiveAddressController" class="headerlink" title="MemberReceiveAddressController"></a>MemberReceiveAddressController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取对应会员的所有收货地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;memberId&#125;/list&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getAddressListByMemberId</span><span class="params">(<span class="meta">@PathVariable(&quot;memberId&quot;)</span> Long memberId)</span> </span>&#123;</span><br><span class="line">    List&lt;MemberReceiveAddressEntity&gt; addressList = memberReceiveAddressService.list(<span class="keyword">new</span> QueryWrapper&lt;MemberReceiveAddressEntity&gt;().eq(<span class="string">&quot;member_id&quot;</span>, memberId));</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, addressList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Cart模块"><a href="#Cart模块" class="headerlink" title="Cart模块"></a>Cart模块</h3><h4 id="CartServiceImpl"><a href="#CartServiceImpl" class="headerlink" title="CartServiceImpl"></a>CartServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 获取用户选中的所有商品</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;CartItemEntity&gt; <span class="title">getCheckedCartItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 从redis中根据userId获得cartItem</span></span><br><span class="line">    UserInfoTo userInfoTo = CartInterceptor.threadLocal.get();</span><br><span class="line">    <span class="comment">// 封装list</span></span><br><span class="line">    List&lt;CartItemEntity&gt; cartItem = getCartItem(CartConstant.CART_PREFIX + userInfoTo.getUserId());</span><br><span class="line">    <span class="keyword">return</span> cartItem.stream().filter(CartItemEntity::getCheck).map((item) -&gt; &#123;</span><br><span class="line">                <span class="comment">// 存放在redis中的购物项的价格可能会变（冗余字段，用id去查）</span></span><br><span class="line">                <span class="comment">// 我这里就不写了</span></span><br><span class="line">                <span class="comment">// item.setPrice();</span></span><br><span class="line">                <span class="keyword">return</span> item;</span><br><span class="line">            &#125;)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CartController"><a href="#CartController" class="headerlink" title="CartController"></a>CartController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 获得购物车商品</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/checkItems&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;CartItemEntity&gt; <span class="title">getCheckedCartItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;CartItemEntity&gt; cartItemEntityList = cartService.getCheckedCartItems();</span><br><span class="line">    <span class="keyword">return</span> cartItemEntityList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><blockquote><p>怎么说呢，感觉不是很想写网页前台了，现在写给用户的还是小程序 app这种流行，网页基本就是后台管理了，再加上thymeleaf实在是让人难受，就这样吧，不写了，我把重要的业务逻辑记录一下就行。</p><p>唉阻碍我的另一个原因是身体状况，突然理解了讲座的那位学长说的话，多锻炼身体，有体力才能继续啊。</p></blockquote><h2 id="接口幂等性"><a href="#接口幂等性" class="headerlink" title="接口幂等性"></a>接口幂等性</h2><blockquote><p>接口幂等性就是用户对于同一操作发起的一次请求或者多次请求的结果是一致的， 不会因为多次点击而产生了副作用； 比如说支付场景， 用户购买了商品支付扣款成功， 但是返回结果的时候网络异常， 此时钱已经扣了， 用户再次点击按钮， 此时会进行第二次扣款， 返回结果成功， 用户查询余额返发现多扣钱了， 流水记录也变成了两条． ． ． ,这就没有保证接口的幂等性。  </p></blockquote><h3 id="哪些情况需要防止"><a href="#哪些情况需要防止" class="headerlink" title="哪些情况需要防止"></a>哪些情况需要防止</h3><blockquote><ol><li>用户多次点击按钮</li><li>用户页面回退再次提交</li><li>微服务互相调用， 由于网络问题， 导致请求失败。 feign 触发重试机制</li><li>其他业务情况  </li></ol></blockquote><h3 id="什么情况下需要幂等"><a href="#什么情况下需要幂等" class="headerlink" title="什么情况下需要幂等"></a>什么情况下需要幂等</h3><blockquote><p>以 SQL 为例， 有些操作是天然幂等的。</p><p>SELECT * FROM table WHER id=?， 无论执行多少次都不会改变状态， 是天然的幂等。<br>UPDATE tab1 SET col1=1 WHERE col2=2， 无论执行成功多少次状态都是一致的， 也是幂等操作。<br>delete from user where userid=1， 多次操作， 结果一样， 具备幂等性<br>insert into user(userid,name) values(1,’a’) 如 userid 为唯一主键， 即重复操作上面的业务， 只<br>会插入一条用户数据， 具备幂等性。  </p><p>UPDATE tab1 SET col1=col1+1 WHERE col2=2， 每次执行的结果都会发生变化， 不是幂等的。<br>insert into user(userid,name) values(1,’a’) 如 userid 不是主键， 可以重复， 那上面业务多次操<br>作， 数据都会新增多条， 不具备幂等性。  </p></blockquote><h3 id="token-机制"><a href="#token-机制" class="headerlink" title="token 机制"></a>token 机制</h3><blockquote><p>1、 服务端提供了发送 token 的接口。 我们在分析业务的时候， 哪些业务是存在幂等问题的，<br>就必须在执行业务前， 先去获取 token， 服务器会把 token 保存到 redis 中。<br>2、然后调用业务接口请求时， 把 token 携带过去， 一般放在请求头部。<br>3、 服务器判断 token 是否存在 redis 中， 存在表示第一次请求， 然后删除 token,继续执行业<br>务。<br>4、 如果判断 token 不存在 redis 中， 就表示是重复操作， 直接返回重复标记给 client， 这样<br>就保证了业务代码， 不被重复执行。</p><p>危险性：<br>1、 先删除 token 还是后删除 token；<br>    (1) 先删除可能导致， 业务确实没有执行， 重试还带上之前 token， 由于防重设计导致，<br>请求还是不能执行。<br>    (2) 后删除可能导致， 业务处理成功， 但是服务闪断， 出现超时， 没有删除 token， 别<br>人继续重试， 导致业务被执行两边<br>    (3) 我们最好设计为先删除 token， 如果业务调用失败， 就重新获取 token 再次请求。<br>2、 Token 获取、 比较和删除必须是<strong>原子性</strong><br>    (1) redis.get(token) 、 token.equals、 redis.del(token)如果这两个操作不是原子， 可能导<br>致， 高并发下， 都 get 到同样的数据， 判断都成功， 继续业务并发执行<br>    (2) 可以在 redis 使用 lua 脚本完成这个操作<br>        if redis.call(‘get’, KEYS[1]) == ARGV[1] then return redis.call(‘del’, KEYS[1]) else return 0 end  </p></blockquote><h3 id="各种锁机制"><a href="#各种锁机制" class="headerlink" title="各种锁机制"></a>各种锁机制</h3><h4 id="数据库悲观锁"><a href="#数据库悲观锁" class="headerlink" title="数据库悲观锁"></a>数据库悲观锁</h4><blockquote><p>select * from xxxx where id = 1 for update;<br>悲观锁使用时一般伴随事务一起使用， 数据锁定时间可能会很长， 需要根据实际情况选用。<br>另外要注意的是， id 字段一定是主键或者唯一索引， 不然可能造成锁表的结果， 处理起来会<br>非常麻烦。    </p></blockquote><h4 id="数据库乐观锁"><a href="#数据库乐观锁" class="headerlink" title="数据库乐观锁"></a>数据库乐观锁</h4><blockquote><p>这种方法适合在更新的场景中，<br>update t_goods set count = count -1 , version = version + 1 where good_id=2 and version = 1<br>根据 version 版本， 也就是在操作库存前先获取当前商品的 version 版本号， 然后操作的时候<br>带上此 version 号。 我们梳理下， 我们第一次操作库存时， 得到 version 为 1， 调用库存服务<br>version 变成了 2； 但返回给订单服务出现了问题， 订单服务又一次发起调用库存服务， 当订<br>单服务传如的 version 还是 1， 再执行上面的 sql 语句时， 就不会执行； 因为 version 已经变<br>为 2 了， where 条件就不成立。 这样就保证了不管调用几次， 只会真正的处理一次。<br>乐观锁主要使用于处理读多写少的问题  </p></blockquote><h4 id="业务层分布式锁"><a href="#业务层分布式锁" class="headerlink" title="业务层分布式锁"></a>业务层分布式锁</h4><blockquote><p>如果多个机器可能在同一时间同时处理相同的数据， 比如多台机器定时任务都拿到了相同数<br>据处理， 我们就可以加分布式锁， 锁定此数据， 处理完成后释放锁。 获取到锁的必须先判断<br>这个数据是否被处理过。  </p></blockquote><h3 id="各种唯一约束"><a href="#各种唯一约束" class="headerlink" title="各种唯一约束"></a>各种唯一约束</h3><h4 id="数据库唯一约束"><a href="#数据库唯一约束" class="headerlink" title="数据库唯一约束"></a>数据库唯一约束</h4><blockquote><p>插入数据， 应该按照唯一索引进行插入， 比如订单号， 相同的订单就不可能有两条记录插入。<br>我们在数据库层面防止重复。<br>这个机制是利用了数据库的主键唯一约束的特性， 解决了在 insert 场景时幂等问题。 但主键<br>的要求不是自增的主键， 这样就需要业务生成全局唯一的主键。<br>如果是分库分表场景下， 路由规则要保证相同请求下， 落地在同一个数据库和同一表中， 要<br>不然数据库主键约束就不起效果了， 因为是不同的数据库和表主键不相关。  </p></blockquote><h4 id="redis-set-防重"><a href="#redis-set-防重" class="headerlink" title="redis set 防重"></a>redis set 防重</h4><blockquote><p>很多数据需要处理， 只能被处理一次， 比如我们可以计算数据的 MD5 将其放入 redis 的 set，<br>每次处理数据， 先看这个 MD5 是否已经存在， 存在就不处理  </p></blockquote><h3 id="防重表"><a href="#防重表" class="headerlink" title="防重表"></a>防重表</h3><blockquote><p>使用订单号 orderNo 做为去重表的唯一索引， 把唯一索引插入去重表， 再进行业务操作， 且<br>他们在同一个事务中。 这个保证了重复请求时， 因为去重表有唯一约束， 导致请求失败， 避<br>免了幂等问题。 这里要注意的是， 去重表和业务表应该在同一库中， 这样就保证了在同一个<br>事务， 即使业务操作失败了， 也会把去重表的数据回滚。 这个很好的保证了数据一致性。<br>之前说的 redis 防重也算  </p></blockquote><h3 id="全局请求唯一-id"><a href="#全局请求唯一-id" class="headerlink" title="全局请求唯一 id"></a>全局请求唯一 id</h3><blockquote><p>调用接口时， 生成一个唯一 id， redis 将数据保存到集合中（去重） ， 存在即处理过。<br>可以使用 nginx 设置每一个请求的唯一 id；<br>proxy_set_header X-Request-Id $request_id;  </p></blockquote><h3 id="订单提交-token"><a href="#订单提交-token" class="headerlink" title="订单提交 token"></a>订单提交 token</h3><h4 id="添加token"><a href="#添加token" class="headerlink" title="添加token"></a>添加token</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String token = UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">redisTemplate.opsForValue().set(AuthServerConstant.USER_ORDER_TOKEN_PREFIX + memberRespVo.getId(), token, <span class="number">30</span>, TimeUnit.MINUTES);</span><br><span class="line">confirmVo.setOrderToken(token);</span><br></pre></td></tr></table></figure><h4 id="原子验证token"><a href="#原子验证token" class="headerlink" title="原子验证token"></a>原子验证token</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transaction</span> <span class="comment">// 本第事务，只能控制自己服务的事务</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SubmitOrderResponseVo <span class="title">submitOrder</span><span class="params">(OrderSubmitVo vo)</span> </span>&#123;</span><br><span class="line">        confirmVoThreadLocal.set(vo);</span><br><span class="line">        SubmitOrderResponseVo response = <span class="keyword">new</span> SubmitOrderResponseVo();</span><br><span class="line">        MemberRespVo memberRespVo = LoginUserInterceptor.loginUser.get();</span><br><span class="line">        response.setCode(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//1、验证令牌【令牌的对比和删除必须保证原子性】</span></span><br><span class="line">        <span class="comment">//0令牌失败 - 1删除成功</span></span><br><span class="line">        String script = <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;</span>;</span><br><span class="line">        String orderToken = vo.getOrderToken();</span><br><span class="line">        <span class="comment">//原子验证令牌和删除令牌</span></span><br><span class="line">        Long result = redisTemplate.execute(<span class="keyword">new</span> DefaultRedisScript&lt;Long&gt;(script, Long.class), Arrays.asList(OrderConstant.USER_ORDER_TOKEN_PREFIX + memberRespVo.getId()), orderToken);</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="number">0L</span>) &#123;</span><br><span class="line">            <span class="comment">//令牌验证失败</span></span><br><span class="line">            response.setCode(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//令牌验证成功</span></span><br><span class="line">            <span class="comment">//下单：去创建订单，验令牌，验价格，锁库存...</span></span><br><span class="line">            <span class="comment">//1、创建订单，订单项等信息</span></span><br><span class="line">            OrderCreateTo order = createOrder();</span><br><span class="line">            <span class="comment">//2、验价</span></span><br><span class="line">            BigDecimal payAmount = order.getOrder().getPayAmount();</span><br><span class="line">            BigDecimal payPrice = vo.getPayPrice();</span><br><span class="line">            <span class="keyword">if</span> (Math.abs(payAmount.subtract(payPrice).doubleValue()) &lt; <span class="number">0.01</span>) &#123;</span><br><span class="line">                <span class="comment">//金额对比</span></span><br><span class="line">                <span class="comment">//....</span></span><br><span class="line">                <span class="comment">//TODO 3、保存订单</span></span><br><span class="line">                saveOrder(order);</span><br><span class="line">                <span class="comment">//4、库存锁定。只要有异常回滚订单数据。</span></span><br><span class="line">                <span class="comment">// 订单号，所有订单项（skuId，skuName，num）</span></span><br><span class="line">                WareSkuLockVo lockVo = <span class="keyword">new</span> WareSkuLockVo();</span><br><span class="line">                lockVo.setOrderSn(order.getOrder().getOrderSn());</span><br><span class="line">                List&lt;OrderItemVo&gt; locks = order.getOrderItems().stream().map(item -&gt; &#123;</span><br><span class="line">                    OrderItemVo itemVo = <span class="keyword">new</span> OrderItemVo();</span><br><span class="line">                    itemVo.setSkuId(item.getSkuId());</span><br><span class="line">                    itemVo.setCount(item.getSkuQuantity());</span><br><span class="line">                    itemVo.setTitle(item.getSkuName());</span><br><span class="line">                    <span class="keyword">return</span> itemVo;</span><br><span class="line">                &#125;).collect(Collectors.toList());</span><br><span class="line">                lockVo.setLocks(locks);</span><br><span class="line">                <span class="comment">//4、远程锁库存</span></span><br><span class="line">                <span class="comment">//库存成功了，但是网络原因超时了，订单回滚，库存不滚。</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//为了保证高并发。库存服务自己回滚。可以发消息给库存服务；</span></span><br><span class="line">                <span class="comment">//库存服务本身也可以使用自动解锁模式  消息</span></span><br><span class="line">                R r = wmsFeignService.orderLockStock(lockVo);</span><br><span class="line">                <span class="keyword">if</span> (r.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">//锁成功了</span></span><br><span class="line">                    response.setOrder(order.getOrder());</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//TODO 5、远程扣减积分 出异常</span></span><br><span class="line"><span class="comment">//                    int i = 10/0; //订单回滚，库存不滚</span></span><br><span class="line">                    <span class="comment">//订单创建成功发送消息给MQ</span></span><br><span class="line">                    rabbitTemplate.convertAndSend(<span class="string">&quot;order-event-exchange&quot;</span>, <span class="string">&quot;order.create.order&quot;</span>, order.getOrder());</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//TODO 6、清除购物车已经下单的商品</span></span><br><span class="line">                    <span class="keyword">return</span> response;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//锁定失败</span></span><br><span class="line">                    String msg = (String) r.get(<span class="string">&quot;msg&quot;</span>);</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> NoStockException(msg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                response.setCode(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h2 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h2><h3 id="本地事务"><a href="#本地事务" class="headerlink" title="本地事务"></a>本地事务</h3><blockquote><p>详见文档                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211124185045824.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211124185045824.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211124185045824"></p><h4 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h4><blockquote><p>READ UNCOMMITTED（读未提交）<br>该隔离级别的事务会读到其它未提交事务的数据， 此现象也称之为脏读。</p><p>READ COMMITTED（ 读提交）<br>一个事务可以读取另一个已提交的事务， 多次读取会造成不一样的结果， 此现象称为不可重<br>复读问题， Oracle 和 SQL Server 的默认隔离级别。</p><p>REPEATABLE READ（ 可重复读）<br>该隔离级别是 MySQL 默认的隔离级别， 在同一个事务里， select 的结果是事务开始时时间<br>点的状态， 因此， 同样的 select 操作读到的结果会是一致的， 但是， 会有幻读现象。 MySQL<br>的 InnoDB 引擎可以通过 next-key locks 机制（ 参考下文”行锁的算法”一节） 来避免幻读。</p><p>SERIALIZABLE（ 序列化）<br>在该隔离级别下事务都是串行顺序执行的， MySQL 数据库的 InnoDB 引擎会给读操作隐式<br>加一把读共享锁， 从而避免了脏读、 不可重读复读和幻读问题。  </p></blockquote><h4 id="事务的传播行为"><a href="#事务的传播行为" class="headerlink" title="事务的传播行为"></a>事务的传播行为</h4><blockquote><p>1、 PROPAGATION_REQUIRED： 如果当前没有事务， 就创建一个新事务， 如果当前存在事务，<br>就加入该事务， 该设置是最常用的设置。<br>2、 PROPAGATION_SUPPORTS： 支持当前事务， 如果当前存在事务， 就加入该事务， 如果当<br>前不存在事务， 就以非事务执行。<br>3、 PROPAGATION_MANDATORY： 支持当前事务， 如果当前存在事务， 就加入该事务， 如果<br>当前不存在事务， 就抛出异常。<br>4、 PROPAGATION_REQUIRES_NEW： 创建新事务， 无论当前存不存在事务， 都创建新事务。<br>5、 PROPAGATION_NOT_SUPPORTED： 以非事务方式执行操作， 如果当前存在事务， 就把当<br>前事务挂起。<br>6、 PROPAGATION_NEVER： 以非事务方式执行， 如果当前存在事务， 则抛出异常。<br>7、 PROPAGATION_NESTED： 如果当前存在事务， 则在嵌套事务内执行。 如果当前没有事务，<br>则执行与 PROPAGATION_REQUIRED 类似的操作  </p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
            <tag> redis </tag>
            
            <tag> 微服务 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】商城项目实战6</title>
      <link href="/2021/11/17/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-6/"/>
      <url>/2021/11/17/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-6/</url>
      
        <content type="html"><![CDATA[<h2 id="认证服务-短信验证码"><a href="#认证服务-短信验证码" class="headerlink" title="认证服务 - 短信验证码"></a>认证服务 - 短信验证码</h2><h3 id="基础环境搭建"><a href="#基础环境搭建" class="headerlink" title="基础环境搭建"></a>基础环境搭建</h3><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><blockquote><p>开启nacos，feign</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># spring</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># nacos 注册中心</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment"># nacos地址</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">  <span class="comment"># 服务名</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-auto-server</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="comment">#    时间戳格式化</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">  <span class="attr">thymeleaf:</span></span><br><span class="line">    <span class="comment"># thymeleaf缓存</span></span><br><span class="line">    <span class="attr">cache:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">#服务器</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">20000</span></span><br></pre></td></tr></table></figure><h4 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h4><blockquote><p>放入登录注册页面文件，静态资源放到nacos中</p></blockquote><h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><blockquote><ol><li>host</li><li>gateway</li></ol></blockquote><h3 id="viewController"><a href="#viewController" class="headerlink" title="viewController"></a>viewController</h3><blockquote><p>templates下不为index名的html页面都需要通过controller映射后跳转</p><p>如果只是跳转不写任何其他方法，可以使用viewController</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 重写，可以添加urlPath和视图名的对应映射</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/login.html&quot;</span>).setViewName(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">        registry.addViewController(<span class="string">&quot;/reg.html&quot;</span>).setViewName(<span class="string">&quot;reg&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="发送验证码倒计时"><a href="#发送验证码倒计时" class="headerlink" title="发送验证码倒计时"></a>发送验证码倒计时</h3><blockquote><p>使用定时器</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 验证码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;register-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;other_label&quot;</span>&gt;</span>验 证 码</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;code&quot;</span> <span class="attr">maxlength</span>=<span class="string">&quot;20&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入验证码&quot;</span> <span class="attr">class</span>=<span class="string">&quot;caa&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;sendCode&quot;</span>&gt;</span> 发送验证码 <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tips&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color:red&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">th:text</span>=<span class="string">&quot;$&#123;errors!=null?(#maps.containsKey(errors, &#x27;code&#x27;)?errors.code:&#x27;&#x27;):&#x27;&#x27;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">&quot;#sendCode&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//2、倒计时</span></span><br><span class="line">        <span class="keyword">if</span> ($(<span class="built_in">this</span>).hasClass(<span class="string">&quot;disabled&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">//正在倒计时。</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//1、给指定手机号发送验证码</span></span><br><span class="line">            $.get(<span class="string">&quot;/sms/sendcode?phone=&quot;</span> + $(<span class="string">&quot;#phoneNum&quot;</span>).val(), <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (data.code != <span class="number">0</span>) &#123;</span><br><span class="line">                    alert(data.msg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            timeoutChangeStyle();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> num = <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeoutChangeStyle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">&quot;#sendCode&quot;</span>).attr(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;disabled&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">0</span>) &#123;</span><br><span class="line">        $(<span class="string">&quot;#sendCode&quot;</span>).text(<span class="string">&quot;发送验证码&quot;</span>);</span><br><span class="line">        num = <span class="number">60</span>;</span><br><span class="line">        $(<span class="string">&quot;#sendCode&quot;</span>).attr(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> str = num + <span class="string">&quot;s 后再次发送&quot;</span>;</span><br><span class="line">        $(<span class="string">&quot;#sendCode&quot;</span>).text(str);</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="string">&quot;timeoutChangeStyle()&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    num--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="短信验证码"><a href="#短信验证码" class="headerlink" title="短信验证码"></a>短信验证码</h3><blockquote><p>写在第三方工具的模块中</p></blockquote><h4 id="HttpClient"><a href="#HttpClient" class="headerlink" title="HttpClient"></a>HttpClient</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 重要提示如下:</span></span><br><span class="line"><span class="comment">    * HttpUtils请从</span></span><br><span class="line"><span class="comment">    * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/src/main/java/com/aliyun/api/gateway/demo/util/HttpUtils.java</span></span><br><span class="line"><span class="comment">    * 下载</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * 相应的依赖请参照</span></span><br><span class="line"><span class="comment">    * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/pom.xml</span></span><br><span class="line"><span class="comment">    */</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.gulimall.thirdparty.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.NameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.HttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpDelete;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPut;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ClientConnectionManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.scheme.Scheme;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.scheme.SchemeRegistry;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ssl.SSLSocketFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.ByteArrayEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.StringEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.DefaultHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.message.BasicNameValuePair;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLContext;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.TrustManager;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.X509TrustManager;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyManagementException;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.X509Certificate;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doGet</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     Map&lt;String, String&gt; querys)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpGet request = <span class="keyword">new</span> HttpGet(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * post form</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bodys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPost</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      Map&lt;String, String&gt; bodys)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPost request = <span class="keyword">new</span> HttpPost(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (bodys != <span class="keyword">null</span>) &#123;</span><br><span class="line">            List&lt;NameValuePair&gt; nameValuePairList = <span class="keyword">new</span> ArrayList&lt;NameValuePair&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (String key : bodys.keySet()) &#123;</span><br><span class="line">                nameValuePairList.add(<span class="keyword">new</span> BasicNameValuePair(key, bodys.get(key)));</span><br><span class="line">            &#125;</span><br><span class="line">            UrlEncodedFormEntity formEntity = <span class="keyword">new</span> UrlEncodedFormEntity(nameValuePairList, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            formEntity.setContentType(<span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>);</span><br><span class="line">            request.setEntity(formEntity);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Post String</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPost</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      String body)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPost request = <span class="keyword">new</span> HttpPost(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(body)) &#123;</span><br><span class="line">            request.setEntity(<span class="keyword">new</span> StringEntity(body, <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Post stream</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPost</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="keyword">byte</span>[] body)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPost request = <span class="keyword">new</span> HttpPost(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (body != <span class="keyword">null</span>) &#123;</span><br><span class="line">            request.setEntity(<span class="keyword">new</span> ByteArrayEntity(body));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Put String</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPut</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     String body)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPut request = <span class="keyword">new</span> HttpPut(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(body)) &#123;</span><br><span class="line">            request.setEntity(<span class="keyword">new</span> StringEntity(body, <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Put stream</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPut</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     <span class="keyword">byte</span>[] body)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPut request = <span class="keyword">new</span> HttpPut(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (body != <span class="keyword">null</span>) &#123;</span><br><span class="line">            request.setEntity(<span class="keyword">new</span> ByteArrayEntity(body));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Delete</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doDelete</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        Map&lt;String, String&gt; querys)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpDelete request = <span class="keyword">new</span> HttpDelete(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">buildUrl</span><span class="params">(String host, String path, Map&lt;String, String&gt; querys)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">        StringBuilder sbUrl = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sbUrl.append(host);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isBlank(path)) &#123;</span><br><span class="line">            sbUrl.append(path);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != querys) &#123;</span><br><span class="line">            StringBuilder sbQuery = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; query : querys.entrySet()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> &lt; sbQuery.length()) &#123;</span><br><span class="line">                    sbQuery.append(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.isBlank(query.getKey()) &amp;&amp; !StringUtils.isBlank(query.getValue())) &#123;</span><br><span class="line">                    sbQuery.append(query.getValue());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!StringUtils.isBlank(query.getKey())) &#123;</span><br><span class="line">                    sbQuery.append(query.getKey());</span><br><span class="line">                    <span class="keyword">if</span> (!StringUtils.isBlank(query.getValue())) &#123;</span><br><span class="line">                        sbQuery.append(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">                        sbQuery.append(URLEncoder.encode(query.getValue(), <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> &lt; sbQuery.length()) &#123;</span><br><span class="line">                sbUrl.append(<span class="string">&quot;?&quot;</span>).append(sbQuery);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sbUrl.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> HttpClient <span class="title">wrapClient</span><span class="params">(String host)</span> </span>&#123;</span><br><span class="line">        HttpClient httpClient = <span class="keyword">new</span> DefaultHttpClient();</span><br><span class="line">        <span class="keyword">if</span> (host.startsWith(<span class="string">&quot;https://&quot;</span>)) &#123;</span><br><span class="line">            sslClient(httpClient);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sslClient</span><span class="params">(HttpClient httpClient)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SSLContext ctx = SSLContext.getInstance(<span class="string">&quot;TLS&quot;</span>);</span><br><span class="line">            X509TrustManager tm = <span class="keyword">new</span> X509TrustManager() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkClientTrusted</span><span class="params">(X509Certificate[] xcs, String str)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkServerTrusted</span><span class="params">(X509Certificate[] xcs, String str)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            ctx.init(<span class="keyword">null</span>, <span class="keyword">new</span> TrustManager[]&#123;tm&#125;, <span class="keyword">null</span>);</span><br><span class="line">            SSLSocketFactory ssf = <span class="keyword">new</span> SSLSocketFactory(ctx);</span><br><span class="line">            ssf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);</span><br><span class="line">            ClientConnectionManager ccm = httpClient.getConnectionManager();</span><br><span class="line">            SchemeRegistry registry = ccm.getSchemeRegistry();</span><br><span class="line">            registry.register(<span class="keyword">new</span> Scheme(<span class="string">&quot;https&quot;</span>, <span class="number">443</span>, ssf));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyManagementException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(ex);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>HttpClient是阿里云已经封装好的</p></blockquote><blockquote><p>阿里云搜短信，然后找到下面的第三方提供的服务，不过模板要联系客服？我不理解</p><p>这块不记录了，短信还是用不了</p></blockquote><h4 id="SmsComponent"><a href="#SmsComponent" class="headerlink" title="SmsComponent"></a>SmsComponent</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;gulimall.alicloud.sms&quot;)</span>    <span class="comment">// 外部化配置</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="keyword">private</span> String path;</span><br><span class="line">    <span class="keyword">private</span> String appcode;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送短信验证码</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendCode</span><span class="params">(String phone, String code)</span> </span>&#123;</span><br><span class="line">        String method = <span class="string">&quot;POST&quot;</span>;</span><br><span class="line">        Map&lt;String, String&gt; headers = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        <span class="comment">//最后在header中的格式(中间是英文空格)为Authorization:APPCODE 83359fd73fe94948385f570e3c139105</span></span><br><span class="line">        headers.put(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;APPCODE &quot;</span> + appcode);</span><br><span class="line">        Map&lt;String, String&gt; querys = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        querys.put(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;【gulimall】你的验证码是：&quot;</span> + code + <span class="string">&quot;，3分钟内有效！&quot;</span>);</span><br><span class="line">        querys.put(<span class="string">&quot;mobile&quot;</span>, phone);</span><br><span class="line">        Map&lt;String, String&gt; bodys = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 重要提示如下:</span></span><br><span class="line"><span class="comment">             * HttpUtils请从</span></span><br><span class="line"><span class="comment">             * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/src/main/java/com/aliyun/api/gateway/demo/util/HttpUtils.java</span></span><br><span class="line"><span class="comment">             * 下载</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * 相应的依赖请参照</span></span><br><span class="line"><span class="comment">             * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/pom.xml</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            HttpResponse response = HttpUtils.doPost(host, path, method, headers, querys, bodys);</span><br><span class="line">            System.out.println(response.toString());</span><br><span class="line">            <span class="comment">//获取response的body</span></span><br><span class="line">            <span class="comment">//System.out.println(EntityUtils.toString(response.getEntity()));</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义 短信服务配置</span></span><br><span class="line"><span class="attr">gulimall:</span></span><br><span class="line">  <span class="attr">alicloud:</span></span><br><span class="line">    <span class="attr">sms:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">https://cxwg.market.alicloudapi.com</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/sendSms</span></span><br><span class="line">      <span class="attr">appcode:</span> <span class="string">你自己的AppCode</span></span><br></pre></td></tr></table></figure><h4 id="SmsSendController"><a href="#SmsSendController" class="headerlink" title="SmsSendController"></a>SmsSendController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/sms&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsSendController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SmsComponent smsComponent;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 提供调用接口</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sms/sendCode&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">sendCode</span><span class="params">(<span class="meta">@RequestParam(&quot;phone&quot;)</span> String phone, <span class="meta">@RequestParam(&quot;code&quot;)</span> String code)</span> </span>&#123;</span><br><span class="line">        smsComponent.sendCode(phone, code);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="远程调用发送短信验证码服务"><a href="#远程调用发送短信验证码服务" class="headerlink" title="远程调用发送短信验证码服务"></a>远程调用发送短信验证码服务</h3><blockquote><p>auth模块调用third-part模块的短信服务</p></blockquote><h4 id="ThirdPartFeignService"><a href="#ThirdPartFeignService" class="headerlink" title="ThirdPartFeignService"></a>ThirdPartFeignService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.gulimall.auth.feign;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.common.utils.R;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 第三方服务的远程接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FeignClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ThirdPartFeignService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 远程调用发送短信验证码服务</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sms/sendCode&quot;)</span></span><br><span class="line">    <span class="function">R <span class="title">sendCode</span><span class="params">(<span class="meta">@RequestParam(&quot;phone&quot;)</span> String phone, <span class="meta">@RequestParam(&quot;code&quot;)</span> String code)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="LoginController"><a href="#LoginController" class="headerlink" title="LoginController"></a>LoginController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ThirdPartFeignService thirdPartFeignService;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sms/sendcode&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">sendCode</span><span class="params">(<span class="meta">@RequestParam(&quot;phone&quot;)</span> String phone)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 随机生成验证码</span></span><br><span class="line">        String code = UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">        thirdPartFeignService.sendCode(phone, code);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="验证码防刷验证"><a href="#验证码防刷验证" class="headerlink" title="验证码防刷验证"></a>验证码防刷验证</h3><blockquote><p>防刷+校验时间</p><p>使用redis并配置好地址</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ThirdPartFeignService thirdPartFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sms/sendcode&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">sendCode</span><span class="params">(<span class="meta">@RequestParam(&quot;phone&quot;)</span> String phone)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 判断redis中是否有该手机号的验证码，并且在过期时间内</span></span><br><span class="line">        String existCode = redisTemplate.opsForValue().get(AuthServerConstant.SMS_CODE_CACHE_PREDIX + phone);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(existCode)) &#123;</span><br><span class="line">            <span class="keyword">long</span> preTime = Long.parseLong(existCode.split(<span class="string">&quot;_&quot;</span>)[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">if</span> ((System.currentTimeMillis() - preTime) &lt; <span class="number">60000</span>) &#123;</span><br><span class="line">                <span class="comment">// 存在小于六十秒，不能再发验证码</span></span><br><span class="line">                <span class="keyword">return</span> R.error(BizCodeEnum.SMS_CODE_EXCEPTION.getCode(), BizCodeEnum.SMS_CODE_EXCEPTION.getMsg());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 随机生成验证码+系统时间，防刷</span></span><br><span class="line">        String code = UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">        <span class="comment">// 存入redis(key:value == prefix+phone:code)，并设置超时时间</span></span><br><span class="line">        redisTemplate.opsForValue().set(AuthServerConstant.SMS_CODE_CACHE_PREDIX + phone, code + <span class="string">&quot;_&quot;</span> + System.currentTimeMillis(), <span class="number">10</span>, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">// 发送短信</span></span><br><span class="line">        thirdPartFeignService.sendCode(phone, code);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="认证服务-注册"><a href="#认证服务-注册" class="headerlink" title="认证服务 - 注册"></a>认证服务 - 注册</h2><blockquote><p>使用JSR303校验</p></blockquote><h3 id="Auth模块"><a href="#Auth模块" class="headerlink" title="Auth模块"></a>Auth模块</h3><h4 id="UserRegistVo"><a href="#UserRegistVo" class="headerlink" title="UserRegistVo"></a>UserRegistVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRegistVo</span> </span>&#123;</span><br><span class="line">    <span class="comment">// JSR303校验</span></span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;用户名必须提交&quot;)</span></span><br><span class="line">    <span class="meta">@Length(min = 6, max = 18, message = &quot;用户名必须是6-18位字符&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;密码必须填写&quot;)</span></span><br><span class="line">    <span class="meta">@Length(min = 6, max = 18, message = &quot;密码必须是6-18位字符&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;手机号必须填写&quot;)</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^[1]([3-9])[0-9]&#123;9&#125;$&quot;, message = &quot;手机号格式不正确&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;验证码必须填写&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="MemberFeignService"><a href="#MemberFeignService" class="headerlink" title="MemberFeignService"></a>MemberFeignService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;gulimall-member&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MemberFeignService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册会员</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/member/member/regist&quot;)</span></span><br><span class="line">    <span class="function">R <span class="title">regist</span><span class="params">(<span class="meta">@RequestBody</span> UserRegistVo registVo)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="LoginController-1"><a href="#LoginController-1" class="headerlink" title="LoginController"></a>LoginController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/regist&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">register</span><span class="params">(<span class="meta">@Valid</span> UserRegistVo vo, BindingResult bindingResult,</span></span></span><br><span class="line"><span class="params"><span class="function">                       RedirectAttributes attributes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (bindingResult.hasErrors()) &#123;</span><br><span class="line">        Map&lt;String, String&gt; errors = bindingResult.getFieldErrors().stream().collect(Collectors.toMap(FieldError::getField, FieldError::getDefaultMessage));</span><br><span class="line">        <span class="comment">//  校验有错误</span></span><br><span class="line">        <span class="comment">// RedirectAttributes 用于重定向带数据</span></span><br><span class="line">        attributes.addFlashAttribute(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/reg.html&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 远程注册服务</span></span><br><span class="line">    <span class="comment">// 1 校验验证码</span></span><br><span class="line">    String inputCode = vo.getCode();</span><br><span class="line">    String existCode = redisTemplate.opsForValue().get(AuthServerConstant.SMS_CODE_CACHE_PREDIX + vo.getPhone());</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(existCode)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (inputCode.equals(existCode.split(<span class="string">&quot;_&quot;</span>)[<span class="number">0</span>])) &#123;</span><br><span class="line">            <span class="comment">//  验证码正确</span></span><br><span class="line">            <span class="comment">//  删除验证码</span></span><br><span class="line">            redisTemplate.delete(AuthServerConstant.SMS_CODE_CACHE_PREDIX + vo.getPhone());</span><br><span class="line">            <span class="comment">//  远程调用会员服务</span></span><br><span class="line">            R r = memberFeignService.regist(vo);</span><br><span class="line">            <span class="keyword">if</span> (r.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 注册成功</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/login.html&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 远程服务异常</span></span><br><span class="line">                Map&lt;String, String&gt; errors = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">                errors.put(<span class="string">&quot;msg&quot;</span>, r.getMsg());</span><br><span class="line">                attributes.addFlashAttribute(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/reg.html&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 验证码错误</span></span><br><span class="line">            Map&lt;String, String&gt; errors = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">            errors.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">            attributes.addFlashAttribute(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/reg.html&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 不存在验证码</span></span><br><span class="line">        Map&lt;String, String&gt; errors = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        errors.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">        attributes.addFlashAttribute(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/reg.html&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Member模块"><a href="#Member模块" class="headerlink" title="Member模块"></a>Member模块</h3><h4 id="MemberController"><a href="#MemberController" class="headerlink" title="MemberController"></a>MemberController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;member/member&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册会员</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/regist&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">regist</span><span class="params">(<span class="meta">@RequestBody</span> UserRegistVo registVo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 可能会抛已存在的异常</span></span><br><span class="line">            memberService.regist(registVo);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (PhoneExistException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(BizCodeEnum.PHONE_EXIST_EXCEPTION.getCode(), BizCodeEnum.PHONE_EXIST_EXCEPTION.getMsg());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UsernameExistException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(BizCodeEnum.USERNAME_EXIST_EXCEPTION.getCode(), BizCodeEnum.USERNAME_EXIST_EXCEPTION.getMsg());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="MemberServiceImpl"><a href="#MemberServiceImpl" class="headerlink" title="MemberServiceImpl"></a>MemberServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;memberService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">MemberDao</span>, <span class="title">MemberEntity</span>&gt; <span class="keyword">implements</span> <span class="title">MemberService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MemberLevelService levelService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">regist</span><span class="params">(UserRegistVo registVo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 检查用户名和手机号的唯一性</span></span><br><span class="line"></span><br><span class="line">        MemberEntity member = <span class="keyword">new</span> MemberEntity();</span><br><span class="line">        member.setUsername(registVo.getUserName());</span><br><span class="line">        member.setMobile(registVo.getPhone());</span><br><span class="line"></span><br><span class="line">        member.setLevelId(levelService.getDefaultLevel().getId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断是否已存在</span></span><br><span class="line">        checkPhoneUnique(registVo.getPhone());</span><br><span class="line">        checkUsernameUnique(registVo.getUserName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 加密</span></span><br><span class="line">        BCryptPasswordEncoder passwordEncoder = <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">        member.setPassword(passwordEncoder.encode(registVo.getPassword()));</span><br><span class="line"></span><br><span class="line">        baseMapper.insert(member);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkPhoneUnique</span><span class="params">(String phone)</span> <span class="keyword">throws</span> PhoneExistException </span>&#123;</span><br><span class="line">        Integer mobile = baseMapper.selectCount(<span class="keyword">new</span> QueryWrapper&lt;MemberEntity&gt;().eq(<span class="string">&quot;mobile&quot;</span>, phone));</span><br><span class="line">        <span class="keyword">if</span> (mobile &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> PhoneExistException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkUsernameUnique</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameExistException </span>&#123;</span><br><span class="line">        Integer existUsername = baseMapper.selectCount(<span class="keyword">new</span> QueryWrapper&lt;MemberEntity&gt;().eq(<span class="string">&quot;username&quot;</span>, username));</span><br><span class="line">        <span class="keyword">if</span> (existUsername &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameExistException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="异常机制"><a href="#异常机制" class="headerlink" title="异常机制"></a>异常机制</h3><h4 id="异常类UsernameExistException"><a href="#异常类UsernameExistException" class="headerlink" title="异常类UsernameExistException"></a>异常类UsernameExistException</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UsernameExistException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UsernameExistException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="异常类PhoneExistException"><a href="#异常类PhoneExistException" class="headerlink" title="异常类PhoneExistException"></a>异常类PhoneExistException</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneExistException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PhoneExistException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">&quot;手机号已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="MD5盐值加密"><a href="#MD5盐值加密" class="headerlink" title="MD5盐值加密"></a>MD5盐值加密</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211117163550640.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211117163550640.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211117163550640"></p><blockquote><p>MD5可以使用彩虹表暴力破解，所以需要加盐</p></blockquote><h2 id="认证服务-账号登录"><a href="#认证服务-账号登录" class="headerlink" title="认证服务 - 账号登录"></a>认证服务 - 账号登录</h2><h3 id="Auth模块-1"><a href="#Auth模块-1" class="headerlink" title="Auth模块"></a>Auth模块</h3><h4 id="UserLoginVo"><a href="#UserLoginVo" class="headerlink" title="UserLoginVo"></a>UserLoginVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserLoginVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String loginacct;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="MemberFeignService-1"><a href="#MemberFeignService-1" class="headerlink" title="MemberFeignService"></a>MemberFeignService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;gulimall-member&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MemberFeignService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册会员</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/member/member/regist&quot;)</span></span><br><span class="line">    <span class="function">R <span class="title">regist</span><span class="params">(<span class="meta">@RequestBody</span> UserRegistVo registVo)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 会员登录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/member/member/login&quot;)</span></span><br><span class="line">    <span class="function">R <span class="title">login</span><span class="params">(<span class="meta">@RequestBody</span> UserLoginVo loginVo)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="LoginController-2"><a href="#LoginController-2" class="headerlink" title="LoginController"></a>LoginController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(UserLoginVo vo, RedirectAttributes attributes)</span> </span>&#123;</span><br><span class="line">        R r = memberFeignService.login(vo);</span><br><span class="line">        <span class="keyword">if</span> (r.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 登录成功</span></span><br><span class="line">            <span class="comment">// r取出来的值为map类型，map -&gt; json -&gt; bean</span></span><br><span class="line">            String memberJSON = JSONObject.toJSONString(r.get(<span class="string">&quot;member&quot;</span>));</span><br><span class="line">            MemberEntityVo memberEntityVo = JSON.parseObject(memberJSON, MemberEntityVo.class);</span><br><span class="line">            log.info(<span class="string">&quot;登陆成功，用户：&#123;&#125;&quot;</span>, memberJSON);</span><br><span class="line">            <span class="comment">// 保存用户信息至session,注意这里对象的类必须实现序列化，才能保存到redis中</span></span><br><span class="line">            session.setAttribute(AuthServerConstant.LOGIN_USER, memberEntityVo);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:http://gulimall.com&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 账号或密码错误</span></span><br><span class="line">            Map&lt;String, String&gt; errors = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">            errors.put(<span class="string">&quot;msg&quot;</span>, r.getMsg());</span><br><span class="line">            attributes.addFlashAttribute(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/login.html&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Member模块-1"><a href="#Member模块-1" class="headerlink" title="Member模块"></a>Member模块</h3><h4 id="MemberController-1"><a href="#MemberController-1" class="headerlink" title="MemberController"></a>MemberController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 会员登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">login</span><span class="params">(<span class="meta">@RequestBody</span> UserLoginVo loginVo)</span> </span>&#123;</span><br><span class="line">    MemberEntity member = memberService.login(loginVo);</span><br><span class="line">    <span class="keyword">if</span> (member == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnum.LOGIN_FAILED_EXCEPTION.getCode(), BizCodeEnum.LOGIN_FAILED_EXCEPTION.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;member&quot;</span>, member);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="MemberServiceImpl-1"><a href="#MemberServiceImpl-1" class="headerlink" title="MemberServiceImpl"></a>MemberServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MemberEntity <span class="title">login</span><span class="params">(UserLoginVo loginVo)</span> </span>&#123;</span><br><span class="line">    String loginacct = loginVo.getLoginacct();</span><br><span class="line">    String password = loginVo.getPassword();</span><br><span class="line">    MemberEntity member = baseMapper.selectOne(<span class="keyword">new</span> QueryWrapper&lt;MemberEntity&gt;().eq(<span class="string">&quot;username&quot;</span>, loginacct).or().eq(<span class="string">&quot;mobile&quot;</span>, loginacct));</span><br><span class="line">    <span class="keyword">if</span> (member != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 判断密码是否匹配</span></span><br><span class="line">        BCryptPasswordEncoder passwordEncoder = <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">        <span class="keyword">boolean</span> matches = passwordEncoder.matches(password, member.getPassword());</span><br><span class="line">        <span class="keyword">return</span> matches ? member : <span class="keyword">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//  该账号不存在</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="认证服务-社交登录"><a href="#认证服务-社交登录" class="headerlink" title="认证服务 - 社交登录"></a>认证服务 - 社交登录</h2><h3 id="OAuth2"><a href="#OAuth2" class="headerlink" title="OAuth2"></a>OAuth2</h3><blockquote><p>OAuth： OAuth（开放授权） 是一个开放标准， 允许用户授权第三方网站访问他们存储<br>在另外的服务提供者上的信息， 而不需要将用户名和密码提供给第三方网站或分享他们<br>数据的所有内容。</p><p>OAuth2.0： 对于用户相关的 OpenAPI（例如获取用户信息， 动态同步， 照片， 日志， 分<br>享等） ， 为了保护用户数据的安全和隐私， 第三方网站访问用户数据前都需要显式的向<br>用户征求授权  </p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211118133832701.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211118133832701.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211118133832701"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211118133746108.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211118133746108.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211118133746108"></p><h3 id="gitee授权登录"><a href="#gitee授权登录" class="headerlink" title="gitee授权登录"></a>gitee授权登录</h3><h4 id="接口测试"><a href="#接口测试" class="headerlink" title="接口测试"></a>接口测试</h4><blockquote><p>gitee进入修改资料 -&gt; 第三方应用 -&gt; 创建应用，然后根据文档操作即可。</p><p><a href="https://gitee.com/api/v5/oauth_doc#/list-item-1">Gitee OAuth 文档</a></p></blockquote><h4 id="GiteeUserVo"><a href="#GiteeUserVo" class="headerlink" title="GiteeUserVo"></a>GiteeUserVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GiteeUserVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String access_token;</span><br><span class="line">    <span class="keyword">private</span> String token_type;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> expires_in;</span><br><span class="line">    <span class="keyword">private</span> String refresh_token;</span><br><span class="line">    <span class="keyword">private</span> String scope;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> created_at;</span><br><span class="line">    <span class="keyword">private</span> String uid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="MemberServiceImpl-2"><a href="#MemberServiceImpl-2" class="headerlink" title="MemberServiceImpl"></a>MemberServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MemberEntity <span class="title">giteeLogin</span><span class="params">(GiteeUserVo loginVo, JSONObject userInfoJson)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 判断当前社交用户是否曾注册过（根据uid判断）</span></span><br><span class="line">    MemberEntity selectMember = baseMapper.selectOne(<span class="keyword">new</span> QueryWrapper&lt;MemberEntity&gt;().eq(<span class="string">&quot;gitee_uid&quot;</span>, loginVo.getGitee_uid()));</span><br><span class="line">    <span class="keyword">if</span> (selectMember != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 该用户已注册，更换令牌和过期时间</span></span><br><span class="line">        selectMember.setAccessToken(selectMember.getAccessToken());</span><br><span class="line">        selectMember.setExpiresIn(selectMember.getExpiresIn());</span><br><span class="line">        baseMapper.updateById(selectMember);</span><br><span class="line">        <span class="keyword">return</span> selectMember;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 获取授权用户的信息存入自己的数据库</span></span><br><span class="line">        MemberEntity registMember = <span class="keyword">new</span> MemberEntity();</span><br><span class="line">        registMember.setUsername((String) userInfoJson.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        registMember.setLevelId(levelService.getDefaultLevel().getId());</span><br><span class="line">        registMember.setGiteeUid(userInfoJson.getString(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        registMember.setAccessToken(loginVo.getAccess_token());</span><br><span class="line">        registMember.setExpiresIn(loginVo.getExpires_in());</span><br><span class="line">        baseMapper.insert(registMember);</span><br><span class="line">        <span class="keyword">return</span> registMember;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="MemberController-2"><a href="#MemberController-2" class="headerlink" title="MemberController"></a>MemberController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * gitee会员登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/giteelogin&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">loginOAuth</span><span class="params">(<span class="meta">@RequestBody</span> GiteeUserVo loginVo, JSONObject userInfoJson)</span> </span>&#123;</span><br><span class="line">    MemberEntity member = memberService.giteeLogin(loginVo, userInfoJson);</span><br><span class="line">    <span class="keyword">if</span> (member == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnum.LOGIN_FAILED_EXCEPTION.getCode(), BizCodeEnum.LOGIN_FAILED_EXCEPTION.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;member&quot;</span>, member);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="MemberFeignService-2"><a href="#MemberFeignService-2" class="headerlink" title="MemberFeignService"></a>MemberFeignService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;gulimall-member&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MemberFeignService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * gitee会员登录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/member/member/giteelogin&quot;)</span></span><br><span class="line">    <span class="function">R <span class="title">loginOAuth</span><span class="params">(<span class="meta">@RequestBody</span> GiteeUserVo loginVo, JSONObject userInfoJson)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="OAuth2Controller"><a href="#OAuth2Controller" class="headerlink" title="OAuth2Controller"></a>OAuth2Controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/oauth2/gitee/success&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">gitee</span><span class="params">(<span class="meta">@RequestParam(&quot;code&quot;)</span> String code, RedirectAttributes attributes)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 根据code授权码获取token</span></span><br><span class="line">    Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;grant_type&quot;</span>, <span class="string">&quot;authorization_code&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">    map.put(<span class="string">&quot;client_id&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;redirect_uri&quot;</span>, <span class="string">&quot;http://auth.gulimall.com/oauth2/gitee/success&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;client_secret&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    HttpResponse response = HttpUtils.doPost(<span class="string">&quot;https://gitee.com&quot;</span>, <span class="string">&quot;/oauth/token&quot;</span>, <span class="string">&quot;post&quot;</span>, <span class="keyword">new</span> HashMap&lt;&gt;(), <span class="keyword">new</span> HashMap&lt;&gt;(), map);</span><br><span class="line">    <span class="comment">// 根据token获取用户信息</span></span><br><span class="line">    <span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取成功</span></span><br><span class="line">        String json = EntityUtils.toString(response.getEntity());</span><br><span class="line">        GiteeUserVo giteeUserVo = JSON.parseObject(json, GiteeUserVo.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果该用户第一次进入，则自动生成账号，否则登录</span></span><br><span class="line">        HttpResponse userInfoResponse = HttpUtils.doPost(<span class="string">&quot;https://gitee.com&quot;</span>, <span class="string">&quot;/api/v5/user&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="keyword">new</span> HashMap&lt;&gt;(), <span class="keyword">new</span> HashMap&lt;&gt;(), <span class="keyword">new</span> HashMap&lt;String, String&gt;().put(<span class="string">&quot;access_token&quot;</span>, giteeUserVo.getAccess_token()));</span><br><span class="line">        <span class="keyword">if</span> (userInfoResponse.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">            JSONObject userInfoJson = JSON.parseObject(EntityUtils.toString(userInfoResponse.getEntity()));</span><br><span class="line">            R r = memberFeignService.loginOAuth(giteeUserVo, userInfoJson);</span><br><span class="line">            <span class="keyword">if</span> (r.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 获得登录后的member对象</span></span><br><span class="line">                MemberEntityVo member = (MemberEntityVo) r.get(<span class="string">&quot;member&quot;</span>);</span><br><span class="line">                log.info(<span class="string">&quot;登陆成功，用户：&#123;&#125;&quot;</span>, member.toString());</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;redirect:http://gulimall.com&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, String&gt; errors = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">    errors.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;授权登录失败&quot;</span>);</span><br><span class="line">    attributes.addFlashAttribute(<span class="string">&quot;errors&quot;</span>, errors);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:http://auth.gulimall.com/login.html&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>TODO gitee根据token获取userInfo被拒绝了，405not allowed，不清楚为啥，但是postman就能行，可能和httpClient有关</p><p>TODO post请求不能多个requestbody，所以我把获取userinfo放到了memberservice中，只需要传一个giteeUserVo即可</p></blockquote><h2 id="认证服务-登录判断"><a href="#认证服务-登录判断" class="headerlink" title="认证服务 - 登录判断"></a>认证服务 - 登录判断</h2><blockquote><p>使用session，如果不用session的话参考上一个项目，使用jwt token</p></blockquote><h3 id="分布式下的session"><a href="#分布式下的session" class="headerlink" title="分布式下的session"></a>分布式下的session</h3><h4 id="分布式下session问题"><a href="#分布式下session问题" class="headerlink" title="分布式下session问题"></a>分布式下session问题</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135441782.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135441782.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211119135441782"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135511743.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135511743.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211119135511743"></p><h4 id="分布式下session解决方法"><a href="#分布式下session解决方法" class="headerlink" title="分布式下session解决方法"></a>分布式下session解决方法</h4><blockquote><ol><li>session复制</li><li>客户端存储</li><li>hash一致性 </li><li>统一存储</li><li>不同服务，子域session共享</li></ol></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135535102.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135535102.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211119135535102"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135702556.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135702556.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211119135702556"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135713584.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135713584.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211119135713584"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135721385.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135721385.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211119135721385"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135732325.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211119135732325.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211119135732325"></p><h3 id="SpringSession"><a href="#SpringSession" class="headerlink" title="SpringSession"></a>SpringSession</h3><blockquote><p><a href="https://docs.spring.io/spring-session/reference/guides/boot-redis.html">Spring Session - Spring Boot :: Spring Session</a></p></blockquote><h4 id="依赖-配置"><a href="#依赖-配置" class="headerlink" title="依赖 配置"></a>依赖 配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- spring session --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.session.store-type</span>=<span class="string">redis # Session store type.</span></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">localhost # Redis server host.</span></span><br><span class="line"><span class="meta">spring.redis.password</span>= <span class="string"># Login password of the redis server.</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379 # Redis server port.</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableRedisHttpSession</span> <span class="comment">// 开启spring session</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallAuthServerApplication</span> </span>&#123;</span><br></pre></td></tr></table></figure><h4 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// r取出来的值为map类型，map -&gt; json -&gt; bean</span></span><br><span class="line">String memberJSON = JSONObject.toJSONString(r.get(<span class="string">&quot;member&quot;</span>));</span><br><span class="line">MemberEntityVo memberEntityVo = JSON.parseObject(memberJSON, MemberEntityVo.class);</span><br><span class="line">log.info(<span class="string">&quot;登陆成功，用户：&#123;&#125;&quot;</span>, memberJSON);</span><br><span class="line"><span class="comment">// 保存用户信息至session,注意这里对象的类必须实现序列化，才能保存到redis中</span></span><br><span class="line">session.setAttribute(<span class="string">&quot;loginUser&quot;</span>, memberEntityVo);</span><br></pre></td></tr></table></figure><blockquote><p>Cannot deserialize; nested exception is org.springframework.core.serializer.support.SerializationFailedException:</p><p>清空redis</p></blockquote><h4 id="自定义SpringSession配置"><a href="#自定义SpringSession配置" class="headerlink" title="自定义SpringSession配置"></a>自定义SpringSession配置</h4><blockquote><p>用于放大作用域，使得跨域的时候还能使用session中的内容</p><p>放到common里</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableRedisHttpSession</span> <span class="comment">// 开启spring session</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySessionConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 配置cookie的相关信息：作用域和名字</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CookieSerializer <span class="title">cookieSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultCookieSerializer cookieSerializer = <span class="keyword">new</span> DefaultCookieSerializer();</span><br><span class="line">        cookieSerializer.setDomainName(<span class="string">&quot;gulimall.com&quot;</span>);</span><br><span class="line">        cookieSerializer.setCookieName(<span class="string">&quot;GULIMALL_SESSION&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> cookieSerializer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisSerializer&lt;Object&gt; <span class="title">redisSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        GenericJackson2JsonRedisSerializer redisSerializer = <span class="keyword">new</span> GenericJackson2JsonRedisSerializer();</span><br><span class="line">        <span class="keyword">return</span> redisSerializer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><blockquote><p>@EnableRedisHttpSession导入RedisHttpSessionConfiguration配置</p><ol><li>给容器中添加了一个组件<br>SessionRepository ==&gt; RedisOperationsSessionRepository ==&gt; redis操作session。session的增删改查封装类</li><li>SessionRepositoryFilter ==&gt; Filter： session’存储过滤器；每个请求过来都必须经过filter<ol><li>在request中存入SessionRepository</li><li>request，response都被包装。SessionRepositoryRequestWrapper，SessionRepositoryResponseWrapper (装饰者模式)</li><li>放行filter放的是包装过的请求响应</li><li>获取session使用request.getSession() //即包装后的SessionRepositoryRequestWrapper</li><li>wrappedRequest.getSession(); ==&gt; 是重写的方法，先获取SessionRepository ，从SessionRepository 中获取之前存入的session内容。</li></ol></li></ol></blockquote><h3 id="登录判断"><a href="#登录判断" class="headerlink" title="登录判断"></a>登录判断</h3><blockquote><p>记得把webConfig中的映射关了</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 前往登录页前判断是否已经登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/login.html&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">loginPage</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 如果登陆过了就跳过</span></span><br><span class="line">    Object attribute = session.getAttribute(AuthServerConstant.LOGIN_USER);</span><br><span class="line">    <span class="keyword">return</span> attribute == <span class="keyword">null</span> ? <span class="string">&quot;login&quot;</span> : <span class="string">&quot;redirect:http://gulimall.com&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>TODO 这里要去别的模块重复spring session的操作（所以thymeleaf不行，这些都是抽取出来好）</p></blockquote><h3 id="单点登录"><a href="#单点登录" class="headerlink" title="单点登录"></a>单点登录</h3><blockquote><p>多系统下只需一次登录</p></blockquote><h4 id="开源框架-xxl-sso"><a href="#开源框架-xxl-sso" class="headerlink" title="开源框架 xxl-sso"></a>开源框架 xxl-sso</h4><blockquote><p><a href="https://gitee.com/xuxueli0323/xxl-sso?_from=gitee_search">xxl-sso: 一个分布式单点登录框架。只需要登录一次就可以访问所有相互信任的应用系统。 拥有”轻量级、分布式、跨域、Cookie+Token均支持、Web+APP均支持”等特性；。现已开放源代码，开箱即用。 (gitee.com)</a></p></blockquote><blockquote><ol><li>配置</li><li>打包：<br>xxl-sso-master&gt;mvn clean package -Dmaven.skip.test=true</li><li>清楚包：<br>xxl-sso-master&gt;mvn clean package -Dmaven.skip.test=true</li><li>启动服务：<br>xxl-sso-master\xxl-sso-server\target&gt;java -jar xxl-sso-server-1.1.1-SNAPSHOT.jar</li></ol></blockquote><h2 id="购物车"><a href="#购物车" class="headerlink" title="购物车"></a>购物车</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><blockquote><ol><li>模块</li><li>host</li><li>template、静态资源</li><li>网关</li><li>端口、注册中心</li></ol></blockquote><h3 id="数据模型分析"><a href="#数据模型分析" class="headerlink" title="数据模型分析"></a>数据模型分析</h3><blockquote><ol><li>登录、未登录购物车（duck不必）</li><li>登录后会将临时购物车的数据合并到登录后的账号中</li><li>临时购物车的数据在浏览器重启后仍存在</li><li>采用redis</li></ol></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211120111700125.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211120111700125.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211120111700125"></p><h4 id="CartItemVo"><a href="#CartItemVo" class="headerlink" title="CartItemVo"></a>CartItemVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartItemVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long skuId;</span><br><span class="line">    <span class="keyword">private</span> Boolean check = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; skuAttr;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> Integer count;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal totalPrice;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">getTotalPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.price.multiply(<span class="keyword">new</span> BigDecimal(<span class="keyword">this</span>.count));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CartVo"><a href="#CartVo" class="headerlink" title="CartVo"></a>CartVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;CartItemVo&gt; items;</span><br><span class="line">    <span class="keyword">private</span> Integer countNum;  <span class="comment">// 商品总数</span></span><br><span class="line">    <span class="keyword">private</span> Integer countType;  <span class="comment">// 商品类型数</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal totalPrice;  <span class="comment">// 总原价格价-优惠价</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal reduce = <span class="keyword">new</span> BigDecimal(<span class="number">0</span>);  <span class="comment">// 优惠价</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCountNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (items != <span class="keyword">null</span> &amp;&amp; items.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (CartItemVo item : items) &#123;</span><br><span class="line">                count += item.getCount();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCountType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">getTotalPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BigDecimal price = <span class="keyword">new</span> BigDecimal(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (items != <span class="keyword">null</span> &amp;&amp; items.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (CartItemVo item : items) &#123;</span><br><span class="line">                <span class="keyword">if</span> (item.getCheck()) &#123;</span><br><span class="line">                    price = price.add(item.getTotalPrice());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        price = price.subtract(getReduce());</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ThreadLocal用户身份鉴别"><a href="#ThreadLocal用户身份鉴别" class="headerlink" title="ThreadLocal用户身份鉴别"></a>ThreadLocal用户身份鉴别</h3><blockquote><p>同一个线程共享数据</p></blockquote><h4 id="CartWebConfig"><a href="#CartWebConfig" class="headerlink" title="CartWebConfig"></a>CartWebConfig</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartWebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 添加拦截器</span></span><br><span class="line"><span class="comment">     * 配置拦截地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> CartInterceptor()).addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CartInterceptor"><a href="#CartInterceptor" class="headerlink" title="CartInterceptor"></a>CartInterceptor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 判断登录状态，并封装传递给controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;UserInfoTo&gt; threadLocal = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 在方法执行之前拦截</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        UserInfoTo userInfoTo = <span class="keyword">new</span> UserInfoTo();</span><br><span class="line">        <span class="comment">// 存入user-key</span></span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">if</span> (cookies != <span class="keyword">null</span> &amp;&amp; cookies.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">                <span class="comment">// 判断当前cookie是否为user-key，是则存入ThreadLocal</span></span><br><span class="line">                <span class="keyword">if</span> (cookie.getName().equals(AuthServerConstant.TEMP_USER_COOKIE_NAME)) &#123;</span><br><span class="line">                    userInfoTo.setUserKey(cookie.getValue());</span><br><span class="line">                    <span class="comment">// 当前cookie存在user-key</span></span><br><span class="line">                    userInfoTo.setAlreadySet(<span class="keyword">true</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果没有user-key，保存一个临时用户</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(userInfoTo.getUserKey())) &#123;</span><br><span class="line">            String uuid = UUID.randomUUID().toString();</span><br><span class="line">            userInfoTo.setUserKey(uuid);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果登陆了存入userId</span></span><br><span class="line">        MemberEntityVo loginUser = (MemberEntityVo) request.getSession().getAttribute(AuthServerConstant.LOGIN_USER);</span><br><span class="line">        <span class="keyword">if</span> (loginUser != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 已登录</span></span><br><span class="line">            userInfoTo.setUserId(loginUser.getId());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将信息存入threadLocal</span></span><br><span class="line">        threadLocal.set(userInfoTo);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 业务执行之后</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//  只存一次cookie即可</span></span><br><span class="line">        <span class="keyword">if</span> (!threadLocal.get().isAlreadySet()) &#123;</span><br><span class="line">            <span class="comment">// 保存一个cookie，存储user-key，时间一个月</span></span><br><span class="line">            Cookie cookie = <span class="keyword">new</span> Cookie(AuthServerConstant.TEMP_USER_COOKIE_NAME, threadLocal.get().getUserKey());</span><br><span class="line">            cookie.setDomain(ServerConstant.COOKIE_SERVER_DOMAIN);</span><br><span class="line">            cookie.setMaxAge(ServerConstant.COOKIE_MAX_AGE);</span><br><span class="line">            response.addCookie(cookie);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="添加商品"><a href="#添加商品" class="headerlink" title="添加商品"></a>添加商品</h3><h4 id="SkuInfoFeignService"><a href="#SkuInfoFeignService" class="headerlink" title="SkuInfoFeignService"></a>SkuInfoFeignService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;gulimall-product&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SkuInfoFeignService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/product/skuinfo/info/&#123;skuId&#125;&quot;)</span></span><br><span class="line">    <span class="function">R <span class="title">info</span><span class="params">(<span class="meta">@PathVariable(&quot;skuId&quot;)</span> Long skuId)</span></span>;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/product/skusaleattrvalue/list/&#123;skuId&#125;&quot;)</span></span><br><span class="line">    <span class="function">List&lt;String&gt; <span class="title">getSkuSaleAttrList</span><span class="params">(<span class="meta">@PathVariable(&quot;skuId&quot;)</span> String skuId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="SkuSaleAttrValueDao"><a href="#SkuSaleAttrValueDao" class="headerlink" title="SkuSaleAttrValueDao"></a>SkuSaleAttrValueDao</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getSkuSaleAttrList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span><br><span class="line">    select concat(attr_name, &quot;:&quot;, attr_value)</span><br><span class="line">    from gulimall_pms.pms_sku_sale_attr_value</span><br><span class="line">    where sku_id = #&#123;skuId&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="CartController"><a href="#CartController" class="headerlink" title="CartController"></a>CartController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CartService cartService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 添加商品到购物车</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/addToCart&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addToCart</span><span class="params">(<span class="meta">@RequestParam(&quot;skuId&quot;)</span> Long skuId, <span class="meta">@RequestParam(&quot;num&quot;)</span> Integer num, Model model)</span> </span>&#123;</span><br><span class="line">        CartItemVo cartItemVo = cartService.addToCart(skuId, num);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;item&quot;</span>, cartItemVo);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="CartServiceImpl"><a href="#CartServiceImpl" class="headerlink" title="CartServiceImpl"></a>CartServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartServiceImpl</span> <span class="keyword">implements</span> <span class="title">CartService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StringRedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SkuInfoFeignService skuInfoFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ThreadPoolExecutor executor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 添加商品</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CartItemVo <span class="title">addToCart</span><span class="params">(Long skuId, Integer num)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">               BoundHashOperations&lt;String, Object, Object&gt; cartOptions = getCartOptions();</span><br><span class="line"></span><br><span class="line">        String existSku = (String) cartOptions.get(skuId.toString());</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(existSku)) &#123;</span><br><span class="line">            CartItemVo cartItemVo = <span class="keyword">new</span> CartItemVo();</span><br><span class="line">            <span class="comment">// 当前购物城中没有该商品种类</span></span><br><span class="line">            CompletableFuture&lt;Void&gt; getSkuInfoTask = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">                <span class="comment">// 远程调用查询当前sku信息</span></span><br><span class="line">                R r = skuInfoFeignService.getSkuInfo(skuId);</span><br><span class="line">                <span class="keyword">if</span> (r.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">                    SkuInfoTo skuInfo = r.getData(<span class="string">&quot;skuInfo&quot;</span>, <span class="keyword">new</span> TypeReference&lt;SkuInfoTo&gt;() &#123;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="comment">// 将商品添加到购物车</span></span><br><span class="line">                    cartItemVo.setCount(num);</span><br><span class="line">                    cartItemVo.setImage(skuInfo.getSkuDefaultImg());</span><br><span class="line">                    cartItemVo.setTitle(skuInfo.getSkuTitle());</span><br><span class="line">                    cartItemVo.setPrice(skuInfo.getPrice());</span><br><span class="line">                    cartItemVo.setSkuId(skuInfo.getSkuId());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    log.info(<span class="string">&quot;远程调用失败&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, executor);</span><br><span class="line"></span><br><span class="line">            CompletableFuture&lt;Void&gt; getAttrTask = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">                <span class="comment">// 获取当前sku的组合信息? 这个难道不是前端传吗，离谱</span></span><br><span class="line">                cartItemVo.setSkuAttr(skuInfoFeignService.getSkuSaleAttrList(skuId));</span><br><span class="line">            &#125;, executor);</span><br><span class="line"></span><br><span class="line">            CompletableFuture.allOf(getAttrTask, getSkuInfoTask).get();</span><br><span class="line">            cartOptions.put(skuId.toString(), JSON.toJSONString(cartItemVo));</span><br><span class="line">            <span class="keyword">return</span> cartItemVo;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 已经有该商品</span></span><br><span class="line">            CartItemVo cartItemVo = JSON.parseObject(existSku, CartItemVo.class);</span><br><span class="line">            cartItemVo.setCount(cartItemVo.getCount() + num);</span><br><span class="line">            cartOptions.put(skuId.toString(), JSON.toJSONString(cartItemVo));</span><br><span class="line">            <span class="keyword">return</span> cartItemVo;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 从redis中获取该购物车</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> BoundHashOperations&lt;String, Object, Object&gt; <span class="title">getCartOptions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String cartKey = <span class="string">&quot;&quot;</span>;    <span class="comment">// redis中的购物车的key</span></span><br><span class="line">        UserInfoTo userInfoTo = CartInterceptor.threadLocal.get();</span><br><span class="line">        <span class="comment">// 判断是否登录</span></span><br><span class="line">        <span class="keyword">if</span> (userInfoTo.getUserId() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 已登录</span></span><br><span class="line">            cartKey = CartConstant.CART_PREFIX + userInfoTo.getUserId();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 未登录</span></span><br><span class="line">            cartKey = CartConstant.CART_PREFIX + userInfoTo.getUserKey();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.boundHashOps(cartKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="添加商品刷新防止多次添加"><a href="#添加商品刷新防止多次添加" class="headerlink" title="添加商品刷新防止多次添加"></a>添加商品刷新防止多次添加</h3><h4 id="CartController-1"><a href="#CartController-1" class="headerlink" title="CartController"></a>CartController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 添加商品到购物车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/addToCart&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">addToCart</span><span class="params">(<span class="meta">@RequestParam(&quot;skuId&quot;)</span> Long skuId, <span class="meta">@RequestParam(&quot;num&quot;)</span> Integer num, RedirectAttributes attributes)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        CartItemVo cartItemVo = cartService.addToCart(skuId, num);</span><br><span class="line">        <span class="comment">// 使用RedirectAttributes，防止使用model（model是request域）后重定向数据丢失</span></span><br><span class="line">        <span class="comment">// addAttribute能够取多次，addFlashAttribute只能取一次</span></span><br><span class="line">        attributes.addAttribute(<span class="string">&quot;skuId&quot;</span>, skuId);</span><br><span class="line">        <span class="comment">// 防止页面刷新，所以到success页面应该是查操作，再过一个请求即可</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:http://cart.gulimall.com/addToCartSuccess.html&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 跳转到成功页面</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/addToCartSuccess.html&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">addToCartSuccessPage</span><span class="params">(<span class="meta">@RequestParam(&quot;skuId&quot;)</span> Long skuId, Model model)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查询购物车中的skuId对应信息</span></span><br><span class="line">    CartItemVo cartItemVo = cartService.getCatItem(skuId);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;item&quot;</span>, cartItemVo);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CartServiceImpl-1"><a href="#CartServiceImpl-1" class="headerlink" title="CartServiceImpl"></a>CartServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 获取购物车商品信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CartItemVo <span class="title">getCatItem</span><span class="params">(Long skuId)</span> </span>&#123;</span><br><span class="line">    BoundHashOperations&lt;String, Object, Object&gt; cartOptions = getCartOptions();</span><br><span class="line">    String cartItemJSON = (String) cartOptions.get(skuId.toString());</span><br><span class="line">    CartItemVo cartItemVo = JSON.parseObject(cartItemJSON, CartItemVo.class);</span><br><span class="line">    <span class="keyword">return</span> cartItemVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="获取、合并购物车"><a href="#获取、合并购物车" class="headerlink" title="获取、合并购物车"></a>获取、合并购物车</h3><h4 id="cartListPage"><a href="#cartListPage" class="headerlink" title="cartListPage"></a>cartListPage</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/cart.html&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">cartListPage</span><span class="params">(Model model)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">// 通过threadLocal获得当前用户信息</span></span><br><span class="line">    <span class="comment">// UserInfoTo userInfoTo = CartInterceptor.threadLocal.get();</span></span><br><span class="line">    CartEntity cart = cartService.getCart();</span><br><span class="line">    model.addAttribute(<span class="string">&quot;cart&quot;</span>, cart);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;cartList&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CartServiceImpl-2"><a href="#CartServiceImpl-2" class="headerlink" title="CartServiceImpl"></a>CartServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 获得购物车信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CartEntity <span class="title">getCart</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    CartEntity cart = <span class="keyword">new</span> CartEntity();</span><br><span class="line">    BoundHashOperations&lt;String, Object, Object&gt; cartFromRedis = getCartFromRedis();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断是否登录</span></span><br><span class="line">    UserInfoTo userInfoTo = CartInterceptor.threadLocal.get();</span><br><span class="line">    List&lt;CartItemEntity&gt; cartItemByUserKey = getCartItem(CartConstant.CART_PREFIX + userInfoTo.getUserKey());</span><br><span class="line">    <span class="keyword">if</span> (userInfoTo.getUserId() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 已登录</span></span><br><span class="line">        <span class="comment">// 合并购物车（使用addToCart带有同商品的判断）</span></span><br><span class="line">        <span class="keyword">for</span> (CartItemEntity cartItem : cartItemByUserKey) &#123;</span><br><span class="line">            addToCart(cartItem.getSkuId(), cartItem.getCount());</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;CartItemEntity&gt; cartItemByUserId = getCartItem(CartConstant.CART_PREFIX + userInfoTo.getUserId());</span><br><span class="line">        <span class="comment">// redis中清空临时购物车信息</span></span><br><span class="line">        redisTemplate.delete(CartConstant.CART_PREFIX + userInfoTo.getUserKey());</span><br><span class="line">        <span class="comment">// 返回购物车的信息</span></span><br><span class="line">        cart.setItems(cartItemByUserId);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 未登录</span></span><br><span class="line">        <span class="comment">// 返回临时购物车的信息</span></span><br><span class="line">        cart.setItems(cartItemByUserKey);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cart;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 根据xxx获取购物车商品list</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;CartItemEntity&gt; <span class="title">getCartItem</span><span class="params">(String cartKey)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 从redis中根据userId获得cartItem</span></span><br><span class="line">    UserInfoTo userInfoTo = CartInterceptor.threadLocal.get();</span><br><span class="line">    BoundHashOperations&lt;String, Object, Object&gt; cartMap = redisTemplate.boundHashOps(cartKey);</span><br><span class="line">    <span class="comment">// 封装list</span></span><br><span class="line">    List&lt;CartItemEntity&gt; cartItemList = cartMap.values().stream().map((cartItemObj) -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> JSON.parseObject(cartItemObj.toString(), CartItemEntity.class);</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> cartItemList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 从redis中获取该购物车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> BoundHashOperations&lt;String, Object, Object&gt; <span class="title">getCartFromRedis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String cartKey = <span class="string">&quot;&quot;</span>;    <span class="comment">// redis中的购物车的key</span></span><br><span class="line">    UserInfoTo userInfoTo = CartInterceptor.threadLocal.get();</span><br><span class="line">    <span class="comment">// 判断是否登录</span></span><br><span class="line">    <span class="keyword">if</span> (userInfoTo.getUserId() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 已登录</span></span><br><span class="line">        cartKey = CartConstant.CART_PREFIX + userInfoTo.getUserId();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 未登录</span></span><br><span class="line">        cartKey = CartConstant.CART_PREFIX + userInfoTo.getUserKey();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.boundHashOps(cartKey);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="选中、改变数量、删除"><a href="#选中、改变数量、删除" class="headerlink" title="选中、改变数量、删除"></a>选中、改变数量、删除</h3><blockquote><p>这里最好用一个完整的VO+ajax</p></blockquote><h4 id="CartController-2"><a href="#CartController-2" class="headerlink" title="CartController"></a>CartController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 更改购物车选中状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/checkItem&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">checkItem</span><span class="params">(<span class="meta">@RequestParam(&quot;skuId&quot;)</span> Long skuId, <span class="meta">@RequestParam(&quot;check&quot;)</span> Integer check)</span> </span>&#123;</span><br><span class="line">    cartService.checkItem(skuId, check);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:http://cart.gulimall.com/cart.html&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 更改购物车商品数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/countItem&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">countItem</span><span class="params">(<span class="meta">@RequestParam(&quot;skuId&quot;)</span> Long skuId, <span class="meta">@RequestParam(&quot;num&quot;)</span> Integer num)</span> </span>&#123;</span><br><span class="line">    cartService.countItem(skuId, num);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:http://cart.gulimall.com/cart.html&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 更改购物车商品数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/deleteItem&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">deleteItem</span><span class="params">(<span class="meta">@RequestParam(&quot;skuId&quot;)</span> Long skuId)</span> </span>&#123;</span><br><span class="line">    cartService.deleteItem(skuId);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:http://cart.gulimall.com/cart.html&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CartServiceImpl-3"><a href="#CartServiceImpl-3" class="headerlink" title="CartServiceImpl"></a>CartServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 修改商品check</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkItem</span><span class="params">(Long skuId, Integer check)</span> </span>&#123;</span><br><span class="line">    CartItemEntity cartOneItem = getCartOneItem(skuId);</span><br><span class="line">    cartOneItem.setCheck(check == <span class="number">1</span>);</span><br><span class="line">    updateCartOneItem(cartOneItem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 修改商品count</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countItem</span><span class="params">(Long skuId, Integer num)</span> </span>&#123;</span><br><span class="line">    CartItemEntity cartOneItem = getCartOneItem(skuId);</span><br><span class="line">    cartOneItem.setCount(num);</span><br><span class="line">    updateCartOneItem(cartOneItem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * redis删除商品</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteItem</span><span class="params">(Long skuId)</span> </span>&#123;</span><br><span class="line">    BoundHashOperations&lt;String, Object, Object&gt; cartOptions = getCartFromRedis();</span><br><span class="line">    cartOptions.delete(skuId.toString());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 修改redis单个购物车商品信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCartOneItem</span><span class="params">(CartItemEntity cartItemEntity)</span> </span>&#123;</span><br><span class="line">    BoundHashOperations&lt;String, Object, Object&gt; cartOptions = getCartFromRedis();</span><br><span class="line">    String json = JSON.toJSONString(cartItemEntity);</span><br><span class="line">    cartOptions.put(cartItemEntity.getSkuId().toString(), json);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
            <tag> redis </tag>
            
            <tag> 微服务 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】商城项目实战5</title>
      <link href="/2021/11/13/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-5/"/>
      <url>/2021/11/13/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-5/</url>
      
        <content type="html"><![CDATA[<h2 id="Typora"><a href="#Typora" class="headerlink" title="Typora"></a>Typora</h2><blockquote><p>typora11.16有毒，两天没了三次内容，已经写到了前端，不过前端也不想听了，反正cv就完事了</p></blockquote><h2 id="检索服务-页面渲染"><a href="#检索服务-页面渲染" class="headerlink" title="检索服务-页面渲染"></a>检索服务-页面渲染</h2><blockquote><p>吐了，CV</p><p>这一块真的是败笔</p></blockquote><h3 id="面包屑导航"><a href="#面包屑导航" class="headerlink" title="面包屑导航"></a>面包屑导航</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 6 面包屑导航信息</span></span><br><span class="line"><span class="keyword">if</span> (param.getAttrs() != <span class="keyword">null</span> &amp;&amp; param.getAttrs().size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    List&lt;SearchResultVo.NavVo&gt; navVoList = param.getAttrs().stream().map(attr -&gt; &#123;</span><br><span class="line">        <span class="comment">// 分析每一个attr</span></span><br><span class="line">        SearchResultVo.NavVo navVo = <span class="keyword">new</span> SearchResultVo.NavVo();</span><br><span class="line">        String[] s = attr.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">        <span class="comment">// 远程调用product里的方法获得attrName(duck不必)</span></span><br><span class="line">        AttrResponseTo attrResponseTo = productFeignService.attrResponseInfoFeign(Long.valueOf(s[<span class="number">0</span>]));</span><br><span class="line">        <span class="keyword">if</span> (attrResponseTo != <span class="keyword">null</span>) &#123;</span><br><span class="line">            navVo.setNavName(attrResponseTo.getAttrName());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            navVo.setNavName(s[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        navVo.setNavValue(s[<span class="number">1</span>]);</span><br><span class="line">        <span class="comment">// 处理连接，如果是当前的查询条件，则去掉</span></span><br><span class="line">        String encode = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 属性内容带空格的会被编码成+号，需要换回</span></span><br><span class="line">            encode = URLEncoder.encode(attr, <span class="string">&quot;UTF-8&quot;</span>).replace(<span class="string">&quot;+&quot;</span>, <span class="string">&quot;%20&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        String replace = param.get_queryString().replace(<span class="string">&quot;&amp;attrs=&quot;</span> + encode, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        navVo.setLink(<span class="string">&quot;http://search.gulimall.com/list.html?&quot;</span> + replace);</span><br><span class="line">        <span class="keyword">return</span> navVo;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    resultVo.setNavs(navVoList);</span><br><span class="line">&#125;</span><br><span class="line">       <span class="comment">// 6 品牌面包屑导航信息</span></span><br><span class="line">        <span class="keyword">if</span> (param.getBrandId() != <span class="keyword">null</span> &amp;&amp; param.getBrandId().size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            List&lt;SearchResultVo.NavVo&gt; navs = resultVo.getNavs();</span><br><span class="line">            SearchResultVo.NavVo navVo = <span class="keyword">new</span> SearchResultVo.NavVo();</span><br><span class="line">            <span class="comment">// 这里老师用远程调用，duck不必，result里都封装好了</span></span><br><span class="line">            navVo.setNavName(<span class="string">&quot;品牌&quot;</span>);</span><br><span class="line">            StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span> (SearchResultVo.BrandVo brand : resultVo.getBrands()) &#123;</span><br><span class="line">                builder.append(brand.getBrandName()).append(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            navVo.setNavValue(String.valueOf(builder));</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h2 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h2><h3 id="初始化线程的-4-种方式"><a href="#初始化线程的-4-种方式" class="headerlink" title="初始化线程的 4 种方式"></a>初始化线程的 4 种方式</h3><blockquote><ol><li>继承 Thread</li><li>实现 Runnable 接口</li><li>实现 Callable 接口 + FutureTask （可以拿到返回结果， 可以处理异常）</li><li> 线程池</li></ol><p>方式 1 和方式 2： 主进程无法获取线程的运算结果。 不适合当前场景。方式 3： 主进程可以获取线程的运算结果， 但是不利于控制服务器中的线程资源。 可以导致服务器资源耗尽。方式 4： 通过如下两种方式初始化线程池Executors.newFiexedThreadPool(3); 或者new ThreadPoolExecutor(corePoolSize, maximumPoolSize, keepAliveTime, TimeUnit unit, workQueue, threadFactory, handler);</p><p>通过线程池性能稳定， 也可以获取执行结果， 并捕获异常。 但是， 在业务复杂情况下， 一个异步调用可能会依赖于另一个异步调用的执行结果。  </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 单例模式，线程池只有一个</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService service = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;---------- main方法start ----------&quot;</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 1. 继承 Thread</span></span><br><span class="line"><span class="comment">         * 2. 实现 Runnable 接口</span></span><br><span class="line"><span class="comment">         * 3. 实现 Callable 接口 + FutureTask （可以拿到返回结果， 可以处理异常）</span></span><br><span class="line"><span class="comment">         * 4. 线程池</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Thread1 thread1 = new Thread1();</span></span><br><span class="line">        <span class="comment">// thread1.start();    // 启动线程</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Runnable1 runnable1 = new Runnable1();</span></span><br><span class="line">        <span class="comment">// new Thread(runnable1).start();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Callable1 callable1 = new Callable1();</span></span><br><span class="line">        <span class="comment">// FutureTask&lt;Integer&gt; integerFutureTask = new FutureTask&lt;&gt;(callable1);</span></span><br><span class="line">        <span class="comment">// new Thread(integerFutureTask).start();</span></span><br><span class="line">        <span class="comment">// // 阻塞等待，只有task执行完之后才能执行下面的语句</span></span><br><span class="line">        <span class="comment">// System.out.println(integerFutureTask.get());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将所有的多线程异步任务都交给线程池执行,既能控制资源，也稳定</span></span><br><span class="line">        service.submit(<span class="keyword">new</span> Runnable1());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---------- main方法end ----------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread1</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;当前线程ID：&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">10</span> / <span class="number">2</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;运行结果：&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Runnable1</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;当前线程ID：&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">10</span> / <span class="number">2</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;运行结果：&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Callable1</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;当前线程ID：&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">10</span> / <span class="number">2</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;运行结果：&quot;</span> + i);</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h3><h4 id="线程池种类"><a href="#线程池种类" class="headerlink" title="线程池种类"></a>线程池种类</h4><blockquote><ol><li>newCachedThreadPool<br> 创建一个可缓存线程池， 如果线程池长度超过处理需要， 可灵活回收空闲线程， 若无可回收， 则新建线程。<br> core为0，所有线程可回收</li><li>newFixedThreadPool<br> 创建一个定长线程池， 可控制线程最大并发数， 超出的线程会在队列中等<br> core = max，max-core线程可回收</li><li>newScheduledThreadPool<br>创建一个定长线程池， 支持定时及周期性任务执行。</li><li>newSingleThreadExecutor<br>创建一个单线程化的线程池， 它只会用唯一的工作线程来执行任务， 保证所有任务按照指定顺序(FIFO, LIFO, 优先级)执行。  </li></ol></blockquote><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 单例模式，线程池只有一个</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService service = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 七大参数：</span></span><br><span class="line"><span class="comment">         * corePoolSize 核心线程数：线程池创建好以后就准备就绪的线程数,一直存在除非allowCoreThreadTimeOut</span></span><br><span class="line"><span class="comment">         * maximumPoolSize 最大线程数：控制资源</span></span><br><span class="line"><span class="comment">         * keepAliveTime 存活时间：线程空闲时间大于指定时间，释放空闲线程（释放的线程是大于核心线程数的线程）</span></span><br><span class="line"><span class="comment">         * unit 时间单位</span></span><br><span class="line"><span class="comment">         * BlockingQueue&lt;Runnable&gt; 阻塞队列：如果任务很多，多余任务将放在队列当中，只要有空闲线程，就会从队列中取出任务执行</span></span><br><span class="line"><span class="comment">         * threadFactory 线程工厂</span></span><br><span class="line"><span class="comment">         * RejectedExecutionHandler 拒绝策略：处理队列满了之后的操作</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 工作顺序：</span></span><br><span class="line"><span class="comment">         * 1、 线程池创建， 准备好 core 数量的核心线程， 准备接受任务</span></span><br><span class="line"><span class="comment">         * 2、 新的任务进来， 用 core 准备好的空闲线程执行。</span></span><br><span class="line"><span class="comment">         * (1) 、 core 满了， 就将再进来的任务放入阻塞队列中。 空闲的 core 就会自己去阻塞队列获取任务执行</span></span><br><span class="line"><span class="comment">         * (2) 、 阻塞队列满了， 就直接开新线程执行， 最大只能开到 max 指定的数量</span></span><br><span class="line"><span class="comment">         * (3) 、 max 都执行好了。 Max-core 数量空闲的线程会在 keepAliveTime 指定的时间后自动销毁。 最终保持到 core 大小</span></span><br><span class="line"><span class="comment">         * (4) 、 如果线程数开到了 max 的数量， 还有新任务进来， 就会使用 reject 指定的拒绝策略进行处理</span></span><br><span class="line"><span class="comment">         * 3、 所有的线程创建都是由指定的 factory 创建的。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">                <span class="number">5</span>, <span class="number">200</span>, <span class="number">10</span>, TimeUnit.MILLISECONDS, <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;(<span class="number">100000</span>), Executors.defaultThreadFactory(), <span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---------- main方法end ----------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="为什么使用线程池"><a href="#为什么使用线程池" class="headerlink" title="为什么使用线程池"></a>为什么使用线程池</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114130824911.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114130824911.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211114130824911"></p><h3 id="CompletableFuture-异步编排"><a href="#CompletableFuture-异步编排" class="headerlink" title="CompletableFuture  异步编排"></a>CompletableFuture  异步编排</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114131606023.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114131606023.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211114131606023"></p><h4 id="创建异步对象"><a href="#创建异步对象" class="headerlink" title="创建异步对象"></a>创建异步对象</h4><blockquote><p>CompletableFuture 提供了四个静态方法来创建一个异步操作  </p><p>1、 runXxxx 都是没有返回结果的， supplyXxx 都是可以获取返回结果的<br>2、 可以传入自定义的线程池， 否则就用默认的线程池；  </p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114132155487.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114132155487.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211114132155487"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompletableFutureTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 单例模式，线程池只有一个</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService executor = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;---------- main方法start ----------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// CompletableFuture&lt;Void&gt; future = CompletableFuture.runAsync(() -&gt; &#123;</span></span><br><span class="line">        <span class="comment">//     System.out.println(&quot;当前线程ID：&quot; + Thread.currentThread().getId());</span></span><br><span class="line">        <span class="comment">//     int i = 10 / 2;</span></span><br><span class="line">        <span class="comment">//     System.out.println(&quot;运行结果：&quot; + i);</span></span><br><span class="line">        <span class="comment">// &#125;, executor);</span></span><br><span class="line"></span><br><span class="line">        CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;当前线程ID：&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">10</span> / <span class="number">2</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;运行结果：&quot;</span> + i);</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;, executor);</span><br><span class="line">        System.out.println(<span class="string">&quot;future结果：&quot;</span> + future.get());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---------- main方法end ----------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="计算完成时回调方法、异常处理"><a href="#计算完成时回调方法、异常处理" class="headerlink" title="计算完成时回调方法、异常处理"></a>计算完成时回调方法、异常处理</h4><blockquote><p>whenComplete 可以处理正常和异常的计算结果， exceptionally 处理异常情况。</p><p>whenComplete 和 whenCompleteAsync 的区别</p><ol><li>whenComplete： 是执行当前任务的线程执行继续执行 whenComplete 的任务</li><li>whenCompleteAsync： 是执行把 whenCompleteAsync 这个任务继续提交给线程池<br>来进行执行。</li></ol><p>方法不以 Async 结尾， 意味着 Action 使用相同的线程执行， 而 Async 可能会使用其他线程<br>执行（如果是使用相同的线程池， 也可能会被同一个线程选中执行  </p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114132319399.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114132319399.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211114132319399"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompletableFutureTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService executor = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;---------- main方法start ----------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;当前线程ID：&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">10</span> / <span class="number">2</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;运行结果：&quot;</span> + i);</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;, executor).whenComplete((result, exception) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;异步任务成功完成了...结果是：&quot;</span> + result + <span class="string">&quot;；异常是：&quot;</span> + exception);</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">&quot;future结果：&quot;</span> + future.get());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---------- main方法end ----------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompletableFutureTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService executor = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;---------- main方法start ----------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;当前线程ID：&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;运行结果：&quot;</span> + i);</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;, executor).whenComplete((result, exception) -&gt; &#123;</span><br><span class="line">            <span class="comment">// 当future执行完之后执行回调函数，可以获得结果与异常</span></span><br><span class="line">            System.out.println(<span class="string">&quot;异步任务成功完成了...结果是：&quot;</span> + result + <span class="string">&quot;；异常是：&quot;</span> + exception);</span><br><span class="line">        &#125;).exceptionally((exception) -&gt; &#123;</span><br><span class="line">            <span class="comment">// 用于处理异常</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">10</span>;  <span class="comment">// 出现异常后，返回默认值</span></span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">&quot;future结果：&quot;</span> + future.get());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---------- main方法end ----------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="handle方法"><a href="#handle方法" class="headerlink" title="handle方法"></a>handle方法</h4><blockquote><p>和 complete 一样， 可对结果做最后的处理（可处理异常） ， 可改变返回值。  </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompletableFutureTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService executor = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;---------- main方法start ----------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;当前线程ID：&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;运行结果：&quot;</span> + i);</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;, executor).handle((result, exception) -&gt; &#123;</span><br><span class="line">            <span class="comment">// 既可以获得也可以处理</span></span><br><span class="line">            System.out.println(<span class="string">&quot;异步任务成功完成了...结果是：&quot;</span> + result + <span class="string">&quot;；异常是：&quot;</span> + exception);</span><br><span class="line">            <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (exception != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">&quot;future结果：&quot;</span> + future.get());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---------- main方法end ----------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="线程串行化方法"><a href="#线程串行化方法" class="headerlink" title="线程串行化方法"></a>线程串行化方法</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114133526668.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114133526668.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211114133526668"></p><blockquote><p>thenApply 方法： 当一个线程依赖另一个线程时， 获取上一个任务返回的结果， 并返回当前<br>任务的返回值。</p><p>thenAccept 方法： 消费处理结果。 接收任务的处理结果， 并消费处理， 无返回结果。</p><p>thenRun 方法： 只要上面的任务执行完成， 就开始执行 thenRun， 只是处理完任务后， 执行thenRun 的后续操作带有 Async 默认是异步执行的。 同之前。</p><p>以上都要前置任务成功完成。</p><p>Function&lt;? super T,? extends U&gt;<br>T： 上一个任务返回结果的类型<br>U： 当前任务的返回值类型  </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CompletableFutureTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService executor = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;---------- main方法start ----------&quot;</span>);</span><br><span class="line"></span><br><span class="line">       CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;当前线程ID：&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">10</span> / <span class="number">2</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;运行结果：&quot;</span> + i);</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;, executor).thenApplyAsync(result -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;任务二启动，上一次结果+&quot;</span> + result);</span><br><span class="line">            <span class="keyword">return</span> result + <span class="number">1</span>;</span><br><span class="line">        &#125;, executor);</span><br><span class="line">        System.out.println(<span class="string">&quot;future结果：&quot;</span> + future.get());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---------- main方法end ----------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="两任务组合-都要完成"><a href="#两任务组合-都要完成" class="headerlink" title="两任务组合 - 都要完成"></a>两任务组合 - 都要完成</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114134407616.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114134407616.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211114134407616"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114134411872.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114134411872.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211114134411872"></p><blockquote><p>两个任务必须都完成， 触发该任务。</p><p>thenCombine： 组合两个 future， 获取两个 future 的返回结果， 并返回当前任务的返回值<br>thenAcceptBoth： 组合两个 future， 获取两个 future 任务的返回结果， 然后处理任务， 没有<br>返回值。<br>runAfterBoth： 组合两个 future， 不需要获取 future 的结果， 只需两个 future 处理完任务后，<br>处理该任务。  </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">  CompletableFuture&lt;Object&gt; future01 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;任务1线程：&quot;</span> + Thread.currentThread().getId());</span><br><span class="line">      <span class="keyword">int</span> i = <span class="number">10</span> / <span class="number">4</span>;</span><br><span class="line">      System.out.println(<span class="string">&quot;任务1结束：&quot;</span> );</span><br><span class="line">      <span class="keyword">return</span> i;</span><br><span class="line">  &#125;, executor);</span><br><span class="line"></span><br><span class="line">  CompletableFuture&lt;Object&gt; future02 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;任务2线程：&quot;</span> + Thread.currentThread().getId());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">          System.out.println(<span class="string">&quot;任务2结束：&quot;</span> );</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">  &#125;, executor);</span><br><span class="line"></span><br><span class="line">  future01.runAfterBothAsync(future02,()-&gt;&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;任务3开始...&quot;</span>);</span><br><span class="line">  &#125;,executor);</span><br><span class="line"><span class="comment">// void accept(T t, U u);</span></span><br><span class="line">  future01.thenAcceptBothAsync(future02,(f1,f2)-&gt;&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;任务3开始...之前的结果：&quot;</span>+f1+<span class="string">&quot;--》&quot;</span>+f2);</span><br><span class="line">  &#125;,executor);</span><br><span class="line"><span class="comment">//R apply(T t, U u);</span></span><br><span class="line">  CompletableFuture&lt;String&gt; future = future01.thenCombineAsync(future02, (f1, f2) -&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> f1 + <span class="string">&quot;：&quot;</span> + f2 + <span class="string">&quot; -&gt; Haha&quot;</span>;</span><br><span class="line">  &#125;, executor);</span><br></pre></td></tr></table></figure><h4 id="两任务组合-一个完成"><a href="#两任务组合-一个完成" class="headerlink" title="两任务组合 - 一个完成"></a>两任务组合 - 一个完成</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114134431864.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114134431864.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211114134431864"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114134436669.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114134436669.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211114134436669"></p><blockquote><p>当两个任务中， 任意一个 future 任务完成的时候， 执行任务。</p><p>applyToEither： 两个任务有一个执行完成， 获取它的返回值， 处理任务并有新的返回值。<br>acceptEither： 两个任务有一个执行完成， 获取它的返回值， 处理任务， 没有新的返回值。<br>runAfterEither： 两个任务有一个执行完成， 不需要获取 future 的结果， 处理任务， 也没有返<br>回值。  </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 两个任务，只要有一个完成，我们就执行任务3</span></span><br><span class="line"><span class="comment">         * runAfterEitherAsync：不感知结果，自己没有返回值</span></span><br><span class="line"><span class="comment">         * acceptEitherAsync：感知结果，自己没有返回值</span></span><br><span class="line"><span class="comment">         * applyToEitherAsync：感知结果，自己有返回值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"><span class="comment">//        future01.runAfterEitherAsync(future02,()-&gt;&#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;任务3开始...之前的结果：&quot;);</span></span><br><span class="line"><span class="comment">//        &#125;,executor);</span></span><br><span class="line">        <span class="comment">//void accept(T t);</span></span><br><span class="line"><span class="comment">//        future01.acceptEitherAsync(future02,(res)-&gt;&#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;任务3开始...之前的结果：&quot;+res);</span></span><br><span class="line"><span class="comment">//        &#125;,executor);</span></span><br><span class="line"><span class="comment">//        CompletableFuture&lt;String&gt; future = future01.applyToEitherAsync(future02, res -&gt; &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;任务3开始...之前的结果：&quot; + res);</span></span><br><span class="line"><span class="comment">//            return res.toString() + &quot;-&gt;哈哈&quot;;</span></span><br><span class="line"><span class="comment">//        &#125;, executor);</span></span><br></pre></td></tr></table></figure><h4 id="多任务组合"><a href="#多任务组合" class="headerlink" title="多任务组合"></a>多任务组合</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114134505324.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211114134505324.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211114134505324"></p><blockquote><p>allOf： 等待所有任务完成<br>anyOf： 只要有一个任务完成  </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">        CompletableFuture&lt;String&gt; futureImg = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;查询商品的图片信息&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;hello.jpg&quot;</span>;</span><br><span class="line">        &#125;,executor);</span><br><span class="line"></span><br><span class="line">        CompletableFuture&lt;String&gt; futureAttr = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;查询商品的属性&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;黑色+256G&quot;</span>;</span><br><span class="line">        &#125;,executor);</span><br><span class="line"></span><br><span class="line">        CompletableFuture&lt;String&gt; futureDesc = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;查询商品介绍&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;华为&quot;</span>;</span><br><span class="line">        &#125;,executor);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        CompletableFuture&lt;Void&gt; allOf = CompletableFuture.allOf(futureImg, futureAttr, futureDesc);</span></span><br><span class="line">        CompletableFuture&lt;Object&gt; anyOf = CompletableFuture.anyOf(futureImg, futureAttr, futureDesc);</span><br><span class="line">        anyOf.get();<span class="comment">//等待所有结果完成</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        System.out.println(&quot;main....end....&quot;+futureImg.get()+&quot;=&gt;&quot;+futureAttr.get()+&quot;=&gt;&quot;+futureDesc.get());</span></span><br><span class="line">        System.out.println(<span class="string">&quot;main....end....&quot;</span>+anyOf.get());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="前台-商品详情"><a href="#前台-商品详情" class="headerlink" title="前台 - 商品详情"></a>前台 - 商品详情</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><h4 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h4><blockquote><p>存放到nginx -&gt; html -&gt; static 下对应文件夹</p><p>html放到对应模块resources -&gt; templates下</p></blockquote><h4 id="host"><a href="#host" class="headerlink" title="host"></a>host</h4><blockquote><p>192.168.128.129 item.gulimall.com</p></blockquote><h4 id="nacos"><a href="#nacos" class="headerlink" title="nacos"></a>nacos</h4><blockquote><p>之前配置的*.gulimall.com即可</p></blockquote><h4 id="gateway"><a href="#gateway" class="headerlink" title="gateway"></a>gateway</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -----------------------nginx，一定要放在最后，要不然/api/下的配置会被覆盖-----------------------</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">gulimall_host_route</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://gulimall-product</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Host=gulimall.com,item.gulimall.com</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">gulimall_search_route</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://gulimall-search</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Host=search.gulimall.com</span></span><br></pre></td></tr></table></figure><h4 id="页面基本跳转"><a href="#页面基本跳转" class="headerlink" title="页面基本跳转"></a>页面基本跳转</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- |内可直接放字符串| --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;|http://item.gulimall.com/$&#123;product.skuId&#125;.html|&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;product.skuImg&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dim&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SkuInfoService skuInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 展示当前对应skuId的信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;skuId&#125;.html&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">skuItem</span><span class="params">(<span class="meta">@PathVariable(&quot;skuId&quot;)</span> Long skuId, Model model)</span> </span>&#123;</span><br><span class="line">      SkuItemVo skuItemVo = skuInfoService.getItemInfo(skuId);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;item&quot;</span>, skuItemVo);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;item&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SkuItemVo"><a href="#SkuItemVo" class="headerlink" title="SkuItemVo"></a>SkuItemVo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkuItemVo</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1 获取sku基本信息，pms_sku_info</span></span><br><span class="line">    SkuInfoEntity info;</span><br><span class="line">    <span class="keyword">boolean</span> hasStock = <span class="keyword">true</span>;</span><br><span class="line">    <span class="comment">// 2 sku图片 pms_sku_images</span></span><br><span class="line">    List&lt;SkuImagesEntity&gt; images;</span><br><span class="line">    <span class="comment">// 3 获得spu销售属性组合</span></span><br><span class="line">    List&lt;SkuItemSaleAttrVo&gt; saleAttr;</span><br><span class="line">    <span class="comment">// 4 spu销售属性介绍</span></span><br><span class="line">    SpuInfoDescEntity desp;</span><br><span class="line">    <span class="comment">// 5 spu规格参数</span></span><br><span class="line">    List&lt;SpuItemAttrGroupVo&gt; groupAttrs;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SkuItemSaleAttrVo</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 属性id</span></span><br><span class="line">        <span class="keyword">private</span> Long attrId;</span><br><span class="line">        <span class="comment">// 属性名</span></span><br><span class="line">        <span class="keyword">private</span> String attrName;</span><br><span class="line">        <span class="comment">// 属性值</span></span><br><span class="line">        <span class="keyword">private</span> List&lt;AttrValueWithSkuIdVo&gt; attrValues;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuItemAttrGroupVo</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String groupName;</span><br><span class="line">        <span class="keyword">private</span> List&lt;SpuItemBaseAttrVo&gt; attrs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuItemBaseAttrVo</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String attrName;</span><br><span class="line">        <span class="keyword">private</span> String attrValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrValueWithSkuIdVo</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String attrValue;</span><br><span class="line">        <span class="keyword">private</span> String skuIds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="封装基本信息"><a href="#封装基本信息" class="headerlink" title="封装基本信息"></a>封装基本信息</h3><h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;skuInfoService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkuInfoServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SkuInfoDao</span>, <span class="title">SkuInfoEntity</span>&gt; <span class="keyword">implements</span> <span class="title">SkuInfoService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 获取skuInfo,用于详情页展示</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SkuItemVo <span class="title">getItemInfo</span><span class="params">(Long skuId)</span> </span>&#123;</span><br><span class="line">        SkuItemVo skuItemVo = <span class="keyword">new</span> SkuItemVo();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 获取sku基本信息，pms_sku_info</span></span><br><span class="line">        SkuInfoEntity skuInfoEntity = getById(skuId);</span><br><span class="line">        skuItemVo.setInfo(skuInfoEntity);</span><br><span class="line">        Long spuId = skuInfoEntity.getSpuId();</span><br><span class="line">        Long catalogId = skuInfoEntity.getCatalogId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 sku图片 pms_sku_images</span></span><br><span class="line">        List&lt;SkuImagesEntity&gt; skuImagesEntityList = skuImagesService.getBySkuId(skuId);</span><br><span class="line">        skuItemVo.setImages(skuImagesEntityList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 获得spu销售属性组合</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4 spu销售属性介绍 spu_info_desc</span></span><br><span class="line">        SpuInfoDescEntity spuInfoDescEntity = spuInfoDescService.getById(spuId);</span><br><span class="line">        skuItemVo.setDesp(spuInfoDescEntity);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5 spu规格参数</span></span><br><span class="line">        <span class="keyword">return</span> skuItemVo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="封装spu规格参数"><a href="#封装spu规格参数" class="headerlink" title="封装spu规格参数"></a>封装spu规格参数</h3><h4 id="service-1"><a href="#service-1" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5 spu规格参数</span></span><br><span class="line">       List&lt;SkuItemVo.SpuItemAttrGroupVo&gt; spuItemAttrGroupVoList = attrGroupService.getGroupWithAttrForSkuItem(spuId, catalogId);</span><br><span class="line">        skuItemVo.setGroupAttrs(spuItemAttrGroupVoList);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;attrGroupService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrGroupServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">AttrGroupDao</span>, <span class="title">AttrGroupEntity</span>&gt; <span class="keyword">implements</span> <span class="title">AttrGroupService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SkuItemVo.SpuItemAttrGroupVo&gt; getWithAttrForSkuItem(Long spuId, Long catalogId) &#123;</span><br><span class="line">        <span class="keyword">return</span> baseMapper.getWithAttrForSkuItem(spuId, catalogId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="mapper"><a href="#mapper" class="headerlink" title="mapper"></a>mapper</h4><blockquote><p>联表查询，自定义结果集，内部类使用$</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.gulimall.product.dao.AttrGroupDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- resultMap 指定返回的结果集及其中元素 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;spuItemAttrGroupVo&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.gulimall.product.vo.front.SkuItemVo$SpuItemAttrGroupVo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;groupName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;attr_group_name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;attrs&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.atguigu.gulimall.product.vo.front.SkuItemVo$SpuItemBaseAttrVo&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;attrName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;attr_name&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;attrValue&quot;</span> <span class="attr">column</span>=<span class="string">&quot;attr_value&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getWithAttrForSkuItem&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;spuItemAttrGroupVo&quot;</span>&gt;</span></span><br><span class="line">        select ag.attr_group_id,</span><br><span class="line">               ag.attr_group_name,</span><br><span class="line">               aar.attr_id,</span><br><span class="line">               pav.attr_name,</span><br><span class="line">               pav.attr_value</span><br><span class="line">        from gulimall_pms.pms_attr_group ag</span><br><span class="line">                 left join gulimall_pms.pms_attr_attrgroup_relation aar on aar.attr_group_id = ag.attr_group_id</span><br><span class="line">                 left join gulimall_pms.pms_product_attr_value pav on pav.attr_id = aar.attr_id</span><br><span class="line">        where ag.catelog_id = #&#123;catalogId&#125;</span><br><span class="line">          and pav.spu_id = #&#123;spuId&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="封装spu销售属性"><a href="#封装spu销售属性" class="headerlink" title="封装spu销售属性"></a>封装spu销售属性</h3><h4 id="service-2"><a href="#service-2" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3 获得spu销售属性组合</span></span><br><span class="line">List&lt;SkuItemVo.SkuItemSaleAttrVo&gt; skuItemSaleAttrVoList = skuSaleAttrValueService.getAttrBySpuId(skuId);</span><br><span class="line">skuItemVo.setSaleAttr(skuItemSaleAttrVoList);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;skuSaleAttrValueService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkuSaleAttrValueServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SkuSaleAttrValueDao</span>, <span class="title">SkuSaleAttrValueEntity</span>&gt; <span class="keyword">implements</span> <span class="title">SkuSaleAttrValueService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SkuItemVo.SkuItemSaleAttrVo&gt; getAttrBySpuId(Long spuId) &#123;</span><br><span class="line">        <span class="keyword">return</span> baseMapper.getAttrBySpuId(spuId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="mapper-1"><a href="#mapper-1" class="headerlink" title="mapper"></a>mapper</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.gulimall.product.dao.SkuSaleAttrValueDao&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;skuItemSaleAttrVo&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.atguigu.gulimall.product.vo.front.SkuItemVo$SkuItemSaleAttrVo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;attrId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;attr_id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;attrName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;attr_name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;attrValues&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.atguigu.gulimall.product.vo.front.SkuItemVo$AttrValueWithSkuIdVo&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;skuIds&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sku_ids&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;attrValue&quot;</span> <span class="attr">column</span>=<span class="string">&quot;attr_value&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAttrBySpuId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;skuItemSaleAttrVo&quot;</span>&gt;</span></span><br><span class="line">        select sav.attr_id,</span><br><span class="line">               sav.attr_name,</span><br><span class="line">               sav.attr_value,</span><br><span class="line">               group_concat(distinct si.sku_id) sku_ids</span><br><span class="line">        from gulimall_pms.pms_sku_info si</span><br><span class="line">                 left join gulimall_pms.pms_sku_sale_attr_value sav</span><br><span class="line">                           on sav.sku_id = si.sku_id</span><br><span class="line">        where spu_id = #&#123;spuId&#125;</span><br><span class="line">        group by sav.attr_id,</span><br><span class="line">                 sav.attr_name,</span><br><span class="line">                 sav.attr_value</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>这里最好起别名，要不然可能会封装不到</p></blockquote><h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><blockquote><p>自己看</p></blockquote><h3 id="异步编排优化"><a href="#异步编排优化" class="headerlink" title="异步编排优化"></a>异步编排优化</h3><h4 id="外部配置"><a href="#外部配置" class="headerlink" title="外部配置"></a>外部配置</h4><blockquote><p>就是可以在配置文件中配置如下的属性</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要引入依赖spring-boot-configuration-processor</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;gulimall.thread&quot;)</span>    <span class="comment">// 外部化配置</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolConfigProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer coreSize;</span><br><span class="line">    <span class="keyword">private</span> Integer maxSize;</span><br><span class="line">    <span class="keyword">private</span> Integer keepAliveTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="线程池配置"><a href="#线程池配置" class="headerlink" title="线程池配置"></a>线程池配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// @EnableConfigurationProperties(ThreadPoolConfigProperties.class)  //开启属性配置,这个注解和配置类的@Component注解二选一</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThreadConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ThreadPoolExecutor <span class="title">threadPoolExecutor</span><span class="params">(ThreadPoolConfigProperties pool)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">                pool.getCoreSize(), pool.getMaxSize(), pool.getKeepAliveTime(), TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;(<span class="number">100000</span>),</span><br><span class="line">                Executors.defaultThreadFactory(), <span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service-3"><a href="#service-3" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SkuItemVo <span class="title">getItemInfo</span><span class="params">(Long skuId)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    SkuItemVo skuItemVo = <span class="keyword">new</span> SkuItemVo();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 任务1，supplyAsync有返回值</span></span><br><span class="line">    CompletableFuture&lt;SkuInfoEntity&gt; infoFuture = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        <span class="comment">// 1 获取sku基本信息，pms_sku_info</span></span><br><span class="line">        SkuInfoEntity skuInfoEntity = getById(skuId);</span><br><span class="line">        skuItemVo.setInfo(skuInfoEntity);</span><br><span class="line">        <span class="keyword">return</span> skuInfoEntity;</span><br><span class="line">    &#125;, executor);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一下三个任务等任务1完成后才可执行，而且是并行的</span></span><br><span class="line">    CompletableFuture&lt;Void&gt; saleAttrFuture = infoFuture.thenAcceptAsync((skuInfoEntity) -&gt; &#123;</span><br><span class="line">        <span class="comment">// 3 获得spu销售属性组合</span></span><br><span class="line">        List&lt;SkuItemVo.SkuItemSaleAttrVo&gt; skuItemSaleAttrVoList = skuSaleAttrValueService.getAttrBySpuId(skuInfoEntity.getSpuId());</span><br><span class="line">        System.out.println(JSON.toJSONString(skuItemSaleAttrVoList));</span><br><span class="line">        skuItemVo.setSaleAttr(skuItemSaleAttrVoList);</span><br><span class="line">    &#125;, executor);</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Void&gt; descFuture = infoFuture.thenAcceptAsync((skuInfoEntity) -&gt; &#123;</span><br><span class="line">        <span class="comment">// 4 spu销售属性介绍 spu_info_desc</span></span><br><span class="line">        SpuInfoDescEntity spuInfoDescEntity = spuInfoDescService.getById(skuInfoEntity.getSpuId());</span><br><span class="line">        skuItemVo.setDesp(spuInfoDescEntity);</span><br><span class="line">    &#125;, executor);</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Void&gt; groupAttrFuture = infoFuture.thenAcceptAsync((skuInfoEntity) -&gt; &#123;</span><br><span class="line">        <span class="comment">// 5 spu规格参数</span></span><br><span class="line">        List&lt;SkuItemVo.SpuItemAttrGroupVo&gt; spuItemAttrGroupVoList = attrGroupService.getGroupWithAttrForSkuItem(skuInfoEntity.getSpuId(), skuInfoEntity.getCatalogId());</span><br><span class="line">        skuItemVo.setGroupAttrs(spuItemAttrGroupVoList);</span><br><span class="line">    &#125;, executor);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 任务2，该任务和任务1无关，所以和任务1并行即可，runAsync无返回值</span></span><br><span class="line">    CompletableFuture&lt;Void&gt; imageFuture = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">        <span class="comment">// 2 sku图片 pms_sku_images</span></span><br><span class="line">        List&lt;SkuImagesEntity&gt; skuImagesEntityList = skuImagesService.getBySkuId(skuId);</span><br><span class="line">        skuItemVo.setImages(skuImagesEntityList);</span><br><span class="line">    &#125;, executor);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 所有任务都完成后才返回</span></span><br><span class="line">    CompletableFuture.allOf(saleAttrFuture, descFuture, groupAttrFuture, imageFuture).get();</span><br><span class="line">    System.out.println(<span class="string">&quot;商品详情结果：&quot;</span> + JSON.toJSONString(skuItemVo));</span><br><span class="line">    <span class="keyword">return</span> skuItemVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
            <tag> redis </tag>
            
            <tag> 微服务 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】商城项目实战4</title>
      <link href="/2021/11/01/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-4/"/>
      <url>/2021/11/01/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-4/</url>
      
        <content type="html"><![CDATA[<h2 id="SpringBoot整合ES-Rest-Client"><a href="#SpringBoot整合ES-Rest-Client" class="headerlink" title="SpringBoot整合ES-Rest-Client"></a>SpringBoot整合ES-Rest-Client</h2><h3 id="基础搭建"><a href="#基础搭建" class="headerlink" title="基础搭建"></a>基础搭建</h3><h4 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h4><blockquote><p>创建一个独立的module</p></blockquote><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 覆盖springboot的默认版本，必须和client保持一致才行 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">elasticsearch.version</span>&gt;</span>7.4.2<span class="tag">&lt;/<span class="name">elasticsearch.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- elasticsearch.client --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><blockquote><p>nacos、springserver等</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.cloud.nacos.discovery.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">gulimall-search</span></span><br></pre></td></tr></table></figure><h3 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallElasticSearchConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// request设置项</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> RequestOptions COMMON_OPTIONS;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        RequestOptions.Builder builder = RequestOptions.DEFAULT.toBuilder();</span><br><span class="line">        <span class="comment">// builder.addHeader(&quot;Authorization&quot;, &quot;Bearer &quot; + TOKEN);</span></span><br><span class="line">        <span class="comment">// builder.setHttpAsyncResponseConsumerFactory(</span></span><br><span class="line">        <span class="comment">//         new HttpAsyncResponseConsumerFactory</span></span><br><span class="line">        <span class="comment">//                 .HeapBufferedResponseConsumerFactory(30 * 1024 * 1024 * 1024));</span></span><br><span class="line">        COMMON_OPTIONS = builder.build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 注入RestHighLevelClient</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestHighLevelClient <span class="title">esRestClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RestHighLevelClient client = <span class="keyword">new</span> RestHighLevelClient(</span><br><span class="line">                RestClient.builder(</span><br><span class="line">                        <span class="keyword">new</span> HttpHost(<span class="string">&quot;192.168.128.129&quot;</span>, <span class="number">9200</span>, <span class="string">&quot;http&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="TEST-amp-DEBUG"><a href="#TEST-amp-DEBUG" class="headerlink" title="TEST &amp; DEBUG"></a>TEST &amp; DEBUG</h3><blockquote><p>error creating bean with name ‘‘DataSource’</p><p>没有配置数据源，如果不需要就在application类上添加<code>@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.gulimall.gulimallsearch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.gulimall.gulimallsearch.config.GulimallElasticSearchConfig;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHits;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.AggregationBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.Aggregations;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.bucket.terms.Terms;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.bucket.terms.TermsAggregationBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.metrics.Avg;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.metrics.AvgAggregationBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallSearchApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*\</span></span><br><span class="line"><span class="comment">     * 测试复杂检索</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">complexSearch</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 创建检索请求</span></span><br><span class="line">        SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest();</span><br><span class="line">        <span class="comment">// 指定索引</span></span><br><span class="line">        searchRequest.indices(<span class="string">&quot;bank&quot;</span>);</span><br><span class="line">        <span class="comment">// 指定检索条件</span></span><br><span class="line">        SearchSourceBuilder searchSourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * searchSourceBuilder.query();</span></span><br><span class="line"><span class="comment">         * searchSourceBuilder.aggregation();</span></span><br><span class="line"><span class="comment">         * searchSourceBuilder.from()</span></span><br><span class="line"><span class="comment">         * searchSourceBuilder.size()</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * searchSourceBuilder.query(QueryBuilders.matchAllQuery());</span></span><br><span class="line"><span class="comment">         * searchSourceBuilder.query(QueryBuilders.matchPhraseQuery());</span></span><br><span class="line"><span class="comment">         * searchSourceBuilder.query(QueryBuilders.matchQuery(&quot;address&quot;, &quot;mill&quot;));</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * searchSourceBuilder.aggregation(AggregationBuilders.avg(&quot;&quot;).field(&quot;&quot;));</span></span><br><span class="line"><span class="comment">         * searchSourceBuilder.aggregation(AggregationBuilders.terms(&quot;&quot;).field(&quot;&quot;).size(99));</span></span><br><span class="line"><span class="comment">         * ……</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        searchSourceBuilder.query(QueryBuilders.matchQuery(<span class="string">&quot;address&quot;</span>, <span class="string">&quot;mill&quot;</span>));</span><br><span class="line">        <span class="comment">//1.2）、按照年龄的值分布进行聚合</span></span><br><span class="line">        TermsAggregationBuilder ageAgg = AggregationBuilders.terms(<span class="string">&quot;ageAgg&quot;</span>).field(<span class="string">&quot;age&quot;</span>).size(<span class="number">10</span>);</span><br><span class="line">        searchSourceBuilder.aggregation(ageAgg);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.3）、计算平均薪资</span></span><br><span class="line">        AvgAggregationBuilder balanceAvg = AggregationBuilders.avg(<span class="string">&quot;balanceAvg&quot;</span>).field(<span class="string">&quot;balance&quot;</span>);</span><br><span class="line">        searchSourceBuilder.aggregation(balanceAvg);</span><br><span class="line">        System.out.println(<span class="string">&quot;检索条件: &quot;</span> + searchSourceBuilder.toString());</span><br><span class="line">        <span class="comment">// 指定检索条件对象</span></span><br><span class="line">        searchRequest.source(searchSourceBuilder);</span><br><span class="line">        <span class="comment">// 执行检索</span></span><br><span class="line">        SearchResponse response = client.search(searchRequest, GulimallElasticSearchConfig.COMMON_OPTIONS);</span><br><span class="line">        <span class="comment">// 分析结果;</span></span><br><span class="line">        <span class="comment">// 获得hit结果</span></span><br><span class="line">        SearchHits hits = response.getHits();</span><br><span class="line">        SearchHit[] hitsHits = hits.getHits();</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : hitsHits) &#123;</span><br><span class="line">            String sourceAsString = hit.getSourceAsString();</span><br><span class="line">            Accout accout = JSON.parseObject(sourceAsString, Accout.class);</span><br><span class="line">            System.out.println(<span class="string">&quot;accout：&quot;</span> + accout);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取这次检索到的分析信息；</span></span><br><span class="line">        Aggregations aggregations = response.getAggregations();</span><br><span class="line"><span class="comment">//        for (Aggregation aggregation : aggregations.asList()) &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;当前聚合：&quot;+aggregation.getName());</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        Terms terms = aggregations.get(<span class="string">&quot;ageAgg&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Terms.Bucket bucket : terms.getBuckets()) &#123;</span><br><span class="line">            String keyAsString = bucket.getKeyAsString();</span><br><span class="line">            System.out.println(<span class="string">&quot;年龄：&quot;</span> + keyAsString + <span class="string">&quot;==&gt;&quot;</span> + bucket.getDocCount());</span><br><span class="line">        &#125;</span><br><span class="line">        Avg balanceAvg1 = aggregations.get(<span class="string">&quot;balanceAvg&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;平均薪资：&quot;</span> + balanceAvg1.getValue());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ToString</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Accout</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> account_number;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> balance;</span><br><span class="line">        <span class="keyword">private</span> String firstname;</span><br><span class="line">        <span class="keyword">private</span> String lastname;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">        <span class="keyword">private</span> String gender;</span><br><span class="line">        <span class="keyword">private</span> String address;</span><br><span class="line">        <span class="keyword">private</span> String employer;</span><br><span class="line">        <span class="keyword">private</span> String email;</span><br><span class="line">        <span class="keyword">private</span> String city;</span><br><span class="line">        <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*\</span></span><br><span class="line"><span class="comment">     * 测试存储</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">indexData</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 创建indexRequest，传入index值</span></span><br><span class="line">        IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(<span class="string">&quot;users&quot;</span>);</span><br><span class="line">        indexRequest.id(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        <span class="comment">// 传入文档(jsonString格式)</span></span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="string">&quot;张三&quot;</span>, <span class="string">&quot;男&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        String jsonString = JSON.toJSONString(user);</span><br><span class="line">        indexRequest.source(jsonString, XContentType.JSON);</span><br><span class="line">        <span class="comment">// 执行操作并获得响应数据</span></span><br><span class="line">        IndexResponse response = client.index(indexRequest, GulimallElasticSearchConfig.COMMON_OPTIONS);</span><br><span class="line">        System.out.println(response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义类型</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String username;</span><br><span class="line">        <span class="keyword">private</span> String gender;</span><br><span class="line">        <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String username, String gender, Integer age)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.username = username;</span><br><span class="line">            <span class="keyword">this</span>.gender = gender;</span><br><span class="line">            <span class="keyword">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(client);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="商品上架"><a href="#商品上架" class="headerlink" title="商品上架"></a>商品上架</h2><blockquote><p>商品系统—商品维护—SPU管理—上架</p><p>上架即将商品数据保存至ES中，只有上架的商品才能被全文检索。</p></blockquote><h3 id="SKU在ES中存储模型"><a href="#SKU在ES中存储模型" class="headerlink" title="SKU在ES中存储模型"></a>SKU在ES中存储模型</h3><blockquote><p>检索会根据：SKU的标题、价格、销量、品牌、分类、商品规格等进行检索</p><p>模型设计需要花费一定心思，详见文档<code>09、商城业务</code></p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;skuId&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;spuId&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;skuTitle&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;skuPrice&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;skuImg&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;index&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">&quot;doc_values&quot;</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;saleCount&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;hasStock&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;boolean&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;hotScore&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;brandId&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;catalogId&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;brandName&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;index&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">&quot;doc_values&quot;</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;brandImg&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;index&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">&quot;doc_values&quot;</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;catalogName&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;index&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">&quot;doc_values&quot;</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;attrs&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;nested&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                    <span class="attr">&quot;attrId&quot;</span>: &#123;</span><br><span class="line">                        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">&quot;attrName&quot;</span>: &#123;</span><br><span class="line">                        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;index&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                        <span class="attr">&quot;doc_values&quot;</span>: <span class="literal">false</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">&quot;attrValue&quot;</span>: &#123;</span><br><span class="line">                        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>“index”:false<br>“doc_values”:false</p><p>表示该冗余的字段不需要用于检索与聚合</p><p>检索服务回来表示，这个设置数据类型的步骤很重要，特别是nested这种</p></blockquote><blockquote><p>这里的模型必须修改，超级感谢一个大佬，文档很详细</p><p><a href="https://www.yuque.com/zhangshuaiyin/guli-mall/loztwd">检索服务 · 语雀 (yuque.com)</a></p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"># 查看原来的映射规则</span><br><span class="line">GET gulimall_product/_mapping</span><br><span class="line"># 修改为新的映射 并创建新的索引，下面进行数据迁移</span><br><span class="line">PUT /mall_product</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;skuId&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;spuId&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;skuTitle&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;skuPrice&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;skuImg&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;saleCount&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;hosStock&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;boolean&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;hotScore&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;brandId&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;catalogId&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;brandName&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;brandImg&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;catalogName&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;attrs&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;nested&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;attrId&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;attrName&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;attrValue&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 数据迁移</span><br><span class="line">POST _reindex</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;gulimall_product&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;mall_product&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="gulimall-product"><a href="#gulimall-product" class="headerlink" title="gulimall-product"></a>gulimall-product</h3><h4 id="SkuEsModel"><a href="#SkuEsModel" class="headerlink" title="SkuEsModel"></a>SkuEsModel</h4><blockquote><p>写在common的to文件夹中，作为传输对象</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkuEsModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long skuId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long spuId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String skuTitle;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BigDecimal skuPrice;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String skuImg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long saleCount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean hasStock;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long hotScore;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long catalogId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String brandName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String brandImg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String catalogName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Attrs&gt; attrs;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Attrs</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Long attrId;</span><br><span class="line">        <span class="keyword">private</span> String attrName;</span><br><span class="line">        <span class="keyword">private</span> String attrValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="SkuHasStockTo"><a href="#SkuHasStockTo" class="headerlink" title="SkuHasStockTo"></a>SkuHasStockTo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkuHasStockTo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long skuId;</span><br><span class="line">    <span class="keyword">private</span> Boolean hasStock;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="SpuInfoController"><a href="#SpuInfoController" class="headerlink" title="SpuInfoController"></a>SpuInfoController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/spuinfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuInfoController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SpuInfoService spuInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商品上架，保存到ES中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&#123;spuId&#125;/up&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">spuUp</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span> Long spuId)</span> </span>&#123;</span><br><span class="line">        spuInfoService.spuUp(spuId);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="SpuInfoServiceImpl"><a href="#SpuInfoServiceImpl" class="headerlink" title="SpuInfoServiceImpl"></a>SpuInfoServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 商品上架</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">spuUp</span><span class="params">(Long spuId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 将数据存入SkuEsModel对象当中</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 查出sku品牌和分类信息（不需要对每个sku都查询，所以放在stream外面）</span></span><br><span class="line">        SpuInfoEntity spuInfoEntity = <span class="keyword">this</span>.getById(spuId);</span><br><span class="line">        BrandEntity brandEntity = brandService.getById(spuInfoEntity.getBrandId());</span><br><span class="line">        Long brandId = brandEntity.getBrandId();</span><br><span class="line">        String brandLogo = brandEntity.getLogo();</span><br><span class="line">        String brandName = brandEntity.getName();</span><br><span class="line">        CategoryEntity categoryEntity = categoryService.getById(spuInfoEntity.getCatalogId());</span><br><span class="line">        String categoryName = categoryEntity.getName();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 查出sku的attr,并且是可以被全文检索的</span></span><br><span class="line">        List&lt;ProductAttrValueEntity&gt; baseAttrList = productAttrValueService.baseAttrListForSpu(spuId);</span><br><span class="line">        List&lt;Long&gt; attrIdList = baseAttrList.stream().map(attr -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> attr.getAttrId();</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据查出的所有attr找出可以被全文检索的</span></span><br><span class="line">        List&lt;Long&gt; searchAttrIdList = attrService.getIdsCanSearch(attrIdList);</span><br><span class="line">        <span class="comment">// 使用SET集合方便判断是否存在指定id</span></span><br><span class="line">        Set&lt;Long&gt; idSet = <span class="keyword">new</span> HashSet&lt;&gt;(searchAttrIdList);</span><br><span class="line"></span><br><span class="line">        List&lt;SkuEsModel.Attrs&gt; skuEsModelAttrsList = baseAttrList.stream().filter(attr -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> idSet.contains(attr.getAttrId());</span><br><span class="line">        &#125;).map(attr -&gt; &#123;</span><br><span class="line">            SkuEsModel.Attrs attrEntity = <span class="keyword">new</span> SkuEsModel.Attrs();</span><br><span class="line">            BeanUtils.copyProperties(attr, attrEntity);</span><br><span class="line">            <span class="keyword">return</span> attrEntity;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 查出当前spuid对应的sku信息</span></span><br><span class="line">        List&lt;SkuInfoEntity&gt; skuInfoEntities = skuInfoService.getSkuListBySpuId(spuId);</span><br><span class="line"></span><br><span class="line">        Map&lt;Long, Boolean&gt; skuHasStockCollect = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 3.5 查出所有sku的是否有库存信息</span></span><br><span class="line">            List&lt;SkuHasStockTo&gt; skuHasStockList = wareFeignService.getSkuHasStockList(skuInfoEntities.stream().map(SkuInfoEntity::getSkuId).collect(Collectors.toList()));</span><br><span class="line">            <span class="comment">// 封装到map当中，可以直接查询对应key的value</span></span><br><span class="line">            skuHasStockCollect = skuHasStockList.stream().collect(Collectors.toMap(SkuHasStockTo::getSkuId, item -&gt; item.getHasStock()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;库存服务远程调用异常：原因&#123;&#125;&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4 封装每个sku信息</span></span><br><span class="line">        Map&lt;Long, Boolean&gt; finalSkuHasStockCollect = skuHasStockCollect;</span><br><span class="line">        List&lt;SkuEsModel&gt; upSku = skuInfoEntities.stream().map(skuInfo -&gt; &#123;</span><br><span class="line">            SkuEsModel skuEsModel = <span class="keyword">new</span> SkuEsModel();</span><br><span class="line">            BeanUtils.copyProperties(skuInfo, skuEsModel);</span><br><span class="line">            skuEsModel.setSkuPrice(skuInfo.getPrice());</span><br><span class="line">            skuEsModel.setSkuImg(skuInfo.getSkuDefaultImg());</span><br><span class="line">            <span class="comment">// 远程调用库存系统是否有库存</span></span><br><span class="line">            <span class="keyword">if</span> (finalSkuHasStockCollect == <span class="keyword">null</span>) &#123;</span><br><span class="line">                skuEsModel.setHasStock(<span class="keyword">true</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                skuEsModel.setHasStock(finalSkuHasStockCollect.get(skuInfo.getSkuId()));</span><br><span class="line">            &#125;</span><br><span class="line">            skuEsModel.setHotScore(<span class="number">0L</span>);</span><br><span class="line">            skuEsModel.setBrandId(brandId);</span><br><span class="line">            skuEsModel.setBrandImg(brandLogo);</span><br><span class="line">            skuEsModel.setBrandName(brandName);</span><br><span class="line">            skuEsModel.setCatalogName(categoryName);</span><br><span class="line">            skuEsModel.setAttrs(skuEsModelAttrsList);</span><br><span class="line">            <span class="keyword">return</span> skuEsModel;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5 发给ES</span></span><br><span class="line">        R r = searchFeignService.productStatusUp(upSku);</span><br><span class="line">        <span class="keyword">if</span> (r.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 远程调用成功</span></span><br><span class="line">            <span class="comment">// 修改spu的状态为上架</span></span><br><span class="line">            SpuInfoEntity spu = <span class="keyword">new</span> SpuInfoEntity();</span><br><span class="line">            spu.setId(spuId);</span><br><span class="line">            spu.setPublishStatus(ProductConstant.StatusEnum.SPU_UP.getCode());</span><br><span class="line">            <span class="keyword">this</span>.updateById(spu);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// TODO 远程调用失败</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="WareFeignService"><a href="#WareFeignService" class="headerlink" title="WareFeignService"></a>WareFeignService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;gulimall-ware&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WareFeignService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 检查每个sku是否又库存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/ware/waresku/hasstock&quot;)</span></span><br><span class="line">    <span class="function">R <span class="title">getSkuHasStockList</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;Long&gt; skuIdList)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="SearchFeignService"><a href="#SearchFeignService" class="headerlink" title="SearchFeignService"></a>SearchFeignService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;gulimall-search&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SearchFeignService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/search/save/product&quot;)</span></span><br><span class="line">    <span class="function">R <span class="title">productStatusUp</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;SkuEsModel&gt; skuEsModelList)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrDao"><a href="#AttrDao" class="headerlink" title="AttrDao"></a>AttrDao</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在指定的集合中找到所有可以别全文检索的  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectIdsWithSearchAttr&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Long&quot;</span>&gt;</span></span><br><span class="line">    SELECT attr_id</span><br><span class="line">    from gulimall_pms.pms_attr</span><br><span class="line">    WHERE attr_id IN</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;attrIdList&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    AND search_type = 1</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="R"><a href="#R" class="headerlink" title="R"></a>R</h4><blockquote><p>给R加上泛型，用于方便远程调用直接传输对应数据（别的方法也可以）</p><p>我不想写泛型，泛型也还是要加一个TO，直接传一个TO呗，我也不想知道R的其他信息</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">R</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">HashMap</span>&lt;<span class="title">String</span>, <span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="gulimall-ware"><a href="#gulimall-ware" class="headerlink" title="gulimall-ware"></a>gulimall-ware</h3><h4 id="WareSkuController"><a href="#WareSkuController" class="headerlink" title="WareSkuController"></a>WareSkuController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;ware/waresku&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WareSkuController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WareSkuService wareSkuService;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 检查每个sku是否又库存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/hasstock&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;SkuHasStockTo&gt; <span class="title">getSkuHasStockList</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;Long&gt; skuIdList)</span> </span>&#123;</span><br><span class="line">        List&lt;SkuHasStockTo&gt; hasStock = wareSkuService.getSkuHasStockList(skuIdList);</span><br><span class="line">        <span class="keyword">return</span> hasStock;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="WareSkuServiceImpl"><a href="#WareSkuServiceImpl" class="headerlink" title="WareSkuServiceImpl"></a>WareSkuServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 检查每个sku是否又库存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;SkuHasStockTo&gt; <span class="title">getSkuHasStockList</span><span class="params">(List&lt;Long&gt; skuIdList)</span> </span>&#123;</span><br><span class="line">    List&lt;SkuHasStockTo&gt; voList = skuIdList.stream().map(skuId -&gt; &#123;</span><br><span class="line">        SkuHasStockTo skuHasStockVo = <span class="keyword">new</span> SkuHasStockTo();</span><br><span class="line">        Long count = baseMapper.getSkuStock(skuId);</span><br><span class="line">        skuHasStockVo.setSkuId(skuId);</span><br><span class="line">        <span class="comment">// 可能没有库存返回null</span></span><br><span class="line">        skuHasStockVo.setHasStock(count != <span class="keyword">null</span> &amp;&amp; count &gt; <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> skuHasStockVo;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> voList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="WareSkuDao"><a href="#WareSkuDao" class="headerlink" title="WareSkuDao"></a>WareSkuDao</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getSkuStock&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Long&quot;</span>&gt;</span></span><br><span class="line">    SELECT SUM(stock - stock_locked)</span><br><span class="line">    FROM gulimall_wms.wms_ware_sku</span><br><span class="line">    WHERE sku_id = #&#123;skuId&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="gulimall-search"><a href="#gulimall-search" class="headerlink" title="gulimall-search"></a>gulimall-search</h3><h4 id="ElasticSearchController"><a href="#ElasticSearchController" class="headerlink" title="ElasticSearchController"></a>ElasticSearchController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/search&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElasticSearchController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ElasticSearchService searchService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上架商品</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> skuEsModelList</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/product&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">productStatusUp</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;SkuEsModel&gt; skuEsModelList)</span> </span>&#123;</span><br><span class="line">        searchService.productUp(skuEsModelList);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ElasticSearchServiceImpl"><a href="#ElasticSearchServiceImpl" class="headerlink" title="ElasticSearchServiceImpl"></a>ElasticSearchServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElasticSearchServiceImpl</span> <span class="keyword">implements</span> <span class="title">ElasticSearchService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上架商品</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> skuEsModelList</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">productUp</span><span class="params">(List&lt;SkuEsModel&gt; skuEsModelList)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 创建索引</span></span><br><span class="line">        BulkRequest bulkRequest = <span class="keyword">new</span> BulkRequest();</span><br><span class="line">        <span class="keyword">for</span> (SkuEsModel skuEsModel : skuEsModelList) &#123;</span><br><span class="line">            <span class="comment">//构造保存请求</span></span><br><span class="line">            IndexRequest indexRequest = <span class="keyword">new</span> IndexRequest(EsConstant.PRODUCT_INDEX);</span><br><span class="line">            indexRequest.id(String.valueOf(skuEsModel.getSkuId()));</span><br><span class="line">            indexRequest.source(JSON.toJSONString(skuEsModel), XContentType.JSON);</span><br><span class="line">            <span class="comment">// 保存请求添加到bulk中</span></span><br><span class="line">            bulkRequest.add(indexRequest);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 执行批量操作</span></span><br><span class="line">        BulkResponse bulk = client.bulk(bulkRequest, GulimallElasticSearchConfig.COMMON_OPTIONS);</span><br><span class="line">        <span class="comment">// TODO 如果有错误可以处理</span></span><br><span class="line">        <span class="keyword">boolean</span> hasFailures = bulk.hasFailures();</span><br><span class="line">        List&lt;String&gt; collect = Arrays.stream(bulk.getItems()).map(item -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> item.getId();</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        log.error(<span class="string">&quot;商品上架信息：&#123;&#125;&quot;</span>, collect);</span><br><span class="line">        <span class="keyword">return</span> hasFailures;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="DEBUG"><a href="#DEBUG" class="headerlink" title="DEBUG"></a>DEBUG</h3><blockquote><p>懒得写，主要是hasFailures返回值得判断，以及远程调用返回值（使用TO就不会，R泛型需要修改）</p><p>kibana -&gt; GET product/_search查看是否有数据</p><p>跟着做顺畅，但是还是要再看一遍然后自己做</p></blockquote><h2 id="商城首页"><a href="#商城首页" class="headerlink" title="商城首页"></a>商城首页</h2><h3 id="整合themeleaf"><a href="#整合themeleaf" class="headerlink" title="整合themeleaf"></a>整合themeleaf</h3><blockquote><p>震惊，竟然要用模板引擎，想念VUE的第一天</p></blockquote><h4 id="依赖-1"><a href="#依赖-1" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  thymleaf模板引擎  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><blockquote><p>关闭缓存等</p><p>所有前台的controller统一存放在web文件夹下，而后台在app当中</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">springboot:</span></span><br><span class="line"><span class="attr">thymeleaf:</span></span><br><span class="line">  <span class="attr">cache:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h4 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h4><blockquote><p>静态资源放在resources -&gt; static下，模板页面放在templates文件夹下即可</p><p>也可以修改resources location配置</p></blockquote><h3 id="引入dev-tools"><a href="#引入dev-tools" class="headerlink" title="引入dev-tools"></a>引入dev-tools</h3><blockquote><p>热部署</p></blockquote><h4 id="依赖-2"><a href="#依赖-2" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- dev tool --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置-2"><a href="#配置-2" class="headerlink" title="配置"></a>配置</h4><h3 id="渲染一级分类"><a href="#渲染一级分类" class="headerlink" title="渲染一级分类"></a>渲染一级分类</h3><blockquote><p>简直是文艺复兴了</p><p>以后thymeleaf的模板修改我就不PO了，麻烦</p></blockquote><h4 id="IndexController"><a href="#IndexController" class="headerlink" title="IndexController"></a>IndexController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span> <span class="comment">// 不适用RESTController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryService categoryService;</span><br><span class="line">    <span class="meta">@GetMapping(&#123;&quot;/&quot;, &quot;/index.html&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">indexPage</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1 查出所有一级分类</span></span><br><span class="line">        List&lt;CategoryEntity&gt; categoryEntityList = categoryService.getLevel1List();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// thymeleaf已经有了默认前缀，定位到classpath:/resources/templates</span></span><br><span class="line">        <span class="comment">// 默认后缀 html</span></span><br><span class="line">        model.addAttribute(<span class="string">&quot;categoryList&quot;</span>, categoryEntityList);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CategoryServiceImpl"><a href="#CategoryServiceImpl" class="headerlink" title="CategoryServiceImpl"></a>CategoryServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前台：渲染首页</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title">getLevel1List</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;CategoryEntity&gt; categoryEntityList = baseMapper.selectList(<span class="keyword">new</span> QueryWrapper&lt;CategoryEntity&gt;().eq(<span class="string">&quot;parent_cid&quot;</span>, <span class="number">0</span>));</span><br><span class="line">    <span class="keyword">return</span> categoryEntityList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--轮播主体内容--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header_main&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header_banner&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header_main_left&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;category : $&#123;categoryList&#125;&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/static/#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;header_main_left_a&quot;</span> <span class="attr">th:attr</span>=<span class="string">&quot;ctg-data=$&#123;category.catId&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">b</span></span></span><br><span class="line"><span class="tag">                                    <span class="attr">th:text</span>=<span class="string">&quot;$&#123;category.name&#125;&quot;</span>&gt;</span>家用电器<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="渲染子级分类"><a href="#渲染子级分类" class="headerlink" title="渲染子级分类"></a>渲染子级分类</h3><h4 id="CategoryFrontVo"><a href="#CategoryFrontVo" class="headerlink" title="CategoryFrontVo"></a>CategoryFrontVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 二级分类VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Catalog2Vo</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 这个属性名要和前端需要的JSON对应</span></span><br><span class="line">    <span class="keyword">private</span> String catalog1Id;  <span class="comment">// 一级父分类id</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Catalog3Vo&gt; catalog3List;  <span class="comment">// 三级分类（本vo为二级分类）</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 三级分类VO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Catalog3Vo</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String catalog2Id;</span><br><span class="line">        <span class="keyword">private</span> String id;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="IndexController-1"><a href="#IndexController-1" class="headerlink" title="IndexController"></a>IndexController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 渲染二级、三级分类</span></span><br><span class="line"><span class="comment"> * 这里的路径与catalogLoader.js中发送请求的路径一致</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ResponseBody</span>   <span class="comment">// 返回值以JSON方式返回，且不需要跳转页面</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/index/catalog.json&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;Catalog2Vo&gt;&gt; getCatalogJson(Model model) &#123;</span><br><span class="line">    Map&lt;String, List&lt;Catalog2Vo&gt;&gt; category = categoryService.getCatalogJson();</span><br><span class="line">    <span class="keyword">return</span> category;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CategoryServiceImpl-1"><a href="#CategoryServiceImpl-1" class="headerlink" title="CategoryServiceImpl"></a>CategoryServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 渲染二级、三级分类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;Catalog2Vo&gt;&gt; getCatalogJson() &#123;</span><br><span class="line">    List&lt;CategoryEntity&gt; level1List = <span class="keyword">this</span>.getLevel1List();</span><br><span class="line">    <span class="comment">// 封装数据</span></span><br><span class="line">    Map&lt;String, List&lt;Catalog2Vo&gt;&gt; catalogMap = level1List.stream().collect(Collectors.toMap(k -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> k.getCatId().toString();</span><br><span class="line">    &#125;, parent -&gt; &#123;</span><br><span class="line">        <span class="comment">// 将二级分类的内容封装到一级分类当中</span></span><br><span class="line">        List&lt;CategoryEntity&gt; children2List = baseMapper.selectList(<span class="keyword">new</span> QueryWrapper&lt;CategoryEntity&gt;().eq(<span class="string">&quot;parent_cid&quot;</span>, parent.getCatId()));</span><br><span class="line">        List&lt;Catalog2Vo&gt; catalog2VoList = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (children2List != <span class="keyword">null</span>) &#123;</span><br><span class="line">            catalog2VoList = children2List.stream().map(child2 -&gt; &#123;</span><br><span class="line">                Catalog2Vo catalog2Vo = <span class="keyword">new</span> Catalog2Vo(parent.getCatId().toString(), <span class="keyword">null</span>, child2.getCatId().toString(), child2.getName());</span><br><span class="line">                <span class="comment">// 封装三级分类信息</span></span><br><span class="line">                List&lt;CategoryEntity&gt; children3List = baseMapper.selectList(<span class="keyword">new</span> QueryWrapper&lt;CategoryEntity&gt;().eq(<span class="string">&quot;parent_cid&quot;</span>, child2.getCatId()));</span><br><span class="line">                <span class="keyword">if</span> (children3List != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    List&lt;Catalog2Vo.Catalog3Vo&gt; catalog3VoList = children3List.stream().map(child3 -&gt; &#123;</span><br><span class="line">                        Catalog2Vo.Catalog3Vo catalog3Vo = <span class="keyword">new</span> Catalog2Vo.Catalog3Vo(child2.getCatId().toString(), child3.getCatId().toString(), child3.getName());</span><br><span class="line">                        <span class="keyword">return</span> catalog3Vo;</span><br><span class="line">                    &#125;).collect(Collectors.toList());</span><br><span class="line">                    catalog2Vo.setCatalog3List(catalog3VoList);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> catalog2Vo;</span><br><span class="line">            &#125;).collect(Collectors.toList());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> catalog2VoList;</span><br><span class="line">    &#125;));</span><br><span class="line">    <span class="keyword">return</span> catalogMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>为啥老师这么喜欢嵌套？</p></blockquote><h3 id="优化子级分类"><a href="#优化子级分类" class="headerlink" title="优化子级分类"></a>优化子级分类</h3><h4 id="CategoryServiceImpl-2"><a href="#CategoryServiceImpl-2" class="headerlink" title="CategoryServiceImpl"></a>CategoryServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 渲染二级、三级分类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;Catalog2Vo&gt;&gt; getCatalogJson() &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 优化</span></span><br><span class="line"><span class="comment">     * 多次查询数据库 -》 一次查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// 一次查询数据库，获得所有的分类</span></span><br><span class="line">    List&lt;CategoryEntity&gt; allCatList = baseMapper.selectList(<span class="keyword">null</span>);</span><br><span class="line">    <span class="comment">// 获得一级分类</span></span><br><span class="line">    List&lt;CategoryEntity&gt; level1List = getCatListByParentCid(allCatList, <span class="number">0L</span>);</span><br><span class="line">    <span class="comment">// 封装数据</span></span><br><span class="line">    Map&lt;String, List&lt;Catalog2Vo&gt;&gt; catalogMap = level1List.stream().collect(Collectors.toMap(k -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> k.getCatId().toString();</span><br><span class="line">    &#125;, parent -&gt; &#123;</span><br><span class="line">        <span class="comment">// 将二级分类的内容封装到一级分类当中</span></span><br><span class="line">        List&lt;CategoryEntity&gt; children2List = getCatListByParentCid(allCatList, parent.getCatId());</span><br><span class="line">        List&lt;Catalog2Vo&gt; catalog2VoList = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (children2List != <span class="keyword">null</span>) &#123;</span><br><span class="line">            catalog2VoList = children2List.stream().map(child2 -&gt; &#123;</span><br><span class="line">                Catalog2Vo catalog2Vo = <span class="keyword">new</span> Catalog2Vo(parent.getCatId().toString(), <span class="keyword">null</span>, child2.getCatId().toString(), child2.getName());</span><br><span class="line">                <span class="comment">// 封装三级分类信息</span></span><br><span class="line">                List&lt;CategoryEntity&gt; children3List = getCatListByParentCid(allCatList, child2.getCatId());</span><br><span class="line">                <span class="keyword">if</span> (children3List != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    List&lt;Catalog2Vo.Catalog3Vo&gt; catalog3VoList = children3List.stream().map(child3 -&gt; &#123;</span><br><span class="line">                        Catalog2Vo.Catalog3Vo catalog3Vo = <span class="keyword">new</span> Catalog2Vo.Catalog3Vo(child2.getCatId().toString(), child3.getCatId().toString(), child3.getName());</span><br><span class="line">                        <span class="keyword">return</span> catalog3Vo;</span><br><span class="line">                    &#125;).collect(Collectors.toList());</span><br><span class="line">                    catalog2Vo.setCatalog3List(catalog3VoList);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> catalog2Vo;</span><br><span class="line">            &#125;).collect(Collectors.toList());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> catalog2VoList;</span><br><span class="line">    &#125;));</span><br><span class="line">    <span class="keyword">return</span> catalogMap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 根据parentCid查询下级分类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;CategoryEntity&gt; <span class="title">getCatListByParentCid</span><span class="params">(List&lt;CategoryEntity&gt; allCatList, Long parentCid)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// return baseMapper.selectList(new QueryWrapper&lt;CategoryEntity&gt;().eq(&quot;parent_cid&quot;, parent.getCatId()));</span></span><br><span class="line">    List&lt;CategoryEntity&gt; collect = allCatList.stream().filter(categoryEntity -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> categoryEntity.getParentCid().equals(parentCid);</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> collect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="配置反向代理💡"><a href="#配置反向代理💡" class="headerlink" title="配置反向代理💡"></a>配置反向代理💡</h2><blockquote><p>正向代理：如科学上网，隐藏客户端信息</p><p>反向代理：屏蔽内网服务器信息，负载均衡访问</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211104134348607.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211104134348607.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211104134348607"></p><h3 id="配置host"><a href="#配置host" class="headerlink" title="配置host"></a>配置host</h3><blockquote><p>C:\Windows\System32\drivers\etc\host 文件添加上地址</p><p>使用switchHost软件可以快速应用方案</p><p>192.168.128.129/192.168.128.129:80(nginx默认地址) -&gt; gulimall.com</p></blockquote><h3 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h3><blockquote><p>虚拟机外部挂载下的conf文件</p><p>/mydata/nginx/conf/nginx.conf</p><p>/mydata/nginx/conf/conf.d/default.conf</p><p>可以先复制有份conf在配置</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211104135932605.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211104135932605.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211104135932605"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">upstream gulimall&#123;</span><br><span class="line">      server 192.168.128.1:88;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  gulimall.com;</span><br><span class="line"></span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    #access_log  /var/log/nginx/log/host.access.log  main;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">    # 需要配置header，添加上host，因为nginx转发代理给网关的时候会丢失许多信息</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_pass http://gulimall;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>TODO 转不了为什么？nginx可以访问到，但是nginx转发不到本机，我感觉还是proxy_pass配置的问题，但是我每个ip都试过了？</p><p>我不理解：<a href="http://192.168.128.1:10000/">192.168.128.1:10000</a>是可以的，<a href="http://192.168.128.129:5601也是可以的，虚拟机ping">http://192.168.128.129:5601也是可以的，虚拟机ping</a> 192.168.128.1也是可以的？</p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211104155128119.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211104155128119.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211104155128119"></p><p>目测是本机 -&gt; 虚拟机nginx是成功的，但是nginx -&gt; 本机192.168.128.1:10000失败了</p></blockquote><blockquote><p>重点说明！！！以上问题已解决，是本机防火墙的原因，操作如下<a href="https://jingyan.baidu.com/article/9f7e7ec04321f22e29155413.html">Windows 通过命令行关闭防火墙-百度经验 (baidu.com)</a></p><p>感谢：<a href="https://blog.csdn.net/weixin_44928340/article/details/109085861?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_ecpm_v1~rank_aggregation-12-109085861.pc_agg_rank_aggregation&utm_term=nginx+%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E&spm=1000.2123.3001.4430">谷粒商城高级篇p139、p140Nginx反向代理，网关配置不生效解决_含雷的博客-CSDN博客</a>（被ping通欺骗了，所以一开始排除了防火墙）</p><p>关掉本机的防火墙，虚拟机的nginx就能转发到本机了！！！</p></blockquote><h3 id="配置网关"><a href="#配置网关" class="headerlink" title="配置网关"></a>配置网关</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -----------------------nginx，一定要放在最后，要不然/api/下的配置会被覆盖-----------------------</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">gulimall_host_route</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://gulimall-product</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Host=**.gulimall.com,gulimall.com</span></span><br></pre></td></tr></table></figure><blockquote><p>总结一下实现：虚拟机192.168.128.129 通过修改win的host文件，相当于gulimall.com，192.168.128.1:10000 是本机商品服务的地址，现在需要通过请求nginx，然后nginx代理网关，网关再转发给对应服务地址，所以在虚拟机的nginx中配置，请求192.168.128.129:80（nginx端口80），本来是请求虚拟机的nginx，然后nginx配置80端口代理地址192.168.128.1:88（即本机的网关地址），然后网关配置**.gulimall.com转发到gulimall-product服务实现。</p><p>本机请求 -&gt; 虚拟机nginx -&gt; 本机网关 -&gt; 本地服务地址</p></blockquote><h2 id="性能压测"><a href="#性能压测" class="headerlink" title="性能压测"></a>性能压测</h2><h3 id="压力测试"><a href="#压力测试" class="headerlink" title="压力测试"></a>压力测试</h3><blockquote><p>具体介绍见课件04</p></blockquote><h4 id="Jmeter"><a href="#Jmeter" class="headerlink" title="Jmeter"></a>Jmeter</h4><blockquote><p>正好测试课要写测试工具报告</p><p>详细见测试工具报告</p></blockquote><h3 id="性能监控"><a href="#性能监控" class="headerlink" title="性能监控"></a>性能监控</h3><h4 id="堆内存与垃圾回收"><a href="#堆内存与垃圾回收" class="headerlink" title="堆内存与垃圾回收"></a>堆内存与垃圾回收</h4><blockquote><p>详见P144</p></blockquote><h4 id="jvisualvm"><a href="#jvisualvm" class="headerlink" title="jvisualvm"></a>jvisualvm</h4><blockquote><p>命令行启动：jvisualvm</p><p>安装插件 visual gc（建议手动下载然后添加插件即可）</p></blockquote><h3 id="简单优化吞吐量"><a href="#简单优化吞吐量" class="headerlink" title="简单优化吞吐量"></a>简单优化吞吐量</h3><blockquote><p>开启thymeleaf缓存，关闭日志打印，数据库添加索引</p></blockquote><h3 id="nginx动静分离"><a href="#nginx动静分离" class="headerlink" title="nginx动静分离"></a>nginx动静分离</h3><blockquote><p>将静态资源存放在nginx里，所以静态请求直接从nginx里拿资源即可，不需要过网关到服务器Tomcat里拿</p><p>规定：/static/***下的所有请求由nginx直接返回</p></blockquote><h4 id="存放静态资源"><a href="#存放静态资源" class="headerlink" title="存放静态资源"></a>存放静态资源</h4><blockquote><p>将product服务的resource下的所有静态文件（static下）存放到nginx下的html文件夹下的static下（记录一下虚拟机移动文件 mv xxx xxx）</p><p>将html中的静态资源路径添加上/static/前缀</p></blockquote><h4 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h4><blockquote><p>当访问/static下的资源时，要求nginx为我们请求nginx下的html文件夹下的static文件夹</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /static &#123;</span><br><span class="line">     root   /usr/share/nginx/html;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><blockquote><p>如果请求出现403的问题需要修改nginx文件夹的权限</p><p>chmod -R 777 /mydata/nginx/html</p></blockquote><h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><blockquote><p>1优化业务逻辑 —&gt; 2使用缓存</p><p>适用于访问量达、更新频率不高、及时性数据一致性要求不要的数据，极大提升系统性能</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211105154718024.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211105154718024.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211105154718024"></p><blockquote><p>在开发中， 凡是放入缓存中的数据我们都应该指定过期时间， 使其可以在系统即使没有主动更新数据也能自动触发数据加载进缓存的流程。 避免业务崩溃导致的数据永久不一致问题。  </p></blockquote><blockquote><p>最直接的缓存：一个Map对象，是本地缓存<br>在分布式下，一个服务存在多个服务器，就会产生多个缓存，可能数据不一致</p><p>缓存中间件：redis</p></blockquote><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><h4 id="依赖-3"><a href="#依赖-3" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- redis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>使用spring-boot-starter的redis，版本由父项目统一管理</p></blockquote><h4 id="配置-3"><a href="#配置-3" class="headerlink" title="配置"></a>配置</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="comment"># redis地址</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.128</span><span class="number">.129</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ValueOperations&lt;String, String&gt; valueOperations = stringRedisTemplate.opsForValue();</span><br><span class="line">    <span class="comment">// 保存</span></span><br><span class="line">    valueOperations.set(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;hello_&quot;</span> + UUID.randomUUID());</span><br><span class="line">    <span class="comment">// 查询</span></span><br><span class="line">    String hello = valueOperations.get(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;之前保存的数据是： &quot;</span> + hello);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="可视化工具"><a href="#可视化工具" class="headerlink" title="可视化工具"></a>可视化工具</h4><blockquote><p>RDM、ARDM（后者好看）</p></blockquote><h3 id="优化分类业务"><a href="#优化分类业务" class="headerlink" title="优化分类业务"></a>优化分类业务</h3><h4 id="CategoryServiceImpl-3"><a href="#CategoryServiceImpl-3" class="headerlink" title="CategoryServiceImpl"></a>CategoryServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 渲染二级、三级分类(使用缓存)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;Catalog2Vo&gt;&gt; getCatalogJson() &#123;</span><br><span class="line">    String catalogJSON = redisTemplate.opsForValue().get(<span class="string">&quot;catalogJSON&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isEmpty(catalogJSON)) &#123;</span><br><span class="line">        <span class="comment">// 缓存中没有</span></span><br><span class="line">        <span class="comment">// 查询并封装</span></span><br><span class="line">        Map&lt;String, List&lt;Catalog2Vo&gt;&gt; catalogJsonFromDb = getCatalogJsonFromDb();</span><br><span class="line">        <span class="comment">// 放入缓存 (注意存入JSON字符串)</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;catalogJSON&quot;</span>, JSON.toJSONString(catalogJsonFromDb));</span><br><span class="line">        <span class="keyword">return</span> catalogJsonFromDb;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 从缓存中拿数据</span></span><br><span class="line">    Map&lt;String, List&lt;Catalog2Vo&gt;&gt; result = JSON.parseObject(catalogJSON, <span class="keyword">new</span> TypeReference&lt;Map&lt;String, List&lt;Catalog2Vo&gt;&gt;&gt;() &#123;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="解决OutOfDirectMemoryError"><a href="#解决OutOfDirectMemoryError" class="headerlink" title="解决OutOfDirectMemoryError"></a>解决OutOfDirectMemoryError</h4><blockquote><ul><li>TODO 产生堆外内存溢出：OutOfDirectMemoryError</li><li>1）、springboot2.0以后默认使用lettuce作为操作redis的客户端。它使用netty进行网络通信。</li><li>2）、lettuce的bug导致netty堆外内存溢出 -Xmx300m；netty如果没有指定堆外内存，默认使用-Xmx300m</li><li>可以通过-Dio.netty.maxDirectMemory进行设置</li><li>解决方案：不能使用-Dio.netty.maxDirectMemory只去调大堆外内存。</li><li>1）、升级lettuce客户端。   2）、切换使用jedis</li></ul></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- redis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 解决redis堆外内存溢出问题，升级lettuce的版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="缓存失效"><a href="#缓存失效" class="headerlink" title="缓存失效"></a>缓存失效</h3><blockquote><ol><li>缓存穿透<ul><li>缓存穿透是指查询一个一定不存在的数据， 由于缓存是不命中， 将去查询数据库， 但是数据库也无此记录， 我们没有将这次查询的 null 写入缓存， 这将导致这个不存在的数据每次请求都要到存储层去查询， 失去了缓存的意义。</li><li>在流量大时， 可能 DB 就挂掉了， 要是有人利用不存在的 key 频繁攻击我们的应用， 这就是漏洞。</li><li>解决：缓存空结果、 并且设置短的过期时间。</li></ul></li><li>缓存雪崩<ul><li>缓存雪崩是指在我们设置缓存时采用了相同的过期时间， 导致缓存在某一时刻同时失<br>效， 请求全部转发到 DB， DB 瞬时压力过重雪崩。</li><li>解决：原有的失效时间基础上增加一个随机值， 比如 1-5 分钟随机， 这样每一个缓存的过期时间的重复率就会降低， 就很难引发集体失效的事件。</li></ul></li><li>缓存击穿<ul><li>对于一些设置了过期时间的 key， 如果这些 key 可能会在某些时间点被超高并发地访问，<br>是一种非常“热点”的数据</li><li>这个时候， 需要考虑一个问题： 如果这个 key 在大量请求同时进来前正好失效， 那么所<br>有对这个 key 的数据查询都落到 db， 我们称为缓存击穿。</li><li>解决：加锁  </li></ul></li></ol></blockquote><h3 id="Spring-Cache"><a href="#Spring-Cache" class="headerlink" title="Spring Cache"></a>Spring Cache</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107144501288.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107144501288.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211107144501288"></p><h4 id="依赖-4"><a href="#依赖-4" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring cache简化缓存开发 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置-4"><a href="#配置-4" class="headerlink" title="配置"></a>配置</h4><blockquote><p>CacheAutoConfiguration 自动导入 RedisAutoConfiguration，内含 RedisCacheManager 缓存管理器</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="comment"># 缓存</span></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">redis</span></span><br><span class="line">  <span class="comment"># redis</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.128</span><span class="number">.129</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure><h4 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h4><blockquote><ol><li>@Cachable：将数据保存到缓存</li><li>@CacheEvict：将数据从缓存删除</li><li>@CachePut：保存（不影响方法执行）</li><li>@Caching：组合多个缓存操作</li><li>@CacheConfig：在类级别共享相同配置</li><li>@EnableCaching：在启动类上，开启缓存</li></ol></blockquote><h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改(级联更新，连表更新)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Caching(evict = &#123;</span></span><br><span class="line"><span class="meta">        @CacheEvict(cacheNames = &quot;category&quot;, key = &quot;&#x27;level1Category1&#x27;&quot;),  // 删除缓存</span></span><br><span class="line"><span class="meta">        @CacheEvict(cacheNames = &quot;category&quot;, key = &quot;&#x27;level1Category2&#x27;&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateDetail</span><span class="params">(CategoryEntity category)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.updateById(category);</span><br><span class="line">    categoryBrandRelationService.updateCategory(category.getCatId(), category.getName());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前台：渲染首页，一级分类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Cacheable(&#123;&quot;category&quot;&#125;)</span>  <span class="comment">// @Cacheable(缓存分区名)，如果缓存中有则该方法不会被调用，否则会调用方法并将结果放入缓存</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title">getLevel1List</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;CategoryEntity&gt; categoryEntityList = baseMapper.selectList(<span class="keyword">new</span> QueryWrapper&lt;CategoryEntity&gt;().eq(<span class="string">&quot;parent_cid&quot;</span>, <span class="number">0</span>));</span><br><span class="line">    <span class="keyword">return</span> categoryEntityList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="自定义配置"><a href="#自定义配置" class="headerlink" title="自定义配置"></a>自定义配置</h4><blockquote><p>默认</p><ol><li>key默认自动生成，名字为 分区名::SimpleKey []</li><li>缓存的value值默认使用jdk序列化机制，将序列化后的数据保存到redis</li><li>默认ttl时间 -1s</li></ol><p>自定义</p><ol><li><p>指定key：接收SpEL表达式（官网文档有解释各种写法）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(cacheNames = &#123;&quot;category&quot;&#125;, key = &quot;&#x27;level1Category&#x27;&quot;)</span></span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>指定存活时间：单位为毫秒</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">time-to-live:</span> <span class="number">1000</span></span><br></pre></td></tr></table></figure></li><li><p>指定JSON序列化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 自定义配置spring cache</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(CacheProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCacheConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">RedisCacheConfiguration <span class="title">redisCacheConfiguration</span><span class="params">(CacheProperties cacheProperties)</span> </span>&#123;</span><br><span class="line">        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig();</span><br><span class="line">        <span class="comment">// 设置自定义配置，使用JSON序列化机制保存value</span></span><br><span class="line">        config = config.serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> StringRedisSerializer()));</span><br><span class="line">        config = config.serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="keyword">new</span> GenericJackson2JsonRedisSerializer()));</span><br><span class="line">        <span class="comment">// 引入配置文件的配置</span></span><br><span class="line">        <span class="comment">// CacheProperties.Redis redisProperties = cacheProperties.getRedis();</span></span><br><span class="line">        <span class="comment">// if (redisProperties.getTimeToLive() != null) &#123;</span></span><br><span class="line">        <span class="comment">//     config = config.entryTtl(redisProperties.getTimeToLive());</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// if (redisProperties.getKeyPrefix() != null) &#123;</span></span><br><span class="line">        <span class="comment">//     config = config.prefixKeysWith(redisProperties.getKeyPrefix());</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// if (!redisProperties.isCacheNullValues()) &#123;</span></span><br><span class="line">        <span class="comment">//     config = config.disableCachingNullValues();</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// if (!redisProperties.isUseKeyPrefix()) &#123;</span></span><br><span class="line">        <span class="comment">//     config = config.disableKeyPrefix();</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// TODO 这里我一引入就会导致缓存用不了？</span></span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></blockquote><h2 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h2><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107121704131.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107121704131.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211107121704131"></p><h3 id="RedisTemplates实现"><a href="#RedisTemplates实现" class="headerlink" title="RedisTemplates实现"></a>RedisTemplates实现</h3><h4 id="分布式锁演进"><a href="#分布式锁演进" class="headerlink" title="分布式锁演进"></a>分布式锁演进</h4><blockquote><p>原子性：指事务的不可分割性，一个事务的所有操作要么不间断地全部被执行，要么一个也没有执行</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107123619623.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107123619623.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211107123619623"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107123526013.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107123526013.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211107123526013"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107123842030.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107123842030.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211107123842030"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107123853135.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107123853135.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211107123853135"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107123902077.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211107123902077.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211107123902077"></p><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;Catelog2Vo&gt;&gt; getCatalogJsonFromDbWithRedisLock() &#123;</span><br><span class="line"><span class="comment">//1、 占分布式锁。 去 redis 占坑String uuid = UUID.randomUUID().toString();</span></span><br><span class="line">Boolean lock =</span><br><span class="line">redisTemplate.opsForValue().setIfAbsent(<span class="string">&quot;lock&quot;</span>,uuid,<span class="number">300</span>,TimeUnit.SECONDS);</span><br><span class="line"><span class="keyword">if</span>(lock)&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;获取分布式锁成功...&quot;</span>);</span><br><span class="line"><span class="comment">//加锁成功... 执行业务</span></span><br><span class="line"><span class="comment">//2、 设置过期时间， 必须和加锁是同步的， 原子的</span></span><br><span class="line"><span class="comment">//redisTemplate.expire(&quot;lock&quot;,30,TimeUnit.SECONDS);</span></span><br><span class="line">Map&lt;String, List&lt;Catelog2Vo&gt;&gt; dataFromDb;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">dataFromDb = getDataFromDb();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">String script = <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then</span></span><br><span class="line"><span class="string">return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;</span>;</span><br><span class="line"><span class="comment">//删除锁</span></span><br><span class="line">Long lock1 = redisTemplate.execute(<span class="keyword">new</span></span><br><span class="line">DefaultRedisScript&lt;Long&gt;(script, Long.class)</span><br><span class="line">, Arrays.asList(<span class="string">&quot;lock&quot;</span>), uuid);</span><br><span class="line">&#125; <span class="comment">//</span></span><br><span class="line">获取值对比+对比成功删除=原子操作 lua 脚本解锁</span><br><span class="line"><span class="comment">// String lockValue = redisTemplate.opsForValue().get(&quot;lock&quot;);</span></span><br><span class="line"><span class="comment">// if(uuid.equals(lockValue))&#123;</span></span><br><span class="line"><span class="comment">// //删除我自己的锁</span></span><br><span class="line"><span class="comment">// redisTemplate.delete(&quot;lock&quot;);//删除锁</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">return</span> dataFromDb;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//加锁失败...重试。 synchronized ()</span></span><br><span class="line"><span class="comment">//休眠 100ms 重试</span></span><br><span class="line">System.out.println(<span class="string">&quot;获取分布式锁失败...等待重试&quot;</span>);</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">Thread.sleep(<span class="number">200</span>);</span><br><span class="line">&#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">&#125; <span class="function">r</span></span><br><span class="line"><span class="function">eturn <span class="title">getCatalogJsonFromDbWithRedisLock</span><span class="params">()</span></span>;<span class="comment">//自旋的方式</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Redisson"><a href="#Redisson" class="headerlink" title="Redisson"></a>Redisson</h3><blockquote><p>Redisson 是架设在 Redis 基础上的一个 Java 驻内存数据网格（In-Memory Data Grid） 。 充分的利用了 Redis 键值数据库提供的一系列优势， 基于 Java 实用工具包中常用接口， 为使用者提供了一系列具有分布式特性的常用工具类。 使得原本作为协调单机多线程并发程序的工具包获得了协调分布式多机多线程并发系统的能力， 大大降低了设计和研发大规模分布式系统的难度。 同时结合各富特色的分布式服务， 更进一步简化了分布式环境中程序相互之间的协作。</p><p>官方文档： <a href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95">https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95</a>  </p></blockquote><h4 id="依赖-5"><a href="#依赖-5" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- reddisson --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.12.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="程序化配置"><a href="#程序化配置" class="headerlink" title="程序化配置"></a>程序化配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRedissonConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 所有对redisson的使用都是通过client对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(destroyMethod = &quot;shutdown&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedissonClient <span class="title">redisson</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 创建配置</span></span><br><span class="line">        Config config = <span class="keyword">new</span> Config();</span><br><span class="line">        <span class="comment">// 单redis节点模式</span></span><br><span class="line">        config.useSingleServer().setAddress(<span class="string">&quot;redis://192.168.128.129:6379&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Redisson.create(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="前台-检索服务"><a href="#前台-检索服务" class="headerlink" title="前台-检索服务"></a>前台-检索服务</h2><h3 id="搭建页面环境"><a href="#搭建页面环境" class="headerlink" title="搭建页面环境"></a>搭建页面环境</h3><blockquote><p>需要向虚拟机传输文件，所有还是用xshel好使，教程在p122</p></blockquote><h4 id="静态资源-1"><a href="#静态资源-1" class="headerlink" title="静态资源"></a>静态资源</h4><blockquote><p>css,img等资源放在nginx的html文件夹下</p><p>index.html放在项目resource下的templates文件夹下（注意这里index名字改为list，因为首页搜索发请求地址就是search.gulimall.com/list.html</p></blockquote><h4 id="host配置"><a href="#host配置" class="headerlink" title="host配置"></a>host配置</h4><blockquote><p>使用SwitchHost</p><p>192.168.128.129 gulimall.com<br>192.168.128.129 search.gulimall.com</p></blockquote><h4 id="nginx配置-1"><a href="#nginx配置-1" class="headerlink" title="nginx配置"></a>nginx配置</h4><blockquote><p>添加server_name对应host即可</p></blockquote><pre><code>server_name  gulimall.com *.gulimall.com;#charset koi8-r;#access_log  /var/log/nginx/log/host.access.log  main;location /static &#123;    root   /usr/share/nginx/html;&#125;location / &#123;    proxy_set_header Host $host;    proxy_pass http://gulimall;&#125;</code></pre><h4 id="gateway配置"><a href="#gateway配置" class="headerlink" title="gateway配置"></a>gateway配置</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -----------------------nginx，一定要放在最后，要不然/api/下的配置会被覆盖-----------------------</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">gulimall_host_route</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://gulimall-product</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Host=gulimall.com</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">gulimall_search_route</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://gulimall-search</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Host=search.gulimall.com</span></span><br></pre></td></tr></table></figure><blockquote><p>根据之前nginx配置中的proxy_set_header Host $host，网关能根据host来选择不同的服务</p></blockquote><blockquote><p>list.html里面有很多路径错误，记得修改一下</p><p>修改一下发起请求的请求路径</p></blockquote><h3 id="检索模型分析"><a href="#检索模型分析" class="headerlink" title="检索模型分析"></a>检索模型分析</h3><h4 id="查询参数模型"><a href="#查询参数模型" class="headerlink" title="查询参数模型"></a>查询参数模型</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211111154722613.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211111154722613.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211111154722613"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装页面所有可能传递过来的条件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchParamVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String keyword; <span class="comment">// 全文匹配关键字</span></span><br><span class="line">    <span class="keyword">private</span> Long catalog3Id;    <span class="comment">// 三级分类id</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * sort=saleCount_asc/desc</span></span><br><span class="line"><span class="comment">     * sort=skuPrice_asc/desc</span></span><br><span class="line"><span class="comment">     * sort=hotScore_asc/desc</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String sort;    <span class="comment">// 排序条件</span></span><br><span class="line">    <span class="keyword">private</span> Integer hasStock;   <span class="comment">// 是否有货</span></span><br><span class="line">    <span class="keyword">private</span> String skuPrice;    <span class="comment">// 价格区间</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; brandId;   <span class="comment">// 品牌id 可多选</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; attrs; <span class="comment">// 按照属性进行筛选</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageNum;    <span class="comment">// 页码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="返回结果模型"><a href="#返回结果模型" class="headerlink" title="返回结果模型"></a>返回结果模型</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检索返回数据模型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchResultVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;SkuEsModel&gt; products;  <span class="comment">//sku在elasticsearch中的模型</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分页信息</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageNum;    <span class="comment">// 当前页码</span></span><br><span class="line">    <span class="keyword">private</span> Long total; <span class="comment">// 总记录数</span></span><br><span class="line">    <span class="keyword">private</span> Integer totalPages; <span class="comment">// 总页码</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;BrandVo&gt; brands;   <span class="comment">// 当前查询到的所有涉及到的品牌</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;CatalogVo&gt; catalogs;   <span class="comment">// 当前查询到的所有涉及到的分类</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;AttrVo&gt; attrs;     <span class="comment">// 当前查询到的所有涉及到的属性</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 内部类，品牌信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandVo</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Long brandId;</span><br><span class="line">        <span class="keyword">private</span> String brandName;</span><br><span class="line">        <span class="keyword">private</span> String brandImg;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 内部类，属性信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrVo</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Long attrId;</span><br><span class="line">        <span class="keyword">private</span> String attrName;</span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; attrValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 内部类，分类信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CatalogVo</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Long catalogId;</span><br><span class="line">        <span class="keyword">private</span> String catalogName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="检索DSL测试"><a href="#检索DSL测试" class="headerlink" title="检索DSL测试"></a>检索DSL测试</h3><blockquote><p>TODO P177、P178</p><p>十分劝退，头疼</p></blockquote><h3 id="SearchRequest"><a href="#SearchRequest" class="headerlink" title="SearchRequest"></a>SearchRequest</h3><h4 id="查询、排序"><a href="#查询、排序" class="headerlink" title="查询、排序"></a>查询、排序</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MallSearchServiceImpl</span> <span class="keyword">implements</span> <span class="title">MallSearchService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 根据keyword检索所有商品</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SearchResultVo <span class="title">search</span><span class="params">(SearchParamVo searchParamVo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 准备检索请求</span></span><br><span class="line">        SearchRequest searchRequest = buildSearchRequest(searchParamVo);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 执行检索请求</span></span><br><span class="line">            SearchResponse response = client.search(searchRequest, GulimallElasticSearchConfig.COMMON_OPTIONS);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 分析响应数据并封装</span></span><br><span class="line">        SearchResult searchResult = buildSearchResult();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 创建检索结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> SearchResult <span class="title">buildSearchResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 创建检索请求</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> SearchRequest <span class="title">buildSearchRequest</span><span class="params">(SearchParamVo param)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 指定检索条件,详见dsl.json</span></span><br><span class="line">        SearchSourceBuilder searchSourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        <span class="comment">// 查询：模糊匹配，过滤（按照属性、分类、品牌、价格区间、库存）</span></span><br><span class="line">        <span class="comment">// 1 query -&gt; bool 开始</span></span><br><span class="line">        BoolQueryBuilder boolQuery = QueryBuilders.boolQuery();</span><br><span class="line">        <span class="comment">// 1.1 bool -&gt; must 模糊匹配</span></span><br><span class="line">        <span class="comment">// must -&gt; match</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(param.getKeyword())) &#123;</span><br><span class="line">            MatchQueryBuilder matchQuery = QueryBuilders.matchQuery(<span class="string">&quot;skuTitle&quot;</span>, param.getKeyword());</span><br><span class="line">            boolQuery.must(matchQuery);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 1.2 bool -&gt; filter 过滤</span></span><br><span class="line">        <span class="comment">// filter -&gt; 第一个term 按照分类过滤</span></span><br><span class="line">        <span class="keyword">if</span> (param.getCatalog3Id() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            TermQueryBuilder termQuery = QueryBuilders.termQuery(<span class="string">&quot;catalogId&quot;</span>, param.getCatalog3Id());</span><br><span class="line">            boolQuery.filter(termQuery);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// filter -&gt; 第二个terms 按照品牌过滤</span></span><br><span class="line">        <span class="keyword">if</span> (param.getBrandId() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            TermsQueryBuilder termsQuery = QueryBuilders.termsQuery(<span class="string">&quot;brandId&quot;</span>, param.getBrandId());</span><br><span class="line">            boolQuery.filter(termsQuery);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// filter -&gt; 第三个nested 按照属性过滤</span></span><br><span class="line">        <span class="keyword">if</span> (param.getAttrs() != <span class="keyword">null</span> &amp;&amp; param.getAttrs().size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 操作每一个attr(每一个attr都有一个nested)</span></span><br><span class="line">            <span class="keyword">for</span> (String attrStr : param.getAttrs()) &#123;</span><br><span class="line">                <span class="comment">// nested -&gt; query -&gt; bool</span></span><br><span class="line">                BoolQueryBuilder nestedBool = QueryBuilders.boolQuery();</span><br><span class="line">                <span class="comment">// 页面提交格式：attr = 1_5寸:8寸</span></span><br><span class="line">                String[] strings = attrStr.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">                String attrId = strings[<span class="number">0</span>];</span><br><span class="line">                String[] attrValues = strings[<span class="number">1</span>].split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">                <span class="comment">// bool -&gt; must -&gt; term、terms</span></span><br><span class="line">                nestedBool.must(QueryBuilders.termQuery(<span class="string">&quot;attrs.attrId&quot;</span>, attrId));</span><br><span class="line">                nestedBool.must(QueryBuilders.termsQuery(<span class="string">&quot;attrs.attrValue&quot;</span>, attrValues));</span><br><span class="line">                boolQuery.filter(QueryBuilders.nestedQuery(<span class="string">&quot;attrs&quot;</span>, nestedBool, ScoreMode.None));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// filter -&gt; 第四个term 按照库存过滤</span></span><br><span class="line">        <span class="keyword">if</span> (param.getHasStock() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            TermQueryBuilder termQuery = QueryBuilders.termQuery(<span class="string">&quot;hasStock&quot;</span>, param.getHasStock() == <span class="number">1</span>);</span><br><span class="line">            boolQuery.filter(termQuery);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            TermQueryBuilder termQuery = QueryBuilders.termQuery(<span class="string">&quot;hasStock&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">            boolQuery.filter(termQuery);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// filter -&gt; 第四个range 按照价格区间过滤</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(param.getSkuPrice())) &#123;</span><br><span class="line">            RangeQueryBuilder rangeQuery = QueryBuilders.rangeQuery(<span class="string">&quot;skuPrice&quot;</span>);</span><br><span class="line">            String[] priceRange = param.getSkuPrice().split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (param.getSkuPrice().startsWith(<span class="string">&quot;_&quot;</span>)) &#123;</span><br><span class="line">                <span class="comment">//  _xxx, 小于</span></span><br><span class="line">                rangeQuery.lte(priceRange[<span class="number">1</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (param.getSkuPrice().endsWith(<span class="string">&quot;_&quot;</span>)) &#123;</span><br><span class="line">                <span class="comment">//  xxx_, 大于</span></span><br><span class="line">                rangeQuery.gte(priceRange[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 区间</span></span><br><span class="line">                rangeQuery.gte(priceRange[<span class="number">0</span>]).lte(priceRange[<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            boolQuery.filter(rangeQuery);</span><br><span class="line">        &#125;</span><br><span class="line">        searchSourceBuilder.query(boolQuery);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 排序、分页、高亮</span></span><br><span class="line">        <span class="comment">// 2 sort</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(param.getSort())) &#123;</span><br><span class="line">            String sort = param.getSort();</span><br><span class="line">            String[] sortValue = sort.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">            searchSourceBuilder.sort(sortValue[<span class="number">0</span>], SortOrder.fromString(sortValue[<span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2 from sieze</span></span><br><span class="line">        <span class="keyword">if</span> (param.getPageNum() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            searchSourceBuilder.from((param.getPageNum() - <span class="number">1</span>) * EsConstant.PAGE_SIZE);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            searchSourceBuilder.from(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        searchSourceBuilder.size(EsConstant.PAGE_SIZE);</span><br><span class="line">        <span class="comment">// 2 highlight</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(param.getKeyword())) &#123;</span><br><span class="line">            searchSourceBuilder.highlighter(<span class="keyword">new</span> HighlightBuilder().field(<span class="string">&quot;skuTitle&quot;</span>).preTags(<span class="string">&quot;&lt;b style=&#x27;color:red&#x27;&gt;&quot;</span>).postTags(<span class="string">&quot;&lt;/b&gt;&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO 聚合分析</span></span><br><span class="line">        <span class="comment">// 3 aggs</span></span><br><span class="line"></span><br><span class="line">        String s = searchSourceBuilder.toString();</span><br><span class="line">        System.out.println(<span class="string">&quot;构建的DSL：&quot;</span> + s);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建request，指定索引、检索条件</span></span><br><span class="line">        SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(<span class="keyword">new</span> String[]&#123;EsConstant.PRODUCT_INDEX&#125;, searchSourceBuilder);</span><br><span class="line">        <span class="keyword">return</span> searchRequest;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 聚合分析</span></span><br><span class="line"><span class="comment">// 3 aggs</span></span><br><span class="line"><span class="comment">// 3.1 品牌聚合</span></span><br><span class="line">TermsAggregationBuilder brand_agg = AggregationBuilders.terms(<span class="string">&quot;brand_agg&quot;</span>).field(<span class="string">&quot;brandId&quot;</span>).size(EsConstant.BRAND_SIZE);</span><br><span class="line"><span class="comment">// 3.1 子聚合</span></span><br><span class="line">brand_agg.subAggregation(AggregationBuilders.terms(<span class="string">&quot;brand_img_agg&quot;</span>).field(<span class="string">&quot;brandImg&quot;</span>).size(<span class="number">1</span>));</span><br><span class="line">brand_agg.subAggregation(AggregationBuilders.terms(<span class="string">&quot;brand_name_agg&quot;</span>).field(<span class="string">&quot;brandName&quot;</span>).size(<span class="number">1</span>));</span><br><span class="line">searchSourceBuilder.aggregation(brand_agg);</span><br><span class="line"><span class="comment">// 3.2 分类聚合</span></span><br><span class="line">TermsAggregationBuilder catalog_agg = AggregationBuilders.terms(<span class="string">&quot;catalog_agg&quot;</span>).field(<span class="string">&quot;catalogId&quot;</span>).size(EsConstant.CATALOG_SIZE);</span><br><span class="line"><span class="comment">// 3.2 子聚合</span></span><br><span class="line">catalog_agg.subAggregation(AggregationBuilders.terms(<span class="string">&quot;catalog_name_agg&quot;</span>).field(<span class="string">&quot;catalogName&quot;</span>).size(<span class="number">1</span>));</span><br><span class="line">searchSourceBuilder.aggregation(catalog_agg);</span><br><span class="line"><span class="comment">// 3.3 属性聚合</span></span><br><span class="line">NestedAggregationBuilder attr_agg = AggregationBuilders.nested(<span class="string">&quot;attr_agg&quot;</span>, <span class="string">&quot;attrs&quot;</span>);</span><br><span class="line"><span class="comment">// 3.3 子聚合</span></span><br><span class="line">TermsAggregationBuilder attr_id_agg = AggregationBuilders.terms(<span class="string">&quot;attr_id_agg&quot;</span>).field(<span class="string">&quot;attrs.attrId&quot;</span>);</span><br><span class="line"><span class="comment">// 3.3 子子聚合</span></span><br><span class="line">attr_id_agg.subAggregation(AggregationBuilders.terms(<span class="string">&quot;attr_name_agg&quot;</span>).field(<span class="string">&quot;attrs.attrName&quot;</span>).size(<span class="number">1</span>));</span><br><span class="line">attr_id_agg.subAggregation(AggregationBuilders.terms(<span class="string">&quot;attr_value_agg&quot;</span>).field(<span class="string">&quot;attrs.attrValue&quot;</span>).size(<span class="number">50</span>));</span><br><span class="line">attr_agg.subAggregation(attr_id_agg);</span><br><span class="line">searchSourceBuilder.aggregation(attr_agg);</span><br></pre></td></tr></table></figure><blockquote><p>注意：如果使用文档的es模型映射规则，会有问题，详见本文档的商品上架的模型分析</p></blockquote><h3 id="SearchResult"><a href="#SearchResult" class="headerlink" title="SearchResult"></a>SearchResult</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   * 创建检索结果</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> SearchResultVo <span class="title">buildSearchResult</span><span class="params">(SearchResponse response, SearchParamVo param)</span> </span>&#123;</span><br><span class="line">      SearchResultVo resultVo = <span class="keyword">new</span> SearchResultVo();</span><br><span class="line">      SearchHits hits = response.getHits();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 1 封装商品</span></span><br><span class="line">      List&lt;SkuEsModel&gt; skuList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">      <span class="keyword">if</span> (hits.getHits() != <span class="keyword">null</span> &amp;&amp; hits.getHits().length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">for</span> (SearchHit hit : hits.getHits()) &#123;</span><br><span class="line">              <span class="comment">// 获得hit中的resource，json转为对象</span></span><br><span class="line">              SkuEsModel sku = JSON.parseObject(hit.getSourceAsString(), SkuEsModel.class);</span><br><span class="line">              <span class="comment">// 是否高亮</span></span><br><span class="line">              <span class="keyword">if</span> (!StringUtils.isEmpty(param.getKeyword())) &#123;</span><br><span class="line">                  HighlightField highlightField = hit.getHighlightFields().get(<span class="string">&quot;skuTitle&quot;</span>);</span><br><span class="line">                  String highlight = highlightField.getFragments()[<span class="number">0</span>].toString();</span><br><span class="line">                  sku.setSkuTitle(highlight);</span><br><span class="line">              &#125;</span><br><span class="line">              skuList.add(sku);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      resultVo.setProducts(skuList);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2 封装属性聚合信息</span></span><br><span class="line">      List&lt;SearchResultVo.AttrVo&gt; attrVoList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">      <span class="comment">// 获得聚合</span></span><br><span class="line">      ParsedNested attr_agg = response.getAggregations().get(<span class="string">&quot;attr_agg&quot;</span>);</span><br><span class="line">      ParsedLongTerms attr_id_agg = attr_agg.getAggregations().get(<span class="string">&quot;attr_id_agg&quot;</span>);</span><br><span class="line">      <span class="keyword">for</span> (Terms.Bucket bucket : attr_id_agg.getBuckets()) &#123;</span><br><span class="line">          SearchResultVo.AttrVo attrVo = <span class="keyword">new</span> SearchResultVo.AttrVo();</span><br><span class="line">          <span class="comment">// 封装id，在聚合中</span></span><br><span class="line">          attrVo.setAttrId(Long.valueOf(String.valueOf(bucket.getKeyAsNumber())));</span><br><span class="line">          <span class="comment">// 封装name，在子聚合中</span></span><br><span class="line">          ParsedStringTerms attr_name_agg = bucket.getAggregations().get(<span class="string">&quot;attr_name_agg&quot;</span>);</span><br><span class="line">          attrVo.setAttrName(attr_name_agg.getBuckets().get(<span class="number">0</span>).getKeyAsString());</span><br><span class="line">          <span class="comment">// 封装valueList，在子聚合中</span></span><br><span class="line">          List&lt;String&gt; attrValue = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">          ParsedStringTerms attr_value_agg = bucket.getAggregations().get(<span class="string">&quot;attr_value_agg&quot;</span>);</span><br><span class="line">          <span class="keyword">for</span> (Terms.Bucket aggBucket : attr_value_agg.getBuckets()) &#123;</span><br><span class="line">              attrValue.add(aggBucket.getKeyAsString());</span><br><span class="line">          &#125;</span><br><span class="line">          attrVo.setAttrValue(attrValue);</span><br><span class="line">          attrVoList.add(attrVo);</span><br><span class="line">      &#125;</span><br><span class="line">      resultVo.setAttrs(attrVoList);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3 封装品牌聚合信息</span></span><br><span class="line">      List&lt;SearchResultVo.BrandVo&gt; brandVoList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">      <span class="comment">// 获得聚合</span></span><br><span class="line">      ParsedLongTerms brand_agg = response.getAggregations().get(<span class="string">&quot;brand_agg&quot;</span>);</span><br><span class="line">      <span class="comment">// 根据brandId有许多个bucket</span></span><br><span class="line">      <span class="keyword">for</span> (Terms.Bucket bucket : brand_agg.getBuckets()) &#123;</span><br><span class="line">          <span class="comment">// 封装brandId，在聚合中</span></span><br><span class="line">          SearchResultVo.BrandVo brandVo = <span class="keyword">new</span> SearchResultVo.BrandVo();</span><br><span class="line">          brandVo.setBrandId(Long.valueOf(bucket.getKeyAsString()));</span><br><span class="line">          <span class="comment">// 封装brandName\brandImg，在子聚合中</span></span><br><span class="line">          ParsedStringTerms brand_name_agg = bucket.getAggregations().get(<span class="string">&quot;brand_name_agg&quot;</span>);</span><br><span class="line">          brandVo.setBrandName(brand_name_agg.getBuckets().get(<span class="number">0</span>).getKeyAsString());</span><br><span class="line">          ParsedStringTerms brand_img_agg = bucket.getAggregations().get(<span class="string">&quot;brand_img_agg&quot;</span>);</span><br><span class="line">          brandVo.setBrandImg(brand_img_agg.getBuckets().get(<span class="number">0</span>).getKeyAsString());</span><br><span class="line">          brandVoList.add(brandVo);</span><br><span class="line">      &#125;</span><br><span class="line">      resultVo.setBrands(brandVoList);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 4 封装分类聚合信息</span></span><br><span class="line">      List&lt;SearchResultVo.CatalogVo&gt; catalogVoList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">      <span class="comment">// 获得聚合</span></span><br><span class="line">      ParsedLongTerms catalog_agg = response.getAggregations().get(<span class="string">&quot;catalog_agg&quot;</span>);</span><br><span class="line">      <span class="comment">// 根据catelogId有许多个bucket</span></span><br><span class="line">      <span class="keyword">for</span> (Terms.Bucket bucket : catalog_agg.getBuckets()) &#123;</span><br><span class="line">          <span class="comment">// 封装CatalogId，在聚合中</span></span><br><span class="line">          SearchResultVo.CatalogVo catalogVo = <span class="keyword">new</span> SearchResultVo.CatalogVo();</span><br><span class="line">          catalogVo.setCatalogId(Long.valueOf(bucket.getKeyAsString()));</span><br><span class="line">          <span class="comment">// 封装CatalogName，在子聚合中</span></span><br><span class="line">          ParsedStringTerms catalog_name_agg = bucket.getAggregations().get(<span class="string">&quot;catalog_name_agg&quot;</span>);</span><br><span class="line">          catalogVo.setCatalogName(catalog_name_agg.getBuckets().get(<span class="number">0</span>).getKeyAsString());</span><br><span class="line">          catalogVoList.add(catalogVo);</span><br><span class="line">      &#125;</span><br><span class="line">      resultVo.setCatalogs(catalogVoList);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 5 封装分页信息</span></span><br><span class="line">      <span class="keyword">long</span> total = hits.getTotalHits().value;</span><br><span class="line">      resultVo.setTotal(total);</span><br><span class="line">      resultVo.setTotalPages((<span class="keyword">int</span>) ((total + EsConstant.PRODUCT_PAGE_SIZE - <span class="number">1</span>) / EsConstant.PRODUCT_PAGE_SIZE));</span><br><span class="line">      resultVo.setPageNum(param.getPageNum());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> resultVo;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>wc，typora有毒，两天没了三次内容，而且未保存内容草稿也没用，东西都没了，我吐了，可能是内容太多了，新开一个</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
            <tag> redis </tag>
            
            <tag> 微服务 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【学习笔记】ElasticSearch</title>
      <link href="/2021/10/31/xue-xi-bi-ji-elasticsearch/"/>
      <url>/2021/10/31/xue-xi-bi-ji-elasticsearch/</url>
      
        <content type="html"><![CDATA[<h2 id="ES基础概念"><a href="#ES基础概念" class="headerlink" title="ES基础概念"></a>ES基础概念</h2><blockquote><p>[Elasticsearch Guide <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">7.15] | Elastic 文档</a></p><p>Elasticsearch 是一个分布式、RESTful 风格的搜索和数据分析引擎，是目前全文搜索引擎的首选。</p><p>mysql更适用于数据量小的CRUD，而Elasticsearch适用于大数据。</p><p>对ES的所有操作只需要使用rest请求即可完成</p></blockquote><h3 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h3><blockquote><ol><li>index 索引<ul><li>动词：相当于insert</li><li>名词：相当于Database</li></ul></li><li>Type 类型<ul><li>相当于Table</li></ul></li><li>Document 文档<ul><li>JSON格式，相当于表中的内容</li></ul></li></ol></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031155240115.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031155240115.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211031155240115"></p><h3 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h3><blockquote><ol><li>分词：将整句拆分为单词</li><li>检索：查询词都出现在哪个记录当中</li><li>相关性得分：基于一定算法算哪个权重更高</li></ol></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031155548529.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031155548529.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211031155548529"></p><h2 id="Docker安装ES和可视化工具"><a href="#Docker安装ES和可视化工具" class="headerlink" title="Docker安装ES和可视化工具"></a>Docker安装ES和可视化工具</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><blockquote><p>docker pull elasticsearch:7.4.2</p><p>docker pull kibana:7.4.2</p></blockquote><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><blockquote><p>mkdir -p /mydata/elasticsearch/config<br>mkdir -p /mydata/elasticsearch/data</p><p>echo “http.host: 0.0.0.0” &gt;&gt; /mydata/elasticsearch/config/elasticsearch.yml</p><p>docker run –name elasticsearch -p 9200:9200 -p 9300:9300 <br>-e “discovery.type=single-node” <br>-e ES_JAVA_OPTS=”-Xms64m -Xmx128m” <br>-v /mydata/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml <br>-v /mydata/elasticsearch/data:/usr/share/elasticsearch/data <br>-v /mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins <br>-d elasticsearch:7.4.2</p><p>chmod -R 777 /mydata/elasticsearch/ 保证权限</p><p>docker run –name kibana -e ELASTICSEARCH_HOSTS=<a href="http://192.168.128.129:9200/">http://192.168.128.129:9200</a> -p 5601:5601 <br>-d kibana:7.4.2<br><a href="http://192.168.56.10:9200/">http://192.168.56.10:9200</a> 为虚拟机地址</p></blockquote><h3 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h3><blockquote><p><a href="http://192.168.128.129:9200/">http://192.168.128.129:9200/</a></p><p>访问不了的执行上述保证权限的命令</p><p><a href="http://192.168.128.129:5601/">http://192.168.128.129:5601/</a></p><p>kibana可能要等一会才能启动，刷新就行</p></blockquote><h2 id="基础请求格式"><a href="#基础请求格式" class="headerlink" title="基础请求格式"></a>基础请求格式</h2><h3 id="查询-cat"><a href="#查询-cat" class="headerlink" title="查询  _cat"></a>查询  _cat</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031163511553.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031163511553.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211031163511553"></p><h3 id="保存、更新文档"><a href="#保存、更新文档" class="headerlink" title="保存、更新文档"></a>保存、更新文档</h3><blockquote><p>保存一个数据， 保存在哪个索引的哪个类型下， 指定用哪个唯一标识  </p><p>在 customer 索引下的 external 类型下保存 1 号数据，数据使用JSON格式<br>    PUT customer/external/1<br>    { “name”: “John Doe” }</p><p>PUT 和 POST 都可以，POST 新增。<br>POST如果不指定 id， 会自动生成 id。如果指定 id （并且该id存在）就会修改这个数据， 并新增版本号。<br>PUT可以新增可以修改。PUT 必须指定 id； 由于 PUT 需要指定 id， 我们一般都用来做修改操作，不指定 id 会报错。</p></blockquote><h3 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h3><blockquote><p>GET /customer/external/1</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031164700095.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031164700095.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211031164700095"></p><h3 id="更新文档-乐观锁"><a href="#更新文档-乐观锁" class="headerlink" title="更新文档 乐观锁"></a>更新文档 乐观锁</h3><blockquote><p>PUT /customer/external/1?if_seq_no=1&amp;if_primary_term=1<br>{ “name”: “John Doe 1” }</p><p>这里将if判断seq_no和primary_term</p></blockquote><h3 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h3><blockquote><p>POST customer/external/1/_<em>update<br>{<br>    “doc”:<br>        { “name”: “John Doew” }<br>}</em><br>PUT 操作和POST不带update，总会将数据重新保存并增加 version 版本；<br>POST 带_update，对比元数据如果一样就不进行任何操作，文档 version不增加</p><p>对于大并发更新， 不带 update；<br>对于大并发查询偶尔更新， 带 update；<br>对比更新， 重新计算分配规则。</p></blockquote><h3 id="删除文档、索引"><a href="#删除文档、索引" class="headerlink" title="删除文档、索引"></a>删除文档、索引</h3><blockquote><p>DELETE customer/external/1</p><p>DELETE customer</p><p>没有删除类型，新版本type不建议了</p></blockquote><h3 id="bulk-批量-API"><a href="#bulk-批量-API" class="headerlink" title="bulk 批量 API"></a>bulk 批量 API</h3><blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031170829231.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031170829231.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211031170829231"></p><p>POSTMAN里面测不了，去kibana -&gt; dev tools</p><p>bulk API 以此按顺序执行所有的 action（动作） 。 如果一个单个的动作因任何原因而失败，它将继续处理它后面剩余的动作。 当 bulk API 返回时， 它将提供每个动作的状态（与发送的顺序相同） ， 所以您可以检查是否一个指定的动作是不是失败了。  </p></blockquote><h2 id="导入测试数据"><a href="#导入测试数据" class="headerlink" title="导入测试数据"></a>导入测试数据</h2><blockquote><p>感谢评论区，好人一生平安：<a href="https://gitee.com/xlh_blog/common_content/blob/master/es%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE.json##">es测试数据.json · 坐看云起时/common_content - Gitee.com</a></p><p>POST /bank/account/_bulk</p></blockquote><h2 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h2><h3 id="SearchAPI"><a href="#SearchAPI" class="headerlink" title="SearchAPI"></a>SearchAPI</h3><blockquote><p>ES 支持两种基本方式检索 :<br>    一个是通过使用 REST request URI 发送搜索参数（uri+检索参数）<br>    另一个是通过使用 REST request body 来发送它们（uri+请求体）  </p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031173158137.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031173158137.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211031173158137"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031173256674.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031173256674.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211031173256674"></p><h3 id="QueryDSL"><a href="#QueryDSL" class="headerlink" title="QueryDSL"></a>QueryDSL</h3><h4 id="基本语法格式"><a href="#基本语法格式" class="headerlink" title="基本语法格式"></a>基本语法格式</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101130742684.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101130742684.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101130742684"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101130856523.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101130856523.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101130856523"></p><h4 id="返回特定字段"><a href="#返回特定字段" class="headerlink" title="返回特定字段"></a>返回特定字段</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131305376.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131305376.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101131305376"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131315986.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131315986.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101131315986"></p><h4 id="match-匹配查询"><a href="#match-匹配查询" class="headerlink" title="match 匹配查询"></a>match 匹配查询</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131428605.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131428605.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101131428605"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131446139.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131446139.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101131446139"></p><blockquote><p>address.keyword 表示精确匹配，必须匹配为完整字段，如果使用match_phrase则匹配包含完整字段的即可</p></blockquote><h4 id="match-phrase-短语匹配"><a href="#match-phrase-短语匹配" class="headerlink" title="match_phrase 短语匹配"></a>match_phrase 短语匹配</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131702396.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131702396.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101131702396"></p><h4 id="multi-match-多字段匹配"><a href="#multi-match-多字段匹配" class="headerlink" title="multi_match 多字段匹配"></a>multi_match 多字段匹配</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131719772.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131719772.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101131719772"></p><h4 id="bool-复合查询"><a href="#bool-复合查询" class="headerlink" title="bool  复合查询"></a>bool  复合查询</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131740945.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131740945.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101131740945"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131754764.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131754764.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101131754764"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131805931.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131805931.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101131805931"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131835764.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131835764.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101131835764"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131845253.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131845253.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101131845253"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131917270.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131917270.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101131917270"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131900305.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101131900305.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101131900305"></p><h4 id="filter-结果过滤"><a href="#filter-结果过滤" class="headerlink" title="filter  结果过滤"></a>filter  结果过滤</h4><blockquote><p>must not、filter 不会计算相关性得分，must、should会</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101132101270.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101132101270.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101132101270"></p><h4 id="term"><a href="#term" class="headerlink" title="term"></a>term</h4><blockquote><p>和 match 一样。 匹配某个属性的值。 全文检索字段用 match， 其他非 text 字段匹配用 term。  </p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101132126457.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101132126457.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101132126457"></p><h3 id="aggregations-执行聚合"><a href="#aggregations-执行聚合" class="headerlink" title="aggregations  执行聚合"></a>aggregations  执行聚合</h3><blockquote><p>聚合提供了从数据中分组和提取数据的能力。 最简单的聚合方法大致等于 SQL GROUP<br>BY 和 SQL 聚合函数。 在 Elasticsearch 中， 您有执行搜索返回 hits（ 命中结果） ， 并且同时返<br>回聚合结果， 把一个响应中的所有 hits（ 命中结果） 分隔开的能力。 这是非常强大且有效的，<br>您可以执行查询和多个聚合， 并且在一次使用中得到各自的（ 任何一个的） 返回结果， 使用<br>一次简洁和简化的 API 来避免网络往返。  </p></blockquote><h3 id="Mapping"><a href="#Mapping" class="headerlink" title="Mapping"></a>Mapping</h3><h4 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101132703882.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101132703882.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101132703882"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101132712276.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101132712276.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101132712276"></p><h4 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h4><blockquote><p>Mapping 是用来定义一个文档（ document） ， 以及它所包含的属性（ field） 是如何存储和<br>索引的  </p></blockquote><h3 id="分词"><a href="#分词" class="headerlink" title="分词"></a>分词</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101135712278.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101135712278.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101135712278"></p><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101141113680.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211101141113680.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211101141113680"></p><blockquote><p><a href="http://192.168.128.129/">http://192.168.128.129:80/</a></p><p>即可访问linux的nginx</p></blockquote><h2 id="Elasticsearch-Rest-Client"><a href="#Elasticsearch-Rest-Client" class="headerlink" title="Elasticsearch-Rest-Client"></a>Elasticsearch-Rest-Client</h2><blockquote><p>官方RestClient，封装了ES操作</p><p>[Java High Level REST Client | Java REST Client <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html">7.15] | Elastic</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> ElasticSearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】商城项目实战3</title>
      <link href="/2021/10/28/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-3/"/>
      <url>/2021/10/28/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-3/</url>
      
        <content type="html"><![CDATA[<h2 id="Controller三个注释（获取值）"><a href="#Controller三个注释（获取值）" class="headerlink" title="Controller三个注释（获取值）"></a>Controller三个注释（获取值）</h2><blockquote><ol><li>@RequestBody请求体中的JSON</li><li>@RequestParam是url?后跟的键值对</li><li>@PathVariable是REST风格url中的{}变量</li></ol></blockquote><h2 id="Object划分"><a href="#Object划分" class="headerlink" title="Object划分"></a>Object划分</h2><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131128469.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131128469.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211028131128469"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131145962.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131145962.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211028131145962"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131152946.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131152946.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211028131152946"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131204191.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211028131204191.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211028131204191"></p><h2 id="配置服务内存"><a href="#配置服务内存" class="headerlink" title="配置服务内存"></a>配置服务内存</h2><blockquote><p>终于你也有今天啊老师，内存终于不够了吧</p><p>RunConfigurations -&gt; xxx application -&gt; environment -&gt; Vm opinion -&gt; 设置-Xmx100m，最大100m</p></blockquote><h2 id="平台属性—规格参数（后端）"><a href="#平台属性—规格参数（后端）" class="headerlink" title="平台属性—规格参数（后端）"></a>平台属性—规格参数（后端）</h2><h3 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h3><h4 id="AttrRequestVo"><a href="#AttrRequestVo" class="headerlink" title="AttrRequestVo"></a>AttrRequestVo</h4><blockquote><p>使用自定义的VO对象用于封装数据</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.gulimall.product.vo;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于封装请求数据和响应数据</span></span><br><span class="line"><span class="comment"> * 不需要添加上与sql相关的注解</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrVo</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 属性id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long attrId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 属性名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String attrName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否需要检索[0-不需要，1-需要]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer searchType;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 属性图标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String icon;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 可选值列表[用逗号分隔]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String valueSelect;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 属性类型[0-销售属性，1-基本属性，2-既是销售属性又是基本属性]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer attrType;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启用状态[0 - 禁用，1 - 启用]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long enable;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 所属分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long catelogId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 快速展示【是否展示在介绍上；0-否 1-是】，在sku中仍然可以调整</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer showDesc;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分组ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long attrGroupId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrController"><a href="#AttrController" class="headerlink" title="AttrController"></a>AttrController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrService attrService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存,这里使用自定义的Vo对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:attr:save&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(<span class="meta">@RequestBody</span> AttrVo attr)</span> </span>&#123;</span><br><span class="line">        attrService.saveAttr(attr);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrServiceImpl"><a href="#AttrServiceImpl" class="headerlink" title="AttrServiceImpl"></a>AttrServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;attrService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">AttrDao</span>, <span class="title">AttrEntity</span>&gt; <span class="keyword">implements</span> <span class="title">AttrService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AttrAttrgroupRelationDao relationDao;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存规格参数，连表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>  <span class="comment">// 事务</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveAttr</span><span class="params">(AttrVo attr)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1、保存到attr表</span></span><br><span class="line">        AttrEntity attrEntity = <span class="keyword">new</span> AttrEntity();</span><br><span class="line">        <span class="comment">// 使用BeanUtil封装对应属性</span></span><br><span class="line">        BeanUtils.copyProperties(attr, attrEntity);</span><br><span class="line">        <span class="keyword">this</span>.save(attrEntity);</span><br><span class="line">        <span class="comment">// 2、保存到relation表</span></span><br><span class="line">        AttrAttrgroupRelationEntity relationEntity = <span class="keyword">new</span> AttrAttrgroupRelationEntity();</span><br><span class="line">        relationEntity.setAttrId(attrEntity.getAttrId());<span class="comment">// 注意这里要使用attrEntity，因为使用attr是没有id的（没有添加mybatis的注解，所以没有自动生成id）</span></span><br><span class="line">        relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">        relationDao.insert(relationEntity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="查询分页"><a href="#查询分页" class="headerlink" title="查询分页"></a>查询分页</h3><h4 id="AttrResponseVo"><a href="#AttrResponseVo" class="headerlink" title="AttrResponseVo"></a>AttrResponseVo</h4><blockquote><p>原来可以使用继承的写法，学到了</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrResponseVo</span> <span class="keyword">extends</span> <span class="title">AttrEntity</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分类名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String catelogName;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分组名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String groupName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrController-1"><a href="#AttrController-1" class="headerlink" title="AttrController"></a>AttrController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrService attrService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/base/list/&#123;catelogId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">baseAttrList</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params, <span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId)</span> </span>&#123;</span><br><span class="line">        PageUtils page = attrService.queryBaseAttrPage(params, catelogId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrServiceImpl-1"><a href="#AttrServiceImpl-1" class="headerlink" title="AttrServiceImpl"></a>AttrServiceImpl</h4><blockquote><p>带新增的两个属性</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;attrService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">AttrDao</span>, <span class="title">AttrEntity</span>&gt; <span class="keyword">implements</span> <span class="title">AttrService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AttrAttrgroupRelationDao relationDao;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询attr表分页</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> catelogId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryBaseAttrPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId)</span> </span>&#123;</span><br><span class="line">   QueryWrapper&lt;AttrEntity&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (catelogId != <span class="number">0</span>) &#123;</span><br><span class="line">            queryWrapper.eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId);</span><br><span class="line">        &#125;</span><br><span class="line">        String key = (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">            <span class="comment">// and拼接，因为可能id为0所以已经含有了一个eq条件</span></span><br><span class="line">            queryWrapper.and((wrapper) -&gt; &#123;</span><br><span class="line">                wrapper.eq(<span class="string">&quot;attr_id&quot;</span>, key).or().like(<span class="string">&quot;attr_name&quot;</span>, key);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获得分页对象</span></span><br><span class="line">        IPage&lt;AttrEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">                <span class="keyword">new</span> Query&lt;AttrEntity&gt;().getPage(params),</span><br><span class="line">                queryWrapper</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// 同时还要添加上attrResponseVo中多的两个属性</span></span><br><span class="line">        <span class="comment">// 但是不能直接连表查询，数据量太大了。（两表叉乘笛卡尔积）</span></span><br><span class="line">        <span class="comment">// 所以先获取到分页后获取查询到的数据,再重新处理</span></span><br><span class="line">        PageUtils pageUtils = <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">        List&lt;AttrEntity&gt; records = page.getRecords();</span><br><span class="line">        List&lt;AttrResponseVo&gt; responseVoList = records.stream().map((attrEntity) -&gt; &#123;</span><br><span class="line">            AttrResponseVo responseVo = <span class="keyword">new</span> AttrResponseVo();</span><br><span class="line">            <span class="comment">// 先复制基本属性</span></span><br><span class="line">            BeanUtils.copyProperties(attrEntity, responseVo);</span><br><span class="line">            <span class="comment">// 再加入新的两个属性</span></span><br><span class="line">            CategoryEntity categoryEntity = categoryDao.selectById(attrEntity.getCatelogId());</span><br><span class="line">            <span class="keyword">if</span> (categoryEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">                responseVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">            &#125;</span><br><span class="line">            AttrAttrgroupRelationEntity relationEntity = relationDao.selectOne(<span class="keyword">new</span> QueryWrapper&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attrEntity.getAttrId()));</span><br><span class="line">            <span class="keyword">if</span> (relationEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">                responseVo.setGroupName(attrGroupDao.selectById(relationEntity.getAttrGroupId()).getAttrGroupName());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> responseVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">// 重新设置结果集</span></span><br><span class="line">        pageUtils.setList(responseVoList);</span><br><span class="line">        <span class="keyword">return</span> pageUtils;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="查询回显"><a href="#查询回显" class="headerlink" title="查询回显"></a>查询回显</h3><h4 id="AttrResoponseVo"><a href="#AttrResoponseVo" class="headerlink" title="AttrResoponseVo"></a>AttrResoponseVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrResponseVo</span> <span class="keyword">extends</span> <span class="title">AttrEntity</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分类名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String catelogName;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分组名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String groupName;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分类完整路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long[] catelogPath;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 分组ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long attrGroupId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrController-2"><a href="#AttrController-2" class="headerlink" title="AttrController"></a>AttrController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrService attrService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 信息,返回AttrResponseVo对象属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/info/&#123;attrId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">attrResponseInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;attrId&quot;)</span> Long attrId)</span> </span>&#123;</span><br><span class="line">        AttrResponseVo attr = attrService.getResponseAttrInfo(attrId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;attr&quot;</span>, attr);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="AttrServiceImpl-2"><a href="#AttrServiceImpl-2" class="headerlink" title="AttrServiceImpl"></a>AttrServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;attrService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">AttrDao</span>, <span class="title">AttrEntity</span>&gt; <span class="keyword">implements</span> <span class="title">AttrService</span> </span>&#123;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取信息,返回AttrResponseVo对象属性，带catelogPath完整路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AttrResponseVo <span class="title">getResponseAttrInfo</span><span class="params">(Long attrId)</span> </span>&#123;</span><br><span class="line">        AttrResponseVo responseVo = <span class="keyword">new</span> AttrResponseVo();</span><br><span class="line">        AttrEntity attrEntity = <span class="keyword">this</span>.getById(attrId);</span><br><span class="line">        BeanUtils.copyProperties(attrEntity, responseVo);</span><br><span class="line">        <span class="comment">// 额外的属性</span></span><br><span class="line">        <span class="comment">// 设置GroupName需要从relation表中查出groupid</span></span><br><span class="line">        AttrAttrgroupRelationEntity relationEntity = relationDao.selectOne(<span class="keyword">new</span> QueryWrapper&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attrEntity.getAttrId()));</span><br><span class="line">        <span class="keyword">if</span> (relationEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">            responseVo.setAttrGroupId(relationEntity.getAttrGroupId());</span><br><span class="line">            <span class="comment">// 设置GroupName属性</span></span><br><span class="line">            AttrGroupEntity attrGroupEntity = attrGroupDao.selectById(relationEntity.getAttrGroupId());</span><br><span class="line">            <span class="keyword">if</span> (attrGroupEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">                responseVo.setGroupName(attrGroupEntity.getAttrGroupName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 设置CatelogPath属性,直接从分类服务中拿方法</span></span><br><span class="line">        Long[] categoryPath = categoryService.findCategoryPath(attrEntity.getCatelogId());</span><br><span class="line">        responseVo.setCatelogPath(categoryPath);</span><br><span class="line">        <span class="comment">// 设置CatelogName属性</span></span><br><span class="line">        CategoryEntity categoryEntity = categoryDao.selectById(attrEntity.getCatelogId());</span><br><span class="line">        <span class="keyword">if</span> (categoryEntity != <span class="keyword">null</span>) &#123;</span><br><span class="line">            responseVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> responseVo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><h4 id="AttrController-3"><a href="#AttrController-3" class="headerlink" title="AttrController"></a>AttrController</h4><blockquote><p>需要用AttrRequestVo</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/update&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">update</span><span class="params">(<span class="meta">@RequestBody</span> AttrRequestVo attr)</span> </span>&#123;</span><br><span class="line">    attrService.updateAttr(attr);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrServiceImpl-3"><a href="#AttrServiceImpl-3" class="headerlink" title="AttrServiceImpl"></a>AttrServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改,使用AttrRequestVo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateAttr</span><span class="params">(AttrRequestVo attr)</span> </span>&#123;</span><br><span class="line"> <span class="comment">// 修改基本表</span></span><br><span class="line">        AttrEntity attrEntity = <span class="keyword">new</span> AttrEntity();</span><br><span class="line">        BeanUtils.copyProperties(attr, attrEntity);</span><br><span class="line">        <span class="keyword">this</span>.updateById(attrEntity);</span><br><span class="line">        <span class="comment">// 修改/新增relation表</span></span><br><span class="line">        AttrAttrgroupRelationEntity relationEntity = <span class="keyword">new</span> AttrAttrgroupRelationEntity();</span><br><span class="line">        relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">        relationEntity.setAttrId(attr.getAttrId());</span><br><span class="line">        <span class="comment">// 这里主要判断relation表中是否存在对应attr属性id的数据（即表中是否存入对应属性对应分组，如果没有对应分组，那么需要执行插入语句而不是修改语句）</span></span><br><span class="line">        Integer count = relationDao.selectCount(<span class="keyword">new</span> QueryWrapper&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attr.getAttrId()));</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            relationDao.update(relationEntity, <span class="keyword">new</span> UpdateWrapper&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attr.getAttrId()));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            relationDao.insert(relationEntity);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="平台属性—销售属性（后端）"><a href="#平台属性—销售属性（后端）" class="headerlink" title="平台属性—销售属性（后端）"></a>平台属性—销售属性（后端）</h2><blockquote><p>规格参数和销售属性其实就是attr属性中attrType的不同，所以controller还是同一个，只是请求地址中片段不同，只需要在requestMapping中获得参数判断一下即可，</p></blockquote><h4 id="常量类"><a href="#常量类" class="headerlink" title="常量类"></a>常量类</h4><blockquote><p>在common模块中写一个类，里面写各种枚举</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductConstant</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">AttrEnum</span> </span>&#123;</span><br><span class="line">        ATTR_TYPE_BASE(<span class="number">1</span>, <span class="string">&quot;基本属性&quot;</span>), ATTR_TYPE_SALE(<span class="number">0</span>, <span class="string">&quot;销售属性&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String msg;</span><br><span class="line">        AttrEnum(<span class="keyword">int</span> code, String msg) &#123;</span><br><span class="line">            <span class="keyword">this</span>.code = code;</span><br><span class="line">            <span class="keyword">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrController-4"><a href="#AttrController-4" class="headerlink" title="AttrController"></a>AttrController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrService attrService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 信息,返回AttrResponseVo对象属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/info/&#123;attrId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">attrResponseInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;attrId&quot;)</span> Long attrId)</span> </span>&#123;</span><br><span class="line">        AttrResponseVo attr = attrService.getResponseAttrInfo(attrId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;attr&quot;</span>, attr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 条件查询分页列表,返回AttrResponseVo对象属性</span></span><br><span class="line"><span class="comment">     * attrType 用于判断是销售属性还是基本属性（详见文档）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;attrType&#125;/list/&#123;catelogId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">attrResponseList</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="meta">@PathVariable(&quot;attrType&quot;)</span> String attrType,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId)</span> </span>&#123;</span><br><span class="line">        PageUtils page = attrService.queryBaseAttrPage(params, catelogId,attrType);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrService"><a href="#AttrService" class="headerlink" title="AttrService"></a>AttrService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 条件查询attr表分页</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> catelogId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> attrType</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryBaseAttrPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId, String attrType)</span> </span>&#123;</span><br><span class="line"> <span class="comment">// 这里判断attrType，用于查询是规格参数还是销售属性</span></span><br><span class="line">        QueryWrapper&lt;AttrEntity&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;AttrEntity&gt;().eq(<span class="string">&quot;attr_type&quot;</span>, <span class="string">&quot;base&quot;</span>.equalsIgnoreCase(attrType) ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (catelogId != <span class="number">0</span>) &#123;</span><br><span class="line">            queryWrapper.eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存规格参数，连表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span>  <span class="comment">// 事务</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveAttr</span><span class="params">(AttrRequestVo attr)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1、保存到attr表</span></span><br><span class="line">        AttrEntity attrEntity = <span class="keyword">new</span> AttrEntity();</span><br><span class="line">        <span class="comment">// 使用BeanUtil封装对应属性</span></span><br><span class="line">        BeanUtils.copyProperties(attr, attrEntity);</span><br><span class="line">        <span class="keyword">this</span>.save(attrEntity);</span><br><span class="line">        <span class="comment">// 2、保存到relation表</span></span><br><span class="line">        <span class="comment">// 判断是否是销售属性，如果不是那么不需要添加到relation表</span></span><br><span class="line">        <span class="keyword">if</span> (attr.getAttrType() == ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode()) &#123;</span><br><span class="line">            AttrAttrgroupRelationEntity relationEntity = <span class="keyword">new</span> AttrAttrgroupRelationEntity();</span><br><span class="line">            relationEntity.setAttrId(attrEntity.getAttrId()); <span class="comment">// 注意这里要使用attrEntity，因为使用attr是没有id的（没有添加mybatis的注解，所以没有自动生成id）</span></span><br><span class="line">            relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">            relationDao.insert(relationEntity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="平台属性—属性分组（后端）"><a href="#平台属性—属性分组（后端）" class="headerlink" title="平台属性—属性分组（后端）"></a>平台属性—属性分组（后端）</h2><h3 id="查询关联"><a href="#查询关联" class="headerlink" title="查询关联"></a>查询关联</h3><blockquote><p>分组和属性多对多，需要关联表</p></blockquote><h4 id="AttrGroupController"><a href="#AttrGroupController" class="headerlink" title="AttrGroupController"></a>AttrGroupController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attrgroup&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrGroupController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrGroupService attrGroupService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrService attrService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得对应分组Id的属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> attrgroupId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;attrgroupId&#125;/attr/relation&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">attrRelationList</span><span class="params">(<span class="meta">@PathVariable(&quot;attrgroupId&quot;)</span> String attrgroupId)</span> </span>&#123;</span><br><span class="line">        List&lt;AttrEntity&gt; list = attrService.getRelationAttr(attrgroupId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrService-1"><a href="#AttrService-1" class="headerlink" title="AttrService"></a>AttrService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获得对应分组Id的基本属性（规格参数）</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> attrgroupId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;AttrEntity&gt; <span class="title">getRelationAttr</span><span class="params">(String attrgroupId)</span> </span>&#123;</span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; relationList = relationDao.selectList(<span class="keyword">new</span> QueryWrapper&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_group_id&quot;</span>, attrgroupId));</span><br><span class="line">    List&lt;Long&gt; idList = relationList.stream().map((relationEntity) -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> relationEntity.getAttrId();</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    Collection&lt;AttrEntity&gt; attrEntities = <span class="keyword">this</span>.listByIds(idList);</span><br><span class="line">    <span class="keyword">return</span> (List&lt;AttrEntity&gt;) attrEntities;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="删除关联"><a href="#删除关联" class="headerlink" title="删除关联"></a>删除关联</h3><h4 id="AttrGroupRelationVo"><a href="#AttrGroupRelationVo" class="headerlink" title="AttrGroupRelationVo"></a>AttrGroupRelationVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrGroupRelationVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long attrId;</span><br><span class="line">    <span class="keyword">private</span> Long attrGroupId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrGroupController-1"><a href="#AttrGroupController-1" class="headerlink" title="AttrGroupController"></a>AttrGroupController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除关联</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/attr/relation/delete&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">deleteRelation</span><span class="params">(AttrGroupRelationVo[] vos)</span> </span>&#123;</span><br><span class="line">    attrService.deleteRelation(vos);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrGroupService"><a href="#AttrGroupService" class="headerlink" title="AttrGroupService"></a>AttrGroupService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除关联</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> vos</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteRelation</span><span class="params">(AttrGroupRelationVo[] vos)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// relationDao.delete(new QueryWrapper&lt;&gt;().eq(&quot;attr_id&quot;, attrId).eq(&quot;attr_group_id&quot;, groupId))</span></span><br><span class="line">    <span class="comment">// Vos-&gt;relation对象集合</span></span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; collect = Arrays.asList(vos).stream().map((vo) -&gt; &#123;</span><br><span class="line">        AttrAttrgroupRelationEntity relationEntity = <span class="keyword">new</span> AttrAttrgroupRelationEntity();</span><br><span class="line">        BeanUtils.copyProperties(vo, relationEntity);</span><br><span class="line">        <span class="keyword">return</span> relationEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    relationDao.deleteBatchRelation(collect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrAttrGroupRelationDao"><a href="#AttrAttrGroupRelationDao" class="headerlink" title="AttrAttrGroupRelationDao"></a>AttrAttrGroupRelationDao</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AttrAttrgroupRelationDao</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">AttrAttrgroupRelationEntity</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteBatchRelation</span><span class="params">(<span class="meta">@Param(&quot;entities&quot;)</span> List&lt;AttrAttrgroupRelationEntity&gt; entities)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBatchRelation&quot;</span>&gt;</span></span><br><span class="line">    DELETE</span><br><span class="line">    FROM gulimall_pms.pms_attr_attrgroup_relation</span><br><span class="line">    WHERE</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;entities&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot; OR &quot;</span>&gt;</span></span><br><span class="line">        (attr_id = #&#123;item.attrId&#125; AND attr_group_id = #&#123;item.attrGroupId&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="查询未关联属性"><a href="#查询未关联属性" class="headerlink" title="查询未关联属性"></a>查询未关联属性</h3><h4 id="AttrGroupController-2"><a href="#AttrGroupController-2" class="headerlink" title="AttrGroupController"></a>AttrGroupController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获得对应分组Id没有关联的属性</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> attrgroupId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;attrgroupId&#125;/noattr/relation&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">attrNoRelationList</span><span class="params">(<span class="meta">@PathVariable(&quot;attrgroupId&quot;)</span> String attrgroupId, <span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">    PageUtils pageUtils = attrService.getNoRelationAttr(params, attrgroupId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, pageUtils);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrService-2"><a href="#AttrService-2" class="headerlink" title="AttrService"></a>AttrService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获得对应分组Id没有关联的属性</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> attrgroupId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageUtils <span class="title">getNoRelationAttr</span><span class="params">(Map&lt;String, Object&gt; params, String attrgroupId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 当前分组只能关联自己所属分类里面的属性</span></span><br><span class="line">    AttrGroupEntity attrGroupEntity = attrGroupDao.selectById(attrgroupId);</span><br><span class="line">    Long catelogId = attrGroupEntity.getCatelogId();</span><br><span class="line">    <span class="comment">// 当前分组只能关联没有被别的分组引用的属性</span></span><br><span class="line">    <span class="comment">// 获得当前分类下的其他分组</span></span><br><span class="line">    List&lt;AttrGroupEntity&gt; groupEntities = attrGroupDao.selectList(<span class="keyword">new</span> QueryWrapper&lt;AttrGroupEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId).ne(<span class="string">&quot;attr_group_id&quot;</span>, attrgroupId));</span><br><span class="line">    List&lt;Long&gt; groupIdList = groupEntities.stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> item.getAttrGroupId();</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 获得其他分组中对应的属性id</span></span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; relationEntities = relationDao.selectList(<span class="keyword">new</span> QueryWrapper&lt;AttrAttrgroupRelationEntity&gt;().in(<span class="string">&quot;attr_group_id&quot;</span>, groupIdList));</span><br><span class="line">    List&lt;Long&gt; attrIdList = relationEntities.stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> item.getAttrId();</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 从当前分类的所有属性中取出上述属性</span></span><br><span class="line">    QueryWrapper&lt;AttrEntity&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;AttrEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId).notIn(<span class="string">&quot;attr_id&quot;</span>, attrIdList);</span><br><span class="line">    <span class="comment">// 模糊查询判断</span></span><br><span class="line">    String key = (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        queryWrapper.and((wrapper) -&gt; &#123;</span><br><span class="line">            wrapper.eq(<span class="string">&quot;attr_id&quot;</span>, key).or().like(<span class="string">&quot;attr_name&quot;</span>, key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    IPage&lt;AttrEntity&gt; iPage = <span class="keyword">this</span>.page(<span class="keyword">new</span> Query&lt;AttrEntity&gt;().getPage(params), queryWrapper);</span><br><span class="line">    PageUtils pageUtils = <span class="keyword">new</span> PageUtils(iPage);</span><br><span class="line">    <span class="keyword">return</span> pageUtils;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>TODO：这里有个很奇怪的地方，我修改一下关联的话，属性中的所属分组也会改变？</p><p>哦我傻了，这俩个就是对应的功能</p></blockquote><h3 id="添加关联"><a href="#添加关联" class="headerlink" title="添加关联"></a>添加关联</h3><h4 id="AttrGroupController-3"><a href="#AttrGroupController-3" class="headerlink" title="AttrGroupController"></a>AttrGroupController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新建关联</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> vos</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/attr/relation&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">addRelation</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;AttrGroupRelationVo&gt; vos)</span> </span>&#123;</span><br><span class="line">    relationService.saveBatch(vos);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrGroupService-1"><a href="#AttrGroupService-1" class="headerlink" title="AttrGroupService"></a>AttrGroupService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 批量保存</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> vos</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveBatch</span><span class="params">(List&lt;AttrGroupRelationVo&gt; vos)</span> </span>&#123;</span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; relationEntityList = vos.stream().map((vo) -&gt; &#123;</span><br><span class="line">        AttrAttrgroupRelationEntity relationEntity = <span class="keyword">new</span> AttrAttrgroupRelationEntity();</span><br><span class="line">        BeanUtils.copyProperties(vo, relationEntity);</span><br><span class="line">        <span class="keyword">return</span> relationEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">this</span>.saveBatch(relationEntityList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="商品维护—发布商品（后端）"><a href="#商品维护—发布商品（后端）" class="headerlink" title="商品维护—发布商品（后端）"></a>商品维护—发布商品（后端）</h2><h3 id="获取用户等级"><a href="#获取用户等级" class="headerlink" title="获取用户等级"></a>获取用户等级</h3><h4 id="配置网关application-yml"><a href="#配置网关application-yml" class="headerlink" title="配置网关application.yml"></a>配置网关application.yml</h4><blockquote><p>详见文档，需要member模块中的功能，之前还没有配过该模块的网关配置，配置一下即可</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="comment"># member会员配置</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">member_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://gulimall-member</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/member/**</span></span><br><span class="line">          <span class="comment"># 实现转发</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure><h4 id="页面模板"><a href="#页面模板" class="headerlink" title="页面模板"></a>页面模板</h4><blockquote><p>原本renren-generator生成的时候就有了，直接复制到前端src文件夹下即可</p></blockquote><blockquote><p>然后就好了，基本的增删改查</p></blockquote><h3 id="获得分类关联的品牌"><a href="#获得分类关联的品牌" class="headerlink" title="获得分类关联的品牌"></a>获得分类关联的品牌</h3><h4 id="BrandVo"><a href="#BrandVo" class="headerlink" title="BrandVo"></a>BrandVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line">    <span class="keyword">private</span> String brandName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CategoryBrandRelationController"><a href="#CategoryBrandRelationController" class="headerlink" title="CategoryBrandRelationController"></a>CategoryBrandRelationController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/categorybrandrelation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryBrandRelationController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryBrandRelationService relationService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取分类关联的所有品牌列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/brand/list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">relationListByBrand</span><span class="params">(<span class="meta">@RequestParam(&quot;catId&quot;)</span> Long catId)</span> </span>&#123;</span><br><span class="line">        List&lt;BrandEntity&gt; brandEntities = relationService.getBrandsByCatId(catId);</span><br><span class="line">        <span class="comment">// 先获得brandEntity，在转换成Vo</span></span><br><span class="line">        List&lt;BrandVo&gt; list = brandEntities.stream().map((item) -&gt; &#123;</span><br><span class="line">            BrandVo brandVo = <span class="keyword">new</span> BrandVo();</span><br><span class="line">            <span class="comment">// 这里属性名没有对应，所以需要手动设置</span></span><br><span class="line">            brandVo.setBrandId(item.getBrandId());</span><br><span class="line">            brandVo.setBrandName(item.getName());</span><br><span class="line">            <span class="keyword">return</span> brandVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>为什么这里不直接使用relation对象的原因是，为了重用，如果后面还有业务需要获得更多的brand信息，需要用到brandEntity</p></blockquote><h4 id="CategoryBrandRelationServiceImpl"><a href="#CategoryBrandRelationServiceImpl" class="headerlink" title="CategoryBrandRelationServiceImpl"></a>CategoryBrandRelationServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据catId查询关联的所有品牌的所有信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> catId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;BrandEntity&gt; <span class="title">getBrandsByCatId</span><span class="params">(Long catId)</span> </span>&#123;</span><br><span class="line">    List&lt;CategoryBrandRelationEntity&gt; relationList = baseMapper.selectList(<span class="keyword">new</span> QueryWrapper&lt;CategoryBrandRelationEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catId));</span><br><span class="line">    List&lt;BrandEntity&gt; collect = relationList.stream().map(relationEntity -&gt; &#123;</span><br><span class="line">        Long brandId = relationEntity.getBrandId();</span><br><span class="line">        <span class="keyword">return</span> brandService.getById(brandId);</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> collect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="获取分类关联的分组和属性"><a href="#获取分类关联的分组和属性" class="headerlink" title="获取分类关联的分组和属性"></a>获取分类关联的分组和属性</h3><blockquote><ol><li>分类：手机手表……</li><li>分组：主体，基本信息，其他信息</li><li>属性：尺寸，颜色</li></ol><p>属性从属于分组，分组从属于分类（多对一），分类和品牌多对多</p></blockquote><h4 id="AttrGroupWithAttrsVo"><a href="#AttrGroupWithAttrsVo" class="headerlink" title="AttrGroupWithAttrsVo"></a>AttrGroupWithAttrsVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrGroupWithAttrsVo</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分组id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long attrGroupId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String attrGroupName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 描述</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String descript;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组图标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String icon;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 所属分类id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long catelogId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该分组下的所有属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;AttrEntity&gt; attrs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrGroupController-4"><a href="#AttrGroupController-4" class="headerlink" title="AttrGroupController"></a>AttrGroupController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrGroupController</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得对应分类Id关联的分组和属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;catelogId&#125;/withattr&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getAttrGroupWithAttr</span><span class="params">(<span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId, <span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 查出分组</span></span><br><span class="line">        <span class="comment">// 查出属性</span></span><br><span class="line">        List&lt;AttrGroupWithAttrsVo&gt; list = attrGroupService.getWithAttrByCatelogId(catelogId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, list);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="AttrGroupService-2"><a href="#AttrGroupService-2" class="headerlink" title="AttrGroupService"></a>AttrGroupService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获得对应分类Id关联的分组和属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;AttrGroupWithAttrsVo&gt; <span class="title">getWithAttrByCatelogId</span><span class="params">(Long catelogId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查询分组</span></span><br><span class="line">    List&lt;AttrGroupEntity&gt; attrGroupList = <span class="keyword">this</span>.list(<span class="keyword">new</span> QueryWrapper&lt;AttrGroupEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId));</span><br><span class="line">    List&lt;AttrGroupWithAttrsVo&gt; collect = attrGroupList.stream().map(attrGroupEntity -&gt; &#123;</span><br><span class="line">        AttrGroupWithAttrsVo attrGroupWithAttrsVo = <span class="keyword">new</span> AttrGroupWithAttrsVo();</span><br><span class="line">        BeanUtils.copyProperties(attrGroupEntity, attrGroupWithAttrsVo);</span><br><span class="line">        <span class="comment">// 查询所有属性</span></span><br><span class="line">        List&lt;AttrEntity&gt; attrList = attrService.getRelationAttr(attrGroupEntity.getAttrGroupId());</span><br><span class="line">        attrGroupWithAttrsVo.setAttrs(attrList);</span><br><span class="line">        <span class="keyword">return</span> attrGroupWithAttrsVo;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> collect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="新增商品"><a href="#新增商品" class="headerlink" title="新增商品"></a>新增商品</h3><h4 id="Vo"><a href="#Vo" class="headerlink" title="Vo"></a>Vo</h4><blockquote><p>准备一个Vo接收JSON数据，使用BEJSON网站下的转java实体类工具，然后下载即可</p><p>真不戳！</p></blockquote><h4 id="SpuInfoController"><a href="#SpuInfoController" class="headerlink" title="SpuInfoController"></a>SpuInfoController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/spuinfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuInfoController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SpuInfoService spuInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:spuinfo:save&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(<span class="meta">@RequestBody</span> SpuSaveVo spuSaveVo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// spuInfoService.save(spuInfo);</span></span><br><span class="line">        spuInfoService.saveSpuVo(spuSaveVo);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="远程服务"><a href="#远程服务" class="headerlink" title="远程服务"></a>远程服务</h4><blockquote><p>因为涉及到coupon模块，需要远程调用</p><ol><li><p>开启服务</p><p>@EnableDiscoveryClient    // 被调用服务application上，开启nacos注册<br>@EnableFeignClients(basePackages = “com.atguigu.gulimall.product.feign”)     //feign</p></li><li><p>TO : 由于两个服务之间需要公用一种对象，使用TO传输对象，可以写在common公共模块中</p></li><li><p>编写接口</p></li></ol></blockquote><h4 id="远程服务接口"><a href="#远程服务接口" class="headerlink" title="远程服务接口"></a>远程服务接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;gulimall-coupon&quot;)</span>    <span class="comment">// 声明调用的服务</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CouponFeignService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1 先将远程电调用服务方法的对象转为JSON</span></span><br><span class="line"><span class="comment">     * 2 请求coupon服务中的save请求，JSON存放在请求体中</span></span><br><span class="line"><span class="comment">     * 3 收到请求，将请求体中的JSON转为请求方法的参数</span></span><br><span class="line"><span class="comment">     * （<span class="doctag">@ResponseBody</span>方JSON和对象能够互相转换）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/coupon/spubounds/save&quot;)</span></span><br><span class="line">    <span class="function">R <span class="title">saveSpuBound</span><span class="params">(<span class="meta">@RequestBody</span> SpuBoundTo spuBoundTo)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="SpuInfoServiceImpl"><a href="#SpuInfoServiceImpl" class="headerlink" title="SpuInfoServiceImpl"></a>SpuInfoServiceImpl</h4><blockquote><p>因为这个商品Vo涉及表众多，还有关联到远程调用，所以代码量较长。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;spuInfoService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuInfoServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SpuInfoDao</span>, <span class="title">SpuInfoEntity</span>&gt; <span class="keyword">implements</span> <span class="title">SpuInfoService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SpuInfoDescService spuInfoDescService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SpuImagesService spuImagesService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductAttrValueService productAttrValueService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AttrService attrService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SkuInfoService skuInfoService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SkuImagesService skuImagesService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SkuSaleAttrValueService skuSaleAttrValueService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CouponFeignService couponFeignService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存saveSpuVoInfo，前端接收的一个对象，涉及多个表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spuSaveVo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSpuVoInfo</span><span class="params">(SpuSaveVo spuSaveVo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 保存spu info: spu_info</span></span><br><span class="line">        SpuInfoEntity spuInfoEntity = <span class="keyword">new</span> SpuInfoEntity();</span><br><span class="line">        BeanUtils.copyProperties(spuSaveVo, spuInfoEntity);</span><br><span class="line">        spuInfoEntity.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        spuInfoEntity.setUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">this</span>.save(spuInfoEntity);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存spu info_desc: spu_info_desc</span></span><br><span class="line">        List&lt;String&gt; decrypts = spuSaveVo.getDecript();</span><br><span class="line">        SpuInfoDescEntity spuInfoDescEntity = <span class="keyword">new</span> SpuInfoDescEntity();</span><br><span class="line">        spuInfoDescEntity.setSpuId(spuInfoEntity.getId()); <span class="comment">// 保存之后会将id自动封装到infoEntity</span></span><br><span class="line">        spuInfoDescEntity.setDecript(String.join(<span class="string">&quot;,&quot;</span>, decrypts));   <span class="comment">// 使用，拼接</span></span><br><span class="line">        spuInfoDescService.save(spuInfoDescEntity);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存spu images: spu_images</span></span><br><span class="line">        List&lt;String&gt; images = spuSaveVo.getImages();</span><br><span class="line">        List&lt;SpuImagesEntity&gt; spuImagesList = images.stream().map(image -&gt; &#123;</span><br><span class="line">            SpuImagesEntity spuImagesEntity = <span class="keyword">new</span> SpuImagesEntity();</span><br><span class="line">            spuImagesEntity.setSpuId(spuInfoEntity.getId());</span><br><span class="line">            spuImagesEntity.setImgUrl(image);</span><br><span class="line">            <span class="keyword">return</span> spuImagesEntity;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        spuImagesService.saveBatch(spuImagesList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存spu product_attr_value: product_attr_valu</span></span><br><span class="line">        List&lt;BaseAttrs&gt; baseAttrs = spuSaveVo.getBaseAttrs();</span><br><span class="line">        List&lt;ProductAttrValueEntity&gt; collect = baseAttrs.stream().map(attr -&gt; &#123;</span><br><span class="line">            ProductAttrValueEntity attrValueEntity = <span class="keyword">new</span> ProductAttrValueEntity();</span><br><span class="line">            attrValueEntity.setAttrId(attr.getAttrId());</span><br><span class="line">            attrValueEntity.setSpuId(spuInfoEntity.getId());</span><br><span class="line">            attrValueEntity.setAttrName(attrService.getById(attr.getAttrId()).getAttrName());</span><br><span class="line">            attrValueEntity.setAttrValue(attr.getAttrValues());</span><br><span class="line">            attrValueEntity.setQuickShow(attr.getShowDesc());</span><br><span class="line">            <span class="keyword">return</span> attrValueEntity;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        productAttrValueService.saveBatch(collect);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存spu 积分信息: sms_spu_bounds</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存sku对应sku_info: sku_info、sku_images、sku_sale_attr_value、sms_sku_ladder、sms_sku_full_reduction、sms_member_price</span></span><br><span class="line">        List&lt;Skus&gt; skus = spuSaveVo.getSkus();</span><br><span class="line">        <span class="keyword">if</span> (skus != <span class="keyword">null</span> &amp;&amp; skus.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            skus.forEach(sku -&gt; &#123;</span><br><span class="line">                <span class="comment">// 1 保存基本信息</span></span><br><span class="line">                SkuInfoEntity skuInfoEntity = <span class="keyword">new</span> SkuInfoEntity();</span><br><span class="line">                BeanUtils.copyProperties(sku, skuInfoEntity);</span><br><span class="line">                skuInfoEntity.setBrandId(spuInfoEntity.getBrandId());</span><br><span class="line">                skuInfoEntity.setCatalogId(spuInfoEntity.getCatalogId());</span><br><span class="line">                skuInfoEntity.setSaleCount(<span class="number">0L</span>);</span><br><span class="line">                skuInfoEntity.setSpuId(spuInfoEntity.getId());</span><br><span class="line">                String defaultImg = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                <span class="keyword">for</span> (Images img : sku.getImages()) &#123;   <span class="comment">// 这里用for而不是foreach，注意看报错的原因，lamda表达式中的变量要final</span></span><br><span class="line">                    <span class="keyword">if</span> (img.getDefaultImg() == <span class="number">1</span>) &#123;</span><br><span class="line">                        defaultImg = img.getImgUrl();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                skuInfoEntity.setSkuDefaultImg(defaultImg);</span><br><span class="line">                skuInfoService.save(skuInfoEntity);</span><br><span class="line">                Long skuId = skuInfoEntity.getSkuId();  <span class="comment">// 必须是保存完之后才能获得</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 2 保存图片</span></span><br><span class="line">                List&lt;SkuImagesEntity&gt; skuImagesList = sku.getImages().stream().map(img -&gt; &#123;</span><br><span class="line">                    SkuImagesEntity skuImagesEntity = <span class="keyword">new</span> SkuImagesEntity();</span><br><span class="line">                    skuImagesEntity.setSkuId(skuId);</span><br><span class="line">                    skuImagesEntity.setImgUrl(img.getImgUrl());</span><br><span class="line">                    skuImagesEntity.setDefaultImg(img.getDefaultImg());</span><br><span class="line">                    <span class="keyword">return</span> skuImagesEntity;</span><br><span class="line">                &#125;).collect(Collectors.toList());</span><br><span class="line">                skuImagesService.saveBatch(skuImagesList);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 3 保存属性</span></span><br><span class="line">                List&lt;Attr&gt; attrList = sku.getAttr();</span><br><span class="line">                List&lt;SkuSaleAttrValueEntity&gt; skuSaleAttrValueList = attrList.stream().map(attr -&gt; &#123;</span><br><span class="line">                    SkuSaleAttrValueEntity skuSaleAttrValueEntity = <span class="keyword">new</span> SkuSaleAttrValueEntity();</span><br><span class="line">                    BeanUtils.copyProperties(attr, skuSaleAttrValueEntity);</span><br><span class="line">                    skuSaleAttrValueEntity.setSkuId(skuId);</span><br><span class="line">                    <span class="keyword">return</span> skuSaleAttrValueEntity;</span><br><span class="line">                &#125;).collect(Collectors.toList());</span><br><span class="line">                skuSaleAttrValueService.saveBatch(skuSaleAttrValueList);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 以下需要远程服务</span></span><br><span class="line">                <span class="comment">// 4 保存优惠</span></span><br><span class="line">                Bounds bounds = spuSaveVo.getBounds();</span><br><span class="line">                SpuBoundTo spuBoundTo = <span class="keyword">new</span> SpuBoundTo();</span><br><span class="line">                BeanUtils.copyProperties(bounds, spuBoundTo);</span><br><span class="line">                spuBoundTo.setSpuId(spuInfoEntity.getId());</span><br><span class="line">                R saveSpuBound = couponFeignService.saveSpuBound(spuBoundTo);</span><br><span class="line">                <span class="keyword">if</span> (saveSpuBound.getCode() != <span class="number">0</span>) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;远程保存spu积分信息失败&quot;</span>);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 5 保存满减</span></span><br><span class="line">                SkuReductionTo skuReductionTo = <span class="keyword">new</span> SkuReductionTo();</span><br><span class="line">                BeanUtils.copyProperties(sku, skuReductionTo);</span><br><span class="line">                skuReductionTo.setSkuId(skuId);</span><br><span class="line">                R saveSkuReduction = couponFeignService.saveSkuReduction(skuReductionTo);</span><br><span class="line">                <span class="keyword">if</span> (saveSkuReduction.getCode() != <span class="number">0</span>) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;远程保存spu积满减信息失败&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="SkuFullReductionServiceImpl"><a href="#SkuFullReductionServiceImpl" class="headerlink" title="SkuFullReductionServiceImpl"></a>SkuFullReductionServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;skuFullReductionService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkuFullReductionServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">SkuFullReductionDao</span>, <span class="title">SkuFullReductionEntity</span>&gt; <span class="keyword">implements</span> <span class="title">SkuFullReductionService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SkuLadderService skuLadderService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MemberPriceService memberPriceService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSkuReduction</span><span class="params">(SkuReductionTo skuReductionTo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 保存ladder</span></span><br><span class="line">        SkuLadderEntity skuLadderEntity = <span class="keyword">new</span> SkuLadderEntity();</span><br><span class="line">        skuLadderEntity.setSkuId(skuReductionTo.getSkuId());</span><br><span class="line">        skuLadderEntity.setFullCount(skuReductionTo.getFullCount());</span><br><span class="line">        skuLadderEntity.setDiscount(skuReductionTo.getDiscount());</span><br><span class="line">        skuLadderEntity.setAddOther(skuReductionTo.getCountStatus());</span><br><span class="line">        skuLadderService.save(skuLadderEntity);</span><br><span class="line">        <span class="comment">// 保存满减</span></span><br><span class="line">        SkuFullReductionEntity skuFullReductionEntity = <span class="keyword">new</span> SkuFullReductionEntity();</span><br><span class="line">        BeanUtils.copyProperties(skuReductionTo, skuFullReductionEntity);</span><br><span class="line">        <span class="keyword">this</span>.save(skuFullReductionEntity);</span><br><span class="line">        <span class="comment">// 保存会员价格</span></span><br><span class="line">        List&lt;MemberPriceTo&gt; memberPriceToList = skuReductionTo.getMemberPrice();</span><br><span class="line">        List&lt;MemberPriceEntity&gt; memberPriceList = memberPriceToList.stream().map(memberPriceTo -&gt; &#123;</span><br><span class="line">            MemberPriceEntity memberPriceEntity = <span class="keyword">new</span> MemberPriceEntity();</span><br><span class="line">            memberPriceEntity.setSkuId(skuReductionTo.getSkuId());</span><br><span class="line">            memberPriceEntity.setMemberLevelId(memberPriceTo.getId());</span><br><span class="line">            memberPriceEntity.setMemberLevelName(memberPriceTo.getName());</span><br><span class="line">            memberPriceEntity.setMemberPrice(memberPriceTo.getPrice());</span><br><span class="line">            memberPriceEntity.setAddOther(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> memberPriceEntity;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        memberPriceService.saveBatch(memberPriceList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="debug-amp-test"><a href="#debug-amp-test" class="headerlink" title="debug &amp; test"></a>debug &amp; test</h4><blockquote><p>妈耶一次成功有点开心</p><p>TODO: 失败的情况没有编写</p></blockquote><h2 id="商品维护—SPU管理（后端）"><a href="#商品维护—SPU管理（后端）" class="headerlink" title="商品维护—SPU管理（后端）"></a>商品维护—SPU管理（后端）</h2><h3 id="时间戳格式化"><a href="#时间戳格式化" class="headerlink" title="时间戳格式化"></a>时间戳格式化</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="comment">#    时间戳格式化</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure><h3 id="SPU待条件检索"><a href="#SPU待条件检索" class="headerlink" title="SPU待条件检索"></a>SPU待条件检索</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="comment">//@RequiresPermissions(&quot;product:spuinfo:list&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">list</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">    PageUtils page = spuInfoService.queryPageByCondition(params); </span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *待条件查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryPageByCondition</span><span class="params">(Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;SpuInfoEntity&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    String key = (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        wrapper.and((w) -&gt; &#123;</span><br><span class="line">            w.eq(<span class="string">&quot;id&quot;</span>, key).or().like(<span class="string">&quot;spu_name&quot;</span>, key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    String status = (String) params.get(<span class="string">&quot;status&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(status)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;publish_status&quot;</span>, status);</span><br><span class="line">    &#125;</span><br><span class="line">    String brandId = (String) params.get(<span class="string">&quot;brandId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(brandId)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;brand_id&quot;</span>, brandId);</span><br><span class="line">    &#125;</span><br><span class="line">    String catelogId = (String) params.get(<span class="string">&quot;catelogId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(catelogId)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;catalog_id&quot;</span>, catelogId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IPage&lt;SpuInfoEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> Query&lt;SpuInfoEntity&gt;().getPage(params),</span><br><span class="line">            wrapper</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SKU检索"><a href="#SKU检索" class="headerlink" title="SKU检索"></a>SKU检索</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/skuinfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SkuInfoController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SkuInfoService skuInfoService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:skuinfo:list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">list</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">        PageUtils page = skuInfoService.queryPageByCondition(params);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryPageByCondition</span><span class="params">(Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;SkuInfoEntity&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    String key = (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        wrapper.and((w) -&gt; &#123;</span><br><span class="line">            w.eq(<span class="string">&quot;sku_id&quot;</span>, key).or().like(<span class="string">&quot;sku_name&quot;</span>, key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    String brandId = (String) params.get(<span class="string">&quot;brandId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(brandId)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;brand_id&quot;</span>, brandId);</span><br><span class="line">    &#125;</span><br><span class="line">    String catelogId = (String) params.get(<span class="string">&quot;catelogId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(catelogId)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;catalog_id&quot;</span>, catelogId);</span><br><span class="line">    &#125;</span><br><span class="line">    String min = (String) params.get(<span class="string">&quot;min&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(min)) &#123;</span><br><span class="line">        wrapper.ge(<span class="string">&quot;price&quot;</span>, min);</span><br><span class="line">    &#125;</span><br><span class="line">    String max = (String) params.get(<span class="string">&quot;max&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(max)) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            BigDecimal bigDecimal = <span class="keyword">new</span> BigDecimal(max);</span><br><span class="line">            <span class="keyword">if</span> (bigDecimal.compareTo(<span class="keyword">new</span> BigDecimal(<span class="number">0</span>)) == <span class="number">1</span>) &#123;</span><br><span class="line">                wrapper.le(<span class="string">&quot;price&quot;</span>, max);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IPage&lt;SkuInfoEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> Query&lt;SkuInfoEntity&gt;().getPage(params),</span><br><span class="line">            wrapper</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="库存系统—仓库维护（后端）"><a href="#库存系统—仓库维护（后端）" class="headerlink" title="库存系统—仓库维护（后端）"></a>库存系统—仓库维护（后端）</h2><blockquote><p>仓库相关表：gulimall_wms_xxx</p><p>服务：ware</p></blockquote><h3 id="服务基础搭建"><a href="#服务基础搭建" class="headerlink" title="服务基础搭建"></a>服务基础搭建</h3><blockquote><ol><li><p>application.yml中配置nacos、application name</p></li><li><p>注解开启nacos（@EnableDiscoveryClient）（com.alibaba.nacos.api.exception.NacosException: java.lang.reflect.InvocationTargetException这个报错是因为没有配置bootstrap）</p></li><li><p>配置日志</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用于输出日志</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.atguigu:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure></li><li><p>配置网关</p></li><li><p>配置mybatis分页插件</p></li></ol></blockquote><h3 id="获得仓库列表带条件"><a href="#获得仓库列表带条件" class="headerlink" title="获得仓库列表带条件"></a>获得仓库列表带条件</h3><blockquote><p>修改一下原来的queryPage即可，添加上condition</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模糊查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryPageByCondition</span><span class="params">(Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;WareInfoEntity&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    String key = (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        <span class="comment">// and拼接，因为可能id为0所以已经含有了一个eq条件</span></span><br><span class="line">        wrapper.eq(<span class="string">&quot;id&quot;</span>, key).or().like(<span class="string">&quot;name&quot;</span>, key).or().like(<span class="string">&quot;address&quot;</span>, key);</span><br><span class="line">    &#125;</span><br><span class="line">    IPage&lt;WareInfoEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> Query&lt;WareInfoEntity&gt;().getPage(params),</span><br><span class="line">            wrapper</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="库存系统—商品库存（后端）"><a href="#库存系统—商品库存（后端）" class="headerlink" title="库存系统—商品库存（后端）"></a>库存系统—商品库存（后端）</h2><h3 id="获得库存列表带条件"><a href="#获得库存列表带条件" class="headerlink" title="获得库存列表带条件"></a>获得库存列表带条件</h3><blockquote><p>同样</p></blockquote><h2 id="库存系统—采购需求（后端）"><a href="#库存系统—采购需求（后端）" class="headerlink" title="库存系统—采购需求（后端）"></a>库存系统—采购需求（后端）</h2><h3 id="获得需求列表带条件"><a href="#获得需求列表带条件" class="headerlink" title="获得需求列表带条件"></a>获得需求列表带条件</h3><blockquote><p>同样</p></blockquote><h3 id="获得未领取的采购单列表"><a href="#获得未领取的采购单列表" class="headerlink" title="获得未领取的采购单列表"></a>获得未领取的采购单列表</h3><blockquote><p>将多个采购需求合并到一个采购单当中（并且该采购单未被领取）</p></blockquote><h4 id="PurchaseController"><a href="#PurchaseController" class="headerlink" title="PurchaseController"></a>PurchaseController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;ware/purchase&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PurchaseService purchaseService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有未被领取（或新建）的采购单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/unreceive/list&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;ware:purchase:list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">unreceiveList</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">        PageUtils page = purchaseService.queryPageUnreceive(params);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="PurchaseServiceImpl"><a href="#PurchaseServiceImpl" class="headerlink" title="PurchaseServiceImpl"></a>PurchaseServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;purchaseService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">PurchaseDao</span>, <span class="title">PurchaseEntity</span>&gt; <span class="keyword">implements</span> <span class="title">PurchaseService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有未被领取（或新建）的采购单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryPageUnreceive</span><span class="params">(Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">        QueryWrapper&lt;PurchaseEntity&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;status&quot;</span>, <span class="number">0</span>).or().eq(<span class="string">&quot;status&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        IPage&lt;PurchaseEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">                <span class="keyword">new</span> Query&lt;PurchaseEntity&gt;().getPage(params),</span><br><span class="line">                queryWrapper</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="合并采购单"><a href="#合并采购单" class="headerlink" title="合并采购单"></a>合并采购单</h3><blockquote><p>如果前端没有传递采购单的id那么就新建一个采购单</p></blockquote><h4 id="WareConstant"><a href="#WareConstant" class="headerlink" title="WareConstant"></a>WareConstant</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WareConstant</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">PurchaseStatusEnum</span> </span>&#123;</span><br><span class="line">        CREATED(<span class="number">0</span>, <span class="string">&quot;新建&quot;</span>), ASSIGN(<span class="number">1</span>, <span class="string">&quot;已分配&quot;</span>), RECEIVE(<span class="number">2</span>, <span class="string">&quot;已领取&quot;</span>), FINISHED(<span class="number">3</span>, <span class="string">&quot;已完成&quot;</span>), HASERROR(<span class="number">4</span>, <span class="string">&quot;异常&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String msg;</span><br><span class="line">        PurchaseStatusEnum(<span class="keyword">int</span> code, String msg) &#123;</span><br><span class="line">            <span class="keyword">this</span>.code = code;</span><br><span class="line">            <span class="keyword">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">PurchaseDetailStatusEnum</span> </span>&#123;</span><br><span class="line">        CREATED(<span class="number">0</span>, <span class="string">&quot;新建&quot;</span>), ASSIGN(<span class="number">1</span>, <span class="string">&quot;已分配&quot;</span>), BUYYING(<span class="number">2</span>, <span class="string">&quot;正在采购&quot;</span>), FINISHED(<span class="number">3</span>, <span class="string">&quot;已完成&quot;</span>), HASERROR(<span class="number">4</span>, <span class="string">&quot;异常&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">        PurchaseDetailStatusEnum(<span class="keyword">int</span> code, String msg) &#123;</span><br><span class="line">            <span class="keyword">this</span>.code = code;</span><br><span class="line">            <span class="keyword">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="MergeVo"><a href="#MergeVo" class="headerlink" title="MergeVo"></a>MergeVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 合并采购单请求对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MergeVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long purchaseId;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; items;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="PurchaseController-1"><a href="#PurchaseController-1" class="headerlink" title="PurchaseController"></a>PurchaseController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;ware/purchase&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PurchaseService purchaseService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 合并采购单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/merge&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">merge</span><span class="params">(<span class="meta">@RequestBody</span> MergeVo mergeVo)</span> </span>&#123;  <span class="comment">//@RequestBody请求体中的JSON，@RequestParam是url?后跟的键值对，@PathVariable是REST风格url中的&#123;&#125;变量</span></span><br><span class="line">        purchaseService.mergePurchase(mergeVo);</span><br><span class="line">        <span class="keyword">return</span> R.ok()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="PurchaseServiceImpl-1"><a href="#PurchaseServiceImpl-1" class="headerlink" title="PurchaseServiceImpl"></a>PurchaseServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 合并采购单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mergePurchase</span><span class="params">(MergeVo mergeVo)</span> </span>&#123;</span><br><span class="line">    Long purchaseId = mergeVo.getPurchaseId();</span><br><span class="line">    <span class="keyword">if</span> (purchaseId == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 没有采购单id，那么需要新建</span></span><br><span class="line">        PurchaseEntity purchaseEntity = <span class="keyword">new</span> PurchaseEntity();</span><br><span class="line">        purchaseEntity.setStatus(WareConstant.PurchaseStatusEnum.CREATED.getCode());</span><br><span class="line">        <span class="keyword">this</span>.save(purchaseEntity);</span><br><span class="line">        purchaseId = purchaseEntity.getId();</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;Long&gt; items = mergeVo.getItems();</span><br><span class="line">    Long finalPurchaseId = purchaseId;</span><br><span class="line">    <span class="comment">// 将采购需求id集合对应对象修改状态和采购单id</span></span><br><span class="line">    List&lt;PurchaseDetailEntity&gt; detailEntities = items.stream().map(detailId -&gt; &#123;</span><br><span class="line">        PurchaseDetailEntity detailEntity = <span class="keyword">new</span> PurchaseDetailEntity();</span><br><span class="line">        detailEntity.setId(detailId);</span><br><span class="line">        detailEntity.setPurchaseId(finalPurchaseId);</span><br><span class="line">        detailEntity.setStatus(WareConstant.PurchaseDetailStatusEnum.ASSIGN.getCode());</span><br><span class="line">        <span class="keyword">return</span> detailEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    detailService.updateBatchById(detailEntities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="领取采购单"><a href="#领取采购单" class="headerlink" title="领取采购单"></a>领取采购单</h3><h4 id="PurchaseController-2"><a href="#PurchaseController-2" class="headerlink" title="PurchaseController"></a>PurchaseController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;ware/purchase&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PurchaseService purchaseService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 领取采购单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/received&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">received</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;Long&gt; ids)</span> </span>&#123;</span><br><span class="line">        purchaseService.receivedByIds(ids);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="PurchaseServiceImpl-2"><a href="#PurchaseServiceImpl-2" class="headerlink" title="PurchaseServiceImpl"></a>PurchaseServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 领取采购单</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receivedByIds</span><span class="params">(List&lt;Long&gt; ids)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 判断是否为新建或者已分配（给当前用户，但是这里涉及权限）</span></span><br><span class="line">      <span class="comment">// 改变采购单状态</span></span><br><span class="line">      List&lt;PurchaseEntity&gt; purchaseEntityList = ids.stream().map(id -&gt; &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">this</span>.getById(id);</span><br><span class="line">      &#125;).filter(item -&gt; &#123;</span><br><span class="line">          Integer status = item.getStatus();</span><br><span class="line">          <span class="keyword">return</span> (status == WareConstant.PurchaseStatusEnum.ASSIGN.getCode()) || status == WareConstant.PurchaseStatusEnum.CREATED.getCode();</span><br><span class="line">      &#125;).map(purchaseEntity -&gt; &#123;</span><br><span class="line">          purchaseEntity.setStatus(WareConstant.PurchaseStatusEnum.RECEIVE.getCode());</span><br><span class="line">          <span class="keyword">return</span> purchaseEntity;</span><br><span class="line">      &#125;).collect(Collectors.toList());</span><br><span class="line">      <span class="keyword">this</span>.updateBatchById(purchaseEntityList);</span><br><span class="line">      <span class="comment">// 改变采购项状态</span></span><br><span class="line">      purchaseEntityList.forEach(purchaseEntity -&gt; &#123;</span><br><span class="line">          List&lt;PurchaseDetailEntity&gt; detailEntityList = detailService.list(<span class="keyword">new</span> QueryWrapper&lt;PurchaseDetailEntity&gt;().eq(<span class="string">&quot;purchase_id&quot;</span>, purchaseEntity.getId()));</span><br><span class="line">          List&lt;PurchaseDetailEntity&gt; list = detailEntityList.stream().map(detail -&gt; &#123;</span><br><span class="line">              PurchaseDetailEntity detailEntity = <span class="keyword">new</span> PurchaseDetailEntity();</span><br><span class="line">              detailEntity.setId(detail.getId());</span><br><span class="line">              detailEntity.setStatus(WareConstant.PurchaseDetailStatusEnum.ASSIGN.getCode());</span><br><span class="line">              <span class="keyword">return</span> detailEntity;</span><br><span class="line">          &#125;).collect(Collectors.toList());</span><br><span class="line">          detailService.updateBatchById(list);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="完成采购"><a href="#完成采购" class="headerlink" title="完成采购"></a>完成采购</h3><blockquote><p>自动修改对应采购内容的库存数</p></blockquote><h4 id="PurchaseDoneItemVo"><a href="#PurchaseDoneItemVo" class="headerlink" title="PurchaseDoneItemVo"></a>PurchaseDoneItemVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成采购单的请求item</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseDoneItemVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long itemId;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="keyword">private</span> String reason;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="PurchaseFinishedVo"><a href="#PurchaseFinishedVo" class="headerlink" title="PurchaseFinishedVo"></a>PurchaseFinishedVo</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseFinishedVo</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *采购单id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *采购项</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;PurchaseDoneItemVo&gt; items;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="PurchaseController-3"><a href="#PurchaseController-3" class="headerlink" title="PurchaseController"></a>PurchaseController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;ware/purchase&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PurchaseController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PurchaseService purchaseService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 完成采购单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/done&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">finish</span><span class="params">(<span class="meta">@RequestBody</span> PurchaseFinishedVo finishedVo)</span> </span>&#123;</span><br><span class="line">        purchaseService.finishPurchase(finishedVo);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="PurchaseServiceImpl-3"><a href="#PurchaseServiceImpl-3" class="headerlink" title="PurchaseServiceImpl"></a>PurchaseServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成采购单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finishPurchase</span><span class="params">(PurchaseFinishedVo finishedVo)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1 改变采购项状态</span></span><br><span class="line">    <span class="keyword">boolean</span> purchaseFinished = <span class="keyword">true</span>;</span><br><span class="line">    List&lt;PurchaseDetailEntity&gt; updatedDetailList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    List&lt;PurchaseDoneItemVo&gt; doneItemVoList = finishedVo.getItems();</span><br><span class="line">    <span class="keyword">for</span> (PurchaseDoneItemVo doneItemVo : doneItemVoList) &#123;</span><br><span class="line">        PurchaseDetailEntity detailEntity = <span class="keyword">new</span> PurchaseDetailEntity();</span><br><span class="line">        <span class="keyword">if</span> (doneItemVo.getStatus() == WareConstant.PurchaseDetailStatusEnum.HASERROR.getCode()) &#123;</span><br><span class="line">            <span class="comment">// 如果有一个采购项异常，则采购单状态未完成</span></span><br><span class="line">            purchaseFinished = <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 3 将成功采购的采购项修改库存信息</span></span><br><span class="line">            PurchaseDetailEntity detail = detailService.getById(doneItemVo.getItemId());</span><br><span class="line">            wareSkuService.addStock(detail.getSkuId(), detail.getWareId(), detail.getSkuNum());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// TODO 判断采购数是否完成</span></span><br><span class="line">        detailEntity.setStatus(doneItemVo.getStatus());</span><br><span class="line">        detailEntity.setId(doneItemVo.getItemId());</span><br><span class="line">        updatedDetailList.add(detailEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    detailService.updateBatchById(updatedDetailList);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2 改变采购单状态(所有采购项都完成后才可完成，否则为异常)</span></span><br><span class="line">    PurchaseEntity purchaseEntity = <span class="keyword">new</span> PurchaseEntity();</span><br><span class="line">    purchaseEntity.setId(finishedVo.getId());</span><br><span class="line">    <span class="keyword">if</span> (purchaseFinished) &#123;</span><br><span class="line">        purchaseEntity.setStatus(WareConstant.PurchaseStatusEnum.FINISHED.getCode());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        purchaseEntity.setStatus(WareConstant.PurchaseStatusEnum.HASERROR.getCode());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.updateById(purchaseEntity);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="WareSkuServiceImpl"><a href="#WareSkuServiceImpl" class="headerlink" title="WareSkuServiceImpl"></a>WareSkuServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *将成功采购的采购项修改库存信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addStock</span><span class="params">(Long skuId, Long wareId, Integer skuNum)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 判断是否有该库存，没有则新增</span></span><br><span class="line">    Integer count = baseMapper.selectCount(<span class="keyword">new</span> QueryWrapper&lt;WareSkuEntity&gt;().eq(<span class="string">&quot;sku_id&quot;</span>, skuId).eq(<span class="string">&quot;ware_id&quot;</span>, wareId));</span><br><span class="line">    <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">        WareSkuEntity wareSkuEntity = <span class="keyword">new</span> WareSkuEntity();</span><br><span class="line">        wareSkuEntity.setSkuId(skuId);</span><br><span class="line">        wareSkuEntity.setWareId(wareId);</span><br><span class="line">        wareSkuEntity.setStock(skuNum);</span><br><span class="line">        baseMapper.insert(wareSkuEntity);</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">        baseMapper.addStock(skuId, wareId, skuNum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="WareSkuDao"><a href="#WareSkuDao" class="headerlink" title="WareSkuDao"></a>WareSkuDao</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 将成功采购的采购项修改库存信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;addStock&quot;</span>&gt;</span></span><br><span class="line">    UPDATE gulimall_wms.wms_ware_sku</span><br><span class="line">    SET stock = stock + #&#123;skuNum&#125;</span><br><span class="line">    WHERE sku_id = #&#123;skuId&#125;</span><br><span class="line">      AND ware_id = #&#123;wareId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="商品维护—SKU规格维护（后端）"><a href="#商品维护—SKU规格维护（后端）" class="headerlink" title="商品维护—SKU规格维护（后端）"></a>商品维护—SKU规格维护（后端）</h2><blockquote><p>这是一个按钮触发的页面，具体解决方案如下</p><p><a href="https://www.cnblogs.com/nio-nio/p/13740598.html">谷粒商城踩坑汇总（分布式基础（全栈开发篇）） - 大厨无盐煮 - 博客园 (cnblogs.com)</a></p></blockquote><h3 id="获取"><a href="#获取" class="headerlink" title="获取"></a>获取</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AttrService attrService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductAttrValueService valueService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查出商品的规格属性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/base/listforspu/&#123;spuId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">baseAttrListForSpu</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span> Long spuId)</span> </span>&#123;</span><br><span class="line">        List&lt;ProductAttrValueEntity&gt; data = valueService.baseAttrListForSpu(spuId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, data);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;productAttrValueService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductAttrValueServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">ProductAttrValueDao</span>, <span class="title">ProductAttrValueEntity</span>&gt; <span class="keyword">implements</span> <span class="title">ProductAttrValueService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ProductAttrValueEntity&gt; <span class="title">baseAttrListForSpu</span><span class="params">(Long spuId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> baseMapper.selectList(<span class="keyword">new</span> QueryWrapper&lt;ProductAttrValueEntity&gt;().eq(<span class="string">&quot;spu_id&quot;</span>, spuId));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="修改-1"><a href="#修改-1" class="headerlink" title="修改"></a>修改</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrController</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改,使用AttrRequestVo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/update/&#123;spuId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">updateSpuAttr</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span> String spuId,</span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="meta">@RequestBody</span> List&lt;ProductAttrValueEntity&gt; entities)</span> </span>&#123;</span><br><span class="line">        valueService.updateSpuAttr(spuId, entities);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改SPU的ATTr</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateSpuAttr</span><span class="params">(Long spuId, List&lt;ProductAttrValueEntity&gt; entities)</span> </span>&#123;</span><br><span class="line">    baseMapper.delete(<span class="keyword">new</span> QueryWrapper&lt;ProductAttrValueEntity&gt;().eq(<span class="string">&quot;spu_id&quot;</span>, spuId));</span><br><span class="line">    List&lt;ProductAttrValueEntity&gt; collect = entities.stream().map(item -&gt; &#123;</span><br><span class="line">        item.setSpuId(spuId);</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">this</span>.saveBatch(collect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="分布式基础篇—完结撒花🎉"><a href="#分布式基础篇—完结撒花🎉" class="headerlink" title="分布式基础篇—完结撒花🎉"></a>分布式基础篇—完结撒花🎉</h2><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031153716835.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211031153716835.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211031153716835"></p>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
            <tag> redis </tag>
            
            <tag> 微服务 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】商城项目实战2</title>
      <link href="/2021/10/16/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-2/"/>
      <url>/2021/10/16/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-2/</url>
      
        <content type="html"><![CDATA[<h2 id="品牌管理（后台）"><a href="#品牌管理（后台）" class="headerlink" title="品牌管理（后台）"></a>品牌管理（后台）</h2><blockquote><p>商品系统下的品牌管理，数据库表对应product-brand</p></blockquote><h3 id="使用逆向工程"><a href="#使用逆向工程" class="headerlink" title="使用逆向工程"></a>使用逆向工程</h3><blockquote><ol><li>先使用人人快速开发平台，系统管理—&gt;菜单管理—&gt;添加菜单</li><li>使用renren-generator逆向生成工程（之前已经做过了）</li><li>复制粘贴其中resource下的modules文件夹下的视图模板（我qiao这么棒的吗）</li><li>视图模板这里可以先把权限管理删除（v-if=”isAuth”），或者去index.js中的isAuth方法返回TRUE</li><li>增删改查都写好了（还可以这样我qiao）</li></ol></blockquote><h3 id="关闭语法检查"><a href="#关闭语法检查" class="headerlink" title="关闭语法检查"></a>关闭语法检查</h3><blockquote><p>build -&gt; webpack.base.conf.js -&gt; createLintingRule方法中注释即可</p><p>？我发现我注释掉之后会报错，所以还是用我之前那个方法</p></blockquote><h3 id="优化列显示开关按钮"><a href="#优化列显示开关按钮" class="headerlink" title="优化列显示开关按钮"></a>优化列显示开关按钮</h3><h4 id="element-ui组件"><a href="#element-ui组件" class="headerlink" title="element-ui组件"></a>element-ui组件</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211016180038613.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211016180038613.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211016180038613"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211016180640279.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211016180640279.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211016180640279"></p><h4 id="按钮事件"><a href="#按钮事件" class="headerlink" title="按钮事件"></a>按钮事件</h4><blockquote><p>绑定change事件</p><p>注意showStatus在数据库中是int类型，所以需要判断转换一下（但是直接把Switch的active-value换成10就不用再转换了）</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table-column</span><br><span class="line">      prop=&quot;showStatus&quot;</span><br><span class="line">      header-align=&quot;center&quot;</span><br><span class="line">      align=&quot;center&quot;</span><br><span class="line">      label=&quot;显示状态&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">&lt;el-switch</span><br><span class="line">          v-model=&quot;scope.row.showStatus&quot;</span><br><span class="line">          active-color=&quot;#13ce66&quot;</span><br><span class="line">          inactive-color=&quot;#ff4949&quot;</span><br><span class="line">          :active-value=&quot;1&quot;</span><br><span class="line">          :inactive-value=&quot;0&quot;</span><br><span class="line">          @change=&quot;updateBrandStatus(scope.row)&quot;</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;/el-switch&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 改变状态</span></span><br><span class="line">    <span class="function"><span class="title">updateBrandStatus</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;当前scope.row：&quot;</span>, data);</span><br><span class="line">      <span class="comment">// 解构</span></span><br><span class="line">      <span class="keyword">let</span> &#123; brandId, showStatus &#125; = data;</span><br><span class="line">      <span class="comment">// 发送请求修改状态</span></span><br><span class="line">      <span class="built_in">this</span>.$http(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="built_in">this</span>.$http.adornUrl(<span class="string">&quot;/product/brand/update&quot;</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="built_in">this</span>.$http.adornData(&#123; brandId, showStatus &#125;, <span class="literal">false</span>)</span><br><span class="line">      &#125;).then(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;状态更新成功&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="云存储服务（文件上传前后端）"><a href="#云存储服务（文件上传前后端）" class="headerlink" title="云存储服务（文件上传前后端）"></a>云存储服务（文件上传前后端）</h2><blockquote><p>老样子阿里云OSS，这里使用了子用户AK</p><p>文档：<a href="https://help.aliyun.com/document_detail/32009.html">安装 (aliyun.com)</a></p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/Snipaste_2021-10-16_18-51-32.jpg" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/Snipaste_2021-10-16_18-51-32.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Snipaste_2021-10-16_18-51-32"></p><h3 id="AliyunOSS"><a href="#AliyunOSS" class="headerlink" title="AliyunOSS"></a>AliyunOSS</h3><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h4><blockquote><p>下面是官网文档的demo</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span></span><br><span class="line">String endpoint = <span class="string">&quot;yourEndpoint&quot;</span>;</span><br><span class="line"><span class="comment">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span></span><br><span class="line">String accessKeyId = <span class="string">&quot;yourAccessKeyId&quot;</span>;</span><br><span class="line">String accessKeySecret = <span class="string">&quot;yourAccessKeySecret&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建OSSClient实例。</span></span><br><span class="line">OSS ossClient = <span class="keyword">new</span> OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 填写本地文件的完整路径。如果未指定本地路径，则默认从示例程序所属项目对应本地路径中上传文件流。</span></span><br><span class="line">InputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;D:\\localpath\\examplefile.txt&quot;</span>);</span><br><span class="line"><span class="comment">// 依次填写Bucket名称（例如examplebucket）和Object完整路径（例如exampledir/exampleobject.txt）。Object完整路径中不能包含Bucket名称。</span></span><br><span class="line">ossClient.putObject(<span class="string">&quot;examplebucket&quot;</span>, <span class="string">&quot;exampledir/exampleobject.txt&quot;</span>, inputStream);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭OSSClient。</span></span><br><span class="line">ossClient.shutdown();</span><br></pre></td></tr></table></figure><h4 id="子用户"><a href="#子用户" class="headerlink" title="子用户"></a>子用户</h4><blockquote><p>AK进入后创建子用户，然后分配权限（现在用到的权限就AliyunOSSFullAccess，用于读写）</p></blockquote><h3 id="SpringCloudAlibabaOSS"><a href="#SpringCloudAlibabaOSS" class="headerlink" title="SpringCloudAlibabaOSS"></a>SpringCloudAlibabaOSS</h3><blockquote><p>直接用</p><p>文档：<a href="https://github.com/ylh23y/spring-cloud-alibaba-component/blob/master/cloud-oss/README.md">spring-cloud-alibaba-component/README.md at master · ylh23y/spring-cloud-alibaba-component (github.com)</a></p></blockquote><h4 id="依赖-1"><a href="#依赖-1" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- springclcloud alibaba oss --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alicloud-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置application-yml"><a href="#配置application-yml" class="headerlink" title="配置application.yml"></a>配置application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># oss配置</span></span><br><span class="line">    <span class="attr">alicloud:</span></span><br><span class="line">      <span class="attr">access-key:</span></span><br><span class="line">      <span class="attr">secret-key:</span></span><br><span class="line">      <span class="attr">oss:</span></span><br><span class="line">        <span class="attr">endpoint:</span></span><br></pre></td></tr></table></figure><h3 id="服务端签名后上传（后端）"><a href="#服务端签名后上传（后端）" class="headerlink" title="服务端签名后上传（后端）"></a>服务端签名后上传（后端）</h3><blockquote><p>文档：<a href="https://help.aliyun.com/document_detail/31926.html">服务端签名后直传 (aliyun.com)</a></p></blockquote><h4 id="创建第三方服务模块"><a href="#创建第三方服务模块" class="headerlink" title="创建第三方服务模块"></a>创建第三方服务模块</h4><blockquote><p>创建专门的模块third-party</p><p>将上述的依赖改到这个第三方服务的模块中</p></blockquote><h4 id="依赖-2"><a href="#依赖-2" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.gulimall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gulimall-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 不使用数据库，要不然还要配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- springclcloud alibaba oss --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alicloud-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置nacos"><a href="#配置nacos" class="headerlink" title="配置nacos"></a>配置nacos</h4><blockquote><p>bootstrap.properties中配置</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#nacos注册和配置</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.namespace</span>=<span class="string">925cc47f-8b1d-4756-ba4d-c8da28f784c9</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.ext-config[0].data-id</span>=<span class="string">oss.yml</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.ext-config[0].group</span>=<span class="string">DEFAULT_GROUP</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.ext-config[0].refresh</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><h4 id="配置alicloud"><a href="#配置alicloud" class="headerlink" title="配置alicloud"></a>配置alicloud</h4><blockquote><p>在application.yml中，也可以在nacos配置中心配</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># nacos</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">    <span class="comment"># oss配置</span></span><br><span class="line">    <span class="attr">alicloud:</span></span><br><span class="line">      <span class="attr">access-key:</span></span><br><span class="line">      <span class="attr">secret-key:</span></span><br><span class="line">      <span class="attr">oss:</span></span><br><span class="line">        <span class="attr">endpoint:</span></span><br><span class="line">        <span class="attr">bucket:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-third-party</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">30000</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallThirdPartyApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OSSClient ossClient;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aliyunOssTest</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        InputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;C:\\Users\\卢荟\\Desktop\\谷粒电商\\1\\docs\\pics\\6a1b2703a9ed8737.jpg&quot;</span>);</span><br><span class="line">        <span class="comment">// 依次填写Bucket名称（例如examplebucket）和Object完整路径（例如exampledir/exampleobject.txt）。Object完整路径中不能包含Bucket名称。</span></span><br><span class="line">        ossClient.putObject(<span class="string">&quot;lh-demo-gulimall&quot;</span>, <span class="string">&quot;test2.jpg&quot;</span>, inputStream);</span><br><span class="line">        <span class="comment">// 关闭OSSClient。</span></span><br><span class="line">        ossClient.shutdown();</span><br><span class="line">        System.out.println(<span class="string">&quot;上传完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写OSSController"><a href="#编写OSSController" class="headerlink" title="编写OSSController"></a>编写OSSController</h4><blockquote><p>这里有一个点要注意，自动注入OSS接口，而不是OSSClient实现类</p><p>见P63，debug几秒钟绝了</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OssController</span> </span>&#123;</span><br><span class="line">     <span class="comment">// 这里debug好快啊，不愧是老师，</span></span><br><span class="line">    <span class="comment">// OSS接口，OSSClient是实现类已经写好的，要自动注入接口</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OSS ossClient;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.cloud.alicloud.oss.endpoint&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.cloud.alicloud.oss.bucket&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bucket;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.cloud.alicloud.access-key&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String accessId;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/oss/policy&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">policy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String host = <span class="string">&quot;https://&quot;</span> + bucket + <span class="string">&quot;.&quot;</span> + endpoint; <span class="comment">// host的格式为 bucketname.endpoint</span></span><br><span class="line">        <span class="comment">// callbackUrl为上传回调服务器的URL，请将下面的IP和Port配置为您自己的真实信息。</span></span><br><span class="line">        <span class="comment">// String callbackUrl = &quot;http://88.88.88.88:8888&quot;;</span></span><br><span class="line">        <span class="comment">// 以当前日期分类</span></span><br><span class="line">        String format = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>).format(<span class="keyword">new</span> Date());</span><br><span class="line">        String dir = format + <span class="string">&quot;/&quot;</span>; <span class="comment">// 用户上传文件时指定的前缀。</span></span><br><span class="line">        Map&lt;String, String&gt; respMap = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">long</span> expireTime = <span class="number">30</span>;</span><br><span class="line">            <span class="keyword">long</span> expireEndTime = System.currentTimeMillis() + expireTime * <span class="number">1000</span>;</span><br><span class="line">            Date expiration = <span class="keyword">new</span> Date(expireEndTime);</span><br><span class="line">            <span class="comment">// PostObject请求最大可支持的文件大小为5 GB，即CONTENT_LENGTH_RANGE为5*1024*1024*1024。</span></span><br><span class="line">            PolicyConditions policyConds = <span class="keyword">new</span> PolicyConditions();</span><br><span class="line">            policyConds.addConditionItem(PolicyConditions.COND_CONTENT_LENGTH_RANGE, <span class="number">0</span>, <span class="number">1048576000</span>);</span><br><span class="line">            policyConds.addConditionItem(MatchMode.StartWith, PolicyConditions.COND_KEY, dir);</span><br><span class="line">            String postPolicy = ossClient.generatePostPolicy(expiration, policyConds);</span><br><span class="line">            <span class="keyword">byte</span>[] binaryData = postPolicy.getBytes(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            String encodedPolicy = BinaryUtil.toBase64String(binaryData);</span><br><span class="line">            String postSignature = ossClient.calculatePostSignature(postPolicy);</span><br><span class="line">            respMap = <span class="keyword">new</span> LinkedHashMap&lt;String, String&gt;();</span><br><span class="line">            respMap.put(<span class="string">&quot;accessid&quot;</span>, accessId);</span><br><span class="line">            respMap.put(<span class="string">&quot;policy&quot;</span>, encodedPolicy);</span><br><span class="line">            respMap.put(<span class="string">&quot;signature&quot;</span>, postSignature);</span><br><span class="line">            respMap.put(<span class="string">&quot;dir&quot;</span>, dir);</span><br><span class="line">            respMap.put(<span class="string">&quot;host&quot;</span>, host);</span><br><span class="line">            respMap.put(<span class="string">&quot;expire&quot;</span>, String.valueOf(expireEndTime / <span class="number">1000</span>));</span><br><span class="line">            <span class="comment">// respMap.put(&quot;expire&quot;, formatISO8601Date(expiration));</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// Assert.fail(e.getMessage());</span></span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            ossClient.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, respMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>然后就可以通过访问<a href="http://localhost:30000/oss/policy">localhost:30000/oss/policy</a>获取签名等数据</p></blockquote><h4 id="配置网关application-yml"><a href="#配置网关application-yml" class="headerlink" title="配置网关application.yml"></a>配置网关application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">third_party_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://gulimall-third-party</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/thirdparty/**</span></span><br><span class="line">          <span class="comment"># 实现转发</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="comment"># localhost:88/api/thirdparty/oss/policy  -&gt;   localhost:30000/oss/policy</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/thirdparty/(?&lt;segment&gt;.*),/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure><h3 id="文件上传（前端）"><a href="#文件上传（前端）" class="headerlink" title="文件上传（前端）"></a>文件上传（前端）</h3><blockquote><p>资料里有封装好的模板，放入component，将其中el-upload中action属性值改为oss bucket的域名</p></blockquote><h4 id="vue"><a href="#vue" class="headerlink" title="vue"></a>vue</h4><blockquote><p>使用上述组件</p><p>注意这里component里面的名字要和import对应，要不然不报错还显示不出来问题（差点吓死我）</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form-item label=&quot;品牌logo地址&quot; prop=&quot;logo&quot;&gt;</span><br><span class="line">    &lt;singleUpload v-model=&quot;dataForm.logo&quot;&gt; &lt;/singleUpload&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import singleUpload from &quot;@/components/upload/singleUpload&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123; singleUpload &#125;,</span><br></pre></td></tr></table></figure><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211016202334228.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211016202334228.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211016202334228"></p><h4 id="开启跨域"><a href="#开启跨域" class="headerlink" title="开启跨域"></a>开启跨域</h4><blockquote><p>OSS控制台里进入bucket，创建规则</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211016203829738.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211016203829738.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211016203829738"></p><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><blockquote><p>OK，主要实现可以去看组件里的实现</p></blockquote><h2 id="表单数据校验（前端）"><a href="#表单数据校验（前端）" class="headerlink" title="表单数据校验（前端）"></a>表单数据校验（前端）</h2><h3 id="优化列表显示"><a href="#优化列表显示" class="headerlink" title="优化列表显示"></a>优化列表显示</h3><blockquote><p>logo显示图片</p></blockquote><h3 id="表单校验"><a href="#表单校验" class="headerlink" title="表单校验"></a>表单校验</h3><blockquote><p>使用element-ui的表单验证，自定义校验规则</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211017103945172.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211017103945172.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211017103945172"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;检索首字母&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;firstLetter&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">         <span class="attr">v-model</span>=<span class="string">&quot;dataForm.firstLetter&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">placeholder</span>=<span class="string">&quot;检索首字母&quot;</span></span></span><br><span class="line"><span class="tag">       &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;排序&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;sort&quot;</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- v-model.number只允许输入数字类型 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model.number</span>=<span class="string">&quot;dataForm.sort&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;排序&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">dataRule</span>: &#123;</span><br><span class="line">        <span class="attr">firstLetter</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">// 自定义验证规则，使用validator，后跟箭头函数定义规则，也可以写到data中</span></span><br><span class="line">            <span class="attr">validator</span>: <span class="function">(<span class="params">rule, value, callback</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (value === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;首字母必须填写&quot;</span>));</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="regexp">/^[a-zA-Z]$/</span>.test(value)) &#123;</span><br><span class="line">                <span class="comment">// 使用正则表达式判断是否为a-z A-Z</span></span><br><span class="line">                callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;首字母必须a-z或者A-Z之间的单个字母&quot;</span>));</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                callback();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">sort</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">validator</span>: <span class="function">(<span class="params">rule, value, callback</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (value === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;排序字段必须填写&quot;</span>));</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">Number</span>.isInteger(value)) &#123;</span><br><span class="line">                callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;请输入数字值&quot;</span>));</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;排序字段必须大于0&quot;</span>));</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                callback();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h2 id="表单数据校验（后端）"><a href="#表单数据校验（后端）" class="headerlink" title="表单数据校验（后端）"></a>表单数据校验（后端）</h2><h3 id="普通校验"><a href="#普通校验" class="headerlink" title="普通校验"></a>普通校验</h3><h4 id="Bean校验注解-校验规则"><a href="#Bean校验注解-校验规则" class="headerlink" title="Bean校验注解 校验规则"></a>Bean校验注解 校验规则</h4><blockquote><p>@xxx    javax.validation.constraints下的注解，用于定义校验规则</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;pms_brand&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 品牌id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 品牌名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotEmpty</span>       <span class="comment">// 验证规则，String类型非空</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;品牌名不能为空&quot;)</span>    <span class="comment">// 验证规则，至少包含一个非空字符，msg为出错时的提示信息</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 品牌logo地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotEmpty</span></span><br><span class="line">    <span class="meta">@URL(message = &quot;LOGO必须是合法的URL地址&quot;)</span>    <span class="comment">// 验证规则，必须是url</span></span><br><span class="line">    <span class="keyword">private</span> String logo;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 介绍</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotEmpty</span></span><br><span class="line">    <span class="keyword">private</span> String descript;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示状态[0-不显示；1-显示]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull</span>           <span class="comment">// 验证规则，Integer类型非空</span></span><br><span class="line">    <span class="keyword">private</span> Integer showStatus;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检索首字母</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotEmpty</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;/^[a-zA-Z]$/&quot;, message = &quot;检索字母必须是a-z或者A-Z中的单个字母&quot;)</span>    <span class="comment">// 使用自定义校验规则，可以写正则表达式</span></span><br><span class="line">    <span class="keyword">private</span> String firstLetter;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotEmpty</span></span><br><span class="line">    <span class="meta">@Min(value = 0)</span> <span class="comment">// 验证规则，最小不能小于value</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Controller校验注解-开启校验"><a href="#Controller校验注解-开启校验" class="headerlink" title="Controller校验注解 开启校验"></a>Controller校验注解 开启校验</h4><blockquote><p>@Valid    开启校验</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/brand&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BrandService brandService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:brand:save&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span> </span>&#123;</span><br><span class="line">        brandService.save(brand);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取校验结果"><a href="#获取校验结果" class="headerlink" title="获取校验结果"></a>获取校验结果</h4><blockquote><p>BindingResult result封装了紧跟着的对象的校验结果</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="comment">//BindingResult result封装了紧跟着的对象的校验结果</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> BrandEntity brand, BindingResult result)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 判断校验是否出错</span></span><br><span class="line">        <span class="keyword">if</span> (result.hasErrors()) &#123;</span><br><span class="line">            Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            <span class="comment">// 获取校验结果并且封装到map</span></span><br><span class="line">            result.getFieldErrors().forEach((fieldError) -&gt; &#123;</span><br><span class="line">                String message = fieldError.getDefaultMessage();</span><br><span class="line">                String fieldName = fieldError.getField();</span><br><span class="line">                map.put(fieldName, message);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="number">400</span>, <span class="string">&quot;递交的数据不合法&quot;</span>).put(<span class="string">&quot;data&quot;</span>, map);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            brandService.save(brand);</span><br><span class="line">            <span class="keyword">return</span> R.ok();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这个写法可以使用统一异常处理类解决</p></blockquote><h3 id="JSR303分组校验"><a href="#JSR303分组校验" class="headerlink" title="JSR303分组校验"></a>JSR303分组校验</h3><blockquote><p>设想brandId，有两种情况：一是新增，二是修改。当新增的时候我们不需要传入id，而修改的时候需要，那这个时候就需要用到分组校验。</p></blockquote><h4 id="编写接口"><a href="#编写接口" class="headerlink" title="编写接口"></a>编写接口</h4><blockquote><p>使用valid中的注解，里面有一个属性group用于分组，后跟接口类型（只是用于标识区别，接口中不比写代码）</p></blockquote><h4 id="Bean校验注释-带分组"><a href="#Bean校验注释-带分组" class="headerlink" title="Bean校验注释 带分组"></a>Bean校验注释 带分组</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 品牌id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NotNull(message = &quot;修改必须指定id&quot;, groups = &#123;UpdateGroup.class&#125;)</span></span><br><span class="line"><span class="meta">@Null(message = &quot;新增不能指定id&quot;, groups = &#123;AddGroup.class&#125;)</span></span><br><span class="line"><span class="meta">@TableId</span></span><br><span class="line"><span class="keyword">private</span> Long brandId;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 品牌名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NotEmpty</span>       <span class="comment">// 验证规则，String类型非空</span></span><br><span class="line"><span class="meta">@NotBlank(message = &quot;品牌名不能为空&quot;,, groups = &#123;AddGroup.class, UpdateGroup.class&#125;)</span>    <span class="comment">// 验证规则，至少包含一个非空字符，msg为出错时的提示信息</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure><blockquote><p>没有指定group的默认不校验（如果是使用了@Validated({XXX.class})分组校验的情况下）</p></blockquote><h4 id="Controller校验注释-带分组"><a href="#Controller校验注释-带分组" class="headerlink" title="Controller校验注释 带分组"></a>Controller校验注释 带分组</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="comment">//BindingResult result封装了紧跟着的对象的校验结果</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(<span class="meta">@Validated(&#123;AddGroup.class&#125;)</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用统一异常处理，当有异常的时候直接抛出异常即可</span></span><br><span class="line">    brandService.save(brand);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自定义校验注解"><a href="#自定义校验注解" class="headerlink" title="自定义校验注解"></a>自定义校验注解</h3><h4 id="依赖-3"><a href="#依赖-3" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  validation  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置文件ValidationMessages-properties"><a href="#配置文件ValidationMessages-properties" class="headerlink" title="配置文件ValidationMessages.properties"></a>配置文件ValidationMessages.properties</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">com.atguigu.common.valid.ListValue.message</span>=<span class="string">必须提交指定的值</span></span><br></pre></td></tr></table></figure><blockquote><p>别的也可以写在这里面</p></blockquote><h4 id="自定义校验器ListValueConstraintValidator"><a href="#自定义校验器ListValueConstraintValidator" class="headerlink" title="自定义校验器ListValueConstraintValidator"></a>自定义校验器ListValueConstraintValidator</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义校验器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// ConstraintValidator接口《校验注解名，字段名》</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListValueConstraintValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span>&lt;<span class="title">ListValue</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Integer&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(ListValue constraintAnnotation)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] vals = constraintAnnotation.vals();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> val : vals) &#123;</span><br><span class="line">            set.add(val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断是否校验成功(是否包含在注解的val值中)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(Integer value, ConstraintValidatorContext context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> set.contains(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="自定义校验注解ListValue"><a href="#自定义校验注解ListValue" class="headerlink" title="自定义校验注解ListValue"></a>自定义校验注解ListValue</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = &#123;ListValueConstraintValidator.class&#125;)</span> <span class="comment">// 放入自定义校验器</span></span><br><span class="line"><span class="meta">@Target(&#123;METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ListValue &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 需要从配置文件中获取</span></span><br><span class="line">    <span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> &quot;</span>&#123;com.atguigu.common.valid.ListValue.message&#125;<span class="string">&quot;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Class&lt;?&gt;[] groups() default &#123;&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Class&lt;? extends Payload&gt;[] payload() default &#123;&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    int[] vals() default &#123;&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="Bean注解"><a href="#Bean注解" class="headerlink" title="Bean注解"></a>Bean注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示状态[0-不显示；1-显示]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NotNull(message = &quot;必须指定显示状态[0-不显示；1-显示]&quot;, groups = &#123;AddGroup.class, UpdateGroup.class&#125;)</span>    <span class="comment">// 验证规则，Integer类型非空</span></span><br><span class="line"><span class="meta">@ListValue(vals = &#123;0, 1&#125;, groups = &#123;AddGroup.class&#125;)</span><span class="comment">// 自定义验证规则，必须为0或1</span></span><br><span class="line"><span class="keyword">private</span> Integer showStatus;</span><br></pre></td></tr></table></figure><h4 id="controller注解"><a href="#controller注解" class="headerlink" title="controller注解"></a>controller注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="comment">//BindingResult result封装了紧跟着的对象的校验结果</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(<span class="meta">@Validated(&#123;AddGroup.class&#125;)</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用统一异常处理，当有异常的时候直接抛出异常即可</span></span><br><span class="line">    brandService.save(brand);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="统一异常处理"><a href="#统一异常处理" class="headerlink" title="统一异常处理"></a>统一异常处理</h2><blockquote><p>上述不同结果不同返回，可以使用统一异常处理解决重复代码的编写问题</p></blockquote><h3 id="统一异常处理类"><a href="#统一异常处理类" class="headerlink" title="统一异常处理类"></a>统一异常处理类</h3><blockquote><p>使用两个注解@RestControllerAdvice+@ExceptionHandler</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统一异常处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@Slf4j</span>  <span class="comment">// 日志</span></span><br><span class="line"><span class="meta">@RestControllerAdvice(basePackages = &quot;com.atguigu.gulimall.product.controller&quot;)</span></span><br><span class="line"><span class="comment">// 标志这是一个REST风格的ControllerAdvice，即增强的controller，可以用于全局异常处理，后跟需要处理的包名</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallExceptionControllerAdvice</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = MethodArgumentNotValidException.class)</span>  <span class="comment">// 异常处理，value为指定处理的异常</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">handleValidException</span><span class="params">(MethodArgumentNotValidException e)</span> </span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;数据校验有误&#123;&#125;,异常类型&#123;&#125;&quot;</span>, e.getMessage(), e.getClass()); <span class="comment">// 用于测试，先写Exception然后主动出错,就可以获得异常的类型</span></span><br><span class="line">        Map&lt;String, String&gt; errorMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        BindingResult bindingResult = e.getBindingResult();</span><br><span class="line">        bindingResult.getFieldErrors().forEach((item) -&gt; &#123;</span><br><span class="line">            errorMap.put(item.getField(), item.getDefaultMessage());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="number">400</span>, <span class="string">&quot;数据校验有误&quot;</span>).put(<span class="string">&quot;data&quot;</span>, errorMap);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>则controller中的方法不再需要进行判断，出现异常后统一抛出给这个类处理</p></blockquote><h3 id="系统错误码（枚举）"><a href="#系统错误码（枚举）" class="headerlink" title="系统错误码（枚举）"></a>系统错误码（枚举）<img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211017115214372.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211017115214372.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211017115214372"></h3><blockquote><p>可以写一个枚举，放在common里面</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 枚举，错误码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">BizCodeEnum</span> </span>&#123;</span><br><span class="line">    UNKNOWN_EXCEPTION(<span class="number">10000</span>, <span class="string">&quot;系统未知异常&quot;</span>),</span><br><span class="line">    VALID_EXCEPTION(<span class="number">10001</span>, <span class="string">&quot;参数格式校验失败&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    BizCodeEnum(<span class="keyword">int</span> code, String msg) &#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="统一异常处理类（使用错误码）"><a href="#统一异常处理类（使用错误码）" class="headerlink" title="统一异常处理类（使用错误码）"></a>统一异常处理类（使用错误码）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统一异常处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@Slf4j</span>  <span class="comment">// 日志</span></span><br><span class="line"><span class="meta">@RestControllerAdvice(basePackages = &quot;com.atguigu.gulimall.product.controller&quot;)</span></span><br><span class="line"><span class="comment">// 标志这是一个REST风格的ControllerAdvice，即增强的controller，可以用于全局异常处理，后跟需要处理的包名</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallExceptionControllerAdvice</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = MethodArgumentNotValidException.class)</span>  <span class="comment">// 异常处理，value为指定处理的异常</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">handleValidException</span><span class="params">(MethodArgumentNotValidException e)</span> </span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;数据校验有误&#123;&#125;,异常类型&#123;&#125;&quot;</span>, e.getMessage(), e.getClass()); <span class="comment">// 用于测试，先写Exception然后主动出错,就可以获得异常的类型</span></span><br><span class="line">        Map&lt;String, String&gt; errorMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        BindingResult bindingResult = e.getBindingResult();</span><br><span class="line">        bindingResult.getFieldErrors().forEach((item) -&gt; &#123;</span><br><span class="line">            errorMap.put(item.getField(), item.getDefaultMessage());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnum.VALID_EXCEPTION.getCode(), BizCodeEnum.VALID_EXCEPTION.getMsg()).put(<span class="string">&quot;data&quot;</span>, errorMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = Throwable.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">handleException</span><span class="params">(Throwable throwable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnum.UNKNOWN_EXCEPTION.getCode(), BizCodeEnum.UNKNOWN_EXCEPTION.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="属性分组（前后端）"><a href="#属性分组（前后端）" class="headerlink" title="属性分组（前后端）"></a>属性分组（前后端）</h2><h3 id="SKU-amp-SPU-amp-规则参数-amp-销售属性"><a href="#SKU-amp-SPU-amp-规则参数-amp-销售属性" class="headerlink" title="SKU &amp; SPU &amp; 规则参数 &amp; 销售属性"></a>SKU &amp; SPU &amp; 规则参数 &amp; 销售属性</h3><blockquote><p>SPU： Standard Product Unit（标准化产品单元）<br>是商品信息聚合的最小单位， 是一组可复用、 易检索的标准化信息的集合， 该集合描述了一<br>个产品的特性。  </p><p>SKU： Stock Keeping Unit（库存量单位）<br>即库存进出计量的基本单元， 可以是以件， 盒， 托盘等为单位。 SKU 这是对于大型连锁超市<br>DC（配送中心） 物流管理的一个必要的方法。 现在已经被引申为产品统一编号的简称， 每<br>种产品均对应有唯一的 SKU 号。  </p><p>每个分类下的商品共享规格参数， 与销售属性。 只是有些商品不一定要用这个分类下全部的<br>属性；</p><ul><li>属性是以三级分类组织起来的</li><li>规格参数中有些是可以提供检索的</li><li>规格参数也是基本属性， 他们具有自己的分组</li><li>属性的分组也是以三级分类组织起来的</li><li>属性名确定的， 但是值是每一个商品不同来决定的  </li></ul></blockquote><h3 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h3><blockquote><p>P70</p></blockquote><h3 id="前端基础搭建"><a href="#前端基础搭建" class="headerlink" title="前端基础搭建"></a>前端基础搭建</h3><h4 id="创建menu"><a href="#创建menu" class="headerlink" title="创建menu"></a>创建menu</h4><blockquote><p>人人快速开发平台 —》系统管理 —》菜单管理 —》添加菜单</p></blockquote><h4 id="抽取三级分类"><a href="#抽取三级分类" class="headerlink" title="抽取三级分类"></a>抽取三级分类</h4><blockquote><p>把category中显示的部分拿出来，放到单独的vue中，然后在需要使用的vue中import组件，并且在component中声明，然后直接使用组件名标签即可</p></blockquote><h4 id="逆向工程"><a href="#逆向工程" class="headerlink" title="逆向工程"></a>逆向工程</h4><blockquote><p>生成attrgroup放到布局的右边，左边放三级分类</p></blockquote><h3 id="VUE父子组件传递数据"><a href="#VUE父子组件传递数据" class="headerlink" title="VUE父子组件传递数据"></a>VUE父子组件传递数据</h3><h4 id="子组件-gt-父组件"><a href="#子组件-gt-父组件" class="headerlink" title="子组件-&gt;父组件"></a>子组件-&gt;父组件</h4><blockquote><p>使用事件机制，子组件给父组件发送时间并携带数据</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-tree</span><br><span class="line">    @node-click=&quot;nodeClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">  &lt;/el-tree&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 节点点击事件</span><br><span class="line">    nodeClick(data, node, component) &#123;</span><br><span class="line">      // 向父组件发送时间</span><br><span class="line">      this.$emit(&quot;tree-node-click&quot;, data, node, component);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;&quot;&gt;</span><br><span class="line">    &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">      &lt;el-col :span=&quot;6&quot;</span><br><span class="line">        &gt;&lt;category @tree-node-click=&quot;nodeClick&quot;&gt;&lt;/category</span><br><span class="line">      &gt;&lt;/el-col&gt;</span><br><span class="line">    &lt;/el-row&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 子组件事件响应</span><br><span class="line">    nodeClick(data, node, component) &#123;</span><br><span class="line">      console.log(&quot;父组件捕获事件并获取数据：&quot;, data, node, component);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="获取分类属性分组（后端）"><a href="#获取分类属性分组（后端）" class="headerlink" title="获取分类属性分组（后端）"></a>获取分类属性分组（后端）</h3><h4 id="AttrGroupController"><a href="#AttrGroupController" class="headerlink" title="AttrGroupController"></a>AttrGroupController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/list/&#123;catelogId&#125;&quot;)</span></span><br><span class="line"><span class="comment">//@RequiresPermissions(&quot;product:attrgroup:list&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">list</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params, <span class="meta">@PathVariable</span> Long catelogId)</span> </span>&#123;</span><br><span class="line">    PageUtils page = attrGroupService.queryPage(params, catelogId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AttrGroupServiceImpl"><a href="#AttrGroupServiceImpl" class="headerlink" title="AttrGroupServiceImpl"></a>AttrGroupServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (catelogId == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 未指定分类</span></span><br><span class="line">        IPage&lt;AttrGroupEntity&gt; page = <span class="keyword">this</span>.page(<span class="keyword">new</span> Query&lt;AttrGroupEntity&gt;().getPage(params), <span class="keyword">new</span> QueryWrapper&lt;&gt;());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// key是检索条件，已经封装好的</span></span><br><span class="line">        String key = (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        QueryWrapper&lt;AttrGroupEntity&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;AttrGroupEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId);</span><br><span class="line">        <span class="comment">// 如果有key,那么再加上and条件，条件中判断如下</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">            wrapper.and((obj) -&gt; &#123;</span><br><span class="line">                obj.eq(<span class="string">&quot;attr_group_id&quot;</span>, key).or().like(<span class="string">&quot;attr_group_name&quot;</span>, key);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        IPage&lt;AttrGroupEntity&gt; page = <span class="keyword">this</span>.page(<span class="keyword">new</span> Query&lt;AttrGroupEntity&gt;().getPage(params), wrapper);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="新增、修改分组-amp-级联选择器"><a href="#新增、修改分组-amp-级联选择器" class="headerlink" title="新增、修改分组 &amp; 级联选择器"></a>新增、修改分组 &amp; 级联选择器</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211017164803441.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211017164803441.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211017164803441"></p><h4 id="当字段为空时不返回空值"><a href="#当字段为空时不返回空值" class="headerlink" title="当字段为空时不返回空值"></a>当字段为空时不返回空值</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 子分类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_EMPTY)</span> <span class="comment">// 当该字段不为空时才返回字段kv</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span>    <span class="comment">// 表示该属性在数据表中不存在</span></span><br><span class="line"><span class="keyword">private</span> List&lt;CategoryEntity&gt; children;</span><br></pre></td></tr></table></figure><h4 id="新增分组"><a href="#新增分组" class="headerlink" title="新增分组"></a>新增分组</h4><blockquote><p>/#/product-attrgroup</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-dialog</span><br><span class="line">    :title=&quot;!dataForm.attrGroupId ? &#x27;新增&#x27; : &#x27;修改&#x27;&quot;</span><br><span class="line">    :close-on-click-modal=&quot;false&quot;</span><br><span class="line">    :visible.sync=&quot;visible&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;el-form</span><br><span class="line">      :model=&quot;dataForm&quot;</span><br><span class="line">      :rules=&quot;dataRule&quot;</span><br><span class="line">      ref=&quot;dataForm&quot;</span><br><span class="line">      @keyup.enter.native=&quot;dataFormSubmit()&quot;</span><br><span class="line">      label-width=&quot;80px&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form-item label=&quot;组名&quot; prop=&quot;attrGroupName&quot;&gt;</span><br><span class="line">        &lt;el-input</span><br><span class="line">          v-model=&quot;dataForm.attrGroupName&quot;</span><br><span class="line">          placeholder=&quot;组名&quot;</span><br><span class="line">        &gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;排序&quot; prop=&quot;sort&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;dataForm.sort&quot; placeholder=&quot;排序&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;描述&quot; prop=&quot;descript&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;dataForm.descript&quot; placeholder=&quot;描述&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;组图标&quot; prop=&quot;icon&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;dataForm.icon&quot; placeholder=&quot;组图标&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;所属分类id&quot; prop=&quot;catelogId&quot;&gt;</span><br><span class="line">        &lt;el-cascader</span><br><span class="line">          v-model=&quot;dataForm.catelogIds&quot;</span><br><span class="line">          :options=&quot;categorys&quot;</span><br><span class="line">          :props=&quot;props&quot;</span><br><span class="line">        &gt;&lt;/el-cascader&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">    &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">      &lt;el-button @click=&quot;visible = false&quot;&gt;取消&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;dataFormSubmit()&quot;&gt;确定&lt;/el-button&gt;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      categorys: [],</span><br><span class="line">      props: &#123;</span><br><span class="line">        value: &quot;catId&quot;,</span><br><span class="line">        label: &quot;name&quot;,</span><br><span class="line">        children: &quot;children&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      visible: false,</span><br><span class="line">      dataForm: &#123;</span><br><span class="line">        attrGroupId: 0,</span><br><span class="line">        attrGroupName: &quot;&quot;,</span><br><span class="line">        sort: &quot;&quot;,</span><br><span class="line">        descript: &quot;&quot;,</span><br><span class="line">        icon: &quot;&quot;,</span><br><span class="line">        catelogIds: [],</span><br><span class="line">        catelogId: 0</span><br><span class="line">      &#125;,</span><br><span class="line">      dataRule: &#123;</span><br><span class="line">        attrGroupName: [</span><br><span class="line">          &#123; required: true, message: &quot;组名不能为空&quot;, trigger: &quot;blur&quot; &#125;</span><br><span class="line">        ],</span><br><span class="line">        sort: [&#123; required: true, message: &quot;排序不能为空&quot;, trigger: &quot;blur&quot; &#125;],</span><br><span class="line">        descript: [</span><br><span class="line">          &#123; required: true, message: &quot;描述不能为空&quot;, trigger: &quot;blur&quot; &#125;</span><br><span class="line">        ],</span><br><span class="line">        icon: [&#123; required: true, message: &quot;组图标不能为空&quot;, trigger: &quot;blur&quot; &#125;],</span><br><span class="line">        catelogId: [</span><br><span class="line">          &#123; required: true, message: &quot;所属分类id不能为空&quot;, trigger: &quot;blur&quot; &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getMenus();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 获取所有分类</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/list/tree&quot;),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        console.log(data);</span><br><span class="line">        // 这里data使用了解构</span><br><span class="line">        this.categorys = data.data;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    init(id) &#123;</span><br><span class="line">      this.dataForm.attrGroupId = id || 0;</span><br><span class="line">      this.visible = true;</span><br><span class="line">      this.$nextTick(() =&gt; &#123;</span><br><span class="line">        this.$refs[&quot;dataForm&quot;].resetFields();</span><br><span class="line">        if (this.dataForm.attrGroupId) &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(</span><br><span class="line">              `/product/attrgroup/info/$&#123;this.dataForm.attrGroupId&#125;`</span><br><span class="line">            ),</span><br><span class="line">            method: &quot;get&quot;,</span><br><span class="line">            params: this.$http.adornParams()</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            if (data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">              this.dataForm.attrGroupName = data.attrGroup.attrGroupName;</span><br><span class="line">              this.dataForm.sort = data.attrGroup.sort;</span><br><span class="line">              this.dataForm.descript = data.attrGroup.descript;</span><br><span class="line">              this.dataForm.icon = data.attrGroup.icon;</span><br><span class="line">              this.dataForm.catelogId = data.attrGroup.catelogId;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 表单提交</span><br><span class="line">    dataFormSubmit() &#123;</span><br><span class="line">      this.$refs[&quot;dataForm&quot;].validate(valid =&gt; &#123;</span><br><span class="line">        if (valid) &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(</span><br><span class="line">              `/product/attrgroup/$&#123;</span><br><span class="line">                !this.dataForm.attrGroupId ? &quot;save&quot; : &quot;update&quot;</span><br><span class="line">              &#125;`</span><br><span class="line">            ),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(&#123;</span><br><span class="line">              attrGroupId: this.dataForm.attrGroupId || undefined,</span><br><span class="line">              attrGroupName: this.dataForm.attrGroupName,</span><br><span class="line">              sort: this.dataForm.sort,</span><br><span class="line">              descript: this.dataForm.descript,</span><br><span class="line">              icon: this.dataForm.icon,</span><br><span class="line">              catelogId: this.dataForm.catelogIds[</span><br><span class="line">                this.dataForm.catelogIds.length - 1</span><br><span class="line">              ]</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            if (data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: &quot;操作成功&quot;,</span><br><span class="line">                type: &quot;success&quot;,</span><br><span class="line">                duration: 1500,</span><br><span class="line">                onClose: () =&gt; &#123;</span><br><span class="line">                  this.visible = false;</span><br><span class="line">                  this.$emit(&quot;refreshDataList&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$message.error(data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="非数据库中的字段-TableField-exist-false"><a href="#非数据库中的字段-TableField-exist-false" class="headerlink" title="非数据库中的字段@TableField(exist = false)"></a>非数据库中的字段@TableField(exist = false)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 所属分类id的完整路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span>    <span class="comment">// 不是数据库中存在的字段</span></span><br><span class="line"><span class="keyword">private</span> Long[] catelogPath;</span><br></pre></td></tr></table></figure><h4 id="级联选择器回显（后端）"><a href="#级联选择器回显（后端）" class="headerlink" title="级联选择器回显（后端）"></a>级联选择器回显（后端）</h4><blockquote><p>用于搜索分类的完整路径然后回显给级联选择器</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/attrgroup&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttrGroupController</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/info/&#123;attrGroupId&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:attrgroup:info&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">info</span><span class="params">(<span class="meta">@PathVariable(&quot;attrGroupId&quot;)</span> Long attrGroupId)</span> </span>&#123;</span><br><span class="line">        AttrGroupEntity attrGroup = attrGroupService.getById(attrGroupId);</span><br><span class="line"></span><br><span class="line">        Long catelogId = attrGroup.getCatelogId();</span><br><span class="line">        <span class="comment">// 获取完整分类路径（前端所需）</span></span><br><span class="line">        Long[] path = categoryService.findCategoryPath(catelogId);</span><br><span class="line">        attrGroup.setCatelogPath(path);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;attrGroup&quot;</span>, attrGroup);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Long[] findCategoryPath(Long catelogId) &#123;</span><br><span class="line">    List&lt;Long&gt; path = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    List&lt;Long&gt; parentPath = findParentPath(catelogId, path);</span><br><span class="line">    <span class="comment">// 这里需要逆序一下（因为是倒着找的）</span></span><br><span class="line">    Collections.reverse(parentPath);</span><br><span class="line">    <span class="keyword">return</span> parentPath.toArray(<span class="keyword">new</span> Long[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Long&gt; <span class="title">findParentPath</span><span class="params">(Long catelogId, List&lt;Long&gt; path)</span> </span>&#123;</span><br><span class="line">    path.add(catelogId);</span><br><span class="line">    CategoryEntity byId = <span class="keyword">this</span>.getById(catelogId);</span><br><span class="line">    <span class="keyword">if</span> (byId.getParentCid() != <span class="number">0</span>) &#123;</span><br><span class="line">        findParentPath(byId.getParentCid(), path);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> path;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="级联选择器回显（前端）"><a href="#级联选择器回显（前端）" class="headerlink" title="级联选择器回显（前端）"></a>级联选择器回显（前端）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">init</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>.dataForm.attrGroupId = id || <span class="number">0</span>;</span><br><span class="line">     <span class="built_in">this</span>.visible = <span class="literal">true</span>;</span><br><span class="line">     <span class="comment">// $nextTick当组件完全渲染完成之后调用</span></span><br><span class="line">     <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">       <span class="built_in">this</span>.$refs[<span class="string">&quot;dataForm&quot;</span>].resetFields();</span><br><span class="line">       <span class="keyword">if</span> (<span class="built_in">this</span>.dataForm.attrGroupId) &#123;</span><br><span class="line">         <span class="built_in">this</span>.$http(&#123;</span><br><span class="line">           <span class="attr">url</span>: <span class="built_in">this</span>.$http.adornUrl(</span><br><span class="line">             <span class="string">`/product/attrgroup/info/<span class="subst">$&#123;<span class="built_in">this</span>.dataForm.attrGroupId&#125;</span>`</span></span><br><span class="line">           ),</span><br><span class="line">           <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">           <span class="attr">params</span>: <span class="built_in">this</span>.$http.adornParams()</span><br><span class="line">         &#125;).then(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">           <span class="keyword">if</span> (data &amp;&amp; data.code === <span class="number">0</span>) &#123;</span><br><span class="line">             <span class="built_in">this</span>.dataForm.attrGroupName = data.attrGroup.attrGroupName;</span><br><span class="line">             <span class="built_in">this</span>.dataForm.sort = data.attrGroup.sort;</span><br><span class="line">             <span class="built_in">this</span>.dataForm.descript = data.attrGroup.descript;</span><br><span class="line">             <span class="built_in">this</span>.dataForm.icon = data.attrGroup.icon;</span><br><span class="line">             <span class="built_in">this</span>.dataForm.catelogId = data.attrGroup.catelogId;</span><br><span class="line">             <span class="comment">// 当前catlog的完整路径</span></span><br><span class="line">             <span class="built_in">this</span>.dataForm.catelogPath = data.attrGroup.catelogPath;</span><br><span class="line">           &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;);</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增 / 修改</span></span><br><span class="line"><span class="function"><span class="title">addOrUpdateHandle</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.addOrUpdateVisible = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">// $nextTick当组件完全渲染完成之后调用</span></span><br><span class="line">  <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 调用addOrUpdate组件中的init函数</span></span><br><span class="line">    <span class="built_in">this</span>.$refs.addOrUpdate.init(id);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">  @closed=&quot;dialogClose&quot; 对话框关闭回调事件</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:title</span>=<span class="string">&quot;!dataForm.attrGroupId ? &#x27;新增&#x27; : &#x27;修改&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:close-on-click-modal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:visible.sync</span>=<span class="string">&quot;visible&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">closed</span>=<span class="string">&quot;dialogClose&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  <span class="comment">// 关闭对话框清空数据</span></span><br><span class="line">  <span class="function"><span class="title">dialogClose</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.dataForm.catelogPath = [];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="品牌管理页面"><a href="#品牌管理页面" class="headerlink" title="品牌管理页面"></a>品牌管理页面</h2><blockquote><p>之前页面完善一下</p></blockquote><h3 id="MyBatis-Plus分页插件"><a href="#MyBatis-Plus分页插件" class="headerlink" title="MyBatis-Plus分页插件"></a>MyBatis-Plus分页插件</h3><blockquote><p>写法与版本有关，注意官网文档</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.gulimall.product.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span>                  <span class="comment">// 配置类</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span>    <span class="comment">// 开启事务功能</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.gulimall.product.dao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 引入分页插件（注意这里是旧版本，如果版本较新需要自行去官网查看最新写法）</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PaginationInterceptor paginationInterceptor = <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">        <span class="comment">// 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求  默认false</span></span><br><span class="line">        paginationInterceptor.setOverflow(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 设置最大单页限制数量，默认 500 条，-1 不受限制</span></span><br><span class="line">        paginationInterceptor.setLimit(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">return</span> paginationInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h3><blockquote><p>去page对象中添加querywrapper即可</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;brandService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">BrandDao</span>, <span class="title">BrandEntity</span>&gt; <span class="keyword">implements</span> <span class="title">BrandService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageUtils <span class="title">queryPage</span><span class="params">(Map&lt;String, Object&gt; params)</span> </span>&#123;</span><br><span class="line">        QueryWrapper&lt;BrandEntity&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="comment">// 模糊查询</span></span><br><span class="line">        String key = (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">            queryWrapper.eq(<span class="string">&quot;brand_id&quot;</span>, key).or().like(<span class="string">&quot;name&quot;</span>, key);</span><br><span class="line">        &#125;</span><br><span class="line">        IPage&lt;BrandEntity&gt; page = <span class="keyword">this</span>.page(</span><br><span class="line">                <span class="keyword">new</span> Query&lt;BrandEntity&gt;().getPage(params),</span><br><span class="line">                queryWrapper</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageUtils(page);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="品牌分类关联"><a href="#品牌分类关联" class="headerlink" title="品牌分类关联"></a>品牌分类关联</h2><blockquote><p>一个品牌可能做多种产品，所以需要关联</p><p>实现查询关联列表和新增关联</p></blockquote><h3 id="数据表"><a href="#数据表" class="headerlink" title="数据表"></a>数据表</h3><blockquote><p>抽取出来一个category_brand_relation表，因为是多对多的关系</p></blockquote><h3 id="查询、新增品牌关联（后端）"><a href="#查询、新增品牌关联（后端）" class="headerlink" title="查询、新增品牌关联（后端）"></a>查询、新增品牌关联（后端）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/categorybrandrelation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryBrandRelationController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryBrandRelationService categoryBrandRelationService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取品牌关联的所有分类列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/catelog/list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">relationList</span><span class="params">(<span class="meta">@RequestParam(&quot;brandId&quot;)</span> Long brandId)</span> </span>&#123;</span><br><span class="line">        List&lt;CategoryBrandRelationEntity&gt; data = categoryBrandRelationService.list(</span><br><span class="line">                <span class="keyword">new</span> QueryWrapper&lt;CategoryBrandRelationEntity&gt;().eq(<span class="string">&quot;brand_id&quot;</span>, brandId));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存品牌关联的所有分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(<span class="meta">@RequestBody</span> CategoryBrandRelationEntity categoryBrandRelation)</span> </span>&#123;</span><br><span class="line">        categoryBrandRelationService.mySave(categoryBrandRelation);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;categoryBrandRelationService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryBrandRelationServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CategoryBrandRelationDao</span>, <span class="title">CategoryBrandRelationEntity</span>&gt; <span class="keyword">implements</span> <span class="title">CategoryBrandRelationService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BrandDao brandDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CategoryDao categoryDao;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存品牌关联的所有分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mySave</span><span class="params">(CategoryBrandRelationEntity categoryBrandRelation)</span> </span>&#123;</span><br><span class="line">        Long brandId = categoryBrandRelation.getBrandId();</span><br><span class="line">        Long catelogId = categoryBrandRelation.getCatelogId();</span><br><span class="line">        <span class="comment">// 查询对应name</span></span><br><span class="line">        BrandEntity brandEntity = brandDao.selectById(brandId);</span><br><span class="line">        categoryBrandRelation.setBrandName(brandEntity.getName());</span><br><span class="line">        CategoryEntity categoryEntity = categoryDao.selectById(catelogId);</span><br><span class="line">        categoryBrandRelation.setCatelogName(categoryEntity.getName());</span><br><span class="line">        <span class="comment">// 保存</span></span><br><span class="line">        baseMapper.insert(categoryBrandRelation);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="连表修改"><a href="#连表修改" class="headerlink" title="连表修改"></a>连表修改</h3><blockquote><p>例如修改品牌信息，不仅要修改brand表，还有修改category_brand_relation等相关表</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;brandService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">BrandDao</span>, <span class="title">BrandEntity</span>&gt; <span class="keyword">implements</span> <span class="title">BrandService</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改品牌信息相关所有表的信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateDetail</span><span class="params">(BrandEntity brand)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.updateById(brand);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(brand.getName())) &#123;</span><br><span class="line">        <span class="comment">// 更新其他关联表中的数据</span></span><br><span class="line">        categoryBrandRelationService.updateBrand(brand.getBrandId(), brand.getName());</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="comment">// TODO 更新其他关联表</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;categoryBrandRelationService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryBrandRelationServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CategoryBrandRelationDao</span>, <span class="title">CategoryBrandRelationEntity</span>&gt; <span class="keyword">implements</span> <span class="title">CategoryBrandRelationService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 由于brand信息的更新，所以需要更新关联数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> brandId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateBrand</span><span class="params">(Long brandId, String name)</span> </span>&#123;</span><br><span class="line">        CategoryBrandRelationEntity entity = <span class="keyword">new</span> CategoryBrandRelationEntity();</span><br><span class="line">        entity.setBrandName(name);</span><br><span class="line">        entity.setBrandId(brandId);</span><br><span class="line">        <span class="keyword">this</span>.update(entity, <span class="keyword">new</span> UpdateWrapper&lt;CategoryBrandRelationEntity&gt;().eq(<span class="string">&quot;brand_id&quot;</span>, brandId));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>修改分类信息也是如此，只不过换了一种写法，写在了Mapper中</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;categoryService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CategoryDao</span>, <span class="title">CategoryEntity</span>&gt; <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改(级联更新，连表更新)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateDetail</span><span class="params">(CategoryEntity category)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.updateById(category);</span><br><span class="line">    categoryBrandRelationService.updateCategory(category.getCatId(), category.getName());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;categoryBrandRelationService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryBrandRelationServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CategoryBrandRelationDao</span>, <span class="title">CategoryBrandRelationEntity</span>&gt; <span class="keyword">implements</span> <span class="title">CategoryBrandRelationService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 由于catogory信息的更新，所以需要更新关联数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> catId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCategory</span><span class="params">(Long catId, String name)</span> </span>&#123;</span><br><span class="line">        baseMapper.updateCategory(catId, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CategoryBrandRelationDao</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">CategoryBrandRelationEntity</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateCategory</span><span class="params">(<span class="meta">@Param(&quot;catId&quot;)</span> Long catId, <span class="meta">@Param(&quot;name&quot;)</span> String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 由于catogory信息的更新，所以需要更新关联数据   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateCategory&quot;</span>&gt;</span></span><br><span class="line">    UPDATE gulimall_pms.pms_category_brand_relation</span><br><span class="line">    SET catelog_name = #&#123;name&#125;</span><br><span class="line">    WHERE catelog_id = #&#123;catId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
            <tag> redis </tag>
            
            <tag> 微服务 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】商城项目实战1</title>
      <link href="/2021/10/08/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-1/"/>
      <url>/2021/10/08/xiang-mu-bi-ji-shang-cheng-xiang-mu-shi-zhan-1/</url>
      
        <content type="html"><![CDATA[<h2 id="分布式基础概念"><a href="#分布式基础概念" class="headerlink" title="分布式基础概念"></a>分布式基础概念</h2><h3 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h3><blockquote><p>基于业务边界进行服务微化拆分，各个服务器独立部署运行。</p></blockquote><h3 id="集群-amp-分布式-amp-节点"><a href="#集群-amp-分布式-amp-节点" class="headerlink" title="集群&amp;分布式&amp;节点"></a>集群&amp;分布式&amp;节点</h3><blockquote><p>集群是个物理形态，分布式是个工作方式。</p><p>分布式是指将不同的业务分布在不同的地方，集群是指将几台服务器集中在一起实现同一业务。</p><p>分布式中的每个节点（集群中的一个服务器），都可以做集群，然而集群不一定就是分布式的。</p></blockquote><h3 id="远程调用"><a href="#远程调用" class="headerlink" title="远程调用"></a>远程调用</h3><blockquote><p>在分布式系统中，各个服务可能处于不同主机，但是服务之间不可避免的需要相互调用，即远程调用。</p><p>在spring-cloud中使用HTTP+JSON的方式完成远程调用。</p></blockquote><h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><blockquote><p>在分布式系统中，A服务需要调用B服务，且B服务存在于多台机器中，A服务调用任意一个服务器均可完成功能。但是为了使得每一个服务器不要太忙或者太闲，可以使用负载均衡的调用每一个服务器。</p><p>常见的负载均衡算法如下：</p><ol><li>轮询：按顺序，知道最后一个，然后循环。</li><li>最小连接：有限选择连接数最少（压力最小）的服务器。</li><li>散列：根据请求源的IP的散列（HASH）来选择要转发的服务器。</li></ol></blockquote><h3 id="服务注册、发现-amp-注册中心"><a href="#服务注册、发现-amp-注册中心" class="headerlink" title="服务注册、发现&amp;注册中心"></a>服务注册、发现&amp;注册中心</h3><blockquote><p>服务上线后在注册中心注册，从而使得其他服务器或者人能够感知其存在与状态</p></blockquote><h3 id="配置中心"><a href="#配置中心" class="headerlink" title="配置中心"></a>配置中心</h3><blockquote><p>每一个服务器都含有大量的配置，并且每个服务可能部署在多台机器上，所以经常需要变更配置，就可以使用配置中心来集中管理微服务的配置信息。</p></blockquote><h3 id="服务熔断-amp-服务降级"><a href="#服务熔断-amp-服务降级" class="headerlink" title="服务熔断&amp;服务降级"></a>服务熔断&amp;服务降级</h3><blockquote><p>在微服务架构中，微服务之间通过网络进行通讯，当一个服务不可用的时候可能造成雪崩效应。为防止这样的情况，必须要有容错机制来保护服务。</p><p>服务熔断：设置服务的超时时间，当被调用的服务经常失败到达某个阈值，我们可以开启断路保护机制，使得后来的请求不再去调用这个服务，而是本地直接返回默认的数据。</p><p>服务降级：在运维期间，当系统处于高峰期，系统资源紧张，可以让非核心业务降级运行，即某些服务不处理或者简单处理。</p></blockquote><h3 id="API网关"><a href="#API网关" class="headerlink" title="API网关"></a>API网关</h3><blockquote><p>抽象了微服务中都需要的公共功能，同时提供了客户端负载均衡、服务熔断、统一认证、限流流控、日志统计等功能。</p></blockquote><h2 id="微服务架构图"><a href="#微服务架构图" class="headerlink" title="微服务架构图"></a>微服务架构图</h2><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="谷粒商城-微服务架构图"></p><h2 id="微服务划分图"><a href="#微服务划分图" class="headerlink" title="微服务划分图"></a>微服务划分图</h2><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211009140429986.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211009140429986.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211009140429986"></p><h2 id="Linux虚拟机环境搭建"><a href="#Linux虚拟机环境搭建" class="headerlink" title="Linux虚拟机环境搭建"></a>Linux虚拟机环境搭建</h2><blockquote><p>之前的项目已经搭建的差不多了</p></blockquote><h3 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h3><blockquote><p>win：</p><ol><li>ipconfig</li><li>ping 192.168.128.129</li></ol><p>linux：</p><ol><li>ip addr</li><li>ping 10.67.99.2</li></ol><p>docker：</p><ol><li>我的挂载文件地址都在mydata中</li><li>docker images    当前所有镜像</li><li>docker ps             当前正在运行的容器</li><li>docker start xxx   启动容器</li><li>docker exec -it mysql /bin/bash</li><li>docker exec -it redis redis-cli</li><li>whereis [容器名]    查看当前进入的容器文件的地址</li><li>docker update redis –restart=always     自动重启容器</li><li>exit</li></ol><p>mysql：</p><ol><li>mysql -u root -p     访问mysql</li></ol><p>redis：</p><ol><li>keys *</li></ol></blockquote><h2 id="项目前后端基础搭建"><a href="#项目前后端基础搭建" class="headerlink" title="项目前后端基础搭建"></a>项目前后端基础搭建</h2><blockquote><p>后面回来得我表示，从一开始直接复制一样的版本号！！！</p></blockquote><h3 id="基础服务模块"><a href="#基础服务模块" class="headerlink" title="基础服务模块"></a>基础服务模块</h3><blockquote><p>注意每个服务模块，先导入web和openfeign</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211009155653337.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211009155653337.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211009155653337"></p><h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><blockquote><p>每个服务都需要独立的数据库</p><p>注意这里sql文件不要直接导入，可能导出的时候格式设置和现在不符合（创建的数据库字符编码为utf8mb4）,直接导入会中文乱码，用记事本打开后再粘贴运行。</p></blockquote><h3 id="人人开源模板"><a href="#人人开源模板" class="headerlink" title="人人开源模板"></a>人人开源模板</h3><blockquote><p><a href="https://gitee.com/renrenio">人人开源 (gitee.com)</a></p><p>renren-fast（后端）renren-fast-vue（前端）renren-generator（生成器）</p></blockquote><h4 id="renren-fast"><a href="#renren-fast" class="headerlink" title="renren-fast"></a>renren-fast</h4><blockquote><ol><li>renren-fast clone后放到父模块中，记得在父模块的pom文件中写入model。</li><li>运行db文件夹中的对应sql</li><li>修改resources下的配置文件<ol><li>application-dev.yml中的druid数据源信息</li></ol></li></ol></blockquote><h4 id="renren-fast-vue"><a href="#renren-fast-vue" class="headerlink" title="renren-fast-vue"></a>renren-fast-vue</h4><blockquote><ol><li>clone后用vscode打开</li><li>npm install（注意先把package.json中sass的版本改为4.14以上，因为npm的版本为14，两者版本有所对应，详见👉<a href="https://blog.csdn.net/qq_24654501/article/details/119005722">Vue解决报错9_人人开源renren-fast-vue执行npm install报错解决(sass的版本太低而node的版本太高导致）_xiaosi的博客-CSDN博客</a>，奇怪的是package-lock.json中的版本为4.14.1，然而package中却是4.13.1）</li><li>npm run dev，妈耶run了一下试试，就开了一个服务，内存已经85%了</li><li>可以在.eslintignore中添加<code>*.js</code>和<code>*.vue</code>用于忽略语法检查</li></ol></blockquote><h4 id="renren-generator"><a href="#renren-generator" class="headerlink" title="renren-generator"></a>renren-generator</h4><blockquote><ol><li>clone，导入到后端项目中，记得在父模块的pom文件中写入model。</li><li>配置application.yml中的数据源配置（注意数据库名的编写）</li><li>配置generator.properties中的生成数据配置（注意模块名、表前缀即可）</li><li>运行application打开页面点击生成代码（如果一直在读取说明配置信息有误）</li><li>将压缩包中的main文件放入对应模块src文件夹</li><li>去renren-fast模块中的common文件夹中复制报错所需要的类</li></ol></blockquote><h3 id="common模块"><a href="#common模块" class="headerlink" title="common模块"></a>common模块</h3><blockquote><p>承接上文，反正就是修修补补</p><p>controller中的@RequiresPermissions注释可以通过修改generator的controller template（所以说为什么不能一开始就把模板修改了）</p></blockquote><h4 id="当前项目结构"><a href="#当前项目结构" class="headerlink" title="当前项目结构"></a>当前项目结构</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211009192652587.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211009192652587.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211009192652587"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211009192720046.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211009192720046.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211009192720046"></p><h3 id="整合mybatis-plus"><a href="#整合mybatis-plus" class="headerlink" title="整合mybatis-plus"></a>整合mybatis-plus</h3><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><blockquote><p>由于common模块中已经导入了mybatis-plus依赖，所以需要使用只需要导入common模块即可</p><p>同时需要在common中导入mysql驱动</p></blockquote><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><blockquote><p>配置datasource、mapper地址、mybatis-plus等，最好使用yml格式</p></blockquote><h5 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#type: com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="comment">#MySQL配置</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.128.129:3306/gulimall_pms?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"><span class="comment"># mapper</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="comment"># mapper.xml地址</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br><span class="line">  <span class="comment"># 主键自增</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">      </span><br><span class="line"><span class="comment">#服务器（注意不能配置成一样的）</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7000</span></span><br></pre></td></tr></table></figure><blockquote><p>classpath*表示不仅扫描本模块下的类路径，还包括引入的其他依赖的类路径</p></blockquote><h5 id="GulimallProductApplication"><a href="#GulimallProductApplication" class="headerlink" title="GulimallProductApplication"></a>GulimallProductApplication</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.gulimall.product.dao&quot;)</span><span class="comment">// mapper包扫描</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallProductApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(GulimallProductApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="单元测试✅"><a href="#单元测试✅" class="headerlink" title="单元测试✅"></a>单元测试✅</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span><span class="comment">// 记得加，而且要引入Junit和springboot-starter-test依赖</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GulimallProductApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BrandService brandService;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BrandEntity be = <span class="keyword">new</span> BrandEntity();</span><br><span class="line">        be.setName(<span class="string">&quot;huawei&quot;</span>);</span><br><span class="line">        brandService.save(be);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="前端调用api接口请求地址配置"><a href="#前端调用api接口请求地址配置" class="headerlink" title="前端调用api接口请求地址配置"></a>前端调用api接口请求地址配置</h3><blockquote><p>注意去static-&gt;config-&gt;index.js中配置服务地址</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开发环境</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">; (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">window</span>.SITE_CONFIG = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// api接口请求地址(88为网关配置的端口号,api为自定义规则)，注意最后不要有/</span></span><br><span class="line">  <span class="built_in">window</span>.SITE_CONFIG[<span class="string">&#x27;baseUrl&#x27;</span>] = <span class="string">&#x27;http://localhost:88/api&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// cdn地址 = 域名 + 版本号</span></span><br><span class="line">  <span class="built_in">window</span>.SITE_CONFIG[<span class="string">&#x27;domain&#x27;</span>] = <span class="string">&#x27;./&#x27;</span>; <span class="comment">// 域名</span></span><br><span class="line">  <span class="built_in">window</span>.SITE_CONFIG[<span class="string">&#x27;version&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;   <span class="comment">// 版本号(年月日时分)</span></span><br><span class="line">  <span class="built_in">window</span>.SITE_CONFIG[<span class="string">&#x27;cdnUrl&#x27;</span>] = <span class="built_in">window</span>.SITE_CONFIG.domain + <span class="built_in">window</span>.SITE_CONFIG.version;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="网关配置"><a href="#网关配置" class="headerlink" title="网关配置"></a>网关配置</h3><blockquote><p>写在application.yml中，千万注意缩进</p></blockquote><h4 id="解决renren-fase验证码"><a href="#解决renren-fase验证码" class="headerlink" title="解决renren-fase验证码"></a>解决renren-fase验证码</h4><blockquote><p>因为修改了端口号，但是renren-fast登录时候的验证码是在她本来的端口8080才能获取，所以需要让网关发现renren-fast</p><p>改变如localhost:88/api/captcha  -&gt;  localhost:8080/renren-fast/captcha</p></blockquote><blockquote><ol><li>先给renren-fast把nacos配好（注册中心和配置中心的都可以配）</li><li>编写网关配置如下</li></ol></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">          <span class="comment"># lb负载均衡，自动查询服务名为renren-fast的服务器，从而自动获得其ip:port</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://renren-fast</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="comment"># 匹配所有以api开头的前端请求地址</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/**</span></span><br><span class="line">          <span class="comment"># 实现转发</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="comment"># 注意这里的写法，segment这一部分整体不变，然后别的地方进行替换</span></span><br><span class="line">            <span class="comment"># localhost:88/api/xxx  -&gt;   localhost:8080/renren-fast/xxx</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/renren-fast/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>还要开启跨域</p></blockquote><h3 id="解决跨域"><a href="#解决跨域" class="headerlink" title="解决跨域"></a>解决跨域</h3><blockquote><p>在网关当中写一个config类统一配置跨域，可</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.gulimall.config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.reactive.CorsWebFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.reactive.UrlBasedCorsConfigurationSource;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallCorsConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span>   <span class="comment">// 加入到spring容器中直接使用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsWebFilter <span class="title">crosWebFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        UrlBasedCorsConfigurationSource source = <span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">        CorsConfiguration corsConfiguration = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">        <span class="comment">// 配置跨域</span></span><br><span class="line">        corsConfiguration.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        corsConfiguration.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        corsConfiguration.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        corsConfiguration.setAllowCredentials(<span class="keyword">true</span>);    <span class="comment">// 是否允许携带cookie</span></span><br><span class="line">        <span class="comment">// path为需要跨域的地址，corsConfiguration为跨域配置</span></span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, corsConfiguration);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsWebFilter(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211010154403925.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211010154403925.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211010154403925"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211010154515355.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211010154515355.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211010154515355"></p><blockquote><p>这里说明一下，一个login（methods为OPTION表示预见请求）已经通过了</p><p>第二是真实请求，携带了请求数据等</p><p>这里测试还是失败的原因是renren-fast自己已经配置过了跨域，两次跨域=没跨，把renren-fast的config文件夹下的CorsConfig注释掉即可</p></blockquote><h2 id="分布式组件"><a href="#分布式组件" class="headerlink" title="分布式组件"></a>分布式组件</h2><blockquote><p>spring-cloud-alibaba</p><ol><li>nacos：注册中心配置中心</li><li>Sentinel：服务容错（限流、降级、熔断）</li><li>Seata：分布式事务解决方案</li></ol><p>spring-cloud：</p><ol><li>Ribbon：负载均衡</li><li>Feign：声明式HTTP客户端（远程服务）</li><li>Gateway：API网关</li><li>Sleuth：调用链监控</li></ol></blockquote><h3 id="spring-cloud和spring-boot版本对应"><a href="#spring-cloud和spring-boot版本对应" class="headerlink" title="spring-cloud和spring-boot版本对应"></a>spring-cloud和spring-boot版本对应</h3><blockquote><p><a href="https://start.spring.io/actuator/info">https://start.spring.io/actuator/info</a></p><p><a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E">版本说明 · alibaba/spring-cloud-alibaba Wiki (github.com)</a></p><p>这个版本一定要对应起来</p></blockquote><h3 id="nacos注册中心"><a href="#nacos注册中心" class="headerlink" title="nacos注册中心"></a>nacos注册中心</h3><h4 id="依赖-1"><a href="#依赖-1" class="headerlink" title="依赖"></a>依赖</h4><blockquote><p>common模块即可</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ******************** spring-cloud ******************** --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- nacos --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ******************** spring-cloud版本管理 ******************** --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置nacos地址"><a href="#配置nacos地址" class="headerlink" title="配置nacos地址"></a>配置nacos地址</h4><blockquote><p>注意需要使用的服务就需要在application中配置</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#type: com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="comment">#MySQL配置</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.128.129:3306/gulimall_sms?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">  <span class="comment">#nacos地址</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">  <span class="comment"># 服务名</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-coupon</span></span><br></pre></td></tr></table></figure><h4 id="注解开启"><a href="#注解开启" class="headerlink" title="注解开启"></a>注解开启</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.gulimall.coupon.dao&quot;)</span>    <span class="comment">// mapper包扫描</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span>  <span class="comment">// nacos</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallCouponApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(GulimallCouponApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="可视化界面"><a href="#可视化界面" class="headerlink" title="可视化界面"></a>可视化界面</h4><blockquote><p><a href="http://127.0.0.1:8848/nacos">http://127.0.0.1:8848/nacos</a></p></blockquote><h3 id="Feign远程服务"><a href="#Feign远程服务" class="headerlink" title="Feign远程服务"></a>Feign远程服务</h3><h4 id="依赖-2"><a href="#依赖-2" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="服务接口"><a href="#服务接口" class="headerlink" title="服务接口"></a>服务接口</h4><blockquote><p>feign文件夹下写一个接口，在接口中提供声明需要被调用的服务的controller中的对应方法，并且把映射地址改为全地址，并且为接口添加@FeignClient注释，value为需要调用的服务的服务名。</p></blockquote><h4 id="注解开启-1"><a href="#注解开启-1" class="headerlink" title="注解开启"></a>注解开启</h4><blockquote><p>在调用服务的启动类上添加注解@EnableFeignClients(basepackages=”接口地址”)</p><p>(被调用的服务需要在开启nacos注册发现)</p></blockquote><h3 id="nacos配置中心"><a href="#nacos配置中心" class="headerlink" title="nacos配置中心"></a>nacos配置中心</h3><h4 id="依赖-3"><a href="#依赖-3" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><blockquote><p>在resources文件夹下的bootstrap.properties文件中配置Nacos Config元数据（一定得是bootstrap）</p><p>！！！一定要在bootstrap.properties中配置</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当前应用名</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">gulimall-coupon</span></span><br><span class="line"><span class="comment"># nacos配置中心的地址</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br><span class="line"><span class="comment"># nacos配置中心使用的命名空间（如果是自定义的填写对应id）和组</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.namespace</span>=<span class="string">d066b643-6689-4ed1-967d-585be9a3b121</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.group</span>=<span class="string">dev</span></span><br></pre></td></tr></table></figure><h4 id="配置中心-1"><a href="#配置中心-1" class="headerlink" title="配置中心"></a>配置中心</h4><blockquote><p>在配置中心的配置列表中新建配置，DataID为<code>服务名.properties</code>（如果是要加载application.properties的话），然后可以粘贴上配置内容</p><p>注意这里测试了一下，还是把版本都和课件对应上比较好，要不然会有很多问题。</p></blockquote><h4 id="注解开启-2"><a href="#注解开启-2" class="headerlink" title="注解开启"></a>注解开启</h4><blockquote><p>在对应controller中@RefreshScope，当配置中心的配置值改变的时候，对应服务中的配置值也会改变</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RefreshScope</span>   <span class="comment">// 开启配置中心动态获取配置</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;coupon/coupon&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CouponController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;coupon.user.name&#125;&quot;)</span><span class="comment">// 从配置文件中获取值</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;coupon.user.age&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * test配置中心</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;coupon:coupon:list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;name&quot;</span>, name).put(<span class="string">&quot;age&quot;</span>, age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="多配置集"><a href="#多配置集" class="headerlink" title="多配置集"></a>多配置集</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211010113405307.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211010113405307.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211010113405307"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nacos配置中心使用的命名空间（如果是自定义的填写对应id）和组</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.namespace</span>=<span class="string">d066b643-6689-4ed1-967d-585be9a3b121</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.group</span>=<span class="string">dev</span></span><br><span class="line"><span class="comment"># 多配置集</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.ext-config[0].data-id</span>=<span class="string">datasource.yml</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.ext-config[0].group</span>=<span class="string">dev</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.ext-config[0].refresh</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.ext-config[1].data-id</span>=<span class="string">mybatis.yml</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.ext-config[1].group</span>=<span class="string">dev</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.ext-config[1].refresh</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.ext-config[2].data-id</span>=<span class="string">others.yml</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.ext-config[2].group</span>=<span class="string">dev</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.ext-config[2].refresh</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><blockquote><ol><li>命名空间：用于配置隔离，可以通过在bootstrap.properties配置文件修改从而修改对应内容<ol><li>不同的生产环节下使用不同命名空间隔离</li><li>不同微服务之间隔离</li></ol></li><li>配置集：所有的配置的集合</li><li>配置集ID：即nacos中的Data ID</li><li>配置分组：即nacos中的group，也可以隔离</li></ol></blockquote><h3 id="Gateway网关"><a href="#Gateway网关" class="headerlink" title="Gateway网关"></a>Gateway网关</h3><h4 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h4><blockquote><p>创建Gateway模块，记得引入common，在父模块中添加model</p><p>启动类上加如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@EnableDiscoveryClient  //nacos</span><br><span class="line">@SpringBootApplication(exclude = &#123;DataSourceAutoConfiguration.class&#125;)</span><br></pre></td></tr></table></figure></blockquote><h4 id="依赖-4"><a href="#依赖-4" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h4><p>application.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#nacos注册中心</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.discovery.server-addr</span>=<span class="string">127.0.0.1.8848</span></span><br><span class="line"><span class="comment">#应用名</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">gulimall-gateway</span></span><br><span class="line"><span class="comment">#服务端口号</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">12000</span></span><br></pre></td></tr></table></figure><h4 id="网关配置-1"><a href="#网关配置-1" class="headerlink" title="网关配置"></a>网关配置</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">test_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.baidu.com</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Query=url,baidu</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">qq_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.qq.com</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Query=url,qq</span></span><br></pre></td></tr></table></figure><blockquote><p>url为转发的地址，predicates断言为判断条件（详见官网），以上的意思为当uri中有一个key value对应url=baidu、url=qq，则进行跳转。</p><p>测试地址：<a href="http://localhost:88/?url=baidu">http://localhost:88/?url=baidu</a></p></blockquote><h2 id="接口文档"><a href="#接口文档" class="headerlink" title="接口文档"></a>接口文档</h2><p><a href="https://easydoc.net/s/78237135/ZUqEdvA4/hKJTcbfd">1、分页请求参数 - 谷粒商城 - 易文档 (easydoc.net)</a></p><h2 id="商品服务-三级分类（后台）"><a href="#商品服务-三级分类（后台）" class="headerlink" title="商品服务 - 三级分类（后台）"></a>商品服务 - 三级分类（后台）</h2><blockquote><p>product模块，category相关</p></blockquote><h3 id="nacos配置"><a href="#nacos配置" class="headerlink" title="nacos配置"></a>nacos配置</h3><h5 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># nacos 注册中心</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment"># nacos地址</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">  <span class="comment"># 服务名</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-product</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="bootstrap-properties"><a href="#bootstrap-properties" class="headerlink" title="bootstrap.properties"></a>bootstrap.properties</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当前应用名</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">gulimall-product</span></span><br><span class="line"><span class="comment"># nacos配置中心的地址</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br><span class="line"><span class="comment"># nacos配置中心使用的命名空间（如果是自定义的填写对应id）和组</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.config.namespace</span>=<span class="string">415d4381-f509-4bb6-8ad8-c0497e20d904</span></span><br></pre></td></tr></table></figure><h3 id="网关配置-2"><a href="#网关配置-2" class="headerlink" title="网关配置"></a>网关配置</h3><blockquote><p>这里坑很多，顺序，还有缩进，还有断言匹配还有转发的写法</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">product_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://gulimall-product</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/product/**</span></span><br><span class="line">          <span class="comment"># 实现转发</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="comment"># localhost:88/api/product/xxx  -&gt;   localhost:10000/product/xxx</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/$\&#123;segment&#125;</span></span><br><span class="line">        <span class="comment"># 注意顺序，高精度的在前</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">          <span class="comment"># lb负载均衡，自动查询服务名为renren-fast的服务器，从而自动获得其ip:port</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://renren-fast</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="comment"># 匹配所有以api开头的前端请求地址</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/**</span></span><br><span class="line">          <span class="comment"># 实现转发</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="comment"># 注意这里的写法，segment这一部分整体不变，然后别的地方进行替换</span></span><br><span class="line">            <span class="comment"># localhost:88/api/xxx  -&gt;   localhost:8080/renren-fast/xxx</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/renren-fast/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure><h3 id="递归树形结构查询所有分类（后端）"><a href="#递归树形结构查询所有分类（后端）" class="headerlink" title="递归树形结构查询所有分类（后端）"></a>递归树形结构查询所有分类（后端）</h3><h4 id="CategoryEntity"><a href="#CategoryEntity" class="headerlink" title="CategoryEntity"></a>CategoryEntity</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;pms_category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 子分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span>    <span class="comment">// 表示该属性在数据表中不存在</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;CategoryEntity&gt; children;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CategoryController"><a href="#CategoryController" class="headerlink" title="CategoryController"></a>CategoryController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询所有分类，并且以树形结构组合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/list/tree&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">listWithTree</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        List&lt;CategoryEntity&gt; list = categoryService.listWithTree();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CategoryServiceImpl"><a href="#CategoryServiceImpl" class="headerlink" title="CategoryServiceImpl"></a>CategoryServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;categoryService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CategoryDao</span>, <span class="title">CategoryEntity</span>&gt; <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询所有分类，并且以树形结构组合</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title">listWithTree</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1、查出所有分类</span></span><br><span class="line">        List&lt;CategoryEntity&gt; categories = baseMapper.selectList(<span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// 2、组装树形结构</span></span><br><span class="line">        <span class="comment">// 流式、过滤、map映射、排序、递归、lambda</span></span><br><span class="line">        List&lt;CategoryEntity&gt; level1Menus = categories.stream().filter((categoryEntity) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> categoryEntity.getParentCid() == <span class="number">0</span>;</span><br><span class="line">        &#125;).map(categoryEntity -&gt; &#123;</span><br><span class="line">            categoryEntity.setChildren(getChildrens(categoryEntity, categories));</span><br><span class="line">            <span class="keyword">return</span> categoryEntity;</span><br><span class="line">        &#125;).sorted((ce1, ce2) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> (ce1.getSort() == <span class="keyword">null</span> ? <span class="number">0</span> : ce1.getSort()) - (ce2.getSort() == <span class="keyword">null</span> ? <span class="number">0</span> : ce2.getSort());</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> level1Menus;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递归查询所有子分类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> father</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> entityList</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;CategoryEntity&gt; <span class="title">getChildrens</span><span class="params">(CategoryEntity father, List&lt;CategoryEntity&gt; entityList)</span> </span>&#123;</span><br><span class="line">        List&lt;CategoryEntity&gt; childList = entityList.stream().filter((categoryEntity) -&gt; &#123;</span><br><span class="line">            <span class="comment">// 取出每一个entity，判断其是否符合，符合的留下</span></span><br><span class="line">            <span class="keyword">return</span> categoryEntity.getParentCid() == father.getCatId();</span><br><span class="line">        &#125;).map(categoryEntity -&gt; &#123;</span><br><span class="line">            <span class="comment">// 取出每一个entity，为其设置children（使用递归）</span></span><br><span class="line">            categoryEntity.setChildren(getChildrens(categoryEntity, entityList));</span><br><span class="line">            <span class="keyword">return</span> categoryEntity;</span><br><span class="line">        &#125;).sorted((ce1, ce2) -&gt; &#123;</span><br><span class="line">            <span class="comment">// 这里防止getSort()返回null，然后根据sort权重排序</span></span><br><span class="line">            <span class="keyword">return</span> (ce1.getSort() == <span class="keyword">null</span> ? <span class="number">0</span> : ce1.getSort()) - (ce2.getSort() == <span class="keyword">null</span> ? <span class="number">0</span> : ce2.getSort());</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> childList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>上来就放了个大招，java8的新特性</p></blockquote><h3 id="显示所有分类（前端）"><a href="#显示所有分类（前端）" class="headerlink" title="显示所有分类（前端）"></a>显示所有分类（前端）</h3><h4 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h4><blockquote><p>启动renrenfast和renrenfase-vue</p><p>系统管理 -&gt; 菜单管理 -&gt; 添加目录和菜单（我的妈呀可视化操作这也太棒了吧）</p></blockquote><blockquote><p>路径中填写/会被替换成-，所以可以根据这个对应src-&gt;views-&gt;modules下的路径</p><p>即<a href="http://localhost:8001/#/product-category%E5%AF%B9%E5%BA%94%E6%96%87%E4%BB%B6%E5%A4%B9src-&gt;views-&gt;modules-&gt;product-&gt;category.vue">http://localhost:8001/#/product-category对应文件夹src-&gt;views-&gt;modules-&gt;product-&gt;category.vue</a></p></blockquote><h4 id="vue页面"><a href="#vue页面" class="headerlink" title="vue页面"></a>vue页面</h4><blockquote><p>renren-fast-vue\src\views\modules\product\category.vue</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 商品管理-分类维护 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-tree</span><br><span class="line">    :data=&quot;menus&quot;</span><br><span class="line">    :props=&quot;defaultProps&quot;</span><br><span class="line">    @node-click=&quot;handleNodeClick&quot;</span><br><span class="line">  &gt;&lt;/el-tree&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      menus: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &quot;children&quot;, // 子节点属性</span><br><span class="line">        label: &quot;name&quot; //显示的属性</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 获取所有分类</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/list/tree&quot;),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        // 这里data使用了解构</span><br><span class="line">        console.log(&quot;调用api获得菜单数据&quot; + data.data);</span><br><span class="line">        this.menus = data.data;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getMenus();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="删除分类（后端）"><a href="#删除分类（后端）" class="headerlink" title="删除分类（后端）"></a>删除分类（后端）</h3><h4 id="逻辑删除"><a href="#逻辑删除" class="headerlink" title="逻辑删除"></a>逻辑删除</h4><blockquote><p>在application.yml中配置</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mybatis</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="comment"># mapper.xml地址</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment"># 主键自增</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">      <span class="comment"># 逻辑删除</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><blockquote><p>在对应实体类的字段上添加注解@TableLogic</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;pms_category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 逻辑删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableLogic(value = &quot;1&quot;, delval = &quot;0&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer showStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CategoryController-1"><a href="#CategoryController-1" class="headerlink" title="CategoryController"></a>CategoryController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;product/category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除分类，判断是否被其他引用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/delete&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:category:delete&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">deleteWithoutUse</span><span class="params">(<span class="meta">@RequestBody</span> Long[] catIds)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 检查当前删除的菜单是否被其他的地方引用</span></span><br><span class="line">        categoryService.removeByIdsWithoutUse(Arrays.asList(catIds));</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CategoryServiceImpl-1"><a href="#CategoryServiceImpl-1" class="headerlink" title="CategoryServiceImpl"></a>CategoryServiceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;categoryService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CategoryDao</span>, <span class="title">CategoryEntity</span>&gt; <span class="keyword">implements</span> <span class="title">CategoryService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除分类，判断是否被其他引用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> asList</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeByIdsWithoutUse</span><span class="params">(List&lt;Long&gt; asList)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//TODO 检查是否被其他的东西引用</span></span><br><span class="line">        baseMapper.deleteBatchIds(asList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="删除分类（前端）"><a href="#删除分类（前端）" class="headerlink" title="删除分类（前端）"></a>删除分类（前端）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 商品管理-分类维护 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- ====================== 分类树形结构显示 开始 ====================== --&gt;</span><br><span class="line">  &lt;!-- </span><br><span class="line">    node-key=&quot;catId&quot;                  其值为节点数据中的一个字段名</span><br><span class="line">    :expand-on-click-node=&quot;false&quot;     表示设置展开节点的点击位置，FALSE只有当点击箭头的时候才展开</span><br><span class="line">    :default-expanded-keys=&quot;[2, 3]&quot;   表示默认展开的节点</span><br><span class="line">  --&gt;</span><br><span class="line">  &lt;el-tree</span><br><span class="line">    node-key=&quot;catId&quot;</span><br><span class="line">    show-checkbox</span><br><span class="line">    :data=&quot;menus&quot;</span><br><span class="line">    :props=&quot;defaultProps&quot;</span><br><span class="line">    :expand-on-click-node=&quot;false&quot;</span><br><span class="line">    :default-expanded-keys=&quot;expandedKey&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- ====================== 操作按钮 开始 ====================== --&gt;</span><br><span class="line">    &lt;!-- 使用slot添加可操作性按钮 --&gt;</span><br><span class="line">    &lt;!-- node为每一个节点对象（不和后端中entity对应，而是element自定义的），data为该节点的数据 --&gt;</span><br><span class="line">    &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">      &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;span&gt;</span><br><span class="line">        &lt;!-- 这里需要有所判断是否显示对应按钮 --&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          v-if=&quot;node.level &lt;= 2&quot;</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          size=&quot;mini&quot;</span><br><span class="line">          @click=&quot;() =&gt; append(data)&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          Append</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          size=&quot;mini&quot;</span><br><span class="line">          @click=&quot;() =&gt; remove(node, data)&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          Delete</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">    &lt;!-- ====================== 操作按钮 结束 ====================== --&gt;</span><br><span class="line">  &lt;/el-tree&gt;</span><br><span class="line">  &lt;!-- ====================== 分类树形结构显示 结束 ====================== --&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      menus: [], // 菜单列表</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &quot;children&quot;, // 子节点属性</span><br><span class="line">        label: &quot;name&quot; // 显示的属性</span><br><span class="line">      &#125;,</span><br><span class="line">      expandedKey: [] // 默认展开的节点</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 按钮操作</span><br><span class="line">    append(data) &#123;&#125;,</span><br><span class="line">    remove(node, data) &#123;</span><br><span class="line">      var ids = [data.catId];</span><br><span class="line">      this.$confirm(`确定删除【$&#123;data.name&#125;】菜单吗?`, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          // 调用API</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(&quot;/product/category/delete&quot;),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(ids, false)</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            if (data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: &quot;删除成功&quot;,</span><br><span class="line">                type: &quot;success&quot;,</span><br><span class="line">                duration: 800,</span><br><span class="line">                onClose: () =&gt; &#123;</span><br><span class="line">                  // 刷新列表</span><br><span class="line">                  this.getMenus();</span><br><span class="line">                  // 展开父节点位置(这里的id对应node-key绑定的属性名)</span><br><span class="line">                  this.expandedKey = [node.parent.data.catId];</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$message.error(data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="添加分类（后端）"><a href="#添加分类（后端）" class="headerlink" title="添加分类（后端）"></a>添加分类（后端）</h3><blockquote><p>已有</p></blockquote><h3 id="添加分类（前端）"><a href="#添加分类（前端）" class="headerlink" title="添加分类（前端）"></a>添加分类（前端）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 商品管理-分类维护 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- ====================== 分类树形结构显示 开始 ====================== --&gt;</span><br><span class="line">    &lt;!-- </span><br><span class="line">    node-key=&quot;catId&quot;                  其值为节点数据中的一个字段名</span><br><span class="line">    :expand-on-click-node=&quot;false&quot;     表示设置展开节点的点击位置，FALSE只有当点击箭头的时候才展开</span><br><span class="line">    :default-expanded-keys=&quot;[2, 3]&quot;   表示默认展开的节点</span><br><span class="line">  --&gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">      node-key=&quot;catId&quot;</span><br><span class="line">      show-checkbox</span><br><span class="line">      :data=&quot;menus&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      :expand-on-click-node=&quot;false&quot;</span><br><span class="line">      :default-expanded-keys=&quot;expandedKey&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- ====================== 操作按钮 开始 ====================== --&gt;</span><br><span class="line">      &lt;!-- 使用slot添加可操作性按钮 --&gt;</span><br><span class="line">      &lt;!-- node为每一个节点对象（不和后端中entity对应，而是element自定义的），data为该节点的数据 --&gt;</span><br><span class="line">      &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">          &lt;!-- 这里需要有所判断是否显示对应按钮 --&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.level &lt;= 2&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; append(data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            Append</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; remove(node, data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            Delete</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      &lt;!-- ====================== 操作按钮 结束 ====================== --&gt;</span><br><span class="line">    &lt;/el-tree&gt;</span><br><span class="line">    &lt;!-- ====================== 分类树形结构显示 结束 ====================== --&gt;</span><br><span class="line">    &lt;!-- ====================== 添加分类的对话框 开始 ====================== --&gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      title=&quot;添加分类菜单&quot;</span><br><span class="line">      :visible.sync=&quot;dialogVisible&quot;</span><br><span class="line">      width=&quot;30%&quot;</span><br><span class="line">      center</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form :model=&quot;category&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;addCategory()&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">    &lt;!-- ====================== 添加分类的对话框 结束 ====================== --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      menus: [], // 菜单列表</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        // 菜单树属性</span><br><span class="line">        children: &quot;children&quot;, // 子节点属性</span><br><span class="line">        label: &quot;name&quot; // 显示的属性</span><br><span class="line">      &#125;,</span><br><span class="line">      expandedKey: [], // 默认展开的节点</span><br><span class="line">      dialogVisible: false, // 是否打开添加分类的对话框</span><br><span class="line">      category: &#123;</span><br><span class="line">        name: &quot;&quot;,</span><br><span class="line">        parentCid: 0,</span><br><span class="line">        catLevel: 0,</span><br><span class="line">        showStatus: 1,</span><br><span class="line">        sort: 0</span><br><span class="line">      &#125; // 菜单对象</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 添加分类菜单</span><br><span class="line">    addCategory() &#123;</span><br><span class="line">      // 调用api</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/save&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(this.category, false)</span><br><span class="line">      &#125;)</span><br><span class="line">        .then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            message: &quot;保存成功&quot;,</span><br><span class="line">            type: &quot;success&quot;</span><br><span class="line">          &#125;);</span><br><span class="line">          // 关闭对话框</span><br><span class="line">          this.dialogVisible = false;</span><br><span class="line">          // 刷新列表</span><br><span class="line">          this.getMenus();</span><br><span class="line">          // 展开父节点位置数组(这里的id对应node-key绑定的属性名)</span><br><span class="line">          this.expandedKey = [this.category.parentCid];</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(result =&gt; &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            message: &quot;保存失败&quot;,</span><br><span class="line">            type: &quot;error&quot;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 打开添加菜单对话框</span><br><span class="line">    append(data) &#123;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      // 初始化category对象</span><br><span class="line">      this.category.name = &quot;&quot;;</span><br><span class="line">      this.category.parentCid = data.catId;</span><br><span class="line">      this.category.catLevel = data.catLevel * 1 + 1;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="修改分类（后端）"><a href="#修改分类（后端）" class="headerlink" title="修改分类（后端）"></a>修改分类（后端）</h3><blockquote><p>已有</p></blockquote><h3 id="修改分类（前端）"><a href="#修改分类（前端）" class="headerlink" title="修改分类（前端）"></a>修改分类（前端）</h3><blockquote><p>实现简单地信息修改，包括name，icon，productUnit</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 商品管理-分类维护 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- ====================== 分类树形结构显示 开始 ====================== --&gt;</span><br><span class="line">      &lt;!-- ====================== 操作按钮 开始 ====================== --&gt;</span><br><span class="line">      &lt;!-- 使用slot添加可操作性按钮 --&gt;</span><br><span class="line">      &lt;!-- node为每一个节点对象（不和后端中entity对应，而是element自定义的），data为该节点的数据 --&gt;</span><br><span class="line">      &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">          &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;openDialogWithInfo(data)&quot;&gt;</span><br><span class="line">            修改</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      &lt;!-- ====================== 操作按钮 结束 ====================== --&gt;</span><br><span class="line">    &lt;/el-tree&gt;</span><br><span class="line">    &lt;!-- ====================== 分类树形结构显示 结束 ====================== --&gt;</span><br><span class="line">    &lt;!-- ====================== 添加分类的对话框 开始 ====================== --&gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      :title=&quot;dialogTitle&quot;</span><br><span class="line">      :visible.sync=&quot;dialogVisible&quot;</span><br><span class="line">      :close-on-click-modal=&quot;false&quot;</span><br><span class="line">      width=&quot;30%&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form :model=&quot;category&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;图表&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.icon&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;计量单位&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;category.productUnit&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;addOrUpdate()&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">    &lt;!-- ====================== 添加分类的对话框 结束 ====================== --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      menus: [], // 菜单列表</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        // 菜单树属性</span><br><span class="line">        children: &quot;children&quot;, // 子节点属性</span><br><span class="line">        label: &quot;name&quot; // 显示的属性</span><br><span class="line">      &#125;,</span><br><span class="line">      expandedKey: [], // 默认展开的节点</span><br><span class="line">      dialogVisible: false, // 是否打开添加分类的对话框</span><br><span class="line">      dialogType: &quot;&quot;, // 对话框用于添加还是修改</span><br><span class="line">      dialogTitle: &quot;&quot;, // 对话框标题</span><br><span class="line">      category: &#123;</span><br><span class="line">        name: &quot;&quot;,</span><br><span class="line">        catId: null,</span><br><span class="line">        parentCid: 0,</span><br><span class="line">        catLevel: 0,</span><br><span class="line">        showStatus: 1,</span><br><span class="line">        sort: 0,</span><br><span class="line">        icon: &quot;&quot;,</span><br><span class="line">        productUnit: &quot;&quot;</span><br><span class="line">      &#125; // 菜单对象</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 打开添加菜单对话框</span><br><span class="line">    openDialog(data) &#123;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      this.dialogType = &quot;add&quot;;</span><br><span class="line">      this.dialogTitle = &quot;添加分类&quot;;</span><br><span class="line">      // 初始化category对象</span><br><span class="line">      this.category.catId = null;</span><br><span class="line">      this.category.name = &quot;&quot;;</span><br><span class="line">      this.category.parentCid = data.catId;</span><br><span class="line">      this.category.icon = &quot;&quot;;</span><br><span class="line">      this.category.productUnit = &quot;&quot;;</span><br><span class="line">      this.category.catLevel = data.catLevel * 1 + 1;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 打开修改菜单对话框</span><br><span class="line">    openDialogWithInfo(data) &#123;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      this.dialogType = &quot;update&quot;;</span><br><span class="line">      this.dialogTitle = &quot;修改分类&quot;;</span><br><span class="line">      // 调用接口获取对应id的信息，并初始化category对象</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(`/product/category/info/$&#123;data.catId&#125;`),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.category.catId = data.data.catId;</span><br><span class="line">        // 只修改这几个值</span><br><span class="line">        this.category.name = data.data.name;</span><br><span class="line">        this.category.icon = data.data.icon;</span><br><span class="line">        this.category.productUnit = data.data.productUnit;</span><br><span class="line">        // 用于修改完之后展开父菜单</span><br><span class="line">        this.category.parentCid = data.data.parentCid;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 对话框确定按钮判断</span><br><span class="line">    addOrUpdate() &#123;</span><br><span class="line">      if (this.dialogType == &quot;update&quot;) &#123;</span><br><span class="line">        this.updateCategory();</span><br><span class="line">      &#125; else if (this.dialogType == &quot;add&quot;) &#123;</span><br><span class="line">        this.addCategory();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 修改分类菜单</span><br><span class="line">    updateCategory() &#123;</span><br><span class="line">      // 使用解构</span><br><span class="line">      var &#123; catId, name, icon, productUnit &#125; = this.category;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/update&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        // 不能直接发送this.category对象,而是重新封装需要修改的对象</span><br><span class="line">        data: this.$http.adornData(&#123; catId, name, icon, productUnit &#125;, false)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;修改成功&quot;,</span><br><span class="line">          type: &quot;success&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        // 关闭对话框</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">        // 刷新列表</span><br><span class="line">        this.getMenus();</span><br><span class="line">        // 展开父节点位置数组(这里的id对应node-key绑定的属性名)</span><br><span class="line">        this.expandedKey = [this.category.parentCid];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="拖拽修改分类（后端）"><a href="#拖拽修改分类（后端）" class="headerlink" title="拖拽修改分类（后端）"></a>拖拽修改分类（后端）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 批量修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/update/sort&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">updateSort</span><span class="params">(<span class="meta">@RequestBody</span> CategoryEntity[] category)</span> </span>&#123;</span><br><span class="line">    categoryService.updateBatchById(Arrays.asList(category));</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="拖拽修改分类（前端）"><a href="#拖拽修改分类（前端）" class="headerlink" title="拖拽修改分类（前端）"></a>拖拽修改分类（前端）</h3><blockquote><p>el-tree 开启draggable即可，allow-drop判断</p><p>这一part值得重复观看</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 商品管理-分类维护 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-switch</span><br><span class="line">      v-model=&quot;draggable&quot;</span><br><span class="line">      active-text=&quot;开启拖拽排序&quot;</span><br><span class="line">      inactive-text=&quot;关闭拖拽排序&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;/el-switch&gt;</span><br><span class="line">    &lt;el-button v-if=&quot;draggable&quot; @click=&quot;batchSave&quot;&gt;</span><br><span class="line">      批量保存</span><br><span class="line">    &lt;/el-button&gt;</span><br><span class="line">    &lt;!-- ====================== 分类树形结构显示 开始 ====================== --&gt;</span><br><span class="line">    &lt;!-- </span><br><span class="line">    node-key=&quot;catId&quot;                  其值为节点数据中的一个字段名</span><br><span class="line">    :expand-on-click-node=&quot;false&quot;     表示设置展开节点的点击位置，FALSE只有当点击箭头的时候才展开</span><br><span class="line">    :default-expanded-keys=&quot;[2, 3]&quot;   表示默认展开的节点</span><br><span class="line">    draggable                         开启可拖拽的方式</span><br><span class="line">  --&gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">      node-key=&quot;catId&quot;</span><br><span class="line">      show-checkbox</span><br><span class="line">      :data=&quot;menus&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      :expand-on-click-node=&quot;false&quot;</span><br><span class="line">      :default-expanded-keys=&quot;expandedKey&quot;</span><br><span class="line">      :draggable=&quot;draggable&quot;</span><br><span class="line">      :allow-drop=&quot;allowDrop&quot;</span><br><span class="line">      @node-drop=&quot;handleDrop&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- ====================== 操作按钮 开始 ====================== --&gt;</span><br><span class="line">      &lt;!-- 使用slot添加可操作性按钮 --&gt;</span><br><span class="line">      &lt;!-- node为每一个节点对象（不和后端中entity对应，而是element自定义的），data为该节点的数据 --&gt;</span><br><span class="line">      &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">          &lt;!-- 这里需要有所判断是否显示对应按钮 --&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.level &lt;= 2&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;openDialog(data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            添加</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;openDialogWithInfo(data)&quot;&gt;</span><br><span class="line">            修改</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;remove(node, data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            删除</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      &lt;!-- ====================== 操作按钮 结束 ====================== --&gt;</span><br><span class="line">    &lt;/el-tree&gt;</span><br><span class="line">    &lt;!-- ====================== 分类树形结构显示 结束 ====================== --&gt;</span><br><span class="line">    &lt;!-- ====================== 添加分类的对话框 开始 ====================== --&gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      :title=&quot;dialogTitle&quot;</span><br><span class="line">      :visible.sync=&quot;dialogVisible&quot;</span><br><span class="line">      :close-on-click-modal=&quot;false&quot;</span><br><span class="line">      width=&quot;30%&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form :model=&quot;category&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;图表&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.icon&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;计量单位&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;category.productUnit&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;addOrUpdate()&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">    &lt;!-- ====================== 添加分类的对话框 结束 ====================== --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      menus: [], // 菜单列表</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        // 菜单树属性</span><br><span class="line">        children: &quot;children&quot;, // 子节点属性</span><br><span class="line">        label: &quot;name&quot; // 显示的属性</span><br><span class="line">      &#125;,</span><br><span class="line">      expandedKey: [], // 默认展开的节点</span><br><span class="line">      dialogVisible: false, // 是否打开添加分类的对话框</span><br><span class="line">      dialogType: &quot;&quot;, // 对话框用于添加还是修改</span><br><span class="line">      dialogTitle: &quot;&quot;, // 对话框标题</span><br><span class="line">      category: &#123;</span><br><span class="line">        name: &quot;&quot;,</span><br><span class="line">        catId: null,</span><br><span class="line">        parentCid: 0,</span><br><span class="line">        catLevel: 0,</span><br><span class="line">        showStatus: 1,</span><br><span class="line">        sort: 0,</span><br><span class="line">        icon: &quot;&quot;,</span><br><span class="line">        productUnit: &quot;&quot;</span><br><span class="line">      &#125;, // 菜单对象</span><br><span class="line">      pCid: 0,</span><br><span class="line">      maxLevel: 0, // 用于记录子节点最深深度</span><br><span class="line">      updateNodes: [], //所有需要修改的节点</span><br><span class="line">      draggable: false // 可否拖拽</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getMenus();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    batchSave() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/update/sort&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(this.updateNodes, false)</span><br><span class="line">      &#125;)</span><br><span class="line">        .then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            message: &quot;菜单顺序修改成功&quot;,</span><br><span class="line">            type: &quot;success&quot;</span><br><span class="line">          &#125;);</span><br><span class="line">          // 刷新,初始化</span><br><span class="line">          this.updateNodes = [];</span><br><span class="line">          this.maxLevel = 0;</span><br><span class="line">          this.getMenus();</span><br><span class="line">          this.expandedKey = [this.pCid];</span><br><span class="line">          this.pCid = 0;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            message: &quot;菜单顺序修改失败&quot;,</span><br><span class="line">            type: &quot;error&quot;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 修改子节点的层级</span><br><span class="line">    updateNodesChildLevel(node) &#123;</span><br><span class="line">      if (node.childNodes.length &gt; 0) &#123;</span><br><span class="line">        for (let i = 0; i &lt; node.childNodes.length; i++) &#123;</span><br><span class="line">          this.updateNodes.push(&#123;</span><br><span class="line">            catId: node.childNodes[i].data.catId,</span><br><span class="line">            catLevel: node.childNodes[i].level</span><br><span class="line">          &#125;);</span><br><span class="line">          this.updateNodesChildLevel(node.childNodes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 拖拽成功触发</span><br><span class="line">    handleDrop(draggingNode, dropNode, dropType, ev) &#123;</span><br><span class="line">      // 获取最新节点的父节点id(真实数据库中的id,而不是node的id)和顺序和层级</span><br><span class="line">      let pCid = 0;</span><br><span class="line">      let siblings = null;</span><br><span class="line">      if (dropType == &quot;inner&quot;) &#123;</span><br><span class="line">        pCid = dropNode.data.catId;</span><br><span class="line">        siblings = dropNode.childNodes;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        pCid =</span><br><span class="line">          dropNode.parent.data.catId == undefined</span><br><span class="line">            ? 0</span><br><span class="line">            : dropNode.parent.data.catId;</span><br><span class="line">        siblings = dropNode.parent.childNodes;</span><br><span class="line">      &#125;</span><br><span class="line">      //对兄弟节点排序，获得当前的顺序</span><br><span class="line">      for (let i = 0; i &lt; siblings.length; i++) &#123;</span><br><span class="line">        // 先判断当前遍历到的节点是不是被拖拽的节点，是的话需要修改他的pCid</span><br><span class="line">        if (siblings[i].data.catId == draggingNode.data.catId) &#123;</span><br><span class="line">          // 判断层级是否改变</span><br><span class="line">          if (siblings[i].level != draggingNode.level) &#123;</span><br><span class="line">            // 字节点的层级也要改变</span><br><span class="line">            this.updateNodesChildLevel(siblings[i]);</span><br><span class="line">            this.updateNodes.push(&#123;</span><br><span class="line">              catId: siblings[i].data.catId,</span><br><span class="line">              sort: i,</span><br><span class="line">              parentCid: pCid,</span><br><span class="line">              catLevel: siblings[i].level</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.updateNodes.push(&#123;</span><br><span class="line">              catId: siblings[i].data.catId,</span><br><span class="line">              sort: i,</span><br><span class="line">              parentCid: pCid</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          // 需要修改的商品对象，放入updateNodes</span><br><span class="line">          this.updateNodes.push(&#123; catId: siblings[i].data.catId, sort: i &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      this.pCid = pCid;</span><br><span class="line">      console.log(&quot;this.updateNodes:&quot;, this.updateNodes);</span><br><span class="line">      // 调用api</span><br><span class="line">      // this.$http(&#123;</span><br><span class="line">      //   url: this.$http.adornUrl(&quot;/product/category/update/sort&quot;),</span><br><span class="line">      //   method: &quot;post&quot;,</span><br><span class="line">      //   data: this.$http.adornData(this.updateNodes, false)</span><br><span class="line">      // &#125;)</span><br><span class="line">      //   .then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">      //     this.$message(&#123;</span><br><span class="line">      //       message: &quot;菜单顺序修改成功&quot;,</span><br><span class="line">      //       type: &quot;success&quot;</span><br><span class="line">      //     &#125;);</span><br><span class="line">      //     // 刷新,初始化</span><br><span class="line">      //     this.updateNodes = [];</span><br><span class="line">      //     this.maxLevel = 0;</span><br><span class="line">      //     this.getMenus();</span><br><span class="line">      //     this.expandedKey = [pCid];</span><br><span class="line">      //   &#125;)</span><br><span class="line">      //   .catch(() =&gt; &#123;</span><br><span class="line">      //     this.$message(&#123;</span><br><span class="line">      //       message: &quot;菜单顺序修改失败&quot;,</span><br><span class="line">      //       type: &quot;error&quot;</span><br><span class="line">      //     &#125;);</span><br><span class="line">      //   &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 判断是否被拖拽放置（这里要注意层级和深度）</span><br><span class="line">    allowDrop(draggingNode, dropNode, type) &#123;</span><br><span class="line">      // 当前被拖动到的节点的最大深度（因为可能拖家带口）+拖动到的节点的层数 &lt;= 3即可</span><br><span class="line">      // 求当前子节点最大层级</span><br><span class="line">      console.log(&quot;draggingNode:&quot;, draggingNode);</span><br><span class="line">      this.countNodeLevel(draggingNode);</span><br><span class="line">      // 注意这里，需要用子节点的最大层级-当前被拖动的节点的层级+1，获得的值就是被拖动整体的最大深度</span><br><span class="line">      console.log(&quot;maxLevel:&quot; + this.maxLevel);</span><br><span class="line">      console.log(&quot;draggingNode.level:&quot; + draggingNode.level);</span><br><span class="line">      let deep = this.maxLevel - draggingNode.level + 1;</span><br><span class="line">      console.log(&quot;deep:&quot; + deep);</span><br><span class="line">      this.maxLevel = 0;</span><br><span class="line">      // 注意这里要判断type: 前后中（因为elementui他的设计就是这样，两个node是指拖拽后有位置关系的两个节点，type是返回的两个node之间的关系，）</span><br><span class="line">      if (type == &quot;inner&quot;) &#123;</span><br><span class="line">        console.log(&quot;dropNode.level:&quot; + dropNode.level);</span><br><span class="line">        return deep + dropNode.level &lt;= 3;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        console.log(&quot;dropNode.parent.level:&quot; + dropNode.parent.level);</span><br><span class="line">        return deep + dropNode.parent.level &lt;= 3;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 递归查找最深子节点，记录在this.maxLevel中</span><br><span class="line">    countNodeLevel(node) &#123;</span><br><span class="line">      // 如果有子节点</span><br><span class="line">      if (node.childNodes != null &amp;&amp; node.childNodes.length &gt; 0) &#123;</span><br><span class="line">        // 遍历递归</span><br><span class="line">        for (let i = 0; i &lt; node.childNodes.length; i++) &#123;</span><br><span class="line">          if (node.childNodes[i].level &gt; this.maxLevel) &#123;</span><br><span class="line">            this.maxLevel = node.childNodes[i].level;</span><br><span class="line">          &#125;</span><br><span class="line">          // 注意这里maxLevel放在data中，要不然递归拿不到</span><br><span class="line">          this.countNodeLevel(node.childNodes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // 没有子节点</span><br><span class="line">        this.maxLevel = node.level;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 获取所有分类</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/list/tree&quot;),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        console.log(data);</span><br><span class="line">        // 这里data使用了解构</span><br><span class="line">        this.menus = data.data;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 打开添加菜单对话框</span><br><span class="line">    openDialog(data) &#123;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      this.dialogType = &quot;add&quot;;</span><br><span class="line">      this.dialogTitle = &quot;添加分类&quot;;</span><br><span class="line">      // 初始化category对象</span><br><span class="line">      this.category.catId = null;</span><br><span class="line">      this.category.name = &quot;&quot;;</span><br><span class="line">      this.category.parentCid = data.catId;</span><br><span class="line">      this.category.icon = &quot;&quot;;</span><br><span class="line">      this.category.productUnit = &quot;&quot;;</span><br><span class="line">      this.category.catLevel = data.catLevel * 1 + 1;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 打开修改菜单对话框</span><br><span class="line">    openDialogWithInfo(data) &#123;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      this.dialogType = &quot;update&quot;;</span><br><span class="line">      this.dialogTitle = &quot;修改分类&quot;;</span><br><span class="line">      // 调用接口获取对应id的信息，并初始化category对象</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(`/product/category/info/$&#123;data.catId&#125;`),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.category.catId = data.data.catId;</span><br><span class="line">        // 只修改这几个值</span><br><span class="line">        this.category.name = data.data.name;</span><br><span class="line">        this.category.icon = data.data.icon;</span><br><span class="line">        this.category.productUnit = data.data.productUnit;</span><br><span class="line">        // 用于修改完之后展开父菜单</span><br><span class="line">        this.category.parentCid = data.data.parentCid;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 对话框确定按钮判断</span><br><span class="line">    addOrUpdate() &#123;</span><br><span class="line">      if (this.dialogType == &quot;update&quot;) &#123;</span><br><span class="line">        this.updateCategory();</span><br><span class="line">      &#125; else if (this.dialogType == &quot;add&quot;) &#123;</span><br><span class="line">        this.addCategory();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 修改分类菜单</span><br><span class="line">    updateCategory() &#123;</span><br><span class="line">      // 使用解构</span><br><span class="line">      var &#123; catId, name, icon, productUnit &#125; = this.category;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/update&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        // 不能直接发送this.category对象,而是重新封装需要修改的对象</span><br><span class="line">        data: this.$http.adornData(&#123; catId, name, icon, productUnit &#125;, false)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;修改成功&quot;,</span><br><span class="line">          type: &quot;success&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        // 关闭对话框</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">        // 刷新列表</span><br><span class="line">        this.getMenus();</span><br><span class="line">        // 展开父节点位置数组(这里的id对应node-key绑定的属性名)</span><br><span class="line">        this.expandedKey = [this.category.parentCid];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 添加分类菜单</span><br><span class="line">    addCategory() &#123;</span><br><span class="line">      // 调用api</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/save&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(this.category, false)</span><br><span class="line">      &#125;)</span><br><span class="line">        .then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            message: &quot;保存成功&quot;,</span><br><span class="line">            type: &quot;success&quot;</span><br><span class="line">          &#125;);</span><br><span class="line">          // 关闭对话框</span><br><span class="line">          this.dialogVisible = false;</span><br><span class="line">          // 刷新列表</span><br><span class="line">          this.getMenus();</span><br><span class="line">          // 展开父节点位置数组(这里的id对应node-key绑定的属性名)</span><br><span class="line">          this.expandedKey = [this.category.parentCid];</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(result =&gt; &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            message: &quot;保存失败&quot;,</span><br><span class="line">            type: &quot;error&quot;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 删除对应菜单</span><br><span class="line">    remove(node, data) &#123;</span><br><span class="line">      var ids = [data.catId];</span><br><span class="line">      this.$confirm(`确定删除【$&#123;data.name&#125;】菜单吗?`, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          // 调用API</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(&quot;/product/category/delete&quot;),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(ids, false)</span><br><span class="line">          &#125;)</span><br><span class="line">            .then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: &quot;删除成功&quot;,</span><br><span class="line">                type: &quot;success&quot;</span><br><span class="line">              &#125;);</span><br><span class="line">              // 刷新列表</span><br><span class="line">              this.getMenus();</span><br><span class="line">              // 展开父节点位置(这里的id对应node-key绑定的属性名)</span><br><span class="line">              this.expandedKey = [node.parent.data.catId];</span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(result =&gt; &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: &quot;删除失败&quot;,</span><br><span class="line">                type: &quot;error&quot;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>TODO : 当前bug，如果层级3的菜单拖拽到层级2后失踪，应该和pcid有关（拖拽至层级1有效）</p><p>层级2无子节点拖拽到层级2后失踪（不过看起来后台数据库没问题呀？）</p><p>TODO：这个bug被后来的批量保存改正了，反正都批量保存了，也有问题了</p></blockquote><h3 id="批量删除分类（前端）"><a href="#批量删除分类（前端）" class="headerlink" title="批量删除分类（前端）"></a>批量删除分类（前端）</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211016171830386.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211016171830386.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211016171830386"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"> &lt;div&gt;</span><br><span class="line">    &lt;el-button type=&quot;danger&quot; @click=&quot;batchDelete&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line">    &lt;!-- ====================== 分类树形结构显示 开始 ====================== --&gt;</span><br><span class="line">    &lt;!-- </span><br><span class="line">    node-key=&quot;catId&quot;                  其值为节点数据中的一个字段名</span><br><span class="line">    :expand-on-click-node=&quot;false&quot;     表示设置展开节点的点击位置，FALSE只有当点击箭头的时候才展开</span><br><span class="line">    :default-expanded-keys=&quot;[2, 3]&quot;   表示默认展开的节点</span><br><span class="line">    draggable                         开启可拖拽的方式‘</span><br><span class="line">    ref                               可以从this.$refs中获取到该对应组件</span><br><span class="line">  --&gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">      node-key=&quot;catId&quot;</span><br><span class="line">      show-checkbox</span><br><span class="line">      :data=&quot;menus&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      :expand-on-click-node=&quot;false&quot;</span><br><span class="line">      :default-expanded-keys=&quot;expandedKey&quot;</span><br><span class="line">      :draggable=&quot;draggable&quot;</span><br><span class="line">      :allow-drop=&quot;allowDrop&quot;</span><br><span class="line">      @node-drop=&quot;handleDrop&quot;</span><br><span class="line">      ref=&quot;menuTree&quot;</span><br><span class="line">    &gt;</span><br><span class="line"> </span><br><span class="line">        &lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line"> methods: &#123;</span><br><span class="line">    // 批量删除</span><br><span class="line">    batchDelete() &#123;</span><br><span class="line">      let catIds = [];</span><br><span class="line">      // 获取当前选中的节点</span><br><span class="line">      let checkedNodes = this.$refs.menuTree.getCheckedNodes();</span><br><span class="line">      // console.log(checkedNodes);</span><br><span class="line">      // 遍历所有被选中的节点</span><br><span class="line">      for (let i = 0; i &lt; checkedNodes.length; i++) &#123;</span><br><span class="line">        catIds.push(checkedNodes[i].catId);</span><br><span class="line">      &#125;</span><br><span class="line">      // 发送请求</span><br><span class="line">      this.$confirm(`确定批量删除【$&#123;catIds&#125;】菜单吗?`, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          // 调用API</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(&quot;/product/category/delete&quot;),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(catIds, false)</span><br><span class="line">          &#125;)</span><br><span class="line">            .then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: &quot;批量删除成功&quot;,</span><br><span class="line">                type: &quot;success&quot;</span><br><span class="line">              &#125;);</span><br><span class="line">              // 刷新列表</span><br><span class="line">              this.getMenus();</span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(result =&gt; &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: &quot;批量删除失败&quot;,</span><br><span class="line">                type: &quot;error&quot;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;&#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt; </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
            <tag> redis </tag>
            
            <tag> 微服务 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】在线教育项目实战7</title>
      <link href="/2021/10/05/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-7/"/>
      <url>/2021/10/05/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-7/</url>
      
        <content type="html"><![CDATA[<h2 id="统计分析后台（后端-前端）"><a href="#统计分析后台（后端-前端）" class="headerlink" title="统计分析后台（后端+前端）"></a>统计分析后台（后端+前端）</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><blockquote><p>老样子</p></blockquote><h3 id="生成统计数据（后端）"><a href="#生成统计数据（后端）" class="headerlink" title="生成统计数据（后端）"></a>生成统计数据（后端）</h3><blockquote><p>注意，要查询什么数据要在对应模块中查询，然后在统计模块远程调用获取</p></blockquote><h4 id="被调用方controller"><a href="#被调用方controller" class="headerlink" title="被调用方controller"></a>被调用方controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/educenter/member&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UcenterMemberController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UcenterMemberService memberService;</span><br><span class="line">    <span class="comment">// 查询特定天的注册人数</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;countRegister/&#123;day&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">countRegister</span><span class="params">(<span class="meta">@PathVariable</span> String day)</span> </span>&#123;</span><br><span class="line">        Integer count = memberService.countRegister(day);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="被调用方service"><a href="#被调用方service" class="headerlink" title="被调用方service"></a>被调用方service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询特定天的注册人数</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">countRegister</span><span class="params">(String day)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> baseMapper.countRegisterByDay(day);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="被调用方mapper"><a href="#被调用方mapper" class="headerlink" title="被调用方mapper"></a>被调用方mapper</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.educenter.mapper.UcenterMemberMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 查询特定天的注册人数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;countRegisterByDay&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">        SELECT COUNT(*)</span><br><span class="line">        FROM ucenter_member uc</span><br><span class="line">        WHERE DATE(uc.gmt_create) = #&#123;day&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="远程调用接口"><a href="#远程调用接口" class="headerlink" title="远程调用接口"></a>远程调用接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(&quot;service-ucenter&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UcenterClient</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查询特定天的注册人数</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/educenter/member/countRegister/&#123;day&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">countRegister</span><span class="params">(<span class="meta">@PathVariable(&quot;day&quot;)</span> String day)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="调用方controller"><a href="#调用方controller" class="headerlink" title="调用方controller"></a>调用方controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/staservice/sta&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StatisticsDailyController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StatisticsDailyService staService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 统计特定天的注册人数</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;countRegister/&#123;day&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">countRegister</span><span class="params">(<span class="meta">@PathVariable</span> String day)</span> </span>&#123;</span><br><span class="line">        staService.countRegister(day);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="调用方service"><a href="#调用方service" class="headerlink" title="调用方service"></a>调用方service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StatisticsDailyServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">StatisticsDailyMapper</span>, <span class="title">StatisticsDaily</span>&gt; <span class="keyword">implements</span> <span class="title">StatisticsDailyService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UcenterClient ucenterClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countRegister</span><span class="params">(String day)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 先删除相同日期的记录</span></span><br><span class="line">        QueryWrapper&lt;StatisticsDaily&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;date_calculated&quot;</span>, day);</span><br><span class="line">        baseMapper.delete(wrapper);</span><br><span class="line">        <span class="comment">// 获得指定日期的统计数</span></span><br><span class="line">        Integer count = ucenterClient.countRegister(day);</span><br><span class="line">        <span class="comment">// 把统计数据添加到统计表当中</span></span><br><span class="line">        StatisticsDaily statisticsDaily = <span class="keyword">new</span> StatisticsDaily();</span><br><span class="line">        statisticsDaily.setRegisterNum(count);</span><br><span class="line">        statisticsDaily.setDateCalculated(day);</span><br><span class="line">        <span class="comment">// 一下是一些随机数</span></span><br><span class="line">        statisticsDaily.setVideoViewNum(RandomUtils.nextInt(<span class="number">100</span>, <span class="number">200</span>));</span><br><span class="line">        statisticsDaily.setLoginNum(RandomUtils.nextInt(<span class="number">100</span>, <span class="number">200</span>));</span><br><span class="line">        statisticsDaily.setCourseNum(RandomUtils.nextInt(<span class="number">100</span>, <span class="number">200</span>));</span><br><span class="line">        <span class="comment">// 插入数据库</span></span><br><span class="line">        baseMapper.insert(statisticsDaily);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="生成统计数据（前端）"><a href="#生成统计数据（前端）" class="headerlink" title="生成统计数据（前端）"></a>生成统计数据（前端）</h3><h4 id="router"><a href="#router" class="headerlink" title="router"></a>router</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 统计分析模块</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/sta&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: Layout,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/sta/create&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;统计分析&#x27;</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;统计分析&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;example&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;create&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;生成数据&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/statistics/create&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;生成数据&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;show&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;图表显示&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/statistics/show&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;图表显示&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h4 id="api"><a href="#api" class="headerlink" title="api"></a>api</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 统计指定日期的注册数</span></span><br><span class="line">    <span class="function"><span class="title">createCountRegister</span>(<span class="params">day</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/staservice/sta/countRegister/<span class="subst">$&#123;day&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="vue模板与方法"><a href="#vue模板与方法" class="headerlink" title="vue模板与方法"></a>vue模板与方法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;  &lt;div class=&quot;app-container&quot;&gt;    &lt;!--表单--&gt;    &lt;el-form :inline=&quot;true&quot; class=&quot;demo-form-inline&quot;&gt;      &lt;el-form-item label=&quot;日期&quot;&gt;        &lt;!-- 这里绑定了day --&gt;        &lt;el-date-picker          v-model=&quot;day&quot;          type=&quot;date&quot;          placeholder=&quot;选择要统计的日期&quot;          value-format=&quot;yyyy-MM-dd&quot;        /&gt;      &lt;/el-form-item&gt;      &lt;el-button :disabled=&quot;btnDisabled&quot; type=&quot;primary&quot; @click=&quot;create()&quot;        &gt;生成&lt;/el-button      &gt;    &lt;/el-form&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;  import staApi from &#x27;@/api/statistics&#x27;  export default &#123;    data() &#123;      return &#123;        day: &#x27;&#x27;,        btnDisabled: false      &#125;    &#125;,    created() &#123;&#125;,    methods: &#123;      create() &#123;        staApi.createCountRegister(this.day).then(result =&gt; &#123;          // 提示信息          this.$message(&#123;            type: &#x27;success&#x27;,            message: &#x27;生成数据成功!&#x27;          &#125;)          // 跳转到图表显示页面          this.$router.push(&#123; path: &#x27;/sta/show&#x27; &#125;)        &#125;)      &#125;    &#125;  &#125;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h3><blockquote><p>在固定时候自动执行程序</p></blockquote><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><blockquote><p>在启动类上添加注解@EnableScheduling</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableScheduling</span>   <span class="comment">// 使用自动任务public class StatisticsApplication &#123;    public static void main(String[] args) &#123;        SpringApplication.run(StatisticsApplication.class, args);    &#125;&#125;</span></span><br></pre></td></tr></table></figure><h4 id="定时任务类"><a href="#定时任务类" class="headerlink" title="定时任务类"></a>定时任务类</h4><blockquote><p>使用cron表达式，设置执行规则</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Componentpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledTask</span> </span>&#123;    <span class="meta">@Autowired</span>    <span class="keyword">private</span> StatisticsDailyService staService;    <span class="comment">// 0/5 * * * * ?表示每隔5秒执行一次这个方法    @Scheduled(cron = &quot;0/5 * * * * ?&quot;)    public void task1() &#123;        System.out.println(&quot;**************task1执行了..&quot;);    &#125;    //在每天凌晨1点，把前一天数据进行数据查询添加    @Scheduled(cron = &quot;0 0 1 * * ?&quot;)    public void task2() &#123;        staService.countRegister(DateUtil.formatDate(DateUtil.addDays(new Date(), -1)));    &#125;&#125;</span></span><br></pre></td></tr></table></figure><h4 id="日期工具类"><a href="#日期工具类" class="headerlink" title="日期工具类"></a>日期工具类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateUtil</span> </span>&#123;    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String dateFormat = <span class="string">&quot;yyyy-MM-dd&quot;</span>;    <span class="comment">/**     * 格式化日期     *     * <span class="doctag">@param</span> date     * <span class="doctag">@return</span>     */</span>    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">formatDate</span><span class="params">(Date date)</span> </span>&#123;        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(dateFormat);        <span class="keyword">return</span> sdf.format(date);    &#125;    <span class="comment">/**     * 在日期date上增加amount天 。     *     * <span class="doctag">@param</span> date   处理的日期，非null     * <span class="doctag">@param</span> amount 要加的天数，可能为负数     */</span>    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title">addDays</span><span class="params">(Date date, <span class="keyword">int</span> amount)</span> </span>&#123;        Calendar now =Calendar.getInstance();        now.setTime(date);        now.set(Calendar.DATE,now.get(Calendar.DATE)+amount);        <span class="keyword">return</span> now.getTime();    &#125;    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;        System.out.println(DateUtil.formatDate(<span class="keyword">new</span> Date()));        System.out.println(DateUtil.formatDate(DateUtil.addDays(<span class="keyword">new</span> Date(), -<span class="number">1</span>)));    &#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="统计分析图表显示（后端-前端）"><a href="#统计分析图表显示（后端-前端）" class="headerlink" title="统计分析图表显示（后端+前端）"></a>统计分析图表显示（后端+前端）</h2><blockquote><p>使用echarts</p></blockquote><h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// echatrts图表显示@GetMapping(&quot;showChartData/&#123;type&#125;/&#123;begin&#125;/&#123;end&#125;&quot;)public R getChartData(@PathVariable String begin, @PathVariable String end, @PathVariable String type) &#123;    Map&lt;String, Object&gt; map = staService.getChartData(type, begin, end);    return R.ok().data(map);&#125;</span></span><br></pre></td></tr></table></figure><h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// echatrts图表显示@Overridepublic Map&lt;String, Object&gt; getChartData(String type, String begin, String end) &#123;    // 指定日期范围    QueryWrapper&lt;StatisticsDaily&gt; wrapper = new QueryWrapper&lt;&gt;();    wrapper.between(&quot;date_calculated&quot;, begin, end);    // 这里要求前端的传递的value和表中对应字段值相同，select指定查询列    wrapper.select(&quot;date_calculated&quot;, type);    List&lt;StatisticsDaily&gt; staDataList = baseMapper.selectList(wrapper);    //前端要求数组json结构，对应后端java代码是list集合    //创建两个list集合，一个日期list，一个数量list    List&lt;String&gt; dateList = new ArrayList&lt;&gt;();    List&lt;Integer&gt; numList = new ArrayList&lt;&gt;();    //遍历查询所有数据list集合，进行封装    for (int i = 0; i &lt; staDataList.size(); i++) &#123;        StatisticsDaily daily = staDataList.get(i);        //封装日期list集合        dateList.add(daily.getDateCalculated());        //封装对应选择的数量        switch (type) &#123;            case &quot;login_num&quot;:                numList.add(daily.getLoginNum());                break;            case &quot;register_num&quot;:                numList.add(daily.getRegisterNum());                break;            case &quot;video_view_num&quot;:                numList.add(daily.getVideoViewNum());                break;            case &quot;course_num&quot;:                numList.add(daily.getCourseNum());                break;            default:                break;        &#125;    &#125;    //把封装之后两个list集合放到map集合，进行返回    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();    map.put(&quot;dateList&quot;, dateList);    map.put(&quot;numList&quot;, numList);    return map;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><h4 id="引入npm依赖"><a href="#引入npm依赖" class="headerlink" title="引入npm依赖"></a>引入npm依赖</h4><blockquote><p>npm install –save <a href="mailto:&#101;&#99;&#104;&#x61;&#x72;&#x74;&#115;&#x40;&#52;&#46;&#x31;&#x2e;&#48;">&#101;&#99;&#104;&#x61;&#x72;&#x74;&#115;&#x40;&#52;&#46;&#x31;&#x2e;&#48;</a></p></blockquote><h4 id="api-1"><a href="#api-1" class="headerlink" title="api"></a>api</h4><blockquote><p>这里没有使用RequestBody传递对象，而是直接前端调用的时候传递对象取对应值</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得图表数据    getChartData(searchObj) &#123;        return request(&#123;            url: `/staservice/sta/getChartData/$&#123;searchObj.type&#125;/$&#123;searchObj.begin&#125;/$&#123;searchObj.end&#125;`,            method: &#x27;get&#x27;        &#125;)    &#125;</span></span><br></pre></td></tr></table></figure><h4 id="vue模板和方法"><a href="#vue模板和方法" class="headerlink" title="vue模板和方法"></a>vue模板和方法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;  &lt;div class=&quot;app-container&quot;&gt;    &lt;!--表单--&gt;    &lt;el-form :inline=&quot;true&quot; class=&quot;demo-form-inline&quot;&gt;      &lt;el-form-item&gt;        &lt;el-select v-model=&quot;searchObj.type&quot; clearable placeholder=&quot;请选择&quot;&gt;          &lt;el-option label=&quot;学员登录数统计&quot; value=&quot;login_num&quot; /&gt;          &lt;el-option label=&quot;学员注册数统计&quot; value=&quot;register_num&quot; /&gt;          &lt;el-option label=&quot;课程播放数统计&quot; value=&quot;video_view_num&quot; /&gt;          &lt;el-option label=&quot;每日课程数统计&quot; value=&quot;course_num&quot; /&gt;        &lt;/el-select&gt;      &lt;/el-form-item&gt;      &lt;el-form-item&gt;        &lt;el-date-picker          v-model=&quot;searchObj.begin&quot;          type=&quot;date&quot;          placeholder=&quot;选择开始日期&quot;          value-format=&quot;yyyy-MM-dd&quot;        /&gt;      &lt;/el-form-item&gt;      &lt;el-form-item&gt;        &lt;el-date-picker          v-model=&quot;searchObj.end&quot;          type=&quot;date&quot;          placeholder=&quot;选择截止日期&quot;          value-format=&quot;yyyy-MM-dd&quot;        /&gt;      &lt;/el-form-item&gt;      &lt;el-button        :disabled=&quot;btnDisabled&quot;        type=&quot;primary&quot;        icon=&quot;el-icon-search&quot;        @click=&quot;showChart()&quot;        &gt;查询&lt;/el-button      &gt;    &lt;/el-form&gt;    &lt;div class=&quot;chart-container&quot;&gt;      &lt;div id=&quot;chart&quot; class=&quot;chart&quot; style=&quot;height: 500px; width: 100%&quot; /&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;  import echarts from &#x27;echarts&#x27;  import staApi from &#x27;@/api/statistics&#x27;  export default &#123;    data() &#123;      return &#123;        searchObj: &#123;&#125;,        btnDisabled: false,        xData: [],        yData: []      &#125;    &#125;,    methods: &#123;      showChart() &#123;        staApi.getChartData(this.searchObj).then(result =&gt; &#123;          this.yData = result.data.numList          this.xData = result.data.dateList          // 调用下面生成图表的方法，改变值          this.setChart()        &#125;)      &#125;,      // 默认显示图表方法      setChart() &#123;        // 基于准备好的dom，初始化echarts实例        this.chart = echarts.init(document.getElementById(&#x27;chart&#x27;))        // console.log(this.chart)        // 指定图表的配置项和数据        var option = &#123;          title: &#123;            text: &#x27;数据统计&#x27;          &#125;,          tooltip: &#123;            trigger: &#x27;axis&#x27;          &#125;,          dataZoom: [            &#123;              show: true,              height: 30,              xAxisIndex: [0],              bottom: 30,              start: 10,              end: 80,              handleIcon:                &#x27;path://M306.1,413c0,2.2-1.8,4-4,4h-59.8c-2.2,0-4-1.8-4-4V200.8c0-2.2,1.8-4,4-4h59.8c2.2,0,4,1.8,4,4V413z&#x27;,              handleSize: &#x27;110%&#x27;,              handleStyle: &#123;                color: &#x27;#d3dee5&#x27;              &#125;,              textStyle: &#123;                color: &#x27;#fff&#x27;              &#125;,              borderColor: &#x27;#90979c&#x27;            &#125;,            &#123;              type: &#x27;inside&#x27;,              show: true,              height: 15,              start: 1,              end: 35            &#125;          ],          // x轴是类目轴（离散数据）,必须通过data设置类目数据          xAxis: &#123;            type: &#x27;category&#x27;,            data: this.xData          &#125;,          // y轴是数据轴（连续数据）          yAxis: &#123;            type: &#x27;value&#x27;          &#125;,          // 系列列表。每个系列通过 type 决定自己的图表类型          series: [            &#123;              // 系列中的数据内容数组              data: this.yData,              // 折线图              type: &#x27;line&#x27;            &#125;          ]        &#125;        this.chart.setOption(option)      &#125;    &#125;  &#125;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="Canal数据同步"><a href="#Canal数据同步" class="headerlink" title="Canal数据同步"></a>Canal数据同步</h2><blockquote><p>将远程数据库中的数据同步到本地数据库中，一般实际中项目有很多个数据库（比如说统计分析专门一个数据库），其与远程服务调用调用的区别是，该同步耦合度低，效率更高。</p></blockquote><h3 id="linux配置与开启"><a href="#linux配置与开启" class="headerlink" title="linux配置与开启"></a>linux配置与开启</h3><blockquote><ol><li>linux中需要安装mysql（本地Windows也需要mysql）</li><li>创建数据库表（结构需要一样）</li></ol></blockquote><h4 id="linux中docker中使用mysql一些常见命令"><a href="#linux中docker中使用mysql一些常见命令" class="headerlink" title="linux中docker中使用mysql一些常见命令"></a>linux中docker中使用mysql一些常见命令</h4><blockquote><ol><li>su root</li><li>docker ps</li><li>docker start mysql</li><li>docker exec -it mysql bash</li><li>mysql -u root -p</li><li>可以使用命令行，也可以直接用配好的Navicat（实战5中配置redis的时候已经配置好了mysql）</li><li>exit</li><li>docker stop CONTAINER ID</li></ol></blockquote><h4 id="创建数据库表"><a href="#创建数据库表" class="headerlink" title="创建数据库表"></a>创建数据库表</h4><blockquote><p>数据库guli，表test_canal</p><p>注意结构需要一样</p></blockquote><h4 id="mysql开启binlog"><a href="#mysql开启binlog" class="headerlink" title="mysql开启binlog"></a>mysql开启binlog</h4><blockquote><ol><li>开启并进入mysql</li><li>show variables like ‘log_bin’;  查询是否开启binlog</li><li>修改my.cnf（如果使用docker，那么要去挂载的目录下修改），具体如下篇文章</li><li><a href="https://www.freebytes.net/it/java/dokcer-mysql-binlog.htmlz">https://www.freebytes.net/it/java/dokcer-mysql-binlog.htmlz</a></li></ol><p>这里花了大概半个小时吧，还是个人博客文章靠谱，那些CSDN的文章都是炒来炒去的，这篇文章很清楚地讲了你挂载的目录是前半部分（我看CSDN那些文章总以为是配置挂载的时候的后半部分，所以弄了好久都没有用，看了这篇文章几分钟就解决了）</p></blockquote><h4 id="安装并配置canal"><a href="#安装并配置canal" class="headerlink" title="安装并配置canal"></a>安装并配置canal</h4><blockquote><p>linux中下载然后解压</p><p>具体配置见视频</p><p>开启canal即可，进入bin文件夹下sh startup.sh</p></blockquote><h3 id="客户端代码编写"><a href="#客户端代码编写" class="headerlink" title="客户端代码编写"></a>客户端代码编写</h3><blockquote><p>创建模块</p></blockquote><h4 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.otter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>canal.client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端口</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">10000</span></span><br><span class="line"><span class="comment"># 服务名</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">canal-client</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 环境设置：dev、test、prod</span></span><br><span class="line"><span class="meta">spring.profiles.active</span>=<span class="string">dev</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># mysql数据库连接</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">123456789</span></span><br></pre></td></tr></table></figure><h4 id="canal客户端类"><a href="#canal客户端类" class="headerlink" title="canal客户端类"></a>canal客户端类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CanalClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//sql队列</span></span><br><span class="line">    <span class="keyword">private</span> Queue&lt;String&gt; SQL_QUEUE = <span class="keyword">new</span> ConcurrentLinkedQueue&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * canal入库方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        CanalConnector connector = CanalConnectors.newSingleConnector(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;192.168.128.129&quot;</span>,</span><br><span class="line">                <span class="number">11111</span>), <span class="string">&quot;example&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> batchSize = <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connector.connect();</span><br><span class="line">            connector.subscribe(<span class="string">&quot;.*\\..*&quot;</span>);</span><br><span class="line">            connector.rollback();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                    <span class="comment">//尝试从master那边拉去数据batchSize条记录，有多少取多少</span></span><br><span class="line">                    Message message = connector.getWithoutAck(batchSize);</span><br><span class="line">                    <span class="keyword">long</span> batchId = message.getId();</span><br><span class="line">                    <span class="keyword">int</span> size = message.getEntries().size();</span><br><span class="line">                    <span class="keyword">if</span> (batchId == -<span class="number">1</span> || size == <span class="number">0</span>) &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        dataHandle(message.getEntries());</span><br><span class="line">                    &#125;</span><br><span class="line">                    connector.ack(batchId);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//当队列里面堆积的sql大于一定数值的时候就模拟执行</span></span><br><span class="line">                    <span class="keyword">if</span> (SQL_QUEUE.size() &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">                        executeQueueSql();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InvalidProtocolBufferException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            connector.disconnect();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模拟执行队列里面的sql语句</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executeQueueSql</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> size = SQL_QUEUE.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            String sql = SQL_QUEUE.poll();</span><br><span class="line">            System.out.println(<span class="string">&quot;[sql]----&gt; &quot;</span> + sql);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.execute(sql.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据处理</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> entrys</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dataHandle</span><span class="params">(List&lt;Entry&gt; entrys)</span> <span class="keyword">throws</span> InvalidProtocolBufferException </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Entry entry : entrys) &#123;</span><br><span class="line">            <span class="keyword">if</span> (EntryType.ROWDATA == entry.getEntryType()) &#123;</span><br><span class="line">                RowChange rowChange = RowChange.parseFrom(entry.getStoreValue());</span><br><span class="line">                EventType eventType = rowChange.getEventType();</span><br><span class="line">                <span class="keyword">if</span> (eventType == EventType.DELETE) &#123;</span><br><span class="line">                    saveDeleteSql(entry);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (eventType == EventType.UPDATE) &#123;</span><br><span class="line">                    saveUpdateSql(entry);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (eventType == EventType.INSERT) &#123;</span><br><span class="line">                    saveInsertSql(entry);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存更新语句</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> entry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveUpdateSql</span><span class="params">(Entry entry)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            RowChange rowChange = RowChange.parseFrom(entry.getStoreValue());</span><br><span class="line">            List&lt;RowData&gt; rowDatasList = rowChange.getRowDatasList();</span><br><span class="line">            <span class="keyword">for</span> (RowData rowData : rowDatasList) &#123;</span><br><span class="line">                List&lt;Column&gt; newColumnList = rowData.getAfterColumnsList();</span><br><span class="line">                StringBuffer sql = <span class="keyword">new</span> StringBuffer(<span class="string">&quot;update &quot;</span> + entry.getHeader().getTableName() + <span class="string">&quot; set &quot;</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; newColumnList.size(); i++) &#123;</span><br><span class="line">                    sql.append(<span class="string">&quot; &quot;</span> + newColumnList.get(i).getName()</span><br><span class="line">                            + <span class="string">&quot; = &#x27;&quot;</span> + newColumnList.get(i).getValue() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (i != newColumnList.size() - <span class="number">1</span>) &#123;</span><br><span class="line">                        sql.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                sql.append(<span class="string">&quot; where &quot;</span>);</span><br><span class="line">                List&lt;Column&gt; oldColumnList = rowData.getBeforeColumnsList();</span><br><span class="line">                <span class="keyword">for</span> (Column column : oldColumnList) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (column.getIsKey()) &#123;</span><br><span class="line">                        <span class="comment">//暂时只支持单一主键</span></span><br><span class="line">                        sql.append(column.getName() + <span class="string">&quot;=&quot;</span> + column.getValue());</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                SQL_QUEUE.add(sql.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidProtocolBufferException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存删除语句</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> entry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveDeleteSql</span><span class="params">(Entry entry)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            RowChange rowChange = RowChange.parseFrom(entry.getStoreValue());</span><br><span class="line">            List&lt;RowData&gt; rowDatasList = rowChange.getRowDatasList();</span><br><span class="line">            <span class="keyword">for</span> (RowData rowData : rowDatasList) &#123;</span><br><span class="line">                List&lt;Column&gt; columnList = rowData.getBeforeColumnsList();</span><br><span class="line">                StringBuffer sql = <span class="keyword">new</span> StringBuffer(<span class="string">&quot;delete from &quot;</span> + entry.getHeader().getTableName() + <span class="string">&quot; where &quot;</span>);</span><br><span class="line">                <span class="keyword">for</span> (Column column : columnList) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (column.getIsKey()) &#123;</span><br><span class="line">                        <span class="comment">//暂时只支持单一主键</span></span><br><span class="line">                        sql.append(column.getName() + <span class="string">&quot;=&quot;</span> + column.getValue());</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                SQL_QUEUE.add(sql.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidProtocolBufferException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存插入语句</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> entry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveInsertSql</span><span class="params">(Entry entry)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            RowChange rowChange = RowChange.parseFrom(entry.getStoreValue());</span><br><span class="line">            List&lt;RowData&gt; rowDatasList = rowChange.getRowDatasList();</span><br><span class="line">            <span class="keyword">for</span> (RowData rowData : rowDatasList) &#123;</span><br><span class="line">                List&lt;Column&gt; columnList = rowData.getAfterColumnsList();</span><br><span class="line">                StringBuffer sql = <span class="keyword">new</span> StringBuffer(<span class="string">&quot;insert into &quot;</span> + entry.getHeader().getTableName() + <span class="string">&quot; (&quot;</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; columnList.size(); i++) &#123;</span><br><span class="line">                    sql.append(columnList.get(i).getName());</span><br><span class="line">                    <span class="keyword">if</span> (i != columnList.size() - <span class="number">1</span>) &#123;</span><br><span class="line">                        sql.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                sql.append(<span class="string">&quot;) VALUES (&quot;</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; columnList.size(); i++) &#123;</span><br><span class="line">                    sql.append(<span class="string">&quot;&#x27;&quot;</span> + columnList.get(i).getValue() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (i != columnList.size() - <span class="number">1</span>) &#123;</span><br><span class="line">                        sql.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                sql.append(<span class="string">&quot;)&quot;</span>);</span><br><span class="line">                SQL_QUEUE.add(sql.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidProtocolBufferException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 入库</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(String sql)</span> </span>&#123;</span><br><span class="line">        Connection con = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == sql) <span class="keyword">return</span>;</span><br><span class="line">            con = dataSource.getConnection();</span><br><span class="line">            QueryRunner qr = <span class="keyword">new</span> QueryRunner();</span><br><span class="line">            <span class="keyword">int</span> row = qr.execute(con, sql);</span><br><span class="line">            System.out.println(<span class="string">&quot;update: &quot;</span> + row);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            DbUtils.closeQuietly(con);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="启动类"><a href="#启动类" class="headerlink" title="启动类"></a>启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CanalApplication</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CanalClient canalClient;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(CanalApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... strings)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//项目启动，执行canal客户端监听</span></span><br><span class="line">        canalClient.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><blockquote><p>TODO，这里application启动失败，去canal的log里看，说连接mysql的ip失败了，原因是address already in use,</p><p>然后我改了重启还是这个原因，本来没有被占用的端口启动了之后就被占用了，但是canal还是启动失败，就离谱，</p><p>总之原因是canal没有启动，address already in use</p><p>还是没解决，放弃了（我不理解！！！）</p></blockquote><h2 id="SpringCloud微服务"><a href="#SpringCloud微服务" class="headerlink" title="SpringCloud微服务"></a>SpringCloud微服务</h2><h3 id="Gateway网关"><a href="#Gateway网关" class="headerlink" title="Gateway网关"></a>Gateway网关</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><blockquote><p>微服务架构之下不同的微服务有不同的网络地址，外部客户端需要调用多个服务的接口才能完成一个业务需求，但是如果直接让客户端与各个服务器通信，会出现许多问题，所以这些问题需要借助API网关解决。</p><p>网关是结余客户端和服务端之间的之间层，所有外部请求都会先经过API网关这一层，所以网关实现安全，性能，监控等操作。</p><p>就是之前的nginx的增强版</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211006164431906.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211006164431906.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211006164431906"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211006171309513.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211006171309513.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211006171309513"></p><h4 id="创建模块"><a href="#创建模块" class="headerlink" title="创建模块"></a>创建模块</h4><blockquote><p>创建模块infrastructure，子模块api_gateway</p></blockquote><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common_utils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--gson--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--服务调用--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h4><blockquote><p>配置服务按如下配置即可</p><p>也可以使用YAML格式，更方便不用写下标</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端口</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8222</span></span><br><span class="line"><span class="comment"># 服务名</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">service-gateway</span></span><br><span class="line"><span class="comment"># nacos服务地址</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.discovery.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br><span class="line"><span class="comment">#使用服务发现路由</span></span><br><span class="line"><span class="meta">spring.cloud.gateway.discovery.locator.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#设置路由id</span></span><br><span class="line"><span class="meta">spring.cloud.gateway.routes[0].id</span>=<span class="string">service-acl</span></span><br><span class="line"><span class="comment">#设置路由的uri   lb://nacos注册服务名称</span></span><br><span class="line"><span class="meta">spring.cloud.gateway.routes[0].uri</span>=<span class="string">lb://service-acl</span></span><br><span class="line"><span class="comment">#设置路由断言,代理servicerId为auth-service的/auth/路径</span></span><br><span class="line"><span class="meta">spring.cloud.gateway.routes[0].predicates</span>=<span class="string">Path=/*/acl/**</span></span><br><span class="line"><span class="comment">#配置service-edu服务</span></span><br><span class="line"><span class="meta">spring.cloud.gateway.routes[1].id</span>=<span class="string">service-edu</span></span><br><span class="line"><span class="meta">spring.cloud.gateway.routes[1].uri</span>=<span class="string">lb://service-edu</span></span><br><span class="line"><span class="meta">spring.cloud.gateway.routes[1].predicates</span>=<span class="string">Path=/eduservice/**</span></span><br><span class="line"><span class="comment">#配置service-edu服务</span></span><br><span class="line"><span class="meta">spring.cloud.gateway.routes[2].id</span>=<span class="string">service-msm</span></span><br><span class="line"><span class="meta">spring.cloud.gateway.routes[2].uri</span>=<span class="string">lb://service-msm</span></span><br><span class="line"><span class="meta">spring.cloud.gateway.routes[2].predicates</span>=<span class="string">Path=/edumsm/**</span></span><br></pre></td></tr></table></figure><h4 id="启动类-1"><a href="#启动类-1" class="headerlink" title="启动类"></a>启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span><span class="comment">//nacos</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GatewayApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(GatewayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>测试：使用网关的端口号即可访问已配置的微服务OK</p></blockquote><h4 id="跨域问题"><a href="#跨域问题" class="headerlink" title="跨域问题"></a>跨域问题</h4><blockquote><p>在网关中统一开启跨域，cv一下固定config、filter、handler</p><p>注意controller中的跨域注解不能有，要不然两次跨域抵消</p></blockquote><h2 id="权限管理（后端）"><a href="#权限管理（后端）" class="headerlink" title="权限管理（后端）"></a>权限管理（后端）</h2><p>![07 权限管理需求](<a href="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/07">https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/07</a> 权限管理需求.png)</p><h3 id="环境搭建-1"><a href="#环境搭建-1" class="headerlink" title="环境搭建"></a>环境搭建</h3><h4 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h4><blockquote><p>service_acl，spring_security</p></blockquote><h4 id="依赖-1"><a href="#依赖-1" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring_security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="整合接口"><a href="#整合接口" class="headerlink" title="整合接口"></a>整合接口</h4><blockquote><p>直接CV好家伙，好像是因为太复杂了吧，没事下个项目自己做</p></blockquote><h3 id="获取所有菜单"><a href="#获取所有菜单" class="headerlink" title="获取所有菜单"></a>获取所有菜单</h3><blockquote><p>递归，构建树形结构（注意菜单可能有多级结构（之前做过两级的））</p></blockquote><h4 id="entity"><a href="#entity" class="headerlink" title="entity"></a>entity</h4><blockquote><p>注意这个实体类的属性，使用了递归存储children</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Permission</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;编号&quot;)</span></span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.ID_WORKER_STR)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;所属上级&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String pid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;层级&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="keyword">private</span> Integer level;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;下级&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Permission&gt; children;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-1"><a href="#controller-1" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/acl/permission&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PermissionService permissionService;</span><br><span class="line">    <span class="comment">//获取全部菜单</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;查询所有菜单&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">indexAllPermission</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Permission&gt; list =  permissionService.queryAllMenuGuli();</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;children&quot;</span>,list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service-1"><a href="#service-1" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取全部菜单</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Permission&gt; <span class="title">queryAllMenuGuli</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 查询菜单表所有数据</span></span><br><span class="line">    QueryWrapper&lt;Permission&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.orderByDesc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    List&lt;Permission&gt; permissionList = baseMapper.selectList(wrapper);</span><br><span class="line">    <span class="comment">//2 把查询所有菜单list集合按照要求进行封装</span></span><br><span class="line">    List&lt;Permission&gt; resultList = bulidPermission(permissionList);</span><br><span class="line">    <span class="keyword">return</span> resultList;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//把返回所有菜单list集合进行封装的方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Permission&gt; <span class="title">bulidPermission</span><span class="params">(List&lt;Permission&gt; permissionList)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建list集合，用于数据最终封装</span></span><br><span class="line">    List&lt;Permission&gt; finalNode = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">//把所有菜单list集合遍历，得到顶层菜单 pid=0菜单，设置level是1</span></span><br><span class="line">    <span class="keyword">for</span>(Permission permissionNode : permissionList) &#123;</span><br><span class="line">        <span class="comment">//得到顶层菜单 pid=0菜单</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;0&quot;</span>.equals(permissionNode.getPid())) &#123;</span><br><span class="line">            <span class="comment">//设置顶层菜单的level是1</span></span><br><span class="line">            permissionNode.setLevel(<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//根据顶层菜单，向里面进行查询子菜单，封装到finalNode里面</span></span><br><span class="line">            finalNode.add(selectChildren(permissionNode,permissionList));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> finalNode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Permission <span class="title">selectChildren</span><span class="params">(Permission permissionNode, List&lt;Permission&gt; permissionList)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 因为向一层菜单里面放二层菜单，二层里面还要放三层，把对象初始化</span></span><br><span class="line">    permissionNode.setChildren(<span class="keyword">new</span> ArrayList&lt;Permission&gt;());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2 遍历所有菜单list集合，进行判断比较，比较id和pid值是否相同</span></span><br><span class="line">    <span class="keyword">for</span>(Permission it : permissionList) &#123;</span><br><span class="line">        <span class="comment">//判断 id和pid值是否相同</span></span><br><span class="line">        <span class="keyword">if</span>(permissionNode.getId().equals(it.getPid())) &#123;</span><br><span class="line">            <span class="comment">//当前level=父菜单的level值+1</span></span><br><span class="line">            <span class="keyword">int</span> level = permissionNode.getLevel()+<span class="number">1</span>;</span><br><span class="line">            it.setLevel(level);</span><br><span class="line">            <span class="comment">//如果children为空，进行初始化操作</span></span><br><span class="line">            <span class="comment">//if(permissionNode.getChildren() == null) &#123;</span></span><br><span class="line">            <span class="comment">//    permissionNode.setChildren(new ArrayList&lt;Permission&gt;());</span></span><br><span class="line">            <span class="comment">//&#125;</span></span><br><span class="line">            <span class="comment">//把查询出来的子菜单放到父菜单里面</span></span><br><span class="line">            permissionNode.getChildren().add(selectChildren(it,permissionList));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> permissionNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><blockquote><p>SwaggerConfig类中有一行代码需要注释才能测试,，表示路径中有这个关键字则不让测试，可以注释掉这行代码也可以修改controller的路径</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Docket <span class="title">webApiConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">               .groupName(<span class="string">&quot;webApi&quot;</span>)</span><br><span class="line">               .apiInfo(webApiInfo())</span><br><span class="line">               .select()</span><br><span class="line">               <span class="comment">// .paths(Predicates.not(PathSelectors.regex(&quot;/admin/.*&quot;)))</span></span><br><span class="line">               .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/error.*&quot;</span>)))</span><br><span class="line">               .build();</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></blockquote><h3 id="删除菜单"><a href="#删除菜单" class="headerlink" title="删除菜单"></a>删除菜单</h3><blockquote><p>递归删除，删除上级菜单下级菜单也要同时删除</p></blockquote><h4 id="controller-2"><a href="#controller-2" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;递归删除菜单&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;remove/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">remove</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> </span>&#123;</span><br><span class="line">    permissionService.removeChildByIdGuli(id);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service-2"><a href="#service-2" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//============递归删除菜单==================================</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeChildByIdGuli</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 创建list集合，用于封装所有删除菜单id值</span></span><br><span class="line">    List&lt;String&gt; idList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">//2 向idList集合设置删除菜单id</span></span><br><span class="line">    <span class="keyword">this</span>.selectPermissionChildById(id, idList);</span><br><span class="line">    <span class="comment">//把当前id封装到list里面</span></span><br><span class="line">    idList.add(id);</span><br><span class="line">    baseMapper.deleteBatchIds(idList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2 根据当前菜单id，查询菜单里面子菜单id，封装到list集合</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">selectPermissionChildById</span><span class="params">(String id, List&lt;String&gt; idList)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//查询菜单里面子菜单id</span></span><br><span class="line">    QueryWrapper&lt;Permission&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;pid&quot;</span>, id);</span><br><span class="line">    wrapper.select(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    List&lt;Permission&gt; childIdList = baseMapper.selectList(wrapper);</span><br><span class="line">    <span class="comment">//把childIdList里面菜单id值获取出来，封装idList里面，做递归查询</span></span><br><span class="line">    childIdList.stream().forEach(item -&gt; &#123;</span><br><span class="line">        <span class="comment">//封装idList里面</span></span><br><span class="line">        idList.add(item.getId());</span><br><span class="line">        <span class="comment">//递归查询</span></span><br><span class="line">        <span class="keyword">this</span>.selectPermissionChildById(item.getId(), idList);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="角色分配权限"><a href="#角色分配权限" class="headerlink" title="角色分配权限"></a>角色分配权限</h3><h4 id="controller-3"><a href="#controller-3" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;给角色分配权限&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/doAssign&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">doAssign</span><span class="params">(String roleId,String[] permissionId)</span> </span>&#123;</span><br><span class="line">    permissionService.saveRolePermissionRealtionShipGuli(roleId,permissionId);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service-3"><a href="#service-3" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=========================给角色分配菜单=======================</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveRolePermissionRealtionShipGuli</span><span class="params">(String roleId, String[] permissionIds)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//roleId角色id</span></span><br><span class="line">    <span class="comment">//permissionId菜单id 数组形式</span></span><br><span class="line">    <span class="comment">//1 创建list集合，用于封装添加数据</span></span><br><span class="line">    List&lt;RolePermission&gt; rolePermissionList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">//遍历所有菜单数组</span></span><br><span class="line">    <span class="keyword">for</span> (String perId : permissionIds) &#123;</span><br><span class="line">        <span class="comment">//RolePermission对象</span></span><br><span class="line">        RolePermission rolePermission = <span class="keyword">new</span> RolePermission();</span><br><span class="line">        rolePermission.setRoleId(roleId);</span><br><span class="line">        rolePermission.setPermissionId(perId);</span><br><span class="line">        <span class="comment">//封装到list集合</span></span><br><span class="line">        rolePermissionList.add(rolePermission);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//添加到角色菜单关系表</span></span><br><span class="line">    rolePermissionService.saveBatch(rolePermissionList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SpringSecurity"><a href="#SpringSecurity" class="headerlink" title="SpringSecurity"></a>SpringSecurity</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><blockquote><p>spring-security实现功能如下：</p><ol><li>用户认证：用户登录时查询数据库验证用户名和密码</li><li>用户授权：登录之后给予用户对应的权限和操作功能</li></ol><p>spring-security本质上是filter，对请求进行过滤：</p><ul><li>基于session，则对cookie中的sessionid进行解析找到服务器存储的session信息然后判断当前用户是否符合请求的要求</li><li>基于token，则解析出token然后将当前请求加入到spring-security管理的权限信息当中</li></ul></blockquote><h3 id="认证和授权实现思路"><a href="#认证和授权实现思路" class="headerlink" title="认证和授权实现思路"></a>认证和授权实现思路</h3><blockquote><p>如果系统的模块众多，每个模块都需要就行授权与认证，所以我们选择基于token的形式进行授权与认证，用户根据用户名密码认证成功，然后获取当前用户角色的一系列权限值，并以用户名为key，权限列表为value的形式存入redis缓存中，根据用户名相关信息生成token返回，浏览器将token记录到cookie中，每次调用api接口都默认将token携带到header请求头中，Spring-security解析header头获取token信息，解析token获取当前用户名，根据用户名就可以从redis中获取权限列表，这样Spring-security就能够判断当前请求是否有权限访问</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211007145558209.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20211007145558209.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20211007145558209"></p><h3 id="整合"><a href="#整合" class="headerlink" title="整合"></a>整合</h3><h4 id="依赖-2"><a href="#依赖-2" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common_utils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Security依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/6aafe337-8a5d-440c-b93d-ff60d4f9cef6.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/6aafe337-8a5d-440c-b93d-ff60d4f9cef6.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="6aafe337-8a5d-440c-b93d-ff60d4f9cef6"></p><h3 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a>测试</h3><blockquote><p>妈耶太吓人了幸好我备份了（为啥git不先讲），试了下整合，菜单栏还是显示不出来，先恢复了，以后再试</p></blockquote><h2 id="Nacos配置管理"><a href="#Nacos配置管理" class="headerlink" title="Nacos配置管理"></a>Nacos配置管理</h2><h2 id="Git版本管理"><a href="#Git版本管理" class="headerlink" title="Git版本管理"></a>Git版本管理</h2><blockquote><p>创建本地git仓库：idea -&gt; VCS -&gt; Create Git Repository </p><p>将文件加到本地仓库：idea -&gt; 父项目名 -&gt; 右键 -&gt; git -&gt; add</p><p>添加远程仓库地址：idea -&gt; 父项目名 -&gt; 右键 -&gt; git -&gt; git remotes</p><p>将文件提交至远程仓库：commit</p><p>上传：push</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】在线教育项目实战6</title>
      <link href="/2021/10/02/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-6/"/>
      <url>/2021/10/02/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-6/</url>
      
        <content type="html"><![CDATA[<h2 id="前台讲师列表和详情（后端-前端）"><a href="#前台讲师列表和详情（后端-前端）" class="headerlink" title="前台讲师列表和详情（后端+前端）"></a>前台讲师列表和详情（后端+前端）</h2><h3 id="讲师分页列表（后端）"><a href="#讲师分页列表（后端）" class="headerlink" title="讲师分页列表（后端）"></a>讲师分页列表（后端）</h3><h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/teacherfront&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduTeacherService teacherService;</span><br><span class="line">    <span class="comment">// 分页查询讲师列表</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getTeacherFront/&#123;pageNo&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getTeacherFront</span><span class="params">(<span class="meta">@PathVariable</span> Long limit, <span class="meta">@PathVariable</span> Long pageNo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建page对象</span></span><br><span class="line">        Page&lt;EduTeacher&gt; pageTeacher = <span class="keyword">new</span> Page&lt;&gt;(pageNo, limit);</span><br><span class="line">        <span class="comment">// 调用方法实现分类</span></span><br><span class="line">        Map&lt;String, Object&gt; map = teacherService.getTeacherFront(pageTeacher);</span><br><span class="line">        <span class="comment">// 返回分页所有数据</span></span><br><span class="line">        <span class="keyword">return</span> R.ok().data(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduTeacherServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">EduTeacherMapper</span>, <span class="title">EduTeacher</span>&gt; <span class="keyword">implements</span> <span class="title">EduTeacherService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Cacheable(key = &quot;&#x27;indexTeacherList&#x27;&quot;, value = &quot;teacher&quot;)</span>   <span class="comment">// redis</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;EduTeacher&gt; <span class="title">getIndexList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> baseMapper.selectIndexList();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 分页查询讲师列表</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getTeacherFront</span><span class="params">(Page&lt;EduTeacher&gt; pageTeacher)</span> </span>&#123;</span><br><span class="line">        QueryWrapper wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        wrapper.orderByDesc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        baseMapper.selectPage(pageTeacher, wrapper);</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;records&quot;</span>, pageTeacher.getRecords());</span><br><span class="line">        map.put(<span class="string">&quot;total&quot;</span>, pageTeacher.getTotal());</span><br><span class="line">        map.put(<span class="string">&quot;size&quot;</span>, pageTeacher.getSize());</span><br><span class="line">        map.put(<span class="string">&quot;current&quot;</span>, pageTeacher.getCurrent());</span><br><span class="line">        map.put(<span class="string">&quot;pages&quot;</span>, pageTeacher.getPages());</span><br><span class="line">        map.put(<span class="string">&quot;hasNext&quot;</span>, pageTeacher.hasNext());</span><br><span class="line">        map.put(<span class="string">&quot;hasPrevious&quot;</span>, pageTeacher.hasPrevious());</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="讲师分页列表（前端）"><a href="#讲师分页列表（前端）" class="headerlink" title="讲师分页列表（前端）"></a>讲师分页列表（前端）</h3><h4 id="api"><a href="#api" class="headerlink" title="api"></a>api</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 讲师分页列表</span></span><br><span class="line">  <span class="function"><span class="title">getTeacherList</span>(<span class="params">pageNo, limit</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/eduservice/teacherfront/getTeacherFront/<span class="subst">$&#123;pageNo&#125;</span>/<span class="subst">$&#123;limit&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="vue"><a href="#vue" class="headerlink" title="vue"></a>vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;aCoursesList&quot; class=&quot;bg-fa of&quot;&gt;</span><br><span class="line">    &lt;!-- 讲师列表 开始 --&gt;</span><br><span class="line">    &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;header class=&quot;comm-title all-teacher-title&quot;&gt;</span><br><span class="line">        &lt;h2 class=&quot;fl tac&quot;&gt;</span><br><span class="line">          &lt;span class=&quot;c-333&quot;&gt;全部讲师&lt;/span&gt;</span><br><span class="line">        &lt;/h2&gt;</span><br><span class="line">        &lt;section class=&quot;c-tab-title&quot;&gt;</span><br><span class="line">          &lt;a id=&quot;subjectAll&quot; title=&quot;全部&quot; href=&quot;#&quot;&gt;全部&lt;/a&gt;</span><br><span class="line">        &lt;/section&gt;</span><br><span class="line">      &lt;/header&gt;</span><br><span class="line">      &lt;section class=&quot;c-sort-box unBr&quot;&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;!-- /无数据提示 开始--&gt;</span><br><span class="line">          &lt;section class=&quot;no-data-wrap&quot; v-if=&quot;listMap.total == 0&quot;&gt;</span><br><span class="line">            &lt;em class=&quot;icon30 no-data-ico&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">            &lt;span class=&quot;c-666 fsize14 ml10 vam&quot;</span><br><span class="line">              &gt;没有相关数据，小编正在努力整理中...&lt;/span</span><br><span class="line">            &gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">          &lt;!-- /无数据提示 结束--&gt;</span><br><span class="line">          &lt;article class=&quot;i-teacher-list&quot; v-if=&quot;listMap.total &gt; 0&quot;&gt;</span><br><span class="line">            &lt;ul class=&quot;of&quot;&gt;</span><br><span class="line">              &lt;li v-for=&quot;teacher in listMap.records&quot; :key=&quot;teacher.id&quot;&gt;</span><br><span class="line">                &lt;section class=&quot;i-teach-wrap&quot;&gt;</span><br><span class="line">                  &lt;div class=&quot;i-teach-pic&quot;&gt;</span><br><span class="line">                    &lt;a </span><br><span class="line">                       :href=&quot;&#x27;/teacehr/&#x27;+teacher.id&quot;</span><br><span class="line">                       :title=&quot;teacher.name&quot; target=&quot;_blank&quot;&gt;</span><br><span class="line">                      &lt;img :src=&quot;teacher.avatar&quot; alt /&gt;</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                  &lt;div class=&quot;mt10 hLh30 txtOf tac&quot;&gt;</span><br><span class="line">                    &lt;a</span><br><span class="line">                      :href=&quot;&#x27;/teacehr/&#x27;+teacher.id&quot;</span><br><span class="line">                      :title=&quot;teacher.name&quot;</span><br><span class="line">                      target=&quot;_blank&quot;</span><br><span class="line">                      class=&quot;fsize18 c-666&quot;</span><br><span class="line">                      &gt;&#123;&#123; teacher.name &#125;&#125;&lt;/a</span><br><span class="line">                    &gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                  &lt;div class=&quot;hLh30 txtOf tac&quot;&gt;</span><br><span class="line">                    &lt;span class=&quot;fsize14 c-999&quot;&gt;&#123;&#123; teacher.intro &#125;&#125;&lt;/span&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                  &lt;div class=&quot;mt15 i-q-txt&quot;&gt;</span><br><span class="line">                    &lt;p class=&quot;c-999 f-fA&quot;&gt;&#123;&#123; teacher.career &#125;&#125;&lt;/p&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/section&gt;</span><br><span class="line">              &lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">            &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">          &lt;/article&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">    &lt;!-- /讲师列表 结束 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import teacherApi from &#x27;@/api/teacher&#x27;</span><br><span class="line">  export default &#123;</span><br><span class="line">    // 这个页面模板没有使用element-ui的分页条，所以写法有所变化</span><br><span class="line">    // 使用异步调用（this.$route.param == params获取url中的参数值）</span><br><span class="line">    // 该方法只调用一次</span><br><span class="line">    asyncData(&#123; params, error &#125;) &#123;</span><br><span class="line">      return teacherApi.getTeacherList(1, 8).then(result =&gt; &#123;</span><br><span class="line">        // 这里是赋值的简写方式</span><br><span class="line">        return &#123; listMap: result.data.data &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="分页条"><a href="#分页条" class="headerlink" title="分页条"></a>分页条</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;aCoursesList&quot; class=&quot;bg-fa of&quot;&gt;</span><br><span class="line">        &lt;!-- 公共分页 开始 --&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;div class=&quot;paging&quot;&gt;</span><br><span class="line">            &lt;!-- undisable这个class是否存在，取决于数据属性hasPrevious --&gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              :class=&quot;&#123; undisable: !listMap.hasPrevious &#125;&quot;</span><br><span class="line">              href=&quot;#&quot;</span><br><span class="line">              title=&quot;首页&quot;</span><br><span class="line">              @click.prevent=&quot;gotoPage(1)&quot;</span><br><span class="line">              &gt;首页&lt;/a</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              :class=&quot;&#123; undisable: !listMap.hasPrevious &#125;&quot;</span><br><span class="line">              href=&quot;#&quot;</span><br><span class="line">              title=&quot;前一页&quot;</span><br><span class="line">              @click.prevent=&quot;gotoPage(listMap.current - 1)&quot;</span><br><span class="line">              &gt;&amp;lt;&lt;/a</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              v-for=&quot;page in listMap.pages&quot;</span><br><span class="line">              :key=&quot;page&quot;</span><br><span class="line">              :class=&quot;&#123;</span><br><span class="line">                current: listMap.current == page,</span><br><span class="line">                undisable: listMap.current == page,</span><br><span class="line">              &#125;&quot;</span><br><span class="line">              :title=&quot;&#x27;第&#x27; + page + &#x27;页&#x27;&quot;</span><br><span class="line">              href=&quot;#&quot;</span><br><span class="line">              @click.prevent=&quot;gotoPage(page)&quot;</span><br><span class="line">              &gt;&#123;&#123; page &#125;&#125;&lt;/a</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              :class=&quot;&#123; undisable: !listMap.hasNext &#125;&quot;</span><br><span class="line">              href=&quot;#&quot;</span><br><span class="line">              title=&quot;后一页&quot;</span><br><span class="line">              @click.prevent=&quot;gotoPage(listMap.current + 1)&quot;</span><br><span class="line">              &gt;&amp;gt;&lt;/a</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              :class=&quot;&#123; undisable: !listMap.hasNext &#125;&quot;</span><br><span class="line">              href=&quot;#&quot;</span><br><span class="line">              title=&quot;末页&quot;</span><br><span class="line">              @click.prevent=&quot;gotoPage(listMap.pages)&quot;</span><br><span class="line">              &gt;末页&lt;/a</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;div class=&quot;clear&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 公共分页 结束 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import teacherApi from &#x27;@/api/teacher&#x27;</span><br><span class="line">  export default &#123;</span><br><span class="line">    methods: &#123;</span><br><span class="line">      // 分页切换</span><br><span class="line">      gotoPage(page) &#123;</span><br><span class="line">        teacherApi.getTeacherList(page, 8).then(result =&gt; &#123;</span><br><span class="line">          this.listMap = result.data.data</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="讲师详情（后端）"><a href="#讲师详情（后端）" class="headerlink" title="讲师详情（后端）"></a>讲师详情（后端）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 讲师详情</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getTeacherInfoFront/&#123;teacherId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getTeacherInfoFront</span><span class="params">(<span class="meta">@PathVariable</span> String teacherId)</span> </span>&#123;</span><br><span class="line">    EduTeacher teacherInfo = teacherService.getById(teacherId);</span><br><span class="line">    QueryWrapper wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;teacher_id&quot;</span>, teacherId);</span><br><span class="line">    List&lt;EduCourse&gt; courseList = courseService.list(wrapper);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;teacherInfo&quot;</span>, teacherInfo).data(<span class="string">&quot;courseList&quot;</span>, courseList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="讲师详情（前端）"><a href="#讲师详情（前端）" class="headerlink" title="讲师详情（前端）"></a>讲师详情（前端）</h3><h4 id="api-1"><a href="#api-1" class="headerlink" title="api"></a>api</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 讲师详情</span></span><br><span class="line"><span class="function"><span class="title">getTeacherInfo</span>(<span class="params">teacherId</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/eduservice/teacherfront/getTeacherInfoFront/<span class="subst">$&#123;teacherId&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="vue-1"><a href="#vue-1" class="headerlink" title="vue"></a>vue</h4><blockquote><p>注意NUXT的动态变量的页面为_xxx.vue</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;aCoursesList&quot; class=&quot;bg-fa of&quot;&gt;</span><br><span class="line">    &lt;!-- 讲师介绍 开始 --&gt;</span><br><span class="line">    &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;header class=&quot;comm-title&quot;&gt;</span><br><span class="line">        &lt;h2 class=&quot;fl tac&quot;&gt;</span><br><span class="line">          &lt;span class=&quot;c-333&quot;&gt;讲师介绍&lt;/span&gt;</span><br><span class="line">        &lt;/h2&gt;</span><br><span class="line">      &lt;/header&gt;</span><br><span class="line">      &lt;div class=&quot;t-infor-wrap&quot;&gt;</span><br><span class="line">        &lt;!-- 讲师基本信息 --&gt;</span><br><span class="line">        &lt;section class=&quot;fl t-infor-box c-desc-content&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;mt20 ml20&quot;&gt;</span><br><span class="line">            &lt;section class=&quot;t-infor-pic&quot;&gt;</span><br><span class="line">              &lt;img :src=&quot;teacherInfo.avatar&quot; /&gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">            &lt;h3 class=&quot;hLh30&quot;&gt;</span><br><span class="line">              &lt;span class=&quot;fsize24 c-333&quot;</span><br><span class="line">                &gt;&#123;&#123; teacherInfo.name &#125;&#125;&amp;nbsp;&#123;&#123;</span><br><span class="line">                  teacherInfo.level === 1 ? &quot;高级讲师&quot; : &quot;首席讲师&quot;</span><br><span class="line">                &#125;&#125;&lt;/span</span><br><span class="line">              &gt;</span><br><span class="line">            &lt;/h3&gt;</span><br><span class="line">            &lt;section class=&quot;mt10&quot;&gt;</span><br><span class="line">              &lt;span class=&quot;t-tag-bg&quot;&gt;&#123;&#123; teacherInfo.career &#125;&#125;&lt;/span&gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">            &lt;section class=&quot;t-infor-txt&quot;&gt;</span><br><span class="line">              &lt;p class=&quot;mt20&quot;&gt;</span><br><span class="line">                &#123;&#123; teacherInfo.intro &#125;&#125;</span><br><span class="line">              &lt;/p&gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">            &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/section&gt;</span><br><span class="line">        &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;section class=&quot;mt30&quot;&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;header class=&quot;comm-title all-teacher-title c-course-content&quot;&gt;</span><br><span class="line">            &lt;h2 class=&quot;fl tac&quot;&gt;</span><br><span class="line">              &lt;span class=&quot;c-333&quot;&gt;主讲课程&lt;/span&gt;</span><br><span class="line">            &lt;/h2&gt;</span><br><span class="line">            &lt;section class=&quot;c-tab-title&quot;&gt;</span><br><span class="line">              &lt;a href=&quot;javascript: void(0)&quot;&gt;&amp;nbsp;&lt;/a&gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">          &lt;/header&gt;</span><br><span class="line">          &lt;!-- /无数据提示 开始--&gt;</span><br><span class="line">          &lt;section class=&quot;no-data-wrap&quot; v-if=&quot;courseList.length == 0&quot;&gt;</span><br><span class="line">            &lt;em class=&quot;icon30 no-data-ico&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">            &lt;span class=&quot;c-666 fsize14 ml10 vam&quot;</span><br><span class="line">              &gt;没有相关数据，小编正在努力整理中...&lt;/span</span><br><span class="line">            &gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">          &lt;!-- /无数据提示 结束--&gt;</span><br><span class="line">          &lt;article class=&quot;comm-course-list&quot; v-if=&quot;courseList.length &gt; 0&quot;&gt;</span><br><span class="line">            &lt;ul class=&quot;of&quot;&gt;</span><br><span class="line">              &lt;li v-for=&quot;course in courseList&quot; :key=&quot;course.id&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;cc-l-wrap&quot;&gt;</span><br><span class="line">                  &lt;section class=&quot;course-img&quot;&gt;</span><br><span class="line">                    &lt;img :src=&quot;course.cover&quot; class=&quot;img-responsive&quot; /&gt;</span><br><span class="line">                    &lt;div class=&quot;cc-mask&quot;&gt;</span><br><span class="line">                      &lt;a</span><br><span class="line">                        href=&quot;#&quot;</span><br><span class="line">                        title=&quot;开始学习&quot;</span><br><span class="line">                        target=&quot;_blank&quot;</span><br><span class="line">                        class=&quot;comm-btn c-btn-1&quot;</span><br><span class="line">                        &gt;开始学习&lt;/a</span><br><span class="line">                      &gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                  &lt;/section&gt;</span><br><span class="line">                  &lt;h3 class=&quot;hLh30 txtOf mt10&quot;&gt;</span><br><span class="line">                    &lt;a</span><br><span class="line">                      href=&quot;#&quot;</span><br><span class="line">                      :title=&quot;course.title&quot;</span><br><span class="line">                      target=&quot;_blank&quot;</span><br><span class="line">                      class=&quot;course-title fsize18 c-333&quot;</span><br><span class="line">                      &gt;&#123;&#123; course.title &#125;&#125;&lt;/a</span><br><span class="line">                    &gt;</span><br><span class="line">                  &lt;/h3&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">              &lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">            &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">          &lt;/article&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">    &lt;!-- /讲师介绍 结束 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import teacherApi from &#x27;@/api/teacher&#x27;</span><br><span class="line">  export default &#123;</span><br><span class="line">    asyncData(&#123; params, error &#125;) &#123;</span><br><span class="line">      // 注意这里的params后跟的名字要和vue文件名对应（所以他是只能传一个参数吗？）</span><br><span class="line">      return teacherApi.getTeacherInfo(params.id).then(result =&gt; &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          teacherInfo: result.data.data.teacherInfo,</span><br><span class="line">          courseList: result.data.data.courseList</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="前台课程列表和详情（后端-前端）"><a href="#前台课程列表和详情（后端-前端）" class="headerlink" title="前台课程列表和详情（后端+前端）"></a>前台课程列表和详情（后端+前端）</h2><h3 id="课程列表（后端）"><a href="#课程列表（后端）" class="headerlink" title="课程列表（后端）"></a>课程列表（后端）</h3><h4 id="vo类"><a href="#vo类" class="headerlink" title="vo类"></a>vo类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseFrontVo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;讲师id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String teacherId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;一级类别id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subjectParentId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;二级类别id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subjectId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;销量排序&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String buyCountSort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;最新时间排序&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String gmtCreateSort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;价格排序&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String priceSort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-1"><a href="#controller-1" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/coursefront&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduCourseService courseService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 条件查询带分页</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;getCourseList/&#123;pageNo&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getCourseListCondition</span><span class="params">(<span class="meta">@PathVariable</span> Long limit, <span class="meta">@PathVariable</span> Long pageNo, <span class="meta">@RequestBody(required = false)</span> CourseFrontVo courseFrontVo)</span> </span>&#123;</span><br><span class="line">        Page&lt;EduCourse&gt; pageCourse = <span class="keyword">new</span> Page&lt;&gt;(pageNo, limit);</span><br><span class="line">        Map&lt;String, Object&gt; map = courseService.getCOurseFrontList(pageCourse, courseFrontVo);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(map);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service-1"><a href="#service-1" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getCourseFrontList</span><span class="params">(Page&lt;EduCourse&gt; pageCourse, CourseFrontVo courseFrontVo)</span> </span>&#123;</span><br><span class="line">    QueryWrapper wrapper = <span class="keyword">new</span> QueryWrapper();</span><br><span class="line">    <span class="comment">// 判断条件是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(courseFrontVo.getSubjectParentId())) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;subject_parent_id&quot;</span>, courseFrontVo.getSubjectParentId());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(courseFrontVo.getSubjectId())) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;subject_id&quot;</span>, courseFrontVo.getSubjectId());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(courseFrontVo.getBuyCountSort())) &#123;</span><br><span class="line">        wrapper.orderByDesc(<span class="string">&quot;buy_count&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(courseFrontVo.getGmtCreateSort())) &#123; <span class="comment">//最新</span></span><br><span class="line">        wrapper.orderByDesc(<span class="string">&quot;gmt_create&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(courseFrontVo.getPriceSort())) &#123;<span class="comment">//价格</span></span><br><span class="line">        wrapper.orderByDesc(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    baseMapper.selectPage(pageCourse, wrapper);</span><br><span class="line"></span><br><span class="line">    List&lt;EduCourse&gt; records = pageCourse.getRecords();</span><br><span class="line">    <span class="keyword">long</span> current = pageCourse.getCurrent();</span><br><span class="line">    <span class="keyword">long</span> pages = pageCourse.getPages();</span><br><span class="line">    <span class="keyword">long</span> size = pageCourse.getSize();</span><br><span class="line">    <span class="keyword">long</span> total = pageCourse.getTotal();</span><br><span class="line">    <span class="keyword">boolean</span> hasNext = pageCourse.hasNext();<span class="comment">//下一页</span></span><br><span class="line">    <span class="keyword">boolean</span> hasPrevious = pageCourse.hasPrevious();<span class="comment">//上一页</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//把分页数据获取出来，放到map集合</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;items&quot;</span>, records);</span><br><span class="line">    map.put(<span class="string">&quot;current&quot;</span>, current);</span><br><span class="line">    map.put(<span class="string">&quot;pages&quot;</span>, pages);</span><br><span class="line">    map.put(<span class="string">&quot;size&quot;</span>, size);</span><br><span class="line">    map.put(<span class="string">&quot;total&quot;</span>, total);</span><br><span class="line">    map.put(<span class="string">&quot;hasNext&quot;</span>, hasNext);</span><br><span class="line">    map.put(<span class="string">&quot;hasPrevious&quot;</span>, hasPrevious);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//map返回</span></span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="课程列表（前端）"><a href="#课程列表（前端）" class="headerlink" title="课程列表（前端）"></a>课程列表（前端）</h3><h4 id="api-2"><a href="#api-2" class="headerlink" title="api"></a>api</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 讲师分页列表</span></span><br><span class="line">  <span class="function"><span class="title">getCourseList</span>(<span class="params">pageNo, limit, queryCourse</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/eduservice/coursefront/getCourseList/<span class="subst">$&#123;pageNo&#125;</span>/<span class="subst">$&#123;limit&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: queryCourse</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 课程分类列表</span></span><br><span class="line">  <span class="function"><span class="title">getSubjectList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/eduservice/subject/getAllSubjects`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="vue-2"><a href="#vue-2" class="headerlink" title="vue"></a>vue</h4><blockquote><p>这一块内容挺多的，有二级联动查询，有分页条，有条件排序等</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;aCoursesList&quot; class=&quot;bg-fa of&quot;&gt;</span><br><span class="line">    &lt;!-- /课程列表 开始 --&gt;</span><br><span class="line">    &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;header class=&quot;comm-title&quot;&gt;</span><br><span class="line">        &lt;h2 class=&quot;fl tac&quot;&gt;</span><br><span class="line">          &lt;span class=&quot;c-333&quot;&gt;全部课程&lt;/span&gt;</span><br><span class="line">        &lt;/h2&gt;</span><br><span class="line">      &lt;/header&gt;</span><br><span class="line">      &lt;section class=&quot;c-sort-box&quot;&gt;</span><br><span class="line">        &lt;section class=&quot;c-s-dl&quot;&gt;</span><br><span class="line">          &lt;dl&gt;</span><br><span class="line">            &lt;dt&gt;</span><br><span class="line">              &lt;span class=&quot;c-999 fsize14&quot;&gt;课程类别&lt;/span&gt;</span><br><span class="line">            &lt;/dt&gt;</span><br><span class="line">            &lt;dd class=&quot;c-s-dl-li&quot;&gt;</span><br><span class="line">              &lt;ul class=&quot;clearfix&quot;&gt;</span><br><span class="line">                &lt;li&gt;</span><br><span class="line">                  &lt;a title=&quot;全部&quot; href=&quot;#&quot;&gt;全部&lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li</span><br><span class="line">                  v-for=&quot;(item, index) in subjectNestedList&quot;</span><br><span class="line">                  :key=&quot;index&quot;</span><br><span class="line">                  :class=&quot;&#123; active: oneIndex == index &#125;&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                  &lt;a</span><br><span class="line">                    :title=&quot;item.title&quot;</span><br><span class="line">                    href=&quot;#&quot;</span><br><span class="line">                    @click=&quot;searchOne(item.id, index)&quot;</span><br><span class="line">                    &gt;&#123;&#123; item.title &#125;&#125;&lt;/a</span><br><span class="line">                  &gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">              &lt;/ul&gt;</span><br><span class="line">            &lt;/dd&gt;</span><br><span class="line">          &lt;/dl&gt;</span><br><span class="line">          &lt;dl&gt;</span><br><span class="line">            &lt;dt&gt;</span><br><span class="line">              &lt;span class=&quot;c-999 fsize14&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;/dt&gt;</span><br><span class="line">            &lt;dd class=&quot;c-s-dl-li&quot;&gt;</span><br><span class="line">              &lt;ul class=&quot;clearfix&quot;&gt;</span><br><span class="line">                &lt;li</span><br><span class="line">                  v-for=&quot;(item, index) in subSubjectList&quot;</span><br><span class="line">                  :key=&quot;index&quot;</span><br><span class="line">                  :class=&quot;&#123; active: twoIndex == index &#125;&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                  &lt;a</span><br><span class="line">                    :title=&quot;item.title&quot;</span><br><span class="line">                    href=&quot;#&quot;</span><br><span class="line">                    @click=&quot;searchTwo(item.id, index)&quot;</span><br><span class="line">                    &gt;&#123;&#123; item.title &#125;&#125;&lt;/a</span><br><span class="line">                  &gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">              &lt;/ul&gt;</span><br><span class="line">            &lt;/dd&gt;</span><br><span class="line">          &lt;/dl&gt;</span><br><span class="line">          &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/section&gt;</span><br><span class="line">        &lt;div class=&quot;js-wrap&quot;&gt;</span><br><span class="line">          &lt;section class=&quot;fr&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;c-ccc&quot;&gt;</span><br><span class="line">              &lt;i class=&quot;c-master f-fM&quot;&gt;1&lt;/i&gt;/</span><br><span class="line">              &lt;i class=&quot;c-666 f-fM&quot;&gt;1&lt;/i&gt;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">          &lt;section class=&quot;fl&quot;&gt;</span><br><span class="line">            &lt;ol class=&quot;js-tap clearfix&quot;&gt;</span><br><span class="line">              &lt;li :class=&quot;&#123; &#x27;current bg-orange&#x27;: buyCountSort != &#x27;&#x27; &#125;&quot;&gt;</span><br><span class="line">                &lt;a</span><br><span class="line">                  title=&quot;销量&quot;</span><br><span class="line">                  href=&quot;javascript:void(0);&quot;</span><br><span class="line">                  @click=&quot;searchBuyCount()&quot;</span><br><span class="line">                  &gt;销量</span><br><span class="line">                  &lt;span :class=&quot;&#123; hide: buyCountSort == &#x27;&#x27; &#125;&quot;&gt;↓&lt;/span&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">              &lt;/li&gt;</span><br><span class="line">              &lt;li :class=&quot;&#123; &#x27;current bg-orange&#x27;: gmtCreateSort != &#x27;&#x27; &#125;&quot;&gt;</span><br><span class="line">                &lt;a</span><br><span class="line">                  title=&quot;最新&quot;</span><br><span class="line">                  href=&quot;javascript:void(0);&quot;</span><br><span class="line">                  @click=&quot;searchGmtCreate()&quot;</span><br><span class="line">                  &gt;最新</span><br><span class="line">                  &lt;span :class=&quot;&#123; hide: gmtCreateSort == &#x27;&#x27; &#125;&quot;&gt;↓&lt;/span&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">              &lt;/li&gt;</span><br><span class="line">              &lt;li :class=&quot;&#123; &#x27;current bg-orange&#x27;: priceSort != &#x27;&#x27; &#125;&quot;&gt;</span><br><span class="line">                &lt;a</span><br><span class="line">                  title=&quot;价格&quot;</span><br><span class="line">                  href=&quot;javascript:void(0);&quot;</span><br><span class="line">                  @click=&quot;searchPrice()&quot;</span><br><span class="line">                  &gt;价格&amp;nbsp;</span><br><span class="line">                  &lt;span :class=&quot;&#123; hide: priceSort == &#x27;&#x27; &#125;&quot;&gt;↓&lt;/span&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">              &lt;/li&gt;</span><br><span class="line">            &lt;/ol&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;mt40&quot;&gt;</span><br><span class="line">          &lt;!-- /无数据提示 开始--&gt;</span><br><span class="line">          &lt;section class=&quot;no-data-wrap&quot; v-if=&quot;data.total == 0&quot;&gt;</span><br><span class="line">            &lt;em class=&quot;icon30 no-data-ico&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">            &lt;span class=&quot;c-666 fsize14 ml10 vam&quot;</span><br><span class="line">              &gt;没有相关数据，小编正在努力整理中...&lt;/span</span><br><span class="line">            &gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">          &lt;!-- /无数据提示 结束--&gt;</span><br><span class="line">          &lt;article v-if=&quot;data.total &gt; 0&quot; class=&quot;comm-course-list&quot;&gt;</span><br><span class="line">            &lt;ul class=&quot;of&quot; id=&quot;bna&quot;&gt;</span><br><span class="line">              &lt;li v-for=&quot;item in data.items&quot; :key=&quot;item.id&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;cc-l-wrap&quot;&gt;</span><br><span class="line">                  &lt;section class=&quot;course-img&quot;&gt;</span><br><span class="line">                    &lt;img</span><br><span class="line">                      :src=&quot;item.cover&quot;</span><br><span class="line">                      class=&quot;img-responsive&quot;</span><br><span class="line">                      :alt=&quot;item.title&quot;</span><br><span class="line">                    /&gt;</span><br><span class="line">                    &lt;div class=&quot;cc-mask&quot;&gt;</span><br><span class="line">                      &lt;a</span><br><span class="line">                        :href=&quot;&#x27;/course/&#x27; + item.id&quot;</span><br><span class="line">                        title=&quot;开始学习&quot;</span><br><span class="line">                        class=&quot;comm-btn c-btn-1&quot;</span><br><span class="line">                        &gt;开始学习&lt;/a</span><br><span class="line">                      &gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                  &lt;/section&gt;</span><br><span class="line">                  &lt;h3 class=&quot;hLh30 txtOf mt10&quot;&gt;</span><br><span class="line">                    &lt;a</span><br><span class="line">                      :href=&quot;&#x27;/course/&#x27; + item.id&quot;</span><br><span class="line">                      :title=&quot;item.title&quot;</span><br><span class="line">                      class=&quot;course-title fsize18 c-333&quot;</span><br><span class="line">                      &gt;&#123;&#123; item.title &#125;&#125;&lt;/a</span><br><span class="line">                    &gt;</span><br><span class="line">                  &lt;/h3&gt;</span><br><span class="line">                  &lt;section class=&quot;mt10 hLh20 of&quot;&gt;</span><br><span class="line">                    &lt;span</span><br><span class="line">                      v-if=&quot;Number(item.price) === 0&quot;</span><br><span class="line">                      class=&quot;fr jgTag bg-green&quot;</span><br><span class="line">                    &gt;</span><br><span class="line">                      &lt;i class=&quot;c-fff fsize12 f-fA&quot;&gt;免费&lt;/i&gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                    &lt;span class=&quot;fl jgAttr c-ccc f-fA&quot;&gt;</span><br><span class="line">                      &lt;i class=&quot;c-999 f-fA&quot;&gt;9634人学习&lt;/i&gt;</span><br><span class="line">                      |</span><br><span class="line">                      &lt;i class=&quot;c-999 f-fA&quot;&gt;9634评论&lt;/i&gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                  &lt;/section&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">              &lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">            &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">          &lt;/article&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 公共分页 开始 --&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;div class=&quot;paging&quot;&gt;</span><br><span class="line">            &lt;!-- undisable这个class是否存在，取决于数据属性hasPrevious --&gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              :class=&quot;&#123; undisable: !data.hasPrevious &#125;&quot;</span><br><span class="line">              href=&quot;#&quot;</span><br><span class="line">              title=&quot;首页&quot;</span><br><span class="line">              @click.prevent=&quot;gotoPage(1)&quot;</span><br><span class="line">              &gt;首&lt;/a</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              :class=&quot;&#123; undisable: !data.hasPrevious &#125;&quot;</span><br><span class="line">              href=&quot;#&quot;</span><br><span class="line">              title=&quot;前一页&quot;</span><br><span class="line">              @click.prevent=&quot;gotoPage(data.current - 1)&quot;</span><br><span class="line">              &gt;&amp;lt;&lt;/a</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              v-for=&quot;page in data.pages&quot;</span><br><span class="line">              :key=&quot;page&quot;</span><br><span class="line">              :class=&quot;&#123;</span><br><span class="line">                current: data.current == page,</span><br><span class="line">                undisable: data.current == page,</span><br><span class="line">              &#125;&quot;</span><br><span class="line">              :title=&quot;&#x27;第&#x27; + page + &#x27;页&#x27;&quot;</span><br><span class="line">              href=&quot;#&quot;</span><br><span class="line">              @click.prevent=&quot;gotoPage(page)&quot;</span><br><span class="line">              &gt;&#123;&#123; page &#125;&#125;&lt;/a</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              :class=&quot;&#123; undisable: !data.hasNext &#125;&quot;</span><br><span class="line">              href=&quot;#&quot;</span><br><span class="line">              title=&quot;后一页&quot;</span><br><span class="line">              @click.prevent=&quot;gotoPage(data.current + 1)&quot;</span><br><span class="line">              &gt;&amp;gt;&lt;/a</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              :class=&quot;&#123; undisable: !data.hasNext &#125;&quot;</span><br><span class="line">              href=&quot;#&quot;</span><br><span class="line">              title=&quot;末页&quot;</span><br><span class="line">              @click.prevent=&quot;gotoPage(data.pages)&quot;</span><br><span class="line">              &gt;末&lt;/a</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;div class=&quot;clear&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">    &lt;!-- /课程列表 结束 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import courseApi from &#x27;@/api/course&#x27;</span><br><span class="line">  export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        page: 1, // 当前页</span><br><span class="line">        data: &#123;&#125;, // 课程列表</span><br><span class="line">        subjectNestedList: [], // 一级分类列表</span><br><span class="line">        subSubjectList: [], // 二级分类列表</span><br><span class="line"></span><br><span class="line">        queryObj: &#123;&#125;, // 查询表单对象</span><br><span class="line"></span><br><span class="line">        oneIndex: -1,</span><br><span class="line">        twoIndex: -1,</span><br><span class="line">        buyCountSort: &#x27;&#x27;,</span><br><span class="line">        gmtCreateSort: &#x27;&#x27;,</span><br><span class="line">        priceSort: &#x27;&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">      // 课程第一次查询</span><br><span class="line">      this.initCourseFirst()</span><br><span class="line">      // 一级分类显示</span><br><span class="line">      this.initSubject()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      // 1 查询第一页数据</span><br><span class="line">      initCourseFirst() &#123;</span><br><span class="line">        courseApi.getCourseList(1, 8, this.queryObj).then(response =&gt; &#123;</span><br><span class="line">          this.data = response.data.data</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      // 2 查询所有一级分类</span><br><span class="line">      initSubject() &#123;</span><br><span class="line">        courseApi.getSubjectList().then(response =&gt; &#123;</span><br><span class="line">          this.subjectNestedList = response.data.data.list</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      // 3 分页切换的方法</span><br><span class="line">      gotoPage(page) &#123;</span><br><span class="line">        courseApi.getCourseList(page, 8, this.queryObj).then(response =&gt; &#123;</span><br><span class="line">          this.data = response.data.data</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      // 4 点击某个一级分类，查询对应二级分类</span><br><span class="line">      searchOne(subjectParentId, index) &#123;</span><br><span class="line">        // 把传递index值赋值给oneIndex,为了active样式生效</span><br><span class="line">        this.oneIndex = index</span><br><span class="line"></span><br><span class="line">        this.twoIndex = -1</span><br><span class="line">        this.queryObj.subjectId = &#x27;&#x27;</span><br><span class="line">        this.subSubjectList = []</span><br><span class="line"></span><br><span class="line">        // 把一级分类点击id值，赋值给queryObj</span><br><span class="line">        this.queryObj.subjectParentId = subjectParentId</span><br><span class="line">        // 点击某个一级分类进行条件查询</span><br><span class="line">        this.gotoPage(1)</span><br><span class="line"></span><br><span class="line">        // 拿着点击一级分类id 和 所有一级分类id进行比较，</span><br><span class="line">        // 如果id相同，从一级分类里面获取对应的二级分类</span><br><span class="line">        for (let i = 0; i &lt; this.subjectNestedList.length; i++) &#123;</span><br><span class="line">          // 获取每个一级分类</span><br><span class="line">          var oneSubject = this.subjectNestedList[i]</span><br><span class="line">          // 比较id是否相同</span><br><span class="line">          if (subjectParentId == oneSubject.id) &#123;</span><br><span class="line">            // 从一级分类里面获取对应的二级分类</span><br><span class="line">            this.subSubjectList = oneSubject.children</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      // 5 点击某个二级分类实现查询</span><br><span class="line">      searchTwo(subjectId, index) &#123;</span><br><span class="line">        // 把index赋值,为了样式生效</span><br><span class="line">        this.twoIndex = index</span><br><span class="line">        // 把二级分类点击id值，赋值给queryObj</span><br><span class="line">        this.queryObj.subjectId = subjectId</span><br><span class="line">        // 点击某个二级分类进行条件查询</span><br><span class="line">        this.gotoPage(1)</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      // 6 根据销量排序</span><br><span class="line">      searchBuyCount() &#123;</span><br><span class="line">        // 设置对应变量值，为了样式生效</span><br><span class="line">        this.buyCountSort = &#x27;1&#x27;</span><br><span class="line">        this.gmtCreateSort = &#x27;&#x27;</span><br><span class="line">        this.priceSort = &#x27;&#x27;</span><br><span class="line"></span><br><span class="line">        // 把值赋值到queryObj</span><br><span class="line">        this.queryObj.buyCountSort = this.buyCountSort</span><br><span class="line">        this.queryObj.gmtCreateSort = this.gmtCreateSort</span><br><span class="line">        this.queryObj.priceSort = this.priceSort</span><br><span class="line"></span><br><span class="line">        // 调用方法查询</span><br><span class="line">        this.gotoPage(1)</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      // 7 最新排序</span><br><span class="line">      searchGmtCreate() &#123;</span><br><span class="line">        // 设置对应变量值，为了样式生效</span><br><span class="line">        this.buyCountSort = &#x27;&#x27;</span><br><span class="line">        this.gmtCreateSort = &#x27;1&#x27;</span><br><span class="line">        this.priceSort = &#x27;&#x27;</span><br><span class="line"></span><br><span class="line">        // 把值赋值到queryObj</span><br><span class="line">        this.queryObj.buyCountSort = this.buyCountSort</span><br><span class="line">        this.queryObj.gmtCreateSort = this.gmtCreateSort</span><br><span class="line">        this.queryObj.priceSort = this.priceSort</span><br><span class="line"></span><br><span class="line">        // 调用方法查询</span><br><span class="line">        this.gotoPage(1)</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      // 8 价格排序</span><br><span class="line">      searchPrice() &#123;</span><br><span class="line">        // 设置对应变量值，为了样式生效</span><br><span class="line">        this.buyCountSort = &#x27;&#x27;</span><br><span class="line">        this.gmtCreateSort = &#x27;&#x27;</span><br><span class="line">        this.priceSort = &#x27;1&#x27;</span><br><span class="line"></span><br><span class="line">        // 把值赋值到queryObj</span><br><span class="line">        this.queryObj.buyCountSort = this.buyCountSort</span><br><span class="line">        this.queryObj.gmtCreateSort = this.gmtCreateSort</span><br><span class="line">        this.queryObj.priceSort = this.priceSort</span><br><span class="line"></span><br><span class="line">        // 调用方法查询</span><br><span class="line">        this.gotoPage(1)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">  .active &#123;</span><br><span class="line">    background: #bdbdbd;</span><br><span class="line">  &#125;</span><br><span class="line">  .hide &#123;</span><br><span class="line">    display: none;</span><br><span class="line">  &#125;</span><br><span class="line">  .show &#123;</span><br><span class="line">    display: block;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="课程详情（后端）"><a href="#课程详情（后端）" class="headerlink" title="课程详情（后端）"></a>课程详情（后端）</h3><h4 id="vo类-1"><a href="#vo类-1" class="headerlink" title="vo类"></a>vo类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 课程基础信息VO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseFrontInfoVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程销售价格，设置为0则可免费观看&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;总课时&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer lessonNum;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程封面图片路径&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String cover;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;销售数量&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long buyCount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;浏览数量&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程简介&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;讲师ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String teacherId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;讲师姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String teacherName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;讲师资历,一句话说明讲师&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String intro;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;讲师头像&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程一级类别ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subjectLevelOneId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;类别一级名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subjectLevelOne;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程二级类别ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subjectLevelTwoId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;类别二级名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subjectLevelTwo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-2"><a href="#controller-2" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 课程详情信息</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getCourseInfo/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getCourseInfo</span><span class="params">(<span class="meta">@PathVariable</span> String courseId)</span> </span>&#123;</span><br><span class="line">    CourseFrontInfoVo courseInfo = courseService.getBaseCourseInfo(courseId);</span><br><span class="line">    List&lt;ChapterVo&gt; chapterList = chapterService.getChapterVideoByCourseId(courseId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;courseInfo&quot;</span>, courseInfo).data(<span class="string">&quot;chapterList&quot;</span>, chapterList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service-2"><a href="#service-2" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据课程id查询课程基本信息以及其章节列表</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseFrontInfoVo <span class="title">getBaseCourseInfo</span><span class="params">(String courseId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> baseMapper.getBaseCourseInfo(courseId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="mapper"><a href="#mapper" class="headerlink" title="mapper"></a>mapper</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 根据课程id查询课程基本信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getBaseCourseInfo&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.eduservice.entity.frontVo.CourseFrontInfoVo&quot;</span>&gt;</span></span><br><span class="line">    select ec.id,</span><br><span class="line">           ec.title,</span><br><span class="line">           ec.price,</span><br><span class="line">           ec.cover,</span><br><span class="line">           ec.lesson_num AS lessonNum,</span><br><span class="line">           ec.buy_count  AS buyCount,</span><br><span class="line">           ec.view_count AS viewCount,</span><br><span class="line">           ecd.description,</span><br><span class="line">           et.id         AS teacherId,</span><br><span class="line">           et.name       AS teacherName,</span><br><span class="line">           et.intro,</span><br><span class="line">           et.avatar,</span><br><span class="line">           es1.id        AS subjectLevelOneId,</span><br><span class="line">           es1.title     AS subjectLevelOne,</span><br><span class="line">           es2.id        AS subjectLevelTwoId,</span><br><span class="line">           es2.title     AS subjectLevelTwo</span><br><span class="line">    from edu_course ec</span><br><span class="line">             left join edu_course_description ecd on ec.id = ecd.id</span><br><span class="line">             left join edu_teacher et on ec.teacher_id = et.id</span><br><span class="line">             left join edu_subject es1 on ec.subject_parent_id = es1.id</span><br><span class="line">             left join edu_subject es2 on ec.subject_id = es2.id</span><br><span class="line">    where ec.id = #&#123;courseId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="课程详情（前端）"><a href="#课程详情（前端）" class="headerlink" title="课程详情（前端）"></a>课程详情（前端）</h3><h4 id="api-3"><a href="#api-3" class="headerlink" title="api"></a>api</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得课程信息</span></span><br><span class="line"><span class="function"><span class="title">getCourseInfo</span>(<span class="params">courseId</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/eduservice/coursefront/getCourseInfo/<span class="subst">$&#123;courseId&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="vue-3"><a href="#vue-3" class="headerlink" title="vue"></a>vue</h4><blockquote><p>注意这里的简介显示，需要使用v-html</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;aCoursesList&quot; class=&quot;bg-fa of&quot;&gt;</span><br><span class="line">    &lt;!-- /课程详情 开始 --&gt;</span><br><span class="line">    &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;!-- 这里是一个面包屑导航 --&gt;</span><br><span class="line">      &lt;section class=&quot;path-wrap txtOf hLh30&quot;&gt;</span><br><span class="line">        &lt;a href=&quot;#&quot; title class=&quot;c-999 fsize14&quot;&gt;首页&lt;/a&gt;</span><br><span class="line">        \</span><br><span class="line">        &lt;a href=&quot;#&quot; title class=&quot;c-999 fsize14&quot;&gt;&#123;&#123;</span><br><span class="line">          courseInfo.subjectLevelOne</span><br><span class="line">        &#125;&#125;&lt;/a&gt;</span><br><span class="line">        \</span><br><span class="line">        &lt;span class=&quot;c-333 fsize14&quot;&gt;&#123;&#123; courseInfo.subjectLevelTwo &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;article class=&quot;c-v-pic-wrap&quot; style=&quot;height: 357px&quot;&gt;</span><br><span class="line">          &lt;section class=&quot;p-h-video-box&quot; id=&quot;videoPlay&quot;&gt;</span><br><span class="line">            &lt;img</span><br><span class="line">              :src=&quot;courseInfo.cover&quot;</span><br><span class="line">              :alt=&quot;courseInfo.title&quot;</span><br><span class="line">              class=&quot;dis c-v-pic&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">        &lt;/article&gt;</span><br><span class="line">        &lt;aside class=&quot;c-attr-wrap&quot;&gt;</span><br><span class="line">          &lt;section class=&quot;ml20 mr15&quot;&gt;</span><br><span class="line">            &lt;h2 class=&quot;hLh30 txtOf mt15&quot;&gt;</span><br><span class="line">              &lt;span class=&quot;c-fff fsize24&quot;&gt;&#123;&#123; courseInfo.title &#125;&#125;&lt;/span&gt;</span><br><span class="line">            &lt;/h2&gt;</span><br><span class="line">            &lt;section class=&quot;c-attr-jg&quot;&gt;</span><br><span class="line">              &lt;span class=&quot;c-fff&quot;&gt;价格：&lt;/span&gt;</span><br><span class="line">              &lt;b class=&quot;c-yellow&quot; style=&quot;font-size: 24px&quot;</span><br><span class="line">                &gt;￥&#123;&#123; courseInfo.price &#125;&#125;&lt;/b</span><br><span class="line">              &gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">            &lt;section class=&quot;c-attr-mt c-attr-undis&quot;&gt;</span><br><span class="line">              &lt;span class=&quot;c-fff fsize14&quot;</span><br><span class="line">                &gt;主讲： &#123;&#123; courseInfo.teacherName &#125;&#125;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span</span><br><span class="line">              &gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">            &lt;section class=&quot;c-attr-mt of&quot;&gt;</span><br><span class="line">              &lt;span class=&quot;ml10 vam&quot;&gt;</span><br><span class="line">                &lt;em class=&quot;icon18 scIcon&quot;&gt;&lt;/em&gt;</span><br><span class="line">                &lt;a class=&quot;c-fff vam&quot; title=&quot;收藏&quot; href=&quot;#&quot;&gt;收藏&lt;/a&gt;</span><br><span class="line">              &lt;/span&gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">            &lt;section class=&quot;c-attr-mt&quot;&gt;</span><br><span class="line">              &lt;a href=&quot;#&quot; title=&quot;立即观看&quot; class=&quot;comm-btn c-btn-3&quot;&gt;立即观看&lt;/a&gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">        &lt;/aside&gt;</span><br><span class="line">        &lt;aside class=&quot;thr-attr-box&quot;&gt;</span><br><span class="line">          &lt;ol class=&quot;thr-attr-ol clearfix&quot;&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;p&gt;&amp;nbsp;&lt;/p&gt;</span><br><span class="line">              &lt;aside&gt;</span><br><span class="line">                &lt;span class=&quot;c-fff f-fM&quot;&gt;购买数&lt;/span&gt;</span><br><span class="line">                &lt;br /&gt;</span><br><span class="line">                &lt;h6 class=&quot;c-fff f-fM mt10&quot;&gt;&#123;&#123; courseInfo.buyCount &#125;&#125;&lt;/h6&gt;</span><br><span class="line">              &lt;/aside&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;p&gt;&amp;nbsp;&lt;/p&gt;</span><br><span class="line">              &lt;aside&gt;</span><br><span class="line">                &lt;span class=&quot;c-fff f-fM&quot;&gt;课时数&lt;/span&gt;</span><br><span class="line">                &lt;br /&gt;</span><br><span class="line">                &lt;h6 class=&quot;c-fff f-fM mt10&quot;&gt;&#123;&#123; courseInfo.lessonNum &#125;&#125;&lt;/h6&gt;</span><br><span class="line">              &lt;/aside&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;p&gt;&amp;nbsp;&lt;/p&gt;</span><br><span class="line">              &lt;aside&gt;</span><br><span class="line">                &lt;span class=&quot;c-fff f-fM&quot;&gt;浏览数&lt;/span&gt;</span><br><span class="line">                &lt;br /&gt;</span><br><span class="line">                &lt;h6 class=&quot;c-fff f-fM mt10&quot;&gt;&#123;&#123; courseInfo.viewCount &#125;&#125;&lt;/h6&gt;</span><br><span class="line">              &lt;/aside&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          &lt;/ol&gt;</span><br><span class="line">        &lt;/aside&gt;</span><br><span class="line">        &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- /课程封面介绍 --&gt;</span><br><span class="line">      &lt;div class=&quot;mt20 c-infor-box&quot;&gt;</span><br><span class="line">        &lt;article class=&quot;fl col-7&quot;&gt;</span><br><span class="line">          &lt;section class=&quot;mr30&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;i-box&quot;&gt;</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                &lt;section id=&quot;c-i-tabTitle&quot; class=&quot;c-infor-tabTitle c-tab-title&quot;&gt;</span><br><span class="line">                  &lt;a name=&quot;c-i&quot; class=&quot;current&quot; title=&quot;课程详情&quot;&gt;课程详情&lt;/a&gt;</span><br><span class="line">                &lt;/section&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;article class=&quot;ml10 mr10 pt20&quot;&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                  &lt;h6 class=&quot;c-i-content c-infor-title&quot;&gt;</span><br><span class="line">                    &lt;span&gt;课程介绍&lt;/span&gt;</span><br><span class="line">                  &lt;/h6&gt;</span><br><span class="line">                  &lt;div class=&quot;course-txt-body-wrap&quot;&gt;</span><br><span class="line">                    &lt;section class=&quot;course-txt-body&quot;&gt;</span><br><span class="line">                      &lt;!-- 由于当初编写的时候使用的富文本编辑器，所以这里显示要使用v-html --&gt;</span><br><span class="line">                      &lt;p v-html=&quot;courseInfo.description&quot;&gt;</span><br><span class="line">                        &#123;&#123; courseInfo.description &#125;&#125;</span><br><span class="line">                      &lt;/p&gt;</span><br><span class="line">                    &lt;/section&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;!-- /课程介绍 --&gt;</span><br><span class="line">                &lt;div class=&quot;mt50&quot;&gt;</span><br><span class="line">                  &lt;h6 class=&quot;c-g-content c-infor-title&quot;&gt;</span><br><span class="line">                    &lt;span&gt;课程大纲&lt;/span&gt;</span><br><span class="line">                  &lt;/h6&gt;</span><br><span class="line">                  &lt;section class=&quot;mt20&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;lh-menu-wrap&quot;&gt;</span><br><span class="line">                      &lt;menu id=&quot;lh-menu&quot; class=&quot;lh-menu mt10 mr10&quot;&gt;</span><br><span class="line">                        &lt;ul&gt;</span><br><span class="line">                          &lt;!-- 文件目录 --&gt;</span><br><span class="line">                          &lt;li</span><br><span class="line">                            class=&quot;lh-menu-stair&quot;</span><br><span class="line">                            v-for=&quot;chapter in chapterList&quot;</span><br><span class="line">                            :key=&quot;chapter.id&quot;</span><br><span class="line">                          &gt;</span><br><span class="line">                            &lt;a</span><br><span class="line">                              href=&quot;javascript: void(0)&quot;</span><br><span class="line">                              :title=&quot;chapter.title&quot;</span><br><span class="line">                              class=&quot;current-1&quot;</span><br><span class="line">                            &gt;</span><br><span class="line">                              &lt;em class=&quot;lh-menu-i-1 icon18 mr10&quot;&gt;&lt;/em</span><br><span class="line">                              &gt;&#123;&#123; chapter.title &#125;&#125;</span><br><span class="line">                            &lt;/a&gt;</span><br><span class="line">                            &lt;ol class=&quot;lh-menu-ol&quot; style=&quot;display: block&quot;&gt;</span><br><span class="line">                              &lt;li</span><br><span class="line">                                class=&quot;lh-menu-second ml30&quot;</span><br><span class="line">                                v-for=&quot;video in chapter.children&quot;</span><br><span class="line">                                :key=&quot;video.id&quot;</span><br><span class="line">                              &gt;</span><br><span class="line">                                &lt;a href=&quot;#&quot; :title=&quot;video.title&quot;&gt;</span><br><span class="line">                                  &lt;span class=&quot;fr&quot;&gt;</span><br><span class="line">                                    &lt;i class=&quot;free-icon vam mr10&quot;&gt;免费试听&lt;/i&gt;</span><br><span class="line">                                  &lt;/span&gt;</span><br><span class="line">                                  &lt;em class=&quot;lh-menu-i-2 icon16 mr5&quot;&gt;&amp;nbsp;&lt;/em</span><br><span class="line">                                  &gt;&#123;&#123;video.title&#125;&#125;</span><br><span class="line">                                &lt;/a&gt;</span><br><span class="line">                              &lt;/li&gt;</span><br><span class="line">                            &lt;/ol&gt;</span><br><span class="line">                          &lt;/li&gt;</span><br><span class="line">                        &lt;/ul&gt;</span><br><span class="line">                      &lt;/menu&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                  &lt;/section&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;!-- /课程大纲 --&gt;</span><br><span class="line">              &lt;/article&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">        &lt;/article&gt;</span><br><span class="line">        &lt;aside class=&quot;fl col-3&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;i-box&quot;&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">              &lt;section class=&quot;c-infor-tabTitle c-tab-title&quot;&gt;</span><br><span class="line">                &lt;a title href=&quot;javascript:void(0)&quot;&gt;主讲讲师&lt;/a&gt;</span><br><span class="line">              &lt;/section&gt;</span><br><span class="line">              &lt;section class=&quot;stud-act-list&quot;&gt;</span><br><span class="line">                &lt;ul style=&quot;height: auto&quot;&gt;</span><br><span class="line">                  &lt;li&gt;</span><br><span class="line">                    &lt;div class=&quot;u-face&quot;&gt;</span><br><span class="line">                      &lt;a href=&quot;#&quot;&gt;</span><br><span class="line">                        &lt;img :src=&quot;courseInfo.avatar&quot; width=&quot;50&quot; height=&quot;50&quot; /&gt;</span><br><span class="line">                      &lt;/a&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;section class=&quot;hLh30 txtOf&quot;&gt;</span><br><span class="line">                      &lt;a class=&quot;c-333 fsize16 fl&quot; href=&quot;#&quot;&gt;&#123;&#123;</span><br><span class="line">                        courseInfo.teacherName</span><br><span class="line">                      &#125;&#125;&lt;/a&gt;</span><br><span class="line">                    &lt;/section&gt;</span><br><span class="line">                    &lt;section class=&quot;hLh20 txtOf&quot;&gt;</span><br><span class="line">                      &lt;span class=&quot;c-999&quot;&gt;&#123;&#123; courseInfo.intro &#125;&#125;&lt;/span&gt;</span><br><span class="line">                    &lt;/section&gt;</span><br><span class="line">                  &lt;/li&gt;</span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line">              &lt;/section&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/aside&gt;</span><br><span class="line">        &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">    &lt;!-- /课程详情 结束 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import courseApi from &#x27;@/api/course&#x27;</span><br><span class="line">  export default &#123;</span><br><span class="line">    asyncData(&#123; params, error &#125;) &#123;</span><br><span class="line">      return courseApi.getCourseInfo(params.id).then(result =&gt; &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          courseInfo: result.data.data.courseInfo,</span><br><span class="line">          chapterList: result.data.data.chapterList</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p>TODO：里面还有一些跳转还要完善</p></blockquote><h2 id="视频播放器"><a href="#视频播放器" class="headerlink" title="视频播放器"></a>视频播放器</h2><blockquote><p>阿里云视频播放器，使用播放凭证播放</p></blockquote><blockquote><p>注意这里要写到service_vod模块，因为是和阿里云视频相关</p></blockquote><h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><h4 id="controller-3"><a href="#controller-3" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据视频id获取视频凭证</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getPlayAuth/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getPlayAuth</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> <span class="keyword">throws</span> ClientException </span>&#123;</span><br><span class="line">    <span class="comment">// 创建初始化对象</span></span><br><span class="line">    DefaultAcsClient client = InitVodClient.initVodClient(ConstantVodUtils.ACCESS_KEY_ID, ConstantVodUtils.ACCESS_KEY_SECRET);</span><br><span class="line">    <span class="comment">// 创建获取凭证的request和response</span></span><br><span class="line">    GetVideoPlayAuthRequest request = <span class="keyword">new</span> GetVideoPlayAuthRequest();</span><br><span class="line">    request.setVideoId(id);</span><br><span class="line">    <span class="comment">// 调用方法获得凭证</span></span><br><span class="line">    GetVideoPlayAuthResponse acsResponse = client.getAcsResponse(request);</span><br><span class="line">    String playAuth = acsResponse.getPlayAuth();</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;playAuth&quot;</span>, playAuth);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><blockquote><p> 先去修改a标签的href值</p><p> <code> :href=&quot;&#39;/video_player/&#39; + video.videoSourceId&quot;  target=&quot;_blank&quot;</code></p></blockquote><blockquote><p>然后前端在pages文件夹下编写一个动态路由的vue视图，可以命名为_vid.vue，里面编写播放器的模板，这里还专门写了一个video的布局layout，cv即可</p></blockquote><h4 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;guli-player&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;head&quot;&gt;</span><br><span class="line">      &lt;a href=&quot;#&quot; title=&quot;谷粒学院&quot;&gt;</span><br><span class="line">        &lt;img class=&quot;logo&quot; src=&quot;~/assets/img/logo.png&quot; lt=&quot;谷粒学院&quot;&gt;</span><br><span class="line">    &lt;/a&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;body&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;content&quot;&gt;&lt;nuxt/&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">html,body&#123;</span><br><span class="line">  height:100%;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.head &#123;</span><br><span class="line">  height: 50px;</span><br><span class="line">  position: absolute;</span><br><span class="line">  top: 0;</span><br><span class="line">  left: 0;</span><br><span class="line">  width: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.head .logo&#123;</span><br><span class="line">  height: 50px;</span><br><span class="line">  margin-left: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.body &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  top: 50px;</span><br><span class="line">  left: 0;</span><br><span class="line">  right: 0;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="api-4"><a href="#api-4" class="headerlink" title="api"></a>api</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">getPlayAuth</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/eduvod/video/getPlayAuth/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="vue视图"><a href="#vue视图" class="headerlink" title="vue视图"></a>vue视图</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 阿里云视频播放器样式 --&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://g.alicdn.com/de/prismplayer/2.8.1/skins/default/aliplayer-min.css&quot; &gt;</span><br><span class="line">    &lt;!-- 阿里云视频播放器脚本 --&gt;</span><br><span class="line">    &lt;script charset=&quot;utf-8&quot; type=&quot;text/javascript&quot; src=&quot;https://g.alicdn.com/de/prismplayer/2.8.1/aliplayer-min.js&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 定义播放器dom --&gt;</span><br><span class="line">    &lt;div id=&quot;J_prismPlayer&quot; class=&quot;prism-player&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import vod from &#x27;@/api/vod&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    layout: &#x27;video&#x27;,//应用video布局</span><br><span class="line">    asyncData(&#123; params, error &#125;) &#123;</span><br><span class="line">       return vod.getPlayAuth(params.vid)</span><br><span class="line">        .then(response =&gt; &#123;</span><br><span class="line">            return &#123; </span><br><span class="line">                playAuth: response.data.data.playAuth,</span><br><span class="line">                vid: params.vid</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123; //页面渲染之后  created</span><br><span class="line">        new Aliplayer(&#123;</span><br><span class="line">            id: &#x27;J_prismPlayer&#x27;,</span><br><span class="line">            vid: this.vid, // 视频id</span><br><span class="line">            playauth: this.playAuth, // 播放凭证</span><br><span class="line">            encryptType: &#x27;1&#x27;, // 如果播放加密视频，则需设置encryptType=1，非加密视频无需设置此项</span><br><span class="line">            width: &#x27;100%&#x27;,</span><br><span class="line">            height: &#x27;500px&#x27;,</span><br><span class="line">            // 以下可选设置</span><br><span class="line">            cover: &#x27;http://guli.shop/photo/banner/1525939573202.jpg&#x27;, // 封面</span><br><span class="line">            qualitySort: &#x27;asc&#x27;, // 清晰度排序</span><br><span class="line"></span><br><span class="line">            mediaType: &#x27;video&#x27;, // 返回音频还是视频</span><br><span class="line">            autoplay: false, // 自动播放</span><br><span class="line">            isLive: false, // 直播</span><br><span class="line">            rePlay: false, // 循环播放</span><br><span class="line">            preload: true,</span><br><span class="line">            controlBarVisibility: &#x27;hover&#x27;, // 控制条的显示方式：鼠标悬停</span><br><span class="line">            useH5Prism: true, // 播放器类型：html5</span><br><span class="line">        &#125;, function(player) &#123;</span><br><span class="line">            console.log(&#x27;播放器创建成功&#x27;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="更多功能"><a href="#更多功能" class="headerlink" title="更多功能"></a>更多功能</h3><blockquote><p><a href="https://player.alicdn.com/aliplayer/index.html">阿里云Aliplayer播放器 (alicdn.com)</a></p><p>详见文档</p></blockquote><h2 id="视频评论（后端-前端）"><a href="#视频评论（后端-前端）" class="headerlink" title="视频评论（后端+前端）"></a>视频评论（后端+前端）</h2><blockquote><p>具体实现分析：</p><ol><li>创建课程评论表</li><li>创建后端接口<ol><li>分页查询对应课程评论</li><li>添加评论<ol><li>课程评论内容：输入，调用接口</li><li>课程id：进入详情页面就可以查询到课程id</li><li>用户id：根据cookie中的token查询用户信息</li></ol></li><li>远程调用（edu -&gt; ucenter）</li></ol></li></ol></blockquote><h2 id="订单与支付（后端-前端）"><a href="#订单与支付（后端-前端）" class="headerlink" title="订单与支付（后端+前端）"></a>订单与支付（后端+前端）</h2><blockquote><ol><li>创建子模块service_order, application.proerties里大差不差</li><li>代码生成器常规操作</li></ol></blockquote><h3 id="后端基础搭建"><a href="#后端基础搭建" class="headerlink" title="后端基础搭建"></a>后端基础搭建</h3><h4 id="启动类"><a href="#启动类" class="headerlink" title="启动类"></a>启动类</h4><blockquote><p>这个模块需要调用edu和UCenter模块中的方法查询课程和用户信息</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.atguigu&quot;&#125;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.eduorder.mapper&quot;)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span>  <span class="comment">// nacos注册</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span>     <span class="comment">// 使用Feign</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><blockquote><p>微信支付接口的依赖</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.wxpay<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>wxpay-sdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="生成订单（后端）"><a href="#生成订单（后端）" class="headerlink" title="生成订单（后端）"></a>生成订单（后端）</h3><h4 id="OrderController"><a href="#OrderController" class="headerlink" title="OrderController"></a>OrderController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduorder/order&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成订单方法</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;createOrder/&#123;courseId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">createOrder</span><span class="params">(<span class="meta">@PathVariable</span> String courseId, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建订单返回订单号</span></span><br><span class="line">        String memberId = JwtUtils.getMemberIdByJwtToken(request);</span><br><span class="line">        String orderNo = orderService.createOrder(courseId, memberId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;orderNo&quot;</span>, orderNo);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h4><blockquote><p>注意这里要额外写一个vo类用于远程调用的时候返回</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;UcenterMember对象&quot;, description = &quot;会员表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UcenterMemberForOrder</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;会员id&quot;)</span></span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.ID_WORKER_STR)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;微信openid&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String openid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;手机号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;密码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;昵称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;性别 1 女，2 男&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer sex;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;年龄&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;用户头像&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;用户签名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String sign;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;是否禁用 1（true）已禁用，  0（false）未禁用&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isDisabled;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;逻辑删除 1（true）已删除， 0（false）未删除&quot;)</span></span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isDeleted;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;创建时间&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date gmtCreate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;更新时间&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date gmtModified;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这个实体类和UCenterMember无差别，但是放在了common模块当中，所以不同模块中的controller都可以使用该类</p><p>另一个课程相关实体类与这个类似，放在common模块中即可</p></blockquote><h4 id="UcenterMemberController"><a href="#UcenterMemberController" class="headerlink" title="UcenterMemberController"></a>UcenterMemberController</h4><blockquote><p>编写一个被远程调用的方法，通过id获取用户信息</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/educenter/member&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UcenterMemberController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UcenterMemberService memberService;</span><br><span class="line">    <span class="comment">// 根据用户id获取用户信息</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getUserInfoOrder/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UcenterMemberForOrder <span class="title">getUserInfoOrder</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 注意这里的返回类型不要R，而是另一个统一类型</span></span><br><span class="line">        UcenterMember member = memberService.getById(id);</span><br><span class="line">        UcenterMemberForOrder memberForOrder = <span class="keyword">new</span> UcenterMemberForOrder();</span><br><span class="line">        BeanUtils.copyProperties(member, memberForOrder);</span><br><span class="line">        <span class="keyword">return</span> memberForOrder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CourseFrontController"><a href="#CourseFrontController" class="headerlink" title="CourseFrontController"></a>CourseFrontController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/coursefront&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduCourseService courseService;</span><br><span class="line">    <span class="comment">// 根据课程id查询课程信息</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getCourseInfoOrder/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CourseForOrder <span class="title">getCourseInfoOrder</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> </span>&#123;</span><br><span class="line">        CourseInfoVo course = courseService.getCourseInfoById(id);</span><br><span class="line">        CourseForOrder courseForOrder = <span class="keyword">new</span> CourseForOrder();</span><br><span class="line">        BeanUtils.copyProperties(course, courseForOrder);</span><br><span class="line">        <span class="keyword">return</span> courseForOrder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="远程调用配置接口"><a href="#远程调用配置接口" class="headerlink" title="远程调用配置接口"></a>远程调用配置接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(&quot;service-edu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EduClient</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 根据课程id查询课程信息</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/eduservice/coursefront/getCourseInfoOrder/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CourseForOrder <span class="title">getCourseInfoOrder</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(&quot;service-ucenter&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UcenterClient</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 根据用户id获取用户信息</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/educenter/member/getUserInfoOrder/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UcenterMemberForOrder <span class="title">getUserInfoOrder</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="OrderService"><a href="#OrderService" class="headerlink" title="OrderService"></a>OrderService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">OrderMapper</span>, <span class="title">Order</span>&gt; <span class="keyword">implements</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduClient eduClient;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UcenterClient ucenterClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成订单</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createOrder</span><span class="params">(String courseId, String memberId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 远程调用获取用户信息</span></span><br><span class="line">        UcenterMemberForOrder userInfoOrder = ucenterClient.getUserInfoOrder(memberId);</span><br><span class="line">        <span class="comment">// 远程调用获取课程信息</span></span><br><span class="line">        CourseForOrder courseInfoOrder = eduClient.getCourseInfoOrder(courseId);</span><br><span class="line">        <span class="comment">// 添加到数据库</span></span><br><span class="line">        Order order = <span class="keyword">new</span> Order();</span><br><span class="line">        order.setOrderNo(OrderNoUtil.getOrderNo());<span class="comment">//订单号</span></span><br><span class="line">        order.setCourseId(courseId); <span class="comment">//课程id</span></span><br><span class="line">        order.setCourseTitle(courseInfoOrder.getTitle());</span><br><span class="line">        order.setCourseCover(courseInfoOrder.getCover());</span><br><span class="line">        order.setTeacherName(courseInfoOrder.getTeacherName());</span><br><span class="line">        order.setTotalFee(courseInfoOrder.getPrice());</span><br><span class="line">        order.setMemberId(memberId);</span><br><span class="line">        order.setMobile(userInfoOrder.getMobile());</span><br><span class="line">        order.setNickname(userInfoOrder.getNickname());</span><br><span class="line">        order.setStatus(<span class="number">0</span>);  <span class="comment">//订单状态（0：未支付 1：已支付）</span></span><br><span class="line">        order.setPayType(<span class="number">1</span>);  <span class="comment">//支付类型 ，微信1</span></span><br><span class="line">        baseMapper.insert(order);</span><br><span class="line">        <span class="comment">//返回订单号</span></span><br><span class="line">        <span class="keyword">return</span> order.getOrderNo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="查询订单（后端）"><a href="#查询订单（后端）" class="headerlink" title="查询订单（后端）"></a>查询订单（后端）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据订单id查询订单信息</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getOrderInfo/&#123;orderNo&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getOrderInfo</span><span class="params">(<span class="meta">@PathVariable</span> String orderNo)</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;order_no&quot;</span>, orderNo);</span><br><span class="line">    Order order = orderService.getOne(wrapper);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;orderInfo&quot;</span>, order);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="生成订单（前端）"><a href="#生成订单（前端）" class="headerlink" title="生成订单（前端）"></a>生成订单（前端）</h3><h4 id="api-5"><a href="#api-5" class="headerlink" title="api"></a>api</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 生成订单</span></span><br><span class="line">  <span class="function"><span class="title">createOrder</span>(<span class="params">courseId</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/eduorder/order/createOrder/<span class="subst">$&#123;courseId&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 查询订单信息</span></span><br><span class="line">  <span class="function"><span class="title">getOrderInfo</span>(<span class="params">orderNo</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/eduorder/order/getOrderInfo/<span class="subst">$&#123;orderNo&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="课程详情页面跳转"><a href="#课程详情页面跳转" class="headerlink" title="课程详情页面跳转"></a>课程详情页面跳转</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  <span class="comment">// 创建订单</span></span><br><span class="line">  <span class="function"><span class="title">createOrder</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    orderApi.createOrder(<span class="built_in">this</span>.courseId).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 返回订单号  跳转页面</span></span><br><span class="line">      <span class="built_in">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/order/&#x27;</span> + result.data.data.orderNo &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="动态路由页面模板"><a href="#动态路由页面模板" class="headerlink" title="动态路由页面模板"></a>动态路由页面模板</h4><blockquote><p>创建一个动态路由页面，_ono.vue</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;Page Confirm&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;Title&quot;&gt;</span><br><span class="line">      &lt;h1 class=&quot;fl f18&quot;&gt;订单确认&lt;/h1&gt;</span><br><span class="line">      &lt;img src=&quot;~/assets/img/cart_setp2.png&quot; class=&quot;fr&quot; /&gt;</span><br><span class="line">      &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;form name=&quot;flowForm&quot; id=&quot;flowForm&quot; method=&quot;post&quot; action=&quot;&quot;&gt;</span><br><span class="line">      &lt;table class=&quot;GoodList&quot;&gt;</span><br><span class="line">        &lt;tbody&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">            &lt;th class=&quot;name&quot;&gt;商品&lt;/th&gt;</span><br><span class="line">            &lt;th class=&quot;price&quot;&gt;原价&lt;/th&gt;</span><br><span class="line">            &lt;th class=&quot;priceNew&quot;&gt;价格&lt;/th&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">        &lt;/tbody&gt;</span><br><span class="line">        &lt;tbody&gt;</span><br><span class="line">          &lt;!-- &lt;tr&gt;</span><br><span class="line">          &lt;td colspan=&quot;3&quot; class=&quot;Title red f18 fb&quot;&gt;&lt;p&gt;限时折扣&lt;/p&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt; --&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">            &lt;td colspan=&quot;3&quot; class=&quot;teacher&quot;&gt;讲师：&#123;&#123; order.teacherName &#125;&#125;&lt;/td&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">          &lt;tr class=&quot;good&quot;&gt;</span><br><span class="line">            &lt;td class=&quot;name First&quot;&gt;</span><br><span class="line">              &lt;a</span><br><span class="line">                target=&quot;_blank&quot;</span><br><span class="line">                :href=&quot;&#x27;https://localhost:3000/course/&#x27; + order.courseId&quot;</span><br><span class="line">              &gt;</span><br><span class="line">                &lt;img :src=&quot;order.courseCover&quot;</span><br><span class="line">              /&gt;&lt;/a&gt;</span><br><span class="line">              &lt;div class=&quot;goodInfo&quot;&gt;</span><br><span class="line">                &lt;input type=&quot;hidden&quot; class=&quot;ids ids_14502&quot; value=&quot;14502&quot; /&gt;</span><br><span class="line">                &lt;a</span><br><span class="line">                  target=&quot;_blank&quot;</span><br><span class="line">                  :href=&quot;&#x27;https://localhost:3000/course/&#x27; + order.courseId&quot;</span><br><span class="line">                  &gt;&#123;&#123; order.courseTitle &#125;&#125;&lt;/a</span><br><span class="line">                &gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">            &lt;td class=&quot;price&quot;&gt;</span><br><span class="line">              &lt;p&gt;</span><br><span class="line">                ￥&lt;strong&gt;&#123;&#123; order.totalFee &#125;&#125;&lt;/strong&gt;</span><br><span class="line">              &lt;/p&gt;</span><br><span class="line">              &lt;!-- &lt;span class=&quot;discName red&quot;&gt;限时8折&lt;/span&gt; --&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">            &lt;td class=&quot;red priceNew Last&quot;&gt;</span><br><span class="line">              ￥&lt;strong&gt;&#123;&#123; order.totalFee &#125;&#125;&lt;/strong&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">            &lt;td class=&quot;Billing tr&quot; colspan=&quot;3&quot;&gt;</span><br><span class="line">              &lt;div class=&quot;tr&quot;&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                  共 &lt;strong class=&quot;red&quot;&gt;1&lt;/strong&gt; 件商品，合计&lt;span</span><br><span class="line">                    class=&quot;red f20&quot;</span><br><span class="line">                    &gt;￥&lt;strong&gt;&#123;&#123; order.totalFee &#125;&#125;&lt;/strong&gt;&lt;/span</span><br><span class="line">                  &gt;</span><br><span class="line">                &lt;/p&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">        &lt;/tbody&gt;</span><br><span class="line">      &lt;/table&gt;</span><br><span class="line">      &lt;div class=&quot;Finish&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;fr&quot; id=&quot;AgreeDiv&quot;&gt;</span><br><span class="line">          &lt;label for=&quot;Agree&quot;</span><br><span class="line">            &gt;&lt;p class=&quot;on&quot;&gt;</span><br><span class="line">              &lt;input type=&quot;checkbox&quot; checked=&quot;checked&quot; /&gt;我已阅读并同意&lt;a</span><br><span class="line">                href=&quot;javascript:&quot;</span><br><span class="line">                target=&quot;_blank&quot;</span><br><span class="line">                &gt;《谷粒学院购买协议》&lt;/a</span><br><span class="line">              &gt;</span><br><span class="line">            &lt;/p&gt;&lt;/label</span><br><span class="line">          &gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;Main fl&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;fl&quot;&gt;</span><br><span class="line">            &lt;a :href=&quot;&#x27;/course/&#x27; + order.courseId&quot;&gt;返回课程详情页&lt;/a&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class=&quot;fr&quot;&gt;</span><br><span class="line">            &lt;p&gt;</span><br><span class="line">              共 &lt;strong class=&quot;red&quot;&gt;1&lt;/strong&gt; 件商品，合计&lt;span</span><br><span class="line">                class=&quot;red f20&quot;</span><br><span class="line">                &gt;￥&lt;strong id=&quot;AllPrice&quot;&gt;&#123;&#123; order.totalFee &#125;&#125;&lt;/strong&gt;&lt;/span</span><br><span class="line">              &gt;</span><br><span class="line">            &lt;/p&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;input name=&quot;score&quot; value=&quot;0&quot; type=&quot;hidden&quot; id=&quot;usedScore&quot; /&gt;</span><br><span class="line">        &lt;button class=&quot;fr redb&quot; type=&quot;button&quot; id=&quot;submitPay&quot; @click=&quot;toPay()&quot;&gt;</span><br><span class="line">          去支付</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">        &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import ordersApi from &#x27;@/api/order&#x27;</span><br><span class="line">  export default &#123;</span><br><span class="line">    methods: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">asyncData</span>(<span class="params">&#123; params, error &#125;</span>)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> ordersApi.getOrderInfo(params.ono)</span><br><span class="line">        .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123; </span><br><span class="line">                <span class="attr">orderInfo</span>: response.data.data.orderInfo</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><blockquote><p>这里一直在调试，发现我的courseInfo对象为null，debug了一会发现是courseController当中的被远程调用的方法中，返回的对象vo类内的值不一致，导致BeanUtils赋值的时候赋值不了，然后改一下重启就行</p></blockquote><h3 id="生成支付二维码（后端）"><a href="#生成支付二维码（后端）" class="headerlink" title="生成支付二维码（后端）"></a>生成支付二维码（后端）</h3><blockquote><p>好家伙又要企业认证</p></blockquote><h4 id="controller-4"><a href="#controller-4" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduorder/pay-log&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayLogController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PayLogService logService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成微信支付二维码</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;createNative/&#123;orderNo&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">createNative</span><span class="params">(<span class="meta">@PathVariable</span> String orderNo)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = logService.createNative(orderNo);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(map);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service主要业务逻辑"><a href="#service主要业务逻辑" class="headerlink" title="service主要业务逻辑"></a>service主要业务逻辑</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayLogServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">PayLogMapper</span>, <span class="title">PayLog</span>&gt; <span class="keyword">implements</span> <span class="title">PayLogService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成微信支付二维码</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">createNative</span><span class="params">(String orderNo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 根据订单号查询订单信息</span></span><br><span class="line">            QueryWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">            wrapper.eq(<span class="string">&quot;order_no&quot;</span>, orderNo);</span><br><span class="line">            Order order = orderService.getOne(wrapper);</span><br><span class="line">            <span class="comment">// 使用map设置生成二维码所需的参数</span></span><br><span class="line">            Map&lt;String, String&gt; m = <span class="keyword">new</span> HashMap();</span><br><span class="line">            m.put(<span class="string">&quot;appid&quot;</span>, <span class="string">&quot;wx74862e0dfcf69954&quot;</span>);</span><br><span class="line">            m.put(<span class="string">&quot;mch_id&quot;</span>, <span class="string">&quot;1558950191&quot;</span>);</span><br><span class="line">            m.put(<span class="string">&quot;nonce_str&quot;</span>, WXPayUtil.generateNonceStr());</span><br><span class="line">            m.put(<span class="string">&quot;body&quot;</span>, order.getCourseTitle()); <span class="comment">//课程标题</span></span><br><span class="line">            m.put(<span class="string">&quot;out_trade_no&quot;</span>, orderNo); <span class="comment">//订单号</span></span><br><span class="line">            m.put(<span class="string">&quot;total_fee&quot;</span>, order.getTotalFee().multiply(<span class="keyword">new</span> BigDecimal(<span class="string">&quot;100&quot;</span>)).longValue() + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            m.put(<span class="string">&quot;spbill_create_ip&quot;</span>, <span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">            m.put(<span class="string">&quot;notify_url&quot;</span>, <span class="string">&quot;http://guli.shop/api/order/weixinPay/weixinNotify\n&quot;</span>);</span><br><span class="line">            m.put(<span class="string">&quot;trade_type&quot;</span>, <span class="string">&quot;NATIVE&quot;</span>);</span><br><span class="line">            <span class="comment">// 发送httpclient请求，传递参数xml格式</span></span><br><span class="line">            HttpClient client = <span class="keyword">new</span> HttpClient(<span class="string">&quot;https://api.mch.weixin.qq.com/pay/unifiedorder&quot;</span>);</span><br><span class="line">            <span class="comment">//设置xml格式的参数</span></span><br><span class="line">            client.setXmlParam(WXPayUtil.generateSignedXml(m, <span class="string">&quot;T6m9iK73b0kn9g5v426MKfHQH7X8rKwb&quot;</span>));</span><br><span class="line">            client.setHttps(<span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">//执行post请求发送</span></span><br><span class="line">            client.post();</span><br><span class="line">            <span class="comment">// 得到请求返回结果</span></span><br><span class="line">            String xml = client.getContent();</span><br><span class="line">            Map&lt;String, String&gt; resultMap = WXPayUtil.xmlToMap(xml);</span><br><span class="line">            <span class="comment">//最终返回数据 的封装</span></span><br><span class="line">            Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">            map.put(<span class="string">&quot;out_trade_no&quot;</span>, orderNo);</span><br><span class="line">            map.put(<span class="string">&quot;course_id&quot;</span>, order.getCourseId());</span><br><span class="line">            map.put(<span class="string">&quot;total_fee&quot;</span>, order.getTotalFee());</span><br><span class="line">            map.put(<span class="string">&quot;result_code&quot;</span>, resultMap.get(<span class="string">&quot;result_code&quot;</span>));  <span class="comment">//返回二维码操作状态码</span></span><br><span class="line">            map.put(<span class="string">&quot;code_url&quot;</span>, resultMap.get(<span class="string">&quot;code_url&quot;</span>));        <span class="comment">//二维码地址</span></span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;生成二维码失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="查询支付状态（后端）"><a href="#查询支付状态（后端）" class="headerlink" title="查询支付状态（后端）"></a>查询支付状态（后端）</h3><h4 id="controller-5"><a href="#controller-5" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询订单支付状态</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getPayStatus/&#123;orderNo&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getPayStatus</span><span class="params">(<span class="meta">@PathVariable</span> String orderNo)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, String&gt; map = logService.getPayStatus(orderNo);</span><br><span class="line">    <span class="keyword">if</span> (map == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.error().message(<span class="string">&quot;支付出错了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (map.get(<span class="string">&quot;trade_state&quot;</span>).equals(<span class="string">&quot;SUCCESS&quot;</span>)) &#123;</span><br><span class="line">        logService.updateOrderStatus(map);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 特定返回码，前端有拦截器判断</span></span><br><span class="line">    <span class="keyword">return</span> R.ok().code(<span class="number">25000</span>).message(<span class="string">&quot;支付中……&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service-3"><a href="#service-3" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询订单支付状态</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getPayStatus</span><span class="params">(String orderNo)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//1、封装参数</span></span><br><span class="line">        Map&lt;String, String&gt; m = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        m.put(<span class="string">&quot;appid&quot;</span>, <span class="string">&quot;wx74862e0dfcf69954&quot;</span>);</span><br><span class="line">        m.put(<span class="string">&quot;mch_id&quot;</span>, <span class="string">&quot;1558950191&quot;</span>);</span><br><span class="line">        m.put(<span class="string">&quot;out_trade_no&quot;</span>, orderNo);</span><br><span class="line">        m.put(<span class="string">&quot;nonce_str&quot;</span>, WXPayUtil.generateNonceStr());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2 发送httpclient</span></span><br><span class="line">        HttpClient client = <span class="keyword">new</span> HttpClient(<span class="string">&quot;https://api.mch.weixin.qq.com/pay/orderquery&quot;</span>);</span><br><span class="line">        client.setXmlParam(WXPayUtil.generateSignedXml(m, <span class="string">&quot;T6m9iK73b0kn9g5v426MKfHQH7X8rKwb&quot;</span>));</span><br><span class="line">        client.setHttps(<span class="keyword">true</span>);</span><br><span class="line">        client.post();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3 得到请求返回内容</span></span><br><span class="line">        String xml = client.getContent();</span><br><span class="line">        <span class="comment">//6、转成Map再返回</span></span><br><span class="line">        <span class="keyword">return</span> WXPayUtil.xmlToMap(xml);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加支付记录和更新订单状态</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateOrderStatus</span><span class="params">(Map&lt;String, String&gt; map)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//从map获取订单号</span></span><br><span class="line">    String orderNo = map.get(<span class="string">&quot;out_trade_no&quot;</span>);</span><br><span class="line">    <span class="comment">//根据订单号查询订单信息</span></span><br><span class="line">    QueryWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;order_no&quot;</span>, orderNo);</span><br><span class="line">    Order order = orderService.getOne(wrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新订单表订单状态</span></span><br><span class="line">    <span class="keyword">if</span> (order.getStatus().intValue() == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 已经支付过了</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    order.setStatus(<span class="number">1</span>);<span class="comment">//1代表已经支付</span></span><br><span class="line">    orderService.updateById(order);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//向支付表添加支付记录</span></span><br><span class="line">    PayLog payLog = <span class="keyword">new</span> PayLog();</span><br><span class="line">    payLog.setOrderNo(orderNo);  <span class="comment">//订单号</span></span><br><span class="line">    payLog.setPayTime(<span class="keyword">new</span> Date()); <span class="comment">//订单完成时间</span></span><br><span class="line">    payLog.setPayType(<span class="number">1</span>);<span class="comment">//支付类型 1微信</span></span><br><span class="line">    payLog.setTotalFee(order.getTotalFee());<span class="comment">//总金额(分)</span></span><br><span class="line"></span><br><span class="line">    payLog.setTradeState(map.get(<span class="string">&quot;trade_state&quot;</span>));<span class="comment">//支付状态</span></span><br><span class="line">    payLog.setTransactionId(map.get(<span class="string">&quot;transaction_id&quot;</span>)); <span class="comment">//流水号</span></span><br><span class="line">    payLog.setAttr(JSONObject.toJSONString(map));</span><br><span class="line"></span><br><span class="line">    baseMapper.insert(payLog);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="支付（前端）"><a href="#支付（前端）" class="headerlink" title="支付（前端）"></a>支付（前端）</h3><h4 id="api-6"><a href="#api-6" class="headerlink" title="api"></a>api</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成二维码</span></span><br><span class="line"> <span class="function"><span class="title">createNative</span>(<span class="params">orderNo</span>)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> request(&#123;</span><br><span class="line">     <span class="attr">url</span>: <span class="string">`/eduorder/paylog/createNative/<span class="subst">$&#123;orderNo&#125;</span>`</span>,</span><br><span class="line">     <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="comment">// 查询订单状态</span></span><br><span class="line"> <span class="function"><span class="title">getPayStatus</span>(<span class="params">orderNo</span>)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> request(&#123;</span><br><span class="line">     <span class="attr">url</span>: <span class="string">`/eduorder/paylog/getPayStatus/<span class="subst">$&#123;orderNo&#125;</span>`</span>,</span><br><span class="line">     <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure><h4 id="跳转至页面方法"><a href="#跳转至页面方法" class="headerlink" title="跳转至页面方法"></a>跳转至页面方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 去支付</span></span><br><span class="line"><span class="function"><span class="title">toPay</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/pay/&#x27;</span> + <span class="built_in">this</span>.orderInfo.orderNo &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="动态路由模板"><a href="#动态路由模板" class="headerlink" title="动态路由模板"></a>动态路由模板</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;cart py-container&quot;&gt;</span><br><span class="line">    &lt;!--主内容--&gt;</span><br><span class="line">    &lt;div class=&quot;checkout py-container pay&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;checkout-tit&quot;&gt;</span><br><span class="line">        &lt;h4 class=&quot;fl tit-txt&quot;&gt;</span><br><span class="line">          &lt;span class=&quot;success-icon&quot;&gt;&lt;/span</span><br><span class="line">          &gt;&lt;span class=&quot;success-info&quot;</span><br><span class="line">            &gt;订单提交成功，请您及时付款！订单号：&#123;&#123; payObj.out_trade_no &#125;&#125;&lt;/span</span><br><span class="line">          &gt;</span><br><span class="line">        &lt;/h4&gt;</span><br><span class="line">        &lt;span class=&quot;fr&quot;</span><br><span class="line">          &gt;&lt;em class=&quot;sui-lead&quot;&gt;应付金额：&lt;/em</span><br><span class="line">          &gt;&lt;em class=&quot;orange money&quot;&gt;￥&#123;&#123; payObj.total_fee &#125;&#125;&lt;/em&gt;&lt;/span</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;div class=&quot;clearfix&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;checkout-steps&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;fl weixin&quot;&gt;微信支付&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;fl sao&quot;&gt;</span><br><span class="line">          &lt;p class=&quot;red&quot;&gt;请使用微信扫一扫。&lt;/p&gt;</span><br><span class="line">          &lt;div class=&quot;fl code&quot;&gt;</span><br><span class="line">            &lt;!-- &lt;img id=&quot;qrious&quot; src=&quot;~/assets/img/erweima.png&quot; alt=&quot;&quot;&gt; --&gt;</span><br><span class="line">            &lt;!-- &lt;qriously value=&quot;weixin://wxpay/bizpayurl?pr=R7tnDpZ&quot; :size=&quot;338&quot;/&gt; --&gt;</span><br><span class="line">            &lt;qriously :value=&quot;payObj.code_url&quot; :size=&quot;338&quot; /&gt;</span><br><span class="line">            &lt;div class=&quot;saosao&quot;&gt;</span><br><span class="line">              &lt;p&gt;请使用微信扫一扫&lt;/p&gt;</span><br><span class="line">              &lt;p&gt;扫描二维码支付&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;clearfix&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;!-- &lt;p&gt;&lt;a href=&quot;pay.html&quot; target=&quot;_blank&quot;&gt;&gt; 其他支付方式&lt;/a&gt;&lt;/p&gt; --&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import orderApi from &#x27;@/api/order&#x27;</span><br><span class="line">  export default &#123;</span><br><span class="line">    asyncData(&#123; params, error &#125;) &#123;</span><br><span class="line">      return orderApi.createNatvie(params.pid).then(response =&gt; &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          payObj: response.data.data</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        timer1: &#x27;&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p>注意这里需要安装vue-qriously组件</p></blockquote><h4 id="response拦截器"><a href="#response拦截器" class="headerlink" title="response拦截器"></a>response拦截器</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http response 拦截器</span></span><br><span class="line">service.interceptors.response.use(</span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//debugger</span></span><br><span class="line">    <span class="keyword">if</span> (response.data.code == <span class="number">28004</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;response.data.resultCode是28004&quot;</span>)</span><br><span class="line">        <span class="comment">// 返回 错误代码-1 清除ticket信息并跳转到登录页面</span></span><br><span class="line">        <span class="comment">//debugger</span></span><br><span class="line">        <span class="built_in">window</span>.location.href=<span class="string">&quot;/login&quot;</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (response.data.code !== <span class="number">20000</span>) &#123;</span><br><span class="line">        <span class="comment">//25000：订单支付中，不做任何提示</span></span><br><span class="line">        <span class="keyword">if</span>(response.data.code != <span class="number">25000</span>) &#123;</span><br><span class="line">          Message(&#123;</span><br><span class="line">            <span class="attr">message</span>: response.data.message || <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">            <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error.response)   <span class="comment">// 返回接口返回的错误信息</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="调用方法"><a href="#调用方法" class="headerlink" title="调用方法"></a>调用方法</h4><blockquote><p>这里需要用到response拦截器，后端支付中的返回码为25000，需要根据返回码判断是否支付成功</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">timer1</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 注意这里不适用created，因为使用了异步初始化数据，mounted在页面渲染完成后执行</span></span><br><span class="line"><span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.timer1 = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.getPayStatus(<span class="built_in">this</span>.payObj.out_trade_no)</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="comment">// 每隔一段时间查询订单状态</span></span><br><span class="line">  <span class="function"><span class="title">getPayStatus</span>(<span class="params">orderNo</span>)</span> &#123;</span><br><span class="line">    orderApi.getPayStatus(<span class="built_in">this</span>.orderNo).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (result.data.success) &#123;</span><br><span class="line">        <span class="comment">// 清除定时器</span></span><br><span class="line">        <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.timer1)</span><br><span class="line">        <span class="comment">// 提示信息</span></span><br><span class="line">        <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;支付成功!&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// 跳转至课程详情页面</span></span><br><span class="line">        <span class="built_in">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/course/&#x27;</span> + <span class="built_in">this</span>.payObj.course_id &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><blockquote><p>测了一次，没跳转但是状态改了，懒得测了，不想花钱</p><p>debug了一下，发现后端没啥问题，也执行了，付钱了之后也返回了R.ok，但是前端就是显示result为undefined，不理解</p></blockquote><h3 id="课程信息显示完善"><a href="#课程信息显示完善" class="headerlink" title="课程信息显示完善"></a>课程信息显示完善</h3><blockquote><p>免费和不免费，是否购买等页面显示需要区别</p></blockquote><h4 id="查询用户购买课程信息方法"><a href="#查询用户购买课程信息方法" class="headerlink" title="查询用户购买课程信息方法"></a>查询用户购买课程信息方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根绝用户id和课程id查询 用户课程支付情况</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getUserCourseStatus/&#123;cid&#125;/&#123;uid&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">getUserCourseStatus</span><span class="params">(<span class="meta">@PathVariable</span> String cid, <span class="meta">@PathVariable</span> String uid)</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;course_id&quot;</span>, cid);</span><br><span class="line">    wrapper.eq(<span class="string">&quot;member_id&quot;</span>, uid);</span><br><span class="line">    wrapper.eq(<span class="string">&quot;status&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> count = orderService.count(wrapper);</span><br><span class="line">    <span class="comment">// 已经支付完成</span></span><br><span class="line">    <span class="keyword">return</span> count &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>需要修改课程详情接口的返回值，加上课程的支付状态（远程调用上述方法）</p></blockquote><h4 id="配置接口"><a href="#配置接口" class="headerlink" title="配置接口"></a>配置接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fallback = &quot;实现类的class&quot;，熔断器</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;service-order&quot;)</span></span><br><span class="line"><span class="comment">// 调用服务（服务名），这里的服务名要和对应服务的配置文件中的spring.application.name对应</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">orderClient</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 根绝用户id和课程id查询 用户课程支付情况</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/eduorder/order/getUserCourseStatus/&#123;cid&#125;/&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">getUserCourseStatus</span><span class="params">(<span class="meta">@PathVariable(&quot;cid&quot;)</span> String cid, <span class="meta">@PathVariable(&quot;uid&quot;)</span> String uid)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="远程调用"><a href="#远程调用" class="headerlink" title="远程调用"></a>远程调用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/coursefront&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduCourseService courseService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderClient orderClient;</span><br><span class="line">    <span class="comment">// 课程详情信息+课程支付状态（远程调用）</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getCourseInfo/&#123;courseId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getCourseInfo</span><span class="params">(<span class="meta">@PathVariable</span> String courseId, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        CourseFrontInfoVo courseInfo = courseService.getBaseCourseInfo(courseId);</span><br><span class="line">        List&lt;ChapterVo&gt; chapterList = chapterService.getChapterVideoByCourseId(courseId);</span><br><span class="line">        <span class="comment">// 根据课程用户id查询订单状态</span></span><br><span class="line">        <span class="keyword">boolean</span> status = orderClient.getUserCourseStatus(courseId, JwtUtils.getMemberIdByJwtToken(request));</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;courseInfo&quot;</span>, courseInfo).data(<span class="string">&quot;chapterList&quot;</span>, chapterList).data(<span class="string">&quot;isBuy&quot;</span>, status);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="前端-1"><a href="#前端-1" class="headerlink" title="前端"></a>前端</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;aCoursesList&quot; class=&quot;bg-fa of&quot;&gt;</span><br><span class="line">            &lt;section</span><br><span class="line">              class=&quot;c-attr-mt&quot;</span><br><span class="line">              v-if=&quot;isBuy || Number(courseInfo.price === 0)&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;a</span><br><span class="line">                href=&quot;#&quot;</span><br><span class="line">                title=&quot;立即观看&quot;</span><br><span class="line">                class=&quot;comm-btn c-btn-3&quot;</span><br><span class="line">                @click=&quot;createOrder()&quot;</span><br><span class="line">                &gt;立即观看&lt;/a</span><br><span class="line">              &gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">            &lt;section class=&quot;c-attr-mt&quot; v-else&gt;</span><br><span class="line">              &lt;a</span><br><span class="line">                href=&quot;#&quot;</span><br><span class="line">                title=&quot;立即购买&quot;</span><br><span class="line">                class=&quot;comm-btn c-btn-3&quot;</span><br><span class="line">                @click=&quot;createOrder()&quot;</span><br><span class="line">                &gt;立即购买&lt;/a</span><br><span class="line">              &gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import courseApi from &#x27;@/api/course&#x27;</span><br><span class="line">  import orderApi from &#x27;@/api/order&#x27;</span><br><span class="line">  export default &#123;</span><br><span class="line">    // asyncData(&#123; params, error &#125;) &#123;</span><br><span class="line">    //   return courseApi.getCourseInfo(params.id).then(result =&gt; &#123;</span><br><span class="line">    //     return &#123;</span><br><span class="line">    //       courseInfo: result.data.data.courseInfo,</span><br><span class="line">    //       chapterList: result.data.data.chapterList,</span><br><span class="line">    //       courseId: params.id</span><br><span class="line">    //     &#125;</span><br><span class="line">    //   &#125;)</span><br><span class="line">    // &#125;,</span><br><span class="line">    asyncData(&#123; params, error &#125;) &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        courseId: params.id</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        courseInfo: &#123;&#125;,</span><br><span class="line">        chapterList: [],</span><br><span class="line">        isBuy: false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">      // 这里不适用异步调用，而是created</span><br><span class="line">      this.initCourseInfo()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      // 查询课程详情信息</span><br><span class="line">      initCourseInfo() &#123;</span><br><span class="line">        courseApi.getCourseInfo(this.courseId).then(result =&gt; &#123;</span><br><span class="line">          (this.courseInfo = result.data.data.courseInfo),</span><br><span class="line">          (this.chapterList = result.data.data.chapterList),</span><br><span class="line">          (this.isBuy = result.data.data.isBuy)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】在线教育项目实战5</title>
      <link href="/2021/09/28/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-5/"/>
      <url>/2021/09/28/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-5/</url>
      
        <content type="html"><![CDATA[<blockquote><p>这里开始是前台部分</p></blockquote><h2 id="搭建项目前台环境"><a href="#搭建项目前台环境" class="headerlink" title="搭建项目前台环境"></a>搭建项目前台环境</h2><blockquote><p>使用服务端渲染技术NuxtJS框架</p></blockquote><p>![02 搭建项目前台环境（nuxt）](<a href="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/02">https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/02</a> 搭建项目前台环境（nuxt）.png)</p><h3 id="搭建NuxtJS"><a href="#搭建NuxtJS" class="headerlink" title="搭建NuxtJS"></a>搭建NuxtJS</h3><blockquote><ol><li>先赋值template至工作区</li><li>修改.eslintrc.js（复制后台的即可）</li><li>修改package.json，必须修改其中的name,version,decription,author等</li><li>修改nuxt.config.js</li><li>安装依赖npm install</li><li>测试运行npm run dev</li></ol></blockquote><h3 id="NUXT目录结构"><a href="#NUXT目录结构" class="headerlink" title="NUXT目录结构"></a>NUXT目录结构</h3><blockquote><ol><li>资源目录 assets<br>用于组织未编译的静态资源如 LESS、SASS 或 JavaScript。</li><li>组件目录 components<br>用于组织应用的 Vue.js 组件。Nuxt.js 不会扩展增强该目录下 Vue.js 组件，即这些组件不会像页面组件那样有 asyncData 方法的特性。</li><li>布局目录 layouts<br>用于组织应用的布局组件。<ol><li>default.vue：设置头尾信息</li></ol></li><li>页面目录 pages<br>用于组织应用的路由及视图。Nuxt.js 框架读取该目录下所有的 .vue 文件并自动生成对应的路由配置。</li><li>插件目录 plugins<br>用于组织那些需要在 根vue.js应用 实例化之前需要运行的 Javascript 插件。</li><li>nuxt.config.js 文件<br>nuxt.config.js 文件用于组织Nuxt.js 应用的个性化配置，以便覆盖默认配置。</li></ol></blockquote><h3 id="引入基础资源和默认头尾视图"><a href="#引入基础资源和默认头尾视图" class="headerlink" title="引入基础资源和默认头尾视图"></a>引入基础资源和默认头尾视图</h3><blockquote><p>Nuxt本身基于vue，但是没有引入element-ui，所以需要引入</p><p>这里还引入了其他需要的资源，直接cv即可</p><ol><li>assets</li><li>layout -&gt; default.vue</li><li>pages -&gt; index.vue</li></ol></blockquote><h4 id="default-vue"><a href="#default-vue" class="headerlink" title="default.vue"></a>default.vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;in-wrap&quot;&gt;</span><br><span class="line">    &lt;!-- 公共头引入 --&gt;</span><br><span class="line">    &lt;header id=&quot;header&quot;&gt;</span><br><span class="line">      &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;h1 id=&quot;logo&quot;&gt;</span><br><span class="line">          &lt;a href=&quot;#&quot; title=&quot;谷粒学院&quot;&gt;</span><br><span class="line">            &lt;img src=&quot;~/assets/img/logo.png&quot; width=&quot;100%&quot; alt=&quot;谷粒学院&quot; /&gt;</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">        &lt;/h1&gt;</span><br><span class="line">        &lt;div class=&quot;h-r-nsl&quot;&gt;</span><br><span class="line">          &lt;ul class=&quot;nav&quot;&gt;</span><br><span class="line">            &lt;!-- 固定路由 --&gt;</span><br><span class="line">            &lt;router-link to=&quot;/&quot; tag=&quot;li&quot; active-class=&quot;current&quot; exact&gt;</span><br><span class="line">              &lt;a&gt;首页&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/course&quot; tag=&quot;li&quot; active-class=&quot;current&quot;&gt;</span><br><span class="line">              &lt;a&gt;课程&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/teacher&quot; tag=&quot;li&quot; active-class=&quot;current&quot;&gt;</span><br><span class="line">              &lt;a&gt;名师&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/article&quot; tag=&quot;li&quot; active-class=&quot;current&quot;&gt;</span><br><span class="line">              &lt;a&gt;文章&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/qa&quot; tag=&quot;li&quot; active-class=&quot;current&quot;&gt;</span><br><span class="line">              &lt;a&gt;问答&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">          &lt;!-- / nav --&gt;</span><br><span class="line">          &lt;ul class=&quot;h-r-login&quot;&gt;</span><br><span class="line">            &lt;li v-if=&quot;!loginInfo.id&quot; id=&quot;no-login&quot;&gt;</span><br><span class="line">              &lt;a href=&quot;/login&quot; title=&quot;登录&quot;&gt;</span><br><span class="line">                &lt;em class=&quot;icon18 login-icon&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">                &lt;span class=&quot;vam ml5&quot;&gt;登录&lt;/span&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">              |</span><br><span class="line">              &lt;a href=&quot;/register&quot; title=&quot;注册&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;vam ml5&quot;&gt;注册&lt;/span&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li v-if=&quot;loginInfo.id&quot; id=&quot;is-login-one&quot; class=&quot;mr10&quot;&gt;</span><br><span class="line">              &lt;a id=&quot;headerMsgCountId&quot; href=&quot;#&quot; title=&quot;消息&quot;&gt;</span><br><span class="line">                &lt;em class=&quot;icon18 news-icon&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">              &lt;q class=&quot;red-point&quot; style=&quot;display: none&quot;&gt;&amp;nbsp;&lt;/q&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li v-if=&quot;loginInfo.id&quot; id=&quot;is-login-two&quot; class=&quot;h-r-user&quot;&gt;</span><br><span class="line">              &lt;a href=&quot;/ucenter&quot; title&gt;</span><br><span class="line">                &lt;img</span><br><span class="line">                  :src=&quot;loginInfo.avatar&quot;</span><br><span class="line">                  width=&quot;30&quot;</span><br><span class="line">                  height=&quot;30&quot;</span><br><span class="line">                  class=&quot;vam picImg&quot;</span><br><span class="line">                  alt</span><br><span class="line">                /&gt;</span><br><span class="line">                &lt;span id=&quot;userName&quot; class=&quot;vam disIb&quot;&gt;&#123;&#123;</span><br><span class="line">                  loginInfo.nickname</span><br><span class="line">                &#125;&#125;&lt;/span&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">              &lt;a</span><br><span class="line">                href=&quot;javascript:void(0);&quot;</span><br><span class="line">                title=&quot;退出&quot;</span><br><span class="line">                @click=&quot;logout()&quot;</span><br><span class="line">                class=&quot;ml5&quot;</span><br><span class="line">                &gt;退出&lt;/a</span><br><span class="line">              &gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;!-- /未登录显示第1 li；登录后显示第2，3 li --&gt;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">          &lt;aside class=&quot;h-r-search&quot;&gt;</span><br><span class="line">            &lt;form action=&quot;#&quot; method=&quot;post&quot;&gt;</span><br><span class="line">              &lt;label class=&quot;h-r-s-box&quot;&gt;</span><br><span class="line">                &lt;input</span><br><span class="line">                  type=&quot;text&quot;</span><br><span class="line">                  placeholder=&quot;输入你想学的课程&quot;</span><br><span class="line">                  name=&quot;queryCourse.courseName&quot;</span><br><span class="line">                  value</span><br><span class="line">                /&gt;</span><br><span class="line">                &lt;button type=&quot;submit&quot; class=&quot;s-btn&quot;&gt;</span><br><span class="line">                  &lt;em class=&quot;icon18&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">                &lt;/button&gt;</span><br><span class="line">              &lt;/label&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">          &lt;/aside&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;aside class=&quot;mw-nav-btn&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;mw-nav-icon&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/aside&gt;</span><br><span class="line">        &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">    &lt;!-- /公共头引入 --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;nuxt /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 公共底引入 --&gt;</span><br><span class="line">    &lt;footer id=&quot;footer&quot;&gt;</span><br><span class="line">      &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;div class&gt;</span><br><span class="line">          &lt;h4 class=&quot;hLh30&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;fsize18 f-fM c-999&quot;&gt;友情链接&lt;/span&gt;</span><br><span class="line">          &lt;/h4&gt;</span><br><span class="line">          &lt;ul class=&quot;of flink-list&quot;&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;a href=&quot;http://www.atguigu.com/&quot; title=&quot;尚硅谷&quot; target=&quot;_blank&quot;</span><br><span class="line">                &gt;尚硅谷&lt;/a</span><br><span class="line">              &gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">          &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;b-foot&quot;&gt;</span><br><span class="line">          &lt;section class=&quot;fl col-7&quot;&gt;</span><br><span class="line">            &lt;section class=&quot;mr20&quot;&gt;</span><br><span class="line">              &lt;section class=&quot;b-f-link&quot;&gt;</span><br><span class="line">                &lt;a href=&quot;#&quot; title=&quot;关于我们&quot; target=&quot;_blank&quot;&gt;关于我们&lt;/a&gt;|</span><br><span class="line">                &lt;a href=&quot;#&quot; title=&quot;联系我们&quot; target=&quot;_blank&quot;&gt;联系我们&lt;/a&gt;|</span><br><span class="line">                &lt;a href=&quot;#&quot; title=&quot;帮助中心&quot; target=&quot;_blank&quot;&gt;帮助中心&lt;/a&gt;|</span><br><span class="line">                &lt;a href=&quot;#&quot; title=&quot;资源下载&quot; target=&quot;_blank&quot;&gt;资源下载&lt;/a&gt;|</span><br><span class="line">                &lt;span&gt;服务热线：010-56253825(北京) 0755-85293825(深圳)&lt;/span&gt;</span><br><span class="line">                &lt;span&gt;Email：info@atguigu.com&lt;/span&gt;</span><br><span class="line">              &lt;/section&gt;</span><br><span class="line">              &lt;section class=&quot;b-f-link mt10&quot;&gt;</span><br><span class="line">                &lt;span&gt;©2018课程版权均归谷粒学院所有 京ICP备17055252号&lt;/span&gt;</span><br><span class="line">              &lt;/section&gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">          &lt;aside class=&quot;fl col-3 tac mt15&quot;&gt;</span><br><span class="line">            &lt;section class=&quot;gf-tx&quot;&gt;</span><br><span class="line">              &lt;span&gt;</span><br><span class="line">                &lt;img src=&quot;~/assets/img/wx-icon.png&quot; alt /&gt;</span><br><span class="line">              &lt;/span&gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">            &lt;section class=&quot;gf-tx&quot;&gt;</span><br><span class="line">              &lt;span&gt;</span><br><span class="line">                &lt;img src=&quot;~/assets/img/wb-icon.png&quot; alt /&gt;</span><br><span class="line">              &lt;/span&gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">          &lt;/aside&gt;</span><br><span class="line">          &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">    &lt;/footer&gt;</span><br><span class="line">    &lt;!-- /公共底引入 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import &#x27;~/assets/css/reset.css&#x27;</span><br><span class="line">  import &#x27;~/assets/css/theme.css&#x27;</span><br><span class="line">  import &#x27;~/assets/css/global.css&#x27;</span><br><span class="line">  import &#x27;~/assets/css/web.css&#x27;</span><br><span class="line">  export default &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="index-vue"><a href="#index-vue" class="headerlink" title="index.vue"></a>index.vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 幻灯片 开始 --&gt;</span><br><span class="line">    &lt;div v-swiper:mySwiper=&quot;swiperOption&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;swiper-wrapper&quot;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          v-for=&quot;banner in bannerList&quot;</span><br><span class="line">          :key=&quot;banner.id&quot;</span><br><span class="line">          class=&quot;swiper-slide&quot;</span><br><span class="line">          style=&quot;background: #040b1b&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;a target=&quot;_blank&quot; :href=&quot;banner.linkUrl&quot;&gt;</span><br><span class="line">            &lt;img :src=&quot;banner.imageUrl&quot; :alt=&quot;banner.title&quot; /&gt;</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;swiper-pagination swiper-pagination-white&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;swiper-button-prev swiper-button-white&quot;</span><br><span class="line">        slot=&quot;button-prev&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;swiper-button-next swiper-button-white&quot;</span><br><span class="line">        slot=&quot;button-next&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 幻灯片 结束 --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div id=&quot;aCoursesList&quot;&gt;</span><br><span class="line">      &lt;!-- 网校课程 开始 --&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">          &lt;header class=&quot;comm-title&quot;&gt;</span><br><span class="line">            &lt;h2 class=&quot;tac&quot;&gt;</span><br><span class="line">              &lt;span class=&quot;c-333&quot;&gt;热门课程&lt;/span&gt;</span><br><span class="line">            &lt;/h2&gt;</span><br><span class="line">          &lt;/header&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;article class=&quot;comm-course-list&quot;&gt;</span><br><span class="line">              &lt;ul class=&quot;of&quot; id=&quot;bna&quot;&gt;</span><br><span class="line">                &lt;li v-for=&quot;course in courseList&quot; :key=&quot;course.id&quot;&gt;</span><br><span class="line">                  &lt;div class=&quot;cc-l-wrap&quot;&gt;</span><br><span class="line">                    &lt;section class=&quot;course-img&quot;&gt;</span><br><span class="line">                      &lt;img</span><br><span class="line">                        :src=&quot;course.cover&quot;</span><br><span class="line">                        class=&quot;img-responsive&quot;</span><br><span class="line">                        :alt=&quot;course.title&quot;</span><br><span class="line">                      /&gt;</span><br><span class="line">                      &lt;div class=&quot;cc-mask&quot;&gt;</span><br><span class="line">                        &lt;a href=&quot;#&quot; title=&quot;开始学习&quot; class=&quot;comm-btn c-btn-1&quot;</span><br><span class="line">                          &gt;开始学习&lt;/a</span><br><span class="line">                        &gt;</span><br><span class="line">                      &lt;/div&gt;</span><br><span class="line">                    &lt;/section&gt;</span><br><span class="line">                    &lt;h3 class=&quot;hLh30 txtOf mt10&quot;&gt;</span><br><span class="line">                      &lt;a</span><br><span class="line">                        href=&quot;#&quot;</span><br><span class="line">                        :title=&quot;course.title&quot;</span><br><span class="line">                        class=&quot;course-title fsize18 c-333&quot;</span><br><span class="line">                        &gt;&#123;&#123; course.title &#125;&#125;&lt;/a</span><br><span class="line">                      &gt;</span><br><span class="line">                    &lt;/h3&gt;</span><br><span class="line">                    &lt;section class=&quot;mt10 hLh20 of&quot;&gt;</span><br><span class="line">                      &lt;span</span><br><span class="line">                        class=&quot;fr jgTag bg-green&quot;</span><br><span class="line">                        v-if=&quot;Number(course.price) === 0&quot;</span><br><span class="line">                      &gt;</span><br><span class="line">                        &lt;i class=&quot;c-fff fsize12 f-fA&quot;&gt;免费&lt;/i&gt;</span><br><span class="line">                      &lt;/span&gt;</span><br><span class="line">                      &lt;span class=&quot;fl jgAttr c-ccc f-fA&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;c-999 f-fA&quot;&gt;9634人学习&lt;/i&gt;</span><br><span class="line">                        |</span><br><span class="line">                        &lt;i class=&quot;c-999 f-fA&quot;&gt;9634评论&lt;/i&gt;</span><br><span class="line">                      &lt;/span&gt;</span><br><span class="line">                    &lt;/section&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">              &lt;/ul&gt;</span><br><span class="line">              &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/article&gt;</span><br><span class="line">            &lt;section class=&quot;tac pt20&quot;&gt;</span><br><span class="line">              &lt;a href=&quot;#&quot; title=&quot;全部课程&quot; class=&quot;comm-btn c-btn-2&quot;&gt;全部课程&lt;/a&gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/section&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- /网校课程 结束 --&gt;</span><br><span class="line">      &lt;!-- 网校名师 开始 --&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">          &lt;header class=&quot;comm-title&quot;&gt;</span><br><span class="line">            &lt;h2 class=&quot;tac&quot;&gt;</span><br><span class="line">              &lt;span class=&quot;c-333&quot;&gt;名师大咖&lt;/span&gt;</span><br><span class="line">            &lt;/h2&gt;</span><br><span class="line">          &lt;/header&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;article class=&quot;i-teacher-list&quot;&gt;</span><br><span class="line">              &lt;ul class=&quot;of&quot;&gt;</span><br><span class="line">                &lt;li v-for=&quot;teacher in teacherList&quot; :key=&quot;teacher.id&quot;&gt;</span><br><span class="line">                  &lt;section class=&quot;i-teach-wrap&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;i-teach-pic&quot;&gt;</span><br><span class="line">                      &lt;a href=&quot;/teacher/1&quot; :title=&quot;teacher.name&quot;&gt;</span><br><span class="line">                        &lt;img :alt=&quot;teacher.name&quot; :src=&quot;teacher.avatar&quot; /&gt;</span><br><span class="line">                      &lt;/a&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;mt10 hLh30 txtOf tac&quot;&gt;</span><br><span class="line">                      &lt;a</span><br><span class="line">                        href=&quot;/teacher/1&quot;</span><br><span class="line">                        :title=&quot;teacher.name&quot;</span><br><span class="line">                        class=&quot;fsize18 c-666&quot;</span><br><span class="line">                        &gt;&#123;&#123; teacher.name &#125;&#125;</span><br><span class="line">                      &lt;/a&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;hLh30 txtOf tac&quot;&gt;</span><br><span class="line">                      &lt;span class=&quot;fsize14 c-999&quot;&gt;&#123;&#123; teacher.career &#125;&#125;&lt;/span&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;mt15 i-q-txt&quot;&gt;</span><br><span class="line">                      &lt;p class=&quot;c-999 f-fA&quot;&gt;</span><br><span class="line">                        &#123;&#123; teacher.intro &#125;&#125;</span><br><span class="line">                      &lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                  &lt;/section&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">              &lt;/ul&gt;</span><br><span class="line">              &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/article&gt;</span><br><span class="line">            &lt;section class=&quot;tac pt20&quot;&gt;</span><br><span class="line">              &lt;a href=&quot;#&quot; title=&quot;全部讲师&quot; class=&quot;comm-btn c-btn-2&quot;&gt;全部讲师&lt;/a&gt;</span><br><span class="line">            &lt;/section&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/section&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- /网校名师 结束 --&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="轮播图组件"><a href="#轮播图组件" class="headerlink" title="轮播图组件"></a>轮播图组件</h3><blockquote><p>本项目需要用到一个轮播图组件awesome-swiper（这里使用3.1.3版本）</p></blockquote><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p> <code>npm install vue-awesome-swiper@3.1.3</code></p><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><blockquote><p>在 plugins 文件夹下新建文件 nuxt-swiper-plugin.js</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> VueAwesomeSwiper <span class="keyword">from</span> <span class="string">&#x27;vue-awesome-swiper/dist/ssr&#x27;</span></span><br><span class="line">Vue.use(VueAwesomeSwiper)</span><br></pre></td></tr></table></figure><blockquote><p>在 nuxt.config.js 文件中配置插件</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// some nuxt config...</span></span><br><span class="line">  <span class="comment">// awesome-swiper插件配置引入</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    &#123; <span class="attr">src</span>: <span class="string">&#x27;~/plugins/nuxt-swiper-plugin.js&#x27;</span>, <span class="attr">ssr</span>: <span class="literal">false</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">css</span>: [</span><br><span class="line">    <span class="string">&#x27;swiper/dist/css/swiper.css&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="axios依赖与封装"><a href="#axios依赖与封装" class="headerlink" title="axios依赖与封装"></a>axios依赖与封装</h3><blockquote><p>npm install axios</p></blockquote><blockquote><p>创建utils -&gt; request.js</p><p>注意这里的baseURL要与nginx对应</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="comment">// 创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> service = axios.create(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;http://localhost:9001&#x27;</span>, <span class="comment">// api的base_url</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">20000</span> <span class="comment">// 请求超时时间</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br></pre></td></tr></table></figure><h3 id="element-ui"><a href="#element-ui" class="headerlink" title="element-ui"></a>element-ui</h3><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><blockquote><p>npm install element-ui</p></blockquote><h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><blockquote><p>plugins -&gt; nuxt-swiper-plugin.js</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> VueAwesomeSwiper <span class="keyword">from</span> <span class="string">&#x27;vue-awesome-swiper/dist/ssr&#x27;</span></span><br><span class="line"><span class="keyword">import</span> VueQriously <span class="keyword">from</span> <span class="string">&#x27;vue-qriously&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ElementUI <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span> <span class="comment">//element-ui的全部组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span><span class="comment">//element-ui的css</span></span><br><span class="line">Vue.use(ElementUI) <span class="comment">//使用elementUI</span></span><br><span class="line">Vue.use(VueQriously)</span><br><span class="line">Vue.use(VueAwesomeSwiper)</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><blockquote><p>必看注意，直接启动的话eslint语法检查十分严格，类似于空格是2个就不能是4个，所以要把严格检查关闭</p><p><a href="http://t.zoukankan.com/IwishIcould-p-11879386.html">解决vue/cli3.0 语法验证规则 ESLint: Expected indentation of 2 spaces but found 4. (indent) - 走看看 (zoukankan.com)</a></p><p>仔细参考上述文章内容，注意两个步骤都要执行才行（弄了我十几分钟有点烦躁，好在解决了）</p></blockquote><h2 id="首页基础搭建"><a href="#首页基础搭建" class="headerlink" title="首页基础搭建"></a>首页基础搭建</h2><h3 id="讲师和课程视图模板搭建"><a href="#讲师和课程视图模板搭建" class="headerlink" title="讲师和课程视图模板搭建"></a>讲师和课程视图模板搭建</h3><h4 id="固定路由"><a href="#固定路由" class="headerlink" title="固定路由"></a>固定路由</h4><blockquote><p>注意default.js中设置了头导航的固定路由，所以需要在pages文件夹下创建对应的视图</p><p>注意其中的router-link（即路由导航），其中的to对应的地址就是视图的地址，值为文件夹的路径，to会自动找到pages文件夹下对应名字的文件夹中的index.vue</p><p>按照这个思路创建对应视图即可，然后复制资料中已经有的视图模板</p></blockquote><h4 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h4><blockquote><p>动态路由编写有一定的规范</p><p>例如需要根据id查询一条记录，需要在对应pages的文件夹下创建_id.vue文件，（必须是以下划线开头，参数名为下划线后面的文件名）</p></blockquote><h4 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h4><blockquote><p>根据上述条件创建即可，然后内容模板cv即可</p></blockquote><h4 id="当前项目结构"><a href="#当前项目结构" class="headerlink" title="当前项目结构"></a>当前项目结构</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210928194240441.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210928194240441.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210928194240441"></p><h3 id="后端环境搭建"><a href="#后端环境搭建" class="headerlink" title="后端环境搭建"></a>后端环境搭建</h3><h4 id="创建子模块"><a href="#创建子模块" class="headerlink" title="创建子模块"></a>创建子模块</h4><blockquote><p>service_cms</p></blockquote><h4 id="创建并编写配置文件application-properties"><a href="#创建并编写配置文件application-properties" class="headerlink" title="创建并编写配置文件application.properties"></a>创建并编写配置文件application.properties</h4><blockquote><p>注意这里的DataSource配置，如果不对可能会报springboot找不到bean的错误</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端口</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8004</span></span><br><span class="line"><span class="comment"># 服务名</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">service-cms</span></span><br><span class="line"><span class="comment"># mysql数据库连接</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">123456789</span></span><br><span class="line"><span class="comment">#返回json的全局时间格式</span></span><br><span class="line"><span class="meta">spring.jackson.date-format</span>=<span class="string">yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="meta">spring.jackson.time-zone</span>=<span class="string">GMT+8</span></span><br><span class="line"><span class="comment">#配置mapper xml文件的路径</span></span><br><span class="line"><span class="meta">mybatis-plus.mapper-locations</span>=<span class="string">classpath:com/atguigu/educms/mapper/xml/*.xml</span></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">192.168.44.132</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="meta">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="meta">spring.redis.timeout</span>=<span class="string">1800000</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-active</span>=<span class="string">20</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-wait</span>=<span class="string">-1</span></span><br><span class="line"><span class="comment">#最大阻塞等待时间(负数表示没限制)</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-idle</span>=<span class="string">5</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br><span class="line"><span class="comment">#mybatis日志</span></span><br><span class="line"><span class="meta">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="comment"># nacos服务地址</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.discovery.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br></pre></td></tr></table></figure><blockquote><p>这里记得去nginx.conf里配置一下</p></blockquote><h4 id="创建数据库表"><a href="#创建数据库表" class="headerlink" title="创建数据库表"></a>创建数据库表</h4><blockquote><p>导入资料的sql文件即可</p></blockquote><h4 id="编写启动类"><a href="#编写启动类" class="headerlink" title="编写启动类"></a>编写启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.atguigu&quot;&#125;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.educms.mapper&quot;)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span>  <span class="comment">// nacos注册</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CmsApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(CmsApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h4><blockquote><p>老样子改一下就行</p><p>生成之后跨域注释加一下、mapperscan加一下、配置文件中扫描mapper.xml路径加一下</p><p>一些实体类字段的注释也要加一下，比如说自动添加和逻辑删除</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.educms.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CmsApplication</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CrmBannerController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置mapper xml文件的路径</span></span><br><span class="line"><span class="meta">mybatis-plus.mapper-locations</span>=<span class="string">classpath:com/atguigu/educms/mapper/xml/*.xml</span></span><br></pre></td></tr></table></figure><h4 id="当前项目结构-1"><a href="#当前项目结构-1" class="headerlink" title="当前项目结构"></a>当前项目结构</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210928200432351.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210928200432351.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210928200432351"></p><h2 id="首页轮播图（后端）"><a href="#首页轮播图（后端）" class="headerlink" title="首页轮播图（后端）"></a>首页轮播图（后端）</h2><blockquote><p>后台应该也有轮播图的管理模块，所以需要两个bannerController</p></blockquote><h3 id="编写BannerAdminController"><a href="#编写BannerAdminController" class="headerlink" title="编写BannerAdminController"></a>编写BannerAdminController</h3><blockquote><p>用于后台的banner管理接口，TODO：前端页面自己写（我选择不写使用swagger测试嘿嘿😙）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/educms/banneradmin&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BannerAdminController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CrmBannerService bannerService;</span><br><span class="line">    <span class="comment">// 分页查询</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;pageBanner/&#123;pageNo&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">pageBanner</span><span class="params">(<span class="meta">@PathVariable</span> Long limit, <span class="meta">@PathVariable</span> Long pageNo)</span> </span>&#123;</span><br><span class="line">        Page&lt;CrmBanner&gt; pageBanner = <span class="keyword">new</span> Page&lt;&gt;(pageNo, limit);</span><br><span class="line">        bannerService.page(pageBanner, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;records&quot;</span>, pageBanner.getRecords()).data(<span class="string">&quot;total&quot;</span>, pageBanner.getTotal());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2 添加banner</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;addBanner&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">addBanner</span><span class="params">(<span class="meta">@RequestBody</span> CrmBanner crmBanner)</span> </span>&#123;</span><br><span class="line">        bannerService.save(crmBanner);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取Banner&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">get</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> </span>&#123;</span><br><span class="line">        CrmBanner banner = bannerService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;item&quot;</span>, banner);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改Banner&quot;)</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;update&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">updateById</span><span class="params">(<span class="meta">@RequestBody</span> CrmBanner banner)</span> </span>&#123;</span><br><span class="line">        bannerService.updateById(banner);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除Banner&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;remove/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">remove</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> </span>&#123;</span><br><span class="line">        bannerService.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="编写BannerFrontController"><a href="#编写BannerFrontController" class="headerlink" title="编写BannerFrontController"></a>编写BannerFrontController</h3><blockquote><p>用于前台的banner接口，主要用于显示banner</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/educms/bannerfront&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BannerFrontController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CrmBannerService bannerService;</span><br><span class="line">  <span class="comment">//查询banner信息</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getBannerList&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getBannerList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;CrmBanner&gt; list = bannerService.selectAllBanner();</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;list&quot;</span>, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="编写Service"><a href="#编写Service" class="headerlink" title="编写Service"></a>编写Service</h3><blockquote><p>这里自己写了个service，结果啥也没实现，纯属脱裤子放屁，我改了</p><p>我发现我错了，我应该看完整个视频才说话，这个是为了后面的Redis做准备的</p><p>写Mapper里最好（弹幕：感谢这段代码，昨天写了，今天老板让我走）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CrmBannerServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CrmBannerMapper</span>, <span class="title">CrmBanner</span>&gt; <span class="keyword">implements</span> <span class="title">CrmBannerService</span> </span>&#123;</span><br><span class="line"> <span class="comment">// 查询所有banner</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CrmBanner&gt; <span class="title">selectAllBanner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 根据id降序排序，显示排序后的前两条记录</span></span><br><span class="line">        QueryWrapper&lt;CrmBanner&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="comment">// 设置排序条件</span></span><br><span class="line">        wrapper.orderByDesc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置显示数量，last拼接sql语句</span></span><br><span class="line">        wrapper.last(<span class="string">&quot;limit 2&quot;</span>);</span><br><span class="line">        List&lt;CrmBanner&gt; crmBanners = baseMapper.selectList(wrapper);</span><br><span class="line">        <span class="keyword">return</span> crmBanners;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="首页热门课程和名师（后端）"><a href="#首页热门课程和名师（后端）" class="headerlink" title="首页热门课程和名师（后端）"></a>首页热门课程和名师（后端）</h2><blockquote><p>注意这里，controller这些又写到service_edu模块中了</p></blockquote><h3 id="编写Mapper"><a href="#编写Mapper" class="headerlink" title="编写Mapper"></a>编写Mapper</h3><blockquote><p>需求：根据id进行降序排序（或者根据表中专门的热度排序），显示排序之后的前8条数据</p></blockquote><h4 id="EduTeacherMapper"><a href="#EduTeacherMapper" class="headerlink" title="EduTeacherMapper"></a>EduTeacherMapper</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectIndexList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.eduservice.entity.EduTeacher&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from edu_teacher</span><br><span class="line">    order by id desc</span><br><span class="line">    limit 4</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="EduCourseMapper"><a href="#EduCourseMapper" class="headerlink" title="EduCourseMapper"></a>EduCourseMapper</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectIndexList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.eduservice.entity.EduCourse&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from edu_course</span><br><span class="line">    order by id desc</span><br><span class="line">    limit 8</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="编写service"><a href="#编写service" class="headerlink" title="编写service"></a>编写service</h3><blockquote><p>就直接调用baseMapper中的接口即可</p></blockquote><h3 id="编写controller"><a href="#编写controller" class="headerlink" title="编写controller"></a>编写controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/index&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduCourseService courseService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduTeacherService teacherService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询热门课程和讲师</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;index&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;EduCourse&gt; courseList = courseService.getIndexList();</span><br><span class="line">        List&lt;EduTeacher&gt; teacherList = teacherService.getIndexList();</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;courseList&quot;</span>, courseList).data(<span class="string">&quot;teacherList&quot;</span>, teacherList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="首页轮播图和热门讲师课程（前端）"><a href="#首页轮播图和热门讲师课程（前端）" class="headerlink" title="首页轮播图和热门讲师课程（前端）"></a>首页轮播图和热门讲师课程（前端）</h2><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><blockquote><ol><li>api -&gt; banner.js</li><li>api -&gt; index.js</li></ol></blockquote><h4 id="banner-js"><a href="#banner-js" class="headerlink" title="banner.js"></a>banner.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//查询前两条banner数据</span></span><br><span class="line">  <span class="function"><span class="title">getBannerList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/educms/bannerfront/getBannerList&#x27;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//查询热门课程和名师</span></span><br><span class="line">  <span class="function"><span class="title">getIndexList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/eduservice/index/getIndexList&#x27;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="调用接口"><a href="#调用接口" class="headerlink" title="调用接口"></a>调用接口</h3><blockquote><p>注意这里的response需要两个data，应为这个模板没有帮忙封装response的一些东西，之前的直接获得的是response.data</p></blockquote><h4 id="轮播图"><a href="#轮播图" class="headerlink" title="轮播图"></a>轮播图</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;!-- 幻灯片 开始 --&gt;</span><br><span class="line">        &lt;div v-swiper:mySwiper=&quot;swiperOption&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;swiper-wrapper&quot;&gt;</span><br><span class="line">                &lt;div</span><br><span class="line">                    v-for=&quot;banner in bannerList&quot;</span><br><span class="line">                    :key=&quot;banner.id&quot;</span><br><span class="line">                    class=&quot;swiper-slide&quot;</span><br><span class="line">                    style=&quot;background: #040b1b&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                    &lt;a target=&quot;_blank&quot; :href=&quot;banner.linkUrl&quot;&gt;</span><br><span class="line">                        &lt;img :src=&quot;banner.imageUrl&quot; :alt=&quot;banner.title&quot; /&gt;</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;swiper-pagination swiper-pagination-white&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div</span><br><span class="line">                class=&quot;swiper-button-prev swiper-button-white&quot;</span><br><span class="line">                slot=&quot;button-prev&quot;</span><br><span class="line">            &gt;&lt;/div&gt;</span><br><span class="line">            &lt;div</span><br><span class="line">                class=&quot;swiper-button-next swiper-button-white&quot;</span><br><span class="line">                slot=&quot;button-next&quot;</span><br><span class="line">            &gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 幻灯片 结束 --&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import bannerApi from &#x27;@/api/banner&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          swiperOption: &#123;</span><br><span class="line">            // 配置分页</span><br><span class="line">            pagination: &#123;</span><br><span class="line">              el: &#x27;.swiper-pagination&#x27; // 分页的dom节点</span><br><span class="line">            &#125;,</span><br><span class="line">            // 配置导航</span><br><span class="line">            navigation: &#123;</span><br><span class="line">              nextEl: &#x27;.swiper-button-next&#x27;, // 下一页dom节点</span><br><span class="line">              prevEl: &#x27;.swiper-button-prev&#x27; // 前一页dom节点</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          // 数组</span><br><span class="line">          bannerList: [],</span><br><span class="line">          courseList: [],</span><br><span class="line">          teacherList: []</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      created() &#123;</span><br><span class="line">        // 初始化数据</span><br><span class="line">        this.getBannerList()</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        // 初始化首页轮播图课程讲师列表</span><br><span class="line">        getBannerList() &#123;</span><br><span class="line">          bannerApi.getBannerList().then(result =&gt; &#123;</span><br><span class="line">            this.bannerList = result.data.data.list</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="热门课程讲师"><a href="#热门课程讲师" class="headerlink" title="热门课程讲师"></a>热门课程讲师</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;div id=&quot;aCoursesList&quot;&gt;</span><br><span class="line">            &lt;!-- 网校课程 开始 --&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">                    &lt;header class=&quot;comm-title&quot;&gt;</span><br><span class="line">                        &lt;h2 class=&quot;tac&quot;&gt;</span><br><span class="line">                            &lt;span class=&quot;c-333&quot;&gt;热门课程&lt;/span&gt;</span><br><span class="line">                        &lt;/h2&gt;</span><br><span class="line">                    &lt;/header&gt;</span><br><span class="line">                    &lt;div&gt;</span><br><span class="line">                        &lt;article class=&quot;comm-course-list&quot;&gt;</span><br><span class="line">                            &lt;ul class=&quot;of&quot; id=&quot;bna&quot;&gt;</span><br><span class="line">                                &lt;li</span><br><span class="line">                                    v-for=&quot;course in courseList&quot;</span><br><span class="line">                                    :key=&quot;course.id&quot;</span><br><span class="line">                                &gt;</span><br><span class="line">                                    &lt;div class=&quot;cc-l-wrap&quot;&gt;</span><br><span class="line">                                        &lt;section class=&quot;course-img&quot;&gt;</span><br><span class="line">                                            &lt;img</span><br><span class="line">                                                :src=&quot;course.cover&quot;</span><br><span class="line">                                                class=&quot;img-responsive&quot;</span><br><span class="line">                                                :alt=&quot;course.title&quot;</span><br><span class="line">                                            /&gt;</span><br><span class="line">                                            &lt;div class=&quot;cc-mask&quot;&gt;</span><br><span class="line">                                                &lt;a</span><br><span class="line">                                                    href=&quot;#&quot;</span><br><span class="line">                                                    title=&quot;开始学习&quot;</span><br><span class="line">                                                    class=&quot;comm-btn c-btn-1&quot;</span><br><span class="line">                                                    &gt;开始学习&lt;/a</span><br><span class="line">                                                &gt;</span><br><span class="line">                                            &lt;/div&gt;</span><br><span class="line">                                        &lt;/section&gt;</span><br><span class="line">                                        &lt;h3 class=&quot;hLh30 txtOf mt10&quot;&gt;</span><br><span class="line">                                            &lt;a</span><br><span class="line">                                                href=&quot;#&quot;</span><br><span class="line">                                                :title=&quot;course.title&quot;</span><br><span class="line">                                                class=&quot;</span><br><span class="line">                                                    course-title</span><br><span class="line">                                                    fsize18</span><br><span class="line">                                                    c-333</span><br><span class="line">                                                &quot;</span><br><span class="line">                                                &gt;&#123;&#123; course.title &#125;&#125;&lt;/a</span><br><span class="line">                                            &gt;</span><br><span class="line">                                        &lt;/h3&gt;</span><br><span class="line">                                        &lt;section class=&quot;mt10 hLh20 of&quot;&gt;</span><br><span class="line">                                            &lt;span</span><br><span class="line">                                                class=&quot;fr jgTag bg-green&quot;</span><br><span class="line">                                                v-if=&quot;</span><br><span class="line">                                                    Number(course.price) === 0</span><br><span class="line">                                                &quot;</span><br><span class="line">                                            &gt;</span><br><span class="line">                                                &lt;i class=&quot;c-fff fsize12 f-fA&quot;</span><br><span class="line">                                                    &gt;免费&lt;/i</span><br><span class="line">                                                &gt;</span><br><span class="line">                                            &lt;/span&gt;</span><br><span class="line">                                            &lt;span class=&quot;fl jgAttr c-ccc f-fA&quot;&gt;</span><br><span class="line">                                                &lt;i class=&quot;c-999 f-fA&quot;</span><br><span class="line">                                                    &gt;9634人学习&lt;/i</span><br><span class="line">                                                &gt;</span><br><span class="line">                                                |</span><br><span class="line">                                                &lt;i class=&quot;c-999 f-fA&quot;</span><br><span class="line">                                                    &gt;9634评论&lt;/i</span><br><span class="line">                                                &gt;</span><br><span class="line">                                            &lt;/span&gt;</span><br><span class="line">                                        &lt;/section&gt;</span><br><span class="line">                                    &lt;/div&gt;</span><br><span class="line">                                &lt;/li&gt;</span><br><span class="line">                            &lt;/ul&gt;</span><br><span class="line">                            &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">                        &lt;/article&gt;</span><br><span class="line">                        &lt;section class=&quot;tac pt20&quot;&gt;</span><br><span class="line">                            &lt;a</span><br><span class="line">                                href=&quot;#&quot;</span><br><span class="line">                                title=&quot;全部课程&quot;</span><br><span class="line">                                class=&quot;comm-btn c-btn-2&quot;</span><br><span class="line">                                &gt;全部课程&lt;/a</span><br><span class="line">                            &gt;</span><br><span class="line">                        &lt;/section&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/section&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;!-- /网校课程 结束 --&gt;</span><br><span class="line">            &lt;!-- 网校名师 开始 --&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">                    &lt;header class=&quot;comm-title&quot;&gt;</span><br><span class="line">                        &lt;h2 class=&quot;tac&quot;&gt;</span><br><span class="line">                            &lt;span class=&quot;c-333&quot;&gt;名师大咖&lt;/span&gt;</span><br><span class="line">                        &lt;/h2&gt;</span><br><span class="line">                    &lt;/header&gt;</span><br><span class="line">                    &lt;div&gt;</span><br><span class="line">                        &lt;article class=&quot;i-teacher-list&quot;&gt;</span><br><span class="line">                            &lt;ul class=&quot;of&quot;&gt;</span><br><span class="line">                                &lt;li</span><br><span class="line">                                    v-for=&quot;teacher in teacherList&quot;</span><br><span class="line">                                    :key=&quot;teacher.id&quot;</span><br><span class="line">                                &gt;</span><br><span class="line">                                    &lt;section class=&quot;i-teach-wrap&quot;&gt;</span><br><span class="line">                                        &lt;div class=&quot;i-teach-pic&quot;&gt;</span><br><span class="line">                                            &lt;a</span><br><span class="line">                                                href=&quot;/teacher/1&quot;</span><br><span class="line">                                                :title=&quot;teacher.name&quot;</span><br><span class="line">                                            &gt;</span><br><span class="line">                                                &lt;img</span><br><span class="line">                                                    :alt=&quot;teacher.name&quot;</span><br><span class="line">                                                    :src=&quot;teacher.avatar&quot;</span><br><span class="line">                                                /&gt;</span><br><span class="line">                                            &lt;/a&gt;</span><br><span class="line">                                        &lt;/div&gt;</span><br><span class="line">                                        &lt;div class=&quot;mt10 hLh30 txtOf tac&quot;&gt;</span><br><span class="line">                                            &lt;a</span><br><span class="line">                                                href=&quot;/teacher/1&quot;</span><br><span class="line">                                                :title=&quot;teacher.name&quot;</span><br><span class="line">                                                class=&quot;fsize18 c-666&quot;</span><br><span class="line">                                                &gt;&#123;&#123; teacher.name &#125;&#125;&lt;/a</span><br><span class="line">                                            &gt;</span><br><span class="line">                                        &lt;/div&gt;</span><br><span class="line">                                        &lt;div class=&quot;hLh30 txtOf tac&quot;&gt;</span><br><span class="line">                                            &lt;span class=&quot;fsize14 c-999&quot;&gt;&#123;&#123;</span><br><span class="line">                                                teacher.career</span><br><span class="line">                                            &#125;&#125;&lt;/span&gt;</span><br><span class="line">                                        &lt;/div&gt;</span><br><span class="line">                                        &lt;div class=&quot;mt15 i-q-txt&quot;&gt;</span><br><span class="line">                                            &lt;p class=&quot;c-999 f-fA&quot;&gt;</span><br><span class="line">                                                &#123;&#123; teacher.intro &#125;&#125;</span><br><span class="line">                                            &lt;/p&gt;</span><br><span class="line">                                        &lt;/div&gt;</span><br><span class="line">                                    &lt;/section&gt;</span><br><span class="line">                                &lt;/li&gt;</span><br><span class="line">                            &lt;/ul&gt;</span><br><span class="line">                            &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">                        &lt;/article&gt;</span><br><span class="line">                        &lt;section class=&quot;tac pt20&quot;&gt;</span><br><span class="line">                            &lt;a</span><br><span class="line">                                href=&quot;#&quot;</span><br><span class="line">                                title=&quot;全部讲师&quot;</span><br><span class="line">                                class=&quot;comm-btn c-btn-2&quot;</span><br><span class="line">                                &gt;全部讲师&lt;/a</span><br><span class="line">                            &gt;</span><br><span class="line">                        &lt;/section&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/section&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;!-- /网校名师 结束 --&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import bannerApi from &#x27;@/api/banner&#x27;</span><br><span class="line">    import indexApi from &#x27;@/api/index&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          swiperOption: &#123;</span><br><span class="line">            // 配置分页</span><br><span class="line">            pagination: &#123;</span><br><span class="line">              el: &#x27;.swiper-pagination&#x27; // 分页的dom节点</span><br><span class="line">            &#125;,</span><br><span class="line">            // 配置导航</span><br><span class="line">            navigation: &#123;</span><br><span class="line">              nextEl: &#x27;.swiper-button-next&#x27;, // 下一页dom节点</span><br><span class="line">              prevEl: &#x27;.swiper-button-prev&#x27; // 前一页dom节点</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          // 数组</span><br><span class="line">          bannerList: [],</span><br><span class="line">          courseList: [],</span><br><span class="line">          teacherList: []</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      created() &#123;</span><br><span class="line">        // 初始化数据</span><br><span class="line">        this.getBannerList()</span><br><span class="line">        this.getCourseTeacher()</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        // 初始化首页课程讲师列表</span><br><span class="line">        getCourseTeacher() &#123;</span><br><span class="line">          indexApi.getIndexList().then(result =&gt; &#123;</span><br><span class="line">            this.courseList = result.data.data.courseList</span><br><span class="line">            this.teacherList = result.data.data.teacherList</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><blockquote><p>这里我没有把url对应起来，所以报了<code>Access to XMLHttpRequest at &#39;http://localhost:9001/educms/bannerfront/getBannerList&#39; from origin &#39;http://localhost:3000&#39; has been blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource.</code>的错误</p><p>这个错误还有可能是nginx没有配置，或者跨域注解没有加</p></blockquote><h2 id="单点登录SSO"><a href="#单点登录SSO" class="headerlink" title="单点登录SSO"></a>单点登录SSO</h2><p>![02 单点登录三种方式介绍](<a href="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/02">https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/02</a> 单点登录三种方式介绍.png)</p><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210929131659223.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210929131659223.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210929131659223"></p><h3 id="整合"><a href="#整合" class="headerlink" title="整合"></a>整合</h3><blockquote><p>该项目在common模块中配置</p></blockquote><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- redis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- spring2.X集成redis所需common-pool2--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="创建配置类"><a href="#创建配置类" class="headerlink" title="创建配置类"></a>创建配置类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">// 配置类</span></span><br><span class="line"><span class="meta">@EnableCaching</span>  <span class="comment">// 开启cashe缓存</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> <span class="keyword">extends</span> <span class="title">CachingConfigurerSupport</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">        <span class="comment">//key序列化方式</span></span><br><span class="line">        template.setKeySerializer(redisSerializer);</span><br><span class="line">        <span class="comment">//value序列化</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">//value hashmap序列化</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(RedisConnectionFactory factory)</span> </span>&#123;</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        <span class="comment">//解决查询缓存转换异常的问题</span></span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        <span class="comment">// 配置序列化（解决乱码的问题）,过期时间600秒</span></span><br><span class="line">        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofSeconds(<span class="number">600</span>))</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line">        RedisCacheManager cacheManager = RedisCacheManager.builder(factory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="springboot缓存注解"><a href="#springboot缓存注解" class="headerlink" title="springboot缓存注解"></a>springboot缓存注解</h4><blockquote><p>在相对应接口中添加Redis缓存使用注解即可使用Redis缓存</p><ol><li>@Cacheable：一般用在查询方法上，根据方法对其返回结果进行缓存，下次请求时如果缓存存在，name直接读取缓存数据返回</li><li>@CachePut：一般用在新增方法上，使用该注解的方法每次都会执行，并将结果存入指定的缓存中</li><li>@CacheEvict：一般用在更新或者删除方法上，会清空指定的缓存</li></ol></blockquote><h3 id="使用Redis服务"><a href="#使用Redis服务" class="headerlink" title="使用Redis服务"></a>使用Redis服务</h3><h4 id="安装Redis并启动"><a href="#安装Redis并启动" class="headerlink" title="安装Redis并启动"></a>安装Redis并启动</h4><blockquote><p>这里我去谷粒商城看了</p></blockquote><h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><blockquote><p>在需要使用redis的模块的配置文件application.properties中添加配置</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#redis配置</span></span><br><span class="line"><span class="comment">#注意这里的host和port要和虚拟机的对应</span></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">192.168.128.129</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="meta">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="meta">spring.redis.timeout</span>=<span class="string">1800000</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-active</span>=<span class="string">20</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-wait</span>=<span class="string">-1</span></span><br></pre></td></tr></table></figure><h4 id="首页缓存"><a href="#首页缓存" class="headerlink" title="首页缓存"></a>首页缓存</h4><blockquote><p>在相关的service方法上添加注释（注意这里为什么要在service中加，因为注释自动添加到redis的话，是从返回值获取的，controller中定义了统一返回格式，不适用）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CrmBannerServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CrmBannerMapper</span>, <span class="title">CrmBanner</span>&gt; <span class="keyword">implements</span> <span class="title">CrmBannerService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查询所有banner</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Cacheable(key = &quot;&#x27;selectIndexList&#x27;&quot;, value = &quot;banner&quot;)</span><span class="comment">// Redis缓存,注意这里key中要加单引号</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CrmBanner&gt; <span class="title">selectAllBanner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="redis相关命令"><a href="#redis相关命令" class="headerlink" title="redis相关命令"></a>redis相关命令</h4><blockquote><ol><li>使用root权限：su root</li><li>查看VMwarehost：ifconfig</li><li>修改配置文件：vi /mydata/redis/conf/redis.conf</li><li>启动redis：docker start redis</li><li>进入redis：docker exec -it redis redis-cli</li><li>查看所有keyvalue：keys *</li><li>设置查看：set/get xxx</li></ol></blockquote><h2 id="JWT-Json-Web-Token"><a href="#JWT-Json-Web-Token" class="headerlink" title="JWT(Json Web Token)"></a>JWT(Json Web Token)</h2><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210929144700746.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210929144700746.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210929144700746"></p><h4 id="依赖-1"><a href="#依赖-1" class="headerlink" title="依赖"></a>依赖</h4><blockquote><p>先引入依赖，common_utils模块即可 </p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- JWT--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="utils类"><a href="#utils类" class="headerlink" title="utils类"></a>utils类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jws;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jwts;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> EXPIRE = <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APP_SECRET = <span class="string">&quot;ukc8BDbRigUDaY6pZFfWus2jZWLPHO&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJwtToken</span><span class="params">(String id, String nickname)</span> </span>&#123;</span><br><span class="line">        String JwtToken = Jwts.builder()</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;typ&quot;</span>, <span class="string">&quot;JWT&quot;</span>)</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;alg&quot;</span>, <span class="string">&quot;HS256&quot;</span>)</span><br><span class="line">                .setSubject(<span class="string">&quot;guli-user&quot;</span>)</span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> Date())</span><br><span class="line">                .setExpiration(<span class="keyword">new</span> Date(System.currentTimeMillis() + EXPIRE))</span><br><span class="line">                .claim(<span class="string">&quot;id&quot;</span>, id)</span><br><span class="line">                .claim(<span class="string">&quot;nickname&quot;</span>, nickname)</span><br><span class="line">                .signWith(SignatureAlgorithm.HS256, APP_SECRET)</span><br><span class="line">                .compact();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JwtToken;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断token是否存在与有效</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwtToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkToken</span><span class="params">(String jwtToken)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断token是否存在与有效</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkToken</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String jwtToken = request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据token获取会员id</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getMemberIdByJwtToken</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        String jwtToken = request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        Jws&lt;Claims&gt; claimsJws = Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        Claims claims = claimsJws.getBody();</span><br><span class="line">        <span class="keyword">return</span> (String) claims.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="短信微服务"><a href="#短信微服务" class="headerlink" title="短信微服务"></a>短信微服务</h2><h4 id="阿里云短信服务"><a href="#阿里云短信服务" class="headerlink" title="阿里云短信服务"></a>阿里云短信服务</h4><blockquote><p>开启之后，申请签名管理和模板管理</p><p>？？？必须要备案网站好家伙mua的</p><p>TODO，没有域名下次再说吧</p></blockquote><h4 id="创建子模块-1"><a href="#创建子模块-1" class="headerlink" title="创建子模块"></a>创建子模块</h4><blockquote><p>service_msm模块</p></blockquote><h4 id="配置文件application-properties"><a href="#配置文件application-properties" class="headerlink" title="配置文件application.properties"></a>配置文件application.properties</h4><blockquote><p>基本上都是一样的写法</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端口</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8005</span></span><br><span class="line"><span class="comment"># 服务名</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">service-msm</span></span><br><span class="line"><span class="comment"># mysql数据库连接</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">123456789</span></span><br><span class="line"><span class="comment">#redis配置</span></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">192.168.128.129</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="meta">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="meta">spring.redis.timeout</span>=<span class="string">1800000</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-active</span>=<span class="string">20</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-wait</span>=<span class="string">-1</span></span><br><span class="line"><span class="comment">#最大阻塞等待时间(负数表示没限制)</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-idle</span>=<span class="string">5</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br><span class="line"><span class="comment">#最小空闲</span></span><br><span class="line"><span class="comment">#返回json的全局时间格式</span></span><br><span class="line"><span class="meta">spring.jackson.date-format</span>=<span class="string">yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="meta">spring.jackson.time-zone</span>=<span class="string">GMT+8</span></span><br><span class="line"><span class="comment">#mybatis日志</span></span><br><span class="line"><span class="meta">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="comment"># nacos服务地址</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.discovery.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br><span class="line"><span class="comment">#配置mapper xml文件的路径</span></span><br><span class="line"><span class="meta">mybatis-plus.mapper-locations</span>=<span class="string">classpath:com/atguigu/educms/mapper/xml/*.xml</span></span><br></pre></td></tr></table></figure><h4 id="启动类"><a href="#启动类" class="headerlink" title="启动类"></a>启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.atguigu&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MsmApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MsmApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><blockquote><p>TODO</p></blockquote><h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><blockquote><p>TODO</p></blockquote><h2 id="登录注册（后端）"><a href="#登录注册（后端）" class="headerlink" title="登录注册（后端）"></a>登录注册（后端）</h2><h3 id="基础工作"><a href="#基础工作" class="headerlink" title="基础工作"></a>基础工作</h3><h4 id="创建模块"><a href="#创建模块" class="headerlink" title="创建模块"></a>创建模块</h4><blockquote><p>service_ucenter</p></blockquote><h4 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h4><blockquote><p>ucenter_member</p></blockquote><h4 id="代码生成器-1"><a href="#代码生成器-1" class="headerlink" title="代码生成器"></a>代码生成器</h4><blockquote><p>老样子</p></blockquote><h4 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h4><blockquote><p>老样子</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端口</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8006</span></span><br><span class="line"><span class="comment"># 服务名</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">service-ucenter</span></span><br><span class="line"><span class="comment"># mysql数据库连接</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">123456789</span></span><br><span class="line"><span class="comment">#redis配置</span></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">192.168.128.129</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="meta">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="meta">spring.redis.timeout</span>=<span class="string">1800000</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-active</span>=<span class="string">20</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-wait</span>=<span class="string">-1</span></span><br><span class="line"><span class="comment">#最大阻塞等待时间(负数表示没限制)</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-idle</span>=<span class="string">5</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.min-idle</span>=<span class="string">0</span></span><br><span class="line"><span class="comment">#最小空闲</span></span><br><span class="line"><span class="comment">#返回json的全局时间格式</span></span><br><span class="line"><span class="meta">spring.jackson.date-format</span>=<span class="string">yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="meta">spring.jackson.time-zone</span>=<span class="string">GMT+8</span></span><br><span class="line"><span class="comment">#mybatis日志</span></span><br><span class="line"><span class="meta">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="comment"># nacos服务地址</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.discovery.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br><span class="line"><span class="comment">#配置mapper xml文件的路径</span></span><br><span class="line"><span class="meta">mybatis-plus.mapper-locations</span>=<span class="string">classpath:com/atguigu/educenter/mapper/xml/*.xml</span></span><br></pre></td></tr></table></figure><h4 id="启动类-1"><a href="#启动类-1" class="headerlink" title="启动类"></a>启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.atguigu&quot;&#125;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.educenter.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UcenterApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(UcenterApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>还有nginx配置，跨域配置等</p></blockquote><h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><h4 id="MD5Utils"><a href="#MD5Utils" class="headerlink" title="MD5Utils"></a>MD5Utils</h4><blockquote><p>加密工具</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.educenter.utils;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MD5</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encrypt</span><span class="params">(String strSrc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">char</span> hexChars[] = &#123; <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span> &#125;;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = strSrc.getBytes();</span><br><span class="line">            MessageDigest md = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">            md.update(bytes);</span><br><span class="line">            bytes = md.digest();</span><br><span class="line">            <span class="keyword">int</span> j = bytes.length;</span><br><span class="line">            <span class="keyword">char</span>[] chars = <span class="keyword">new</span> <span class="keyword">char</span>[j * <span class="number">2</span>];</span><br><span class="line">            <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bytes.length; i++) &#123;</span><br><span class="line">                <span class="keyword">byte</span> b = bytes[i];</span><br><span class="line">                chars[k++] = hexChars[b &gt;&gt;&gt; <span class="number">4</span> &amp; <span class="number">0xf</span>];</span><br><span class="line">                chars[k++] = hexChars[b &amp; <span class="number">0xf</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(chars);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;MD5加密出错！！+&quot;</span> + e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(MD5.encrypt(<span class="string">&quot;111111&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-1"><a href="#controller-1" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/educenter/member&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UcenterMemberController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UcenterMemberService memberService;</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">loginUser</span><span class="params">(<span class="meta">@RequestBody</span> UcenterMember member)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 调用service方法,并且返回token</span></span><br><span class="line">        String token = memberService.login(member);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service-1"><a href="#service-1" class="headerlink" title="service"></a>service</h4><blockquote><p>注意使用MD5工具加密再比较密码</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UcenterMemberServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">UcenterMemberMapper</span>, <span class="title">UcenterMember</span>&gt; <span class="keyword">implements</span> <span class="title">UcenterMemberService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(UcenterMember member)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获得手机号和密码</span></span><br><span class="line">        String mobile = member.getMobile();</span><br><span class="line">        String password = member.getPassword();</span><br><span class="line">        <span class="comment">// 非空判断</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(mobile) || StringUtils.isEmpty(password)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;手机或密码为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 查询数据库</span></span><br><span class="line">        QueryWrapper&lt;UcenterMember&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;mobile&quot;</span>, mobile);</span><br><span class="line">        UcenterMember mmember = baseMapper.selectOne(wrapper);</span><br><span class="line">        <span class="keyword">if</span> (mmember == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;该账号不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断密码是否正确</span></span><br><span class="line">        <span class="comment">// 数据库密码为加密后的密码，所以需要转换</span></span><br><span class="line">        <span class="comment">// 使用加密方式MD5（只能加密）</span></span><br><span class="line">        <span class="keyword">if</span> (!mmember.getPassword().equals(MD5.encrypt(password))) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断是否禁用</span></span><br><span class="line">        <span class="keyword">if</span> (mmember.getIsDisabled()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;账号禁用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 生成token字符串</span></span><br><span class="line">        String token = JwtUtils.getJwtToken(mmember.getId(), mmember.getNickname());</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="swagger测试"><a href="#swagger测试" class="headerlink" title="swagger测试"></a>swagger测试</h4><blockquote><p>初始值随便复制一个mobile，密码统一为111111</p></blockquote><h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><h4 id="vo实体类"><a href="#vo实体类" class="headerlink" title="vo实体类"></a>vo实体类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisterVo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;昵称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;手机号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;密码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">//@ApiModelProperty(value = &quot;验证码&quot;)</span></span><br><span class="line">    <span class="comment">//private String code;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="controller-2"><a href="#controller-2" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;register&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">registerUser</span><span class="params">(<span class="meta">@RequestBody</span> RegisterVo registerVo)</span> </span>&#123;</span><br><span class="line">    memberService.register(registerVo);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service-2"><a href="#service-2" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(RegisterVo registerVo)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// TODO 验证码判断（暂时不写）</span></span><br><span class="line">    <span class="comment">//获取注册的数据</span></span><br><span class="line">    String mobile = registerVo.getMobile(); <span class="comment">//手机号</span></span><br><span class="line">    String nickname = registerVo.getNickname(); <span class="comment">//昵称</span></span><br><span class="line">    String password = registerVo.getPassword(); <span class="comment">//密码</span></span><br><span class="line">    <span class="comment">//非空判断</span></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isEmpty(mobile) || StringUtils.isEmpty(password) || StringUtils.isEmpty(nickname)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;输入为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断手机号是否重复，表里面存在相同手机号不进行添加</span></span><br><span class="line">    QueryWrapper&lt;UcenterMember&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;mobile&quot;</span>, mobile);</span><br><span class="line">    Integer count = baseMapper.selectCount(wrapper);</span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;手机号重复&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//数据添加数据库中</span></span><br><span class="line">    UcenterMember member = <span class="keyword">new</span> UcenterMember();</span><br><span class="line">    member.setMobile(mobile);</span><br><span class="line">    member.setNickname(nickname);</span><br><span class="line">    member.setPassword(MD5.encrypt(password));<span class="comment">//密码需要加密的</span></span><br><span class="line">    member.setIsDisabled(<span class="keyword">false</span>);<span class="comment">//用户不禁用</span></span><br><span class="line">  member.setAvatar(<span class="string">&quot;http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoj0hHXhgJNOTSOFsS4uZs8x1ConecaVOB8eIl115xmJZcT4oCicvia7wMEufibKtTLqiaJeanU2Lpg3w/132&quot;</span>);</span><br><span class="line">    baseMapper.insert(member);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="回显数据"><a href="#回显数据" class="headerlink" title="回显数据"></a>回显数据</h3><blockquote><p>根据token获得用户信息</p></blockquote><h4 id="controller-3"><a href="#controller-3" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据token获取用户信息</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getMemberInfo&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getMemberInfo</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 调用jwt工具类方法获取request对象的头信息，获得id</span></span><br><span class="line">    String memberId = JwtUtils.getMemberIdByJwtToken(request);</span><br><span class="line">    <span class="comment">// 获得用户信息</span></span><br><span class="line">    UcenterMember member = memberService.getById(memberId);</span><br><span class="line">    <span class="comment">// 这里最好额外使用vo实体类</span></span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;member&quot;</span>, member);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="登录注册（前端）"><a href="#登录注册（前端）" class="headerlink" title="登录注册（前端）"></a>登录注册（前端）</h2><h3 id="注册-1"><a href="#注册-1" class="headerlink" title="注册"></a>注册</h3><h4 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h4><blockquote><p>创建sign.vue然后cv</p><p>这个是专门的注册登录页面的布局</p></blockquote><h4 id="api"><a href="#api" class="headerlink" title="api"></a>api</h4><blockquote><p>api中创建对应js即可</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 注册</span></span><br><span class="line">  <span class="function"><span class="title">register</span>(<span class="params">registerVo</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/educenter/member/register&#x27;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: registerVo</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="vue页面"><a href="#vue页面" class="headerlink" title="vue页面"></a>vue页面</h4><blockquote><p>先去layout -&gt; default.vue中的地址该为登录注册页面的地址</p><p>然后在pages里创建vue视图</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;main&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;title&quot;&gt;</span><br><span class="line">      &lt;a href=&quot;/login&quot;&gt;登录&lt;/a&gt;</span><br><span class="line">      &lt;span&gt;·&lt;/span&gt;</span><br><span class="line">      &lt;a class=&quot;active&quot; href=&quot;/register&quot;&gt;注册&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;sign-up-container&quot;&gt;</span><br><span class="line">      &lt;el-form ref=&quot;userForm&quot; :model=&quot;params&quot;&gt;</span><br><span class="line">        &lt;el-form-item</span><br><span class="line">          class=&quot;input-prepend restyle&quot;</span><br><span class="line">          prop=&quot;nickname&quot;</span><br><span class="line">          :rules=&quot;[</span><br><span class="line">            &#123; required: true, message: &#x27;请输入你的昵称&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">          ]&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;el-input</span><br><span class="line">              type=&quot;text&quot;</span><br><span class="line">              placeholder=&quot;你的昵称&quot;</span><br><span class="line">              v-model=&quot;params.nickname&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;i class=&quot;iconfont icon-user&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item</span><br><span class="line">          class=&quot;input-prepend restyle no-radius&quot;</span><br><span class="line">          prop=&quot;mobile&quot;</span><br><span class="line">          :rules=&quot;[</span><br><span class="line">            &#123; required: true, message: &#x27;请输入手机号码&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">            &#123; validator: checkPhone, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">          ]&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;el-input</span><br><span class="line">              type=&quot;text&quot;</span><br><span class="line">              placeholder=&quot;手机号&quot;</span><br><span class="line">              v-model=&quot;params.mobile&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;i class=&quot;iconfont icon-phone&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item</span><br><span class="line">          class=&quot;input-prepend restyle no-radius&quot;</span><br><span class="line">          prop=&quot;code&quot;</span><br><span class="line">          :rules=&quot;[</span><br><span class="line">            &#123; required: true, message: &#x27;请输入验证码&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">          ]&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;div</span><br><span class="line">            style=&quot;width: 100%; display: block; float: left; position: relative&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;el-input type=&quot;text&quot; placeholder=&quot;验证码&quot; v-model=&quot;params.code&quot; /&gt;</span><br><span class="line">            &lt;i class=&quot;iconfont icon-phone&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div</span><br><span class="line">            class=&quot;btn&quot;</span><br><span class="line">            style=&quot;position: absolute; right: 0; top: 6px; width: 40%&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              href=&quot;javascript:&quot;</span><br><span class="line">              type=&quot;button&quot;</span><br><span class="line">              @click=&quot;getCodeFun()&quot;</span><br><span class="line">              :value=&quot;codeTest&quot;</span><br><span class="line">              style=&quot;border: none; background-color: none&quot;</span><br><span class="line">              &gt;&#123;&#123; codeTest &#125;&#125;&lt;/a</span><br><span class="line">            &gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item</span><br><span class="line">          class=&quot;input-prepend&quot;</span><br><span class="line">          prop=&quot;password&quot;</span><br><span class="line">          :rules=&quot;[&#123; required: true, message: &#x27;请输入密码&#x27;, trigger: &#x27;blur&#x27; &#125;]&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;el-input</span><br><span class="line">              type=&quot;password&quot;</span><br><span class="line">              placeholder=&quot;设置密码&quot;</span><br><span class="line">              v-model=&quot;params.password&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;i class=&quot;iconfont icon-password&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;btn&quot;&gt;</span><br><span class="line">          &lt;input</span><br><span class="line">            type=&quot;button&quot;</span><br><span class="line">            class=&quot;sign-up-button&quot;</span><br><span class="line">            value=&quot;注册&quot;</span><br><span class="line">            @click=&quot;submitRegister()&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;p class=&quot;sign-up-msg&quot;&gt;</span><br><span class="line">          点击 “注册” 即表示您同意并愿意遵守简书</span><br><span class="line">          &lt;br /&gt;</span><br><span class="line">          &lt;a target=&quot;_blank&quot; href=&quot;http://www.jianshu.com/p/c44d171298ce&quot;</span><br><span class="line">            &gt;用户协议&lt;/a</span><br><span class="line">          &gt;</span><br><span class="line">          和</span><br><span class="line">          &lt;a target=&quot;_blank&quot; href=&quot;http://www.jianshu.com/p/2ov8x3&quot;&gt;隐私政策&lt;/a&gt;</span><br><span class="line">          。</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;!-- 更多注册方式 --&gt;</span><br><span class="line">      &lt;div class=&quot;more-sign&quot;&gt;</span><br><span class="line">        &lt;h6&gt;社交帐号直接注册&lt;/h6&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">          &lt;li&gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              id=&quot;weixin&quot;</span><br><span class="line">              class=&quot;weixin&quot;</span><br><span class="line">              target=&quot;_blank&quot;</span><br><span class="line">              href=&quot;http://huaan.free.idcfengye.com/api/ucenter/wx/login&quot;</span><br><span class="line">              &gt;&lt;i class=&quot;iconfont icon-weixin&quot;</span><br><span class="line">            /&gt;&lt;/a&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">          &lt;li&gt;</span><br><span class="line">            &lt;a id=&quot;qq&quot; class=&quot;qq&quot; target=&quot;_blank&quot; href=&quot;#&quot;</span><br><span class="line">              &gt;&lt;i class=&quot;iconfont icon-qq&quot;</span><br><span class="line">            /&gt;&lt;/a&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import &#x27;~/assets/css/sign.css&#x27;</span><br><span class="line">  import &#x27;~/assets/css/iconfont.css&#x27;</span><br><span class="line">  export default &#123;</span><br><span class="line">    layout: &#x27;sign&#x27;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        params: &#123;</span><br><span class="line">          // 封装注册输入数据</span><br><span class="line">          mobile: &#x27;&#x27;,</span><br><span class="line">          code: &#x27;&#x27;, // 验证码</span><br><span class="line">          nickname: &#x27;&#x27;,</span><br><span class="line">          password: &#x27;&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        sending: true, // 是否发送验证码</span><br><span class="line">        second: 60, // 倒计时间</span><br><span class="line">        codeTest: &#x27;获取验证码&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="vue方法"><a href="#vue方法" class="headerlink" title="vue方法"></a>vue方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册提交</span></span><br><span class="line"><span class="function"><span class="title">submitRegister</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  registerApi.register(<span class="built_in">this</span>.params).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 提示注册成功</span></span><br><span class="line">    <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;注册成功&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 跳转登录页面</span></span><br><span class="line">    <span class="built_in">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 发送验证码</span></span><br><span class="line"><span class="function"><span class="title">getCodeFun</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> ((<span class="built_in">this</span>.sending = <span class="literal">false</span>)) &#123;</span><br><span class="line">    <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;请勿频繁点击&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 由于阿里云短信服务不能用，所以这里写假验证</span></span><br><span class="line">  <span class="built_in">this</span>.sending = <span class="literal">false</span></span><br><span class="line">  <span class="comment">// 调用倒计时的方法</span></span><br><span class="line">  <span class="built_in">this</span>.timeDown()</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 验证手机号格式</span></span><br><span class="line"><span class="function"><span class="title">checkPhone</span>(<span class="params">rule, value, callback</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// debugger</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/^1[34578]\d&#123;9&#125;$/</span>.test(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;手机号码格式不正确&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> callback()</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 倒计时</span></span><br><span class="line"><span class="function"><span class="title">timeDown</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    --<span class="built_in">this</span>.second</span><br><span class="line">    <span class="built_in">this</span>.codeTest = <span class="built_in">this</span>.second</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.second &lt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(result)</span><br><span class="line">      <span class="built_in">this</span>.sending = <span class="literal">true</span></span><br><span class="line">      <span class="built_in">this</span>.second = <span class="number">60</span></span><br><span class="line">      <span class="built_in">this</span>.codeTest = <span class="string">&#x27;获取验证码&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>TODO：这里有很多地方需要完善：比如点击验证码之后再次点击数字需要弹窗警告，但是现在不会而且还会加速计时器</p></blockquote><h3 id="登录-1"><a href="#登录-1" class="headerlink" title="登录"></a>登录</h3><h4 id="cookie插件"><a href="#cookie插件" class="headerlink" title="cookie插件"></a>cookie插件</h4><blockquote><p>这里需要用到cookie，需要下载</p><p>npm install js-cookie</p></blockquote><h4 id="api-1"><a href="#api-1" class="headerlink" title="api"></a>api</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 登录</span></span><br><span class="line">  <span class="function"><span class="title">login</span>(<span class="params">member</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/educenter/member/login&#x27;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: member</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 根据token获取用户信息</span></span><br><span class="line">  <span class="function"><span class="title">getLoginMemberInfo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/educenter/member/getMemberInfo&#x27;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="vue视图"><a href="#vue视图" class="headerlink" title="vue视图"></a>vue视图</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;main&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;title&quot;&gt;</span><br><span class="line">      &lt;a class=&quot;active&quot; href=&quot;/login&quot;&gt;登录&lt;/a&gt;</span><br><span class="line">      &lt;span&gt;·&lt;/span&gt;</span><br><span class="line">      &lt;a href=&quot;/register&quot;&gt;注册&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;sign-up-container&quot;&gt;</span><br><span class="line">      &lt;el-form ref=&quot;userForm&quot; :model=&quot;user&quot;&gt;</span><br><span class="line">        &lt;el-form-item</span><br><span class="line">          class=&quot;input-prepend restyle&quot;</span><br><span class="line">          prop=&quot;mobile&quot;</span><br><span class="line">          :rules=&quot;[</span><br><span class="line">            &#123; required: true, message: &#x27;请输入手机号码&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">            &#123; validator: checkPhone, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">          ]&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;el-input type=&quot;text&quot; placeholder=&quot;手机号&quot; v-model=&quot;user.mobile&quot; /&gt;</span><br><span class="line">            &lt;i class=&quot;iconfont icon-phone&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form-item</span><br><span class="line">          class=&quot;input-prepend&quot;</span><br><span class="line">          prop=&quot;password&quot;</span><br><span class="line">          :rules=&quot;[&#123; required: true, message: &#x27;请输入密码&#x27;, trigger: &#x27;blur&#x27; &#125;]&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;el-input</span><br><span class="line">              type=&quot;password&quot;</span><br><span class="line">              placeholder=&quot;密码&quot;</span><br><span class="line">              v-model=&quot;user.password&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;i class=&quot;iconfont icon-password&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;btn&quot;&gt;</span><br><span class="line">          &lt;input</span><br><span class="line">            type=&quot;button&quot;</span><br><span class="line">            class=&quot;sign-in-button&quot;</span><br><span class="line">            value=&quot;登录&quot;</span><br><span class="line">            @click=&quot;submitLogin()&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;!-- 更多登录方式 --&gt;</span><br><span class="line">      &lt;div class=&quot;more-sign&quot;&gt;</span><br><span class="line">        &lt;h6&gt;社交帐号登录&lt;/h6&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">          &lt;li&gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              id=&quot;weixin&quot;</span><br><span class="line">              class=&quot;weixin&quot;</span><br><span class="line">              target=&quot;_blank&quot;</span><br><span class="line">              href=&quot;http://qy.free.idcfengye.com/api/ucenter/weixinLogin/login&quot;</span><br><span class="line">              &gt;&lt;i class=&quot;iconfont icon-weixin&quot;</span><br><span class="line">            /&gt;&lt;/a&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">          &lt;li&gt;</span><br><span class="line">            &lt;a id=&quot;qq&quot; class=&quot;qq&quot; target=&quot;_blank&quot; href=&quot;#&quot;</span><br><span class="line">              &gt;&lt;i class=&quot;iconfont icon-qq&quot;</span><br><span class="line">            /&gt;&lt;/a&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import &#x27;~/assets/css/sign.css&#x27;</span><br><span class="line">  import &#x27;~/assets/css/iconfont.css&#x27;</span><br><span class="line">  export default &#123;</span><br><span class="line">    layout: &#x27;sign&#x27;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        user: &#123;</span><br><span class="line">          mobile: &#x27;&#x27;,</span><br><span class="line">          password: &#x27;&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        loginInfo: &#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  .el-form-item__error &#123;</span><br><span class="line">    z-index: 9999999;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h4 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h4><blockquote><p>在下面的方法中有说明登录token的步骤，其中需要用到拦截器</p><p>拦截器写在utils文件夹下的request.js文件中</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cookie <span class="keyword">from</span> <span class="string">&#x27;js-cookie&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 每次请求中使用拦截器</span></span><br><span class="line">service.interceptors.request.use(</span><br><span class="line">  <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cookie.get(<span class="string">&#x27;guli_token&#x27;</span>)) &#123;</span><br><span class="line">      <span class="comment">// 从cookie中获得token并且放入header中</span></span><br><span class="line">      config.headers[<span class="string">&#x27;token&#x27;</span>] = cookie.get(<span class="string">&#x27;guli_token&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="vue方法-1"><a href="#vue方法-1" class="headerlink" title="vue方法"></a>vue方法</h4><blockquote><ol><li>调用接口登录获取token</li><li>将token放入cookie</li><li>前端拦截器：判断cookie里是否有token，如果有则放到header中</li><li>根据header中的token调用接口获取用户信息</li><li>把获取的用户信息放入cookie</li></ol></blockquote><blockquote><p>login.vue中</p><p>注意这里把对象放入cookie中是要使用JSON.stringify转换为字符串才行，要不然就是object，回报错（cookie获得的json对象为undefined）</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录的方法</span></span><br><span class="line"><span class="function"><span class="title">submitLogin</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 1、调用接口进行登录，返回token字符串</span></span><br><span class="line">  loginApi.login(<span class="built_in">this</span>.user).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 2、获得token,并放入cookie</span></span><br><span class="line">    <span class="comment">// 第一个参数cookie名称，第二个参数值，第三个参数作用范围</span></span><br><span class="line">    cookieApi.set(<span class="string">&#x27;guli_token&#x27;</span>, result.data.data.token, &#123;</span><br><span class="line">      <span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 4、调用接口获取header中的token</span></span><br><span class="line">    loginApi.getLoginMemberInfo().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 5、根据token获取用户信息放入cookie中</span></span><br><span class="line">      <span class="built_in">console</span>.log(response.data.data.member)</span><br><span class="line">      cookieApi.set(<span class="string">&#x27;guli_ucenter&#x27;</span>, <span class="built_in">JSON</span>.stringify(result.data.data.member), &#123;</span><br><span class="line">        <span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 跳转页面</span></span><br><span class="line">    <span class="built_in">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 验证手机号格式</span></span><br><span class="line"><span class="function"><span class="title">checkPhone</span>(<span class="params">rule, value, callback</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="regexp">/^1[34578]\d&#123;9&#125;$/</span>.test(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;手机号码格式不正确&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> callback()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>default.vue中编写根据token获得用户信息</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.showInfo()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">      <span class="comment">// 从cookie中获取用户信息</span></span><br><span class="line">      <span class="function"><span class="title">showInfo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 注意这里需要转换</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;从cookie中获得用户信息：&#x27;</span> + cookieApi.get(<span class="string">&#x27;guli_ucenter&#x27;</span>))</span><br><span class="line">        <span class="keyword">var</span> loginInfoStr = cookieApi.get(<span class="string">&#x27;guli_ucenter&#x27;</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(cookieApi.get(<span class="string">&#x27;guli_ucenter&#x27;</span>))</span><br><span class="line">        <span class="comment">// 把字符串转换为JSON格式</span></span><br><span class="line">        <span class="keyword">if</span> (loginInfoStr) &#123;</span><br><span class="line">          <span class="built_in">this</span>.loginInfo = <span class="built_in">JSON</span>.parse(loginInfoStr)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 退出登录</span></span><br><span class="line">      <span class="function"><span class="title">logout</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 清除cookie</span></span><br><span class="line">        cookieApi.set(<span class="string">&#x27;guli_token&#x27;</span>, <span class="string">&#x27;&#x27;</span>, &#123; <span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span> &#125;)</span><br><span class="line">        cookieApi.set(<span class="string">&#x27;guli_ucenter&#x27;</span>, <span class="string">&#x27;&#x27;</span>, &#123; <span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span> &#125;)</span><br><span class="line">        <span class="comment">// 清除数据</span></span><br><span class="line">        <span class="built_in">this</span>.token = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="built_in">this</span>.loginInfo = &#123;&#125;</span><br><span class="line">        <span class="comment">// 跳转至首页</span></span><br><span class="line">        <span class="built_in">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>TODO：这里需要完善的地方有很多，登录校验（JWT strings must contain exactly 2 period characters. Found: 0）如果输入错误页面竟然显示cookie undefined，而且重新登录也不行，还有前端的信息提示</p></blockquote><h2 id="微信扫码登录（后端-前端）"><a href="#微信扫码登录（后端-前端）" class="headerlink" title="微信扫码登录（后端+前端）"></a>微信扫码登录（后端+前端）</h2><h3 id="OAuth2"><a href="#OAuth2" class="headerlink" title="OAuth2"></a>OAuth2</h3><blockquote><p>一种方案，解决两个问题：</p><ol><li>开放系统间授权</li><li>分布式访问问题</li></ol></blockquote><p>![03 OAuth2介绍](<a href="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/03">https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/03</a> OAuth2介绍.png)</p><h3 id="微信登录准备工作"><a href="#微信登录准备工作" class="headerlink" title="微信登录准备工作"></a>微信登录准备工作</h3><blockquote><p>没事了要付钱，鹅肠真有你的</p><p>没事了老师共享账号，好耶！</p></blockquote><h4 id="配置文件-2"><a href="#配置文件-2" class="headerlink" title="配置文件"></a>配置文件</h4><blockquote><p>service_ucenter模块的配置文件即可（只用于登录注册）</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 微信开放平台 appid</span></span><br><span class="line"><span class="meta">wx.open.app_id</span>=<span class="string">wxed9954c01bb89b47</span></span><br><span class="line"><span class="comment"># 微信开放平台 appsecret</span></span><br><span class="line"><span class="meta">wx.open.app_secret</span>=<span class="string">a7482517235173ddb4083788de60b90e</span></span><br><span class="line"><span class="comment"># 微信开放平台 重定向url</span></span><br><span class="line"><span class="meta">wx.open.redirect_url</span>=<span class="string">http://localhost:8160/api/ucenter/wx/callback</span></span><br></pre></td></tr></table></figure><h4 id="常量类"><a href="#常量类" class="headerlink" title="常量类"></a>常量类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.educenter.utils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstantWxUtils</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.open.app_id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appId;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.open.app_secret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appSecret;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.open.redirect_url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String redirectUrl;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String WX_OPEN_APP_ID;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String WX_OPEN_APP_SECRET;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String WX_OPEN_REDIRECT_URL;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        WX_OPEN_APP_ID = appId;</span><br><span class="line">        WX_OPEN_APP_SECRET = appSecret;</span><br><span class="line">        WX_OPEN_REDIRECT_URL = redirectUrl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="生成二维码"><a href="#生成二维码" class="headerlink" title="生成二维码"></a>生成二维码</h3><h4 id="controller-4"><a href="#controller-4" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/ucenter/wx&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WxApiController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 生成扫描二维码</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;login&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getWxCode</span><span class="params">()</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">        <span class="comment">// 参数位置都是用%s来代替，然后使用String.format</span></span><br><span class="line">        String baseUrl = <span class="string">&quot;https://open.weixin.qq.com/connect/qrconnect&quot;</span> +</span><br><span class="line">                <span class="string">&quot;?appid=%s&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&amp;redirect_uri=%s&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&amp;response_type=code&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&amp;scope=snsapi_login&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&amp;state=%s&quot;</span> +</span><br><span class="line">                <span class="string">&quot;#wechat_redirect&quot;</span>;</span><br><span class="line">        <span class="comment">// 需要进行url编码</span></span><br><span class="line">        String redirectUrl = URLEncoder.encode(ConstantWxUtils.WX_OPEN_REDIRECT_URL, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 传入url中的参数获得最终的url</span></span><br><span class="line">        String url = String.format(baseUrl, ConstantWxUtils.WX_OPEN_APP_ID, redirectUrl, <span class="string">&quot;atguigu&quot;</span>);</span><br><span class="line">        <span class="comment">// 重定向到微信地址</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:&quot;</span> + url;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意这里需要修改端口号，因为用的是老师的url，所以要对应，nginx里也要改</p><p>这里我明白了一点nginx的作用，前端只需要访问nginx提供的9001端口号，而9001能够转发到8001等其他端口号，所以后端端口号改了只要该nginx就行，神奇！</p></blockquote><h3 id="获取扫描人信息"><a href="#获取扫描人信息" class="headerlink" title="获取扫描人信息"></a>获取扫描人信息</h3><h4 id="依赖-2"><a href="#依赖-2" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--httpclient--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--commons-io--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--gson--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="HttpClientUtils"><a href="#HttpClientUtils" class="headerlink" title="HttpClientUtils"></a>HttpClientUtils</h4><blockquote><p>太长不复制了</p></blockquote><h4 id="controller-5"><a href="#controller-5" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UcenterMemberService memberService;</span><br><span class="line"><span class="comment">// 获取扫描人的信息，添加数据</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;callback&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">callback</span><span class="params">(String code, String status)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 1、获取code，类似于验证码</span></span><br><span class="line">    <span class="comment">// 2、请求微信api得到access_token和openid</span></span><br><span class="line">    String baseAccessTokenUrl = <span class="string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token&quot;</span> +</span><br><span class="line">            <span class="string">&quot;?appid=%s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&amp;secret=%s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&amp;code=%s&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&amp;grant_type=authorization_code&quot;</span>;</span><br><span class="line">    <span class="comment">// 拼接参数，发送请求</span></span><br><span class="line">    String accessTokenUrl = String.format(baseAccessTokenUrl, ConstantWxUtils.WX_OPEN_APP_ID, ConstantWxUtils.WX_OPEN_APP_SECRET, code);</span><br><span class="line">    String accessTokenInfo = HttpClientUtils.get(accessTokenUrl);</span><br><span class="line">    <span class="comment">// 转换json-&gt;map集合,获取其中的两个参数,使用json转换工具 Gson</span></span><br><span class="line">    Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">    HashMap accessTokenMap = gson.fromJson(accessTokenInfo, HashMap.class);</span><br><span class="line">    String access_token = (String) accessTokenMap.get(<span class="string">&quot;access_token&quot;</span>);</span><br><span class="line">    String openid = (String) accessTokenMap.get(<span class="string">&quot;openid&quot;</span>);</span><br><span class="line">    <span class="comment">// 把扫描人信息添加数据库里面</span></span><br><span class="line">    <span class="comment">// 判断数据表里面是否存在相同微信信息，根据openid判断</span></span><br><span class="line">    UcenterMember member = memberService.getOpenIdMember(openid);</span><br><span class="line">    <span class="keyword">if</span> (member == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 3、拿着得到accsess_token 和 openid，再去请求微信提供固定的地址，获取到扫描人信息</span></span><br><span class="line">        <span class="comment">// 访问微信的资源服务器，获取用户信息</span></span><br><span class="line">        String baseUserInfoUrl = <span class="string">&quot;https://api.weixin.qq.com/sns/userinfo&quot;</span> +</span><br><span class="line">                <span class="string">&quot;?access_token=%s&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&amp;openid=%s&quot;</span>;</span><br><span class="line">        <span class="comment">// 拼接参数，发送请求</span></span><br><span class="line">        String userInfoUrl = String.format(baseUserInfoUrl, access_token, openid);</span><br><span class="line">        String userInfo = HttpClientUtils.get(userInfoUrl);</span><br><span class="line">        <span class="comment">//转换并获取返回userinfo字符串扫描人信息</span></span><br><span class="line">        HashMap userInfoMap = gson.fromJson(userInfo, HashMap.class);</span><br><span class="line">        String nickname = (String) userInfoMap.get(<span class="string">&quot;nickname&quot;</span>);<span class="comment">//昵称</span></span><br><span class="line">        String headimgurl = (String) userInfoMap.get(<span class="string">&quot;headimgurl&quot;</span>);<span class="comment">//头像</span></span><br><span class="line">        <span class="comment">// 创建扫描member对象</span></span><br><span class="line">        member = <span class="keyword">new</span> UcenterMember();</span><br><span class="line">        member.setOpenid(openid);</span><br><span class="line">        member.setNickname(nickname);</span><br><span class="line">        member.setAvatar(headimgurl);</span><br><span class="line">        memberService.save(member);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4、使用jwt根据member对象生成token字符串</span></span><br><span class="line">    String jwtToken = JwtUtils.getJwtToken(member.getId(), member.getNickname());</span><br><span class="line">    <span class="comment">// 5、最后：返回首页面，通过路径传递token字符串</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:http://localhost:3000?token=&quot;</span> + jwtToken;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service-3"><a href="#service-3" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据openid查询</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> UcenterMember <span class="title">getOpenIdMember</span><span class="params">(String openid)</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;UcenterMember&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;openid&quot;</span>, openid);</span><br><span class="line">    UcenterMember member = baseMapper.selectOne(wrapper);</span><br><span class="line">    <span class="keyword">return</span> member;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><blockquote><p>取地址栏中的带名称的参数值（而不是xx/xx/xx这种使用this.$route.params.xx）使用this.$route.query.xxx</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 获取url中的token</span></span><br><span class="line">  <span class="built_in">this</span>.token = <span class="built_in">this</span>.$route.query.token</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.token) &#123;</span><br><span class="line">    <span class="built_in">this</span>.wxLogin()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.showInfo()</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="comment">// 微信登录后显示用户信息</span></span><br><span class="line">  <span class="function"><span class="title">wxLogin</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 把token放入cookie</span></span><br><span class="line">    cookieApi.set(<span class="string">&#x27;guli_token&#x27;</span>, <span class="built_in">this</span>.token, &#123; <span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span> &#125;)</span><br><span class="line">    <span class="comment">// 调用接口获取header中的token</span></span><br><span class="line">    loginApi.getLoginMemberInfo().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 5、根据token获取用户信息放入cookie中</span></span><br><span class="line">      cookieApi.set(<span class="string">&#x27;guli_ucenter&#x27;</span>, <span class="built_in">JSON</span>.stringify(result.data.data.member), &#123;</span><br><span class="line">        <span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 跳转页面</span></span><br><span class="line">    <span class="built_in">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span> &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 从cookie中获取用户信息</span></span><br><span class="line">  <span class="function"><span class="title">showInfo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> loginInfoStr = cookieApi.get(<span class="string">&#x27;guli_ucenter&#x27;</span>)</span><br><span class="line">    <span class="comment">// 把字符串转换为JSON格式</span></span><br><span class="line">    <span class="keyword">if</span> (loginInfoStr) &#123;</span><br><span class="line">      <span class="built_in">this</span>.loginInfo = <span class="built_in">JSON</span>.parse(loginInfoStr)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意把进入微信扫码的href改为<a href="http://localhost:8160/api/ucenter/wx/login%E5%8D%B3%E5%8F%AF">http://localhost:8160/api/ucenter/wx/login即可</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】在线教育项目实战4</title>
      <link href="/2021/09/25/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-4/"/>
      <url>/2021/09/25/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-4/</url>
      
        <content type="html"><![CDATA[<h2 id="多表连接查询"><a href="#多表连接查询" class="headerlink" title="多表连接查询"></a>多表连接查询</h2><blockquote><p>方式如下</p><ol><li>内连接</li><li>左外连接</li><li>右外连接</li></ol></blockquote><h3 id="课程全部信息查询（后端）"><a href="#课程全部信息查询（后端）" class="headerlink" title="课程全部信息查询（后端）"></a>课程全部信息查询（后端）</h3><h4 id="创建值封装对象类"><a href="#创建值封装对象类" class="headerlink" title="创建值封装对象类"></a>创建值封装对象类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CoursePublishVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String cover;</span><br><span class="line">    <span class="keyword">private</span> Integer lessonNum;</span><br><span class="line">    <span class="keyword">private</span> String subjectLevelOne;</span><br><span class="line">    <span class="keyword">private</span> String subjectLevelTwo;</span><br><span class="line">    <span class="keyword">private</span> String teacherName;</span><br><span class="line">    <span class="keyword">private</span> String price;<span class="comment">//只用于显示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写对应mapper接口"><a href="#编写对应mapper接口" class="headerlink" title="编写对应mapper接口"></a>编写对应mapper接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EduCourseMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">EduCourse</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">CoursePublishVo <span class="title">getCoursePublishInfo</span><span class="params">(String courseId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写对应mapper中sql语句"><a href="#编写对应mapper中sql语句" class="headerlink" title="编写对应mapper中sql语句"></a>编写对应mapper中sql语句</h4><blockquote><p>先查询完了之后再贴上来，出错率很高</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.eduservice.mapper.EduCourseMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getCoursePublishInfo&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.eduservice.entity.vo.CoursePublishVo&quot;</span>&gt;</span></span><br><span class="line">        select ec.id,</span><br><span class="line">               ec.title,</span><br><span class="line">               ec.price,</span><br><span class="line">               ec.lesson_num AS lessonNum,</span><br><span class="line">               ec.cover,</span><br><span class="line">               et.name       AS teacherName,</span><br><span class="line">               es1.title     AS subjectLevelOne,</span><br><span class="line">               es2.title     AS subjectLevelTwo</span><br><span class="line">        from edu_course ec</span><br><span class="line">                 left join edu_course_description ecd on ec.id = ecd.id</span><br><span class="line">                 left join edu_teacher et on ec.teacher_id = et.id</span><br><span class="line">                 left join edu_subject es1 on ec.subject_parent_id = es1.id</span><br><span class="line">                 left join edu_subject es2 on ec.subject_id = es2.id</span><br><span class="line">        where ec.id = #&#123;courseId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="编写controller"><a href="#编写controller" class="headerlink" title="编写controller"></a>编写controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据id查询课程全部信息</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;getCoursePublishInfo/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getCoursePublishInfo</span><span class="params">(<span class="meta">@PathVariable</span> String courseId)</span> </span>&#123;</span><br><span class="line">    CoursePublishVo coursePublishInfo = courseService.getCoursePublishInfo(courseId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;coursePublishInfo&quot;</span>, coursePublishInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写service"><a href="#编写service" class="headerlink" title="编写service"></a>编写service</h4><blockquote><p>同理，直接快捷键就行</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据id查询课程全部信息</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CoursePublishVo <span class="title">getCoursePublishInfo</span><span class="params">(String courseId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> baseMapper.getCoursePublishInfo(courseId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h4><blockquote><p> <code>Invalid bound statement (not found): com.atguigu.eduservice.mapper.EduCourseMapper.getCoursePublishInfo</code></p><p>报错如上，解决如下（详见p130）</p><ol><li>mapper有没有写错</li><li>在target文件夹中xml配置文件有没有被引入<ul><li>可以把mapper.xml放在resource下</li><li>配置pom.xml和application.properties（子模块的pom.xml）</li></ul></li></ol></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mybatis-plus.mapper-locations</span>=<span class="string">classpath:com/atguigu/eduservice/mapper/xml/*.xml</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 解决maven没有导入xml文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="课程全部信息查询（前端）"><a href="#课程全部信息查询（前端）" class="headerlink" title="课程全部信息查询（前端）"></a>课程全部信息查询（前端）</h3><h4 id="api"><a href="#api" class="headerlink" title="api"></a>api</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 课程全部信息</span></span><br><span class="line">    <span class="function"><span class="title">getCoursePublishInfo</span>(<span class="params">courseId</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/course/getCoursePublishInfo/`</span> + courseId,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="vue模板和方法"><a href="#vue模板和方法" class="headerlink" title="vue模板和方法"></a>vue模板和方法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;h2 style=&quot;text-align: center&quot;&gt;发布新课程&lt;/h2&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-steps</span><br><span class="line">            :active=&quot;3&quot;</span><br><span class="line">            process-status=&quot;wait&quot;</span><br><span class="line">            align-center</span><br><span class="line">            style=&quot;margin-bottom: 40px&quot;</span><br><span class="line">        &gt;</span><br><span class="line">            &lt;el-step title=&quot;填写课程基本信息&quot; /&gt;</span><br><span class="line">            &lt;el-step title=&quot;创建课程大纲&quot; /&gt;</span><br><span class="line">            &lt;el-step title=&quot;最终发布&quot; /&gt;</span><br><span class="line">        &lt;/el-steps&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;ccInfo&quot;&gt;</span><br><span class="line">            &lt;img :src=&quot;coursePublishInfo.cover&quot; /&gt;</span><br><span class="line">            &lt;div class=&quot;main&quot;&gt;</span><br><span class="line">                &lt;h2&gt;&#123;&#123; coursePublishInfo.title &#125;&#125;&lt;/h2&gt;</span><br><span class="line">                &lt;p class=&quot;gray&quot;&gt;</span><br><span class="line">                    &lt;span&gt;共&#123;&#123; coursePublishInfo.lessonNum &#125;&#125;课时&lt;/span&gt;</span><br><span class="line">                &lt;/p&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;span</span><br><span class="line">                        &gt;所属分类：&#123;&#123; coursePublishInfo.subjectLevelOne &#125;&#125; —</span><br><span class="line">                        &#123;&#123; coursePublishInfo.subjectLevelTwo &#125;&#125;&lt;/span</span><br><span class="line">                    &gt;</span><br><span class="line">                &lt;/p&gt;</span><br><span class="line">                &lt;p&gt;课程讲师：&#123;&#123; coursePublishInfo.teacherName &#125;&#125;&lt;/p&gt;</span><br><span class="line">                &lt;h3 class=&quot;red&quot;&gt;￥&#123;&#123; coursePublishInfo.price &#125;&#125;&lt;/h3&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;el-button @click=&quot;previous&quot;&gt;返回修改&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button</span><br><span class="line">                :disabled=&quot;saveBtnDisabled&quot;</span><br><span class="line">                type=&quot;primary&quot;</span><br><span class="line">                @click=&quot;publish&quot;</span><br><span class="line">                &gt;发布课程&lt;/el-button</span><br><span class="line">            &gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import courseApi from &#x27;@/api/edu/course.js&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          saveBtnDisabled: false, // 保存按钮是否禁用</span><br><span class="line">          courseId: &#x27;&#x27;, // 课程id</span><br><span class="line">          coursePublishInfo: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      created() &#123;</span><br><span class="line">        // 获取到路由中的id值</span><br><span class="line">        if (this.$route.params &amp;&amp; this.$route.params.id) &#123;</span><br><span class="line">          this.courseId = this.$route.params.id</span><br><span class="line">          this.getCoursePublishInfo(this.courseId)</span><br><span class="line">        &#125;</span><br><span class="line">        console.log(this.coursePublishInfo)</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      methods: &#123;</span><br><span class="line">        getCoursePublishInfo(id) &#123;</span><br><span class="line">          // 调用api</span><br><span class="line">          courseApi.getCoursePublishInfo(id).then(result =&gt; &#123;</span><br><span class="line">            console.log</span><br><span class="line">            this.coursePublishInfo = result.data.coursePublishInfo</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        previous() &#123;</span><br><span class="line">          console.log(&#x27;previous&#x27;)</span><br><span class="line">          this.$router.push(&#123; path: &#x27;/course/chapter/&#x27; + this.courseId &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        publish() &#123;</span><br><span class="line">          console.log(&#x27;publish&#x27;)</span><br><span class="line">          this.$router.push(&#123; path: &#x27;/course/list&#x27; &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="课程发布（后端-前端）"><a href="#课程发布（后端-前端）" class="headerlink" title="课程发布（后端+前端）"></a>课程发布（后端+前端）</h2><h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><blockquote><p>发布就是修改表中一个字段值就行</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布课程（修改status字段值）</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;publishCourse/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">publishCourse</span><span class="params">(<span class="meta">@PathVariable</span> String courseId)</span> </span>&#123;</span><br><span class="line">    EduCourse eduCourse = courseService.getById(courseId);</span><br><span class="line">    eduCourse.setStatus(<span class="string">&quot;Normal&quot;</span>);</span><br><span class="line">    courseService.updateById(eduCourse);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><blockquote><p>api</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 发布课程</span></span><br><span class="line"><span class="function"><span class="title">publishCourse</span>(<span class="params">courseId</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/eduservice/course/publishCourse/`</span> + courseId,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>method</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="title">publish</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  courseApi.publishCourse(<span class="built_in">this</span>.courseId).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/course/list&#x27;</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="课程列表（后端-前端）"><a href="#课程列表（后端-前端）" class="headerlink" title="课程列表（后端+前端）"></a>课程列表（后端+前端）</h2><h3 id="后端（待完善）"><a href="#后端（待完善）" class="headerlink" title="后端（待完善）"></a>后端（待完善）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO 完善条件查询带分页</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getCourseList&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getCourseList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;EduCourse&gt; list = courseService.list(<span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;courseList&quot;</span>, list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="前端-1"><a href="#前端-1" class="headerlink" title="前端"></a>前端</h3><h4 id="api-1"><a href="#api-1" class="headerlink" title="api"></a>api</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得课程列表</span></span><br><span class="line">   <span class="function"><span class="title">getCourseList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> request(&#123;</span><br><span class="line">           <span class="attr">url</span>: <span class="string">`/eduservice/course/getCourseList`</span>,</span><br><span class="line">           <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">       &#125;)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="vue"><a href="#vue" class="headerlink" title="vue"></a>vue</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        课程列表</span><br><span class="line"></span><br><span class="line">        &lt;!--查询表单--&gt;</span><br><span class="line">        &lt;el-form :inline=&quot;true&quot; class=&quot;demo-form-inline&quot;&gt;</span><br><span class="line">            &lt;el-form-item&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;courseQuery.title&quot; placeholder=&quot;课程名称&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-form-item&gt;</span><br><span class="line">                &lt;el-select</span><br><span class="line">                    v-model=&quot;courseQuery.status&quot;</span><br><span class="line">                    clearable</span><br><span class="line">                    placeholder=&quot;课程状态&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                    &lt;el-option value=&quot;Normal&quot; label=&quot;已发布&quot; /&gt;</span><br><span class="line">                    &lt;el-option value=&quot;Draft&quot; label=&quot;未发布&quot; /&gt;</span><br><span class="line">                &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-button type=&quot;primary&quot; icon=&quot;el-icon-search&quot; @click=&quot;getList()&quot;</span><br><span class="line">                &gt;查询&lt;/el-button</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;el-button type=&quot;default&quot; @click=&quot;resetData()&quot;&gt;清空&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-form&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 表格 --&gt;</span><br><span class="line">        &lt;el-table :data=&quot;list&quot; border fit highlight-current-row&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;序号&quot; width=&quot;70&quot; align=&quot;center&quot;&gt;</span><br><span class="line">                &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">                    &#123;&#123; (page - 1) * limit + scope.$index + 1 &#125;&#125;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-table-column prop=&quot;title&quot; label=&quot;课程名称&quot; width=&quot;80&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-table-column label=&quot;课程状态&quot; width=&quot;80&quot;&gt;</span><br><span class="line">                &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">                    &#123;&#123; scope.row.status === &quot;Normal&quot; ? &quot;已发布&quot; : &quot;未发布&quot; &#125;&#125;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-table-column prop=&quot;lessonNum&quot; label=&quot;课时数&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-table-column prop=&quot;gmtCreate&quot; label=&quot;添加时间&quot; width=&quot;160&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-table-column prop=&quot;viewCount&quot; label=&quot;浏览数量&quot; width=&quot;60&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-table-column label=&quot;操作&quot; width=&quot;200&quot; align=&quot;center&quot;&gt;</span><br><span class="line">                &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;router-link :to=&quot;&#x27;/teacher/edit/&#x27; + scope.row.id&quot;&gt;</span><br><span class="line">                        &lt;el-button</span><br><span class="line">                            type=&quot;primary&quot;</span><br><span class="line">                            size=&quot;mini&quot;</span><br><span class="line">                            icon=&quot;el-icon-edit&quot;</span><br><span class="line">                            &gt;编辑课程基本信息&lt;/el-button</span><br><span class="line">                        &gt;</span><br><span class="line">                    &lt;/router-link&gt;</span><br><span class="line">                    &lt;router-link :to=&quot;&#x27;/teacher/edit/&#x27; + scope.row.id&quot;&gt;</span><br><span class="line">                        &lt;el-button</span><br><span class="line">                            type=&quot;primary&quot;</span><br><span class="line">                            size=&quot;mini&quot;</span><br><span class="line">                            icon=&quot;el-icon-edit&quot;</span><br><span class="line">                            &gt;编辑课程大纲息&lt;/el-button</span><br><span class="line">                        &gt;</span><br><span class="line">                    &lt;/router-link&gt;</span><br><span class="line">                    &lt;el-button</span><br><span class="line">                        type=&quot;danger&quot;</span><br><span class="line">                        size=&quot;mini&quot;</span><br><span class="line">                        icon=&quot;el-icon-delete&quot;</span><br><span class="line">                        @click=&quot;removeDataById(scope.row.id)&quot;</span><br><span class="line">                        &gt;删除课程信息&lt;/el-button</span><br><span class="line">                    &gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 分页 --&gt;</span><br><span class="line">        &lt;el-pagination</span><br><span class="line">            :current-page=&quot;page&quot;</span><br><span class="line">            :page-size=&quot;limit&quot;</span><br><span class="line">            :total=&quot;total&quot;</span><br><span class="line">            style=&quot;padding: 30px 0; text-align: center&quot;</span><br><span class="line">            layout=&quot;total, prev, pager, next, jumper&quot;</span><br><span class="line">            @current-change=&quot;getList&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    // 引入调用teacher.js文件</span><br><span class="line">    import courseApi from &#x27;@/api/edu/course&#x27;</span><br><span class="line"></span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          list: null, // 查询之后接口返回集合(注意这里是数组用null)</span><br><span class="line">          page: 1, // 当前页</span><br><span class="line">          limit: 10, // 每页记录数</span><br><span class="line">          total: 0, // 总记录数</span><br><span class="line">          courseQuery: &#123;&#125; // 条件封装对象</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      created() &#123;</span><br><span class="line">        // 页面渲染之前执行，一般调用methods定义的方法</span><br><span class="line">        // 调用</span><br><span class="line">        this.getList()</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        getList() &#123;</span><br><span class="line">          courseApi.getCourseList().then(response =&gt; &#123;</span><br><span class="line">            // 请求成功</span><br><span class="line">            // response接口返回的数据</span><br><span class="line">            this.list = response.data.courseList</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        resetData() &#123;</span><br><span class="line">          // 表单输入项数据清空</span><br><span class="line">          this.courseQuery = &#123;&#125;</span><br><span class="line">          this.getList()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="课程删除（后端-前端）"><a href="#课程删除（后端-前端）" class="headerlink" title="课程删除（后端+前端）"></a>课程删除（后端+前端）</h2><blockquote><p>删除课程：所有章节也会被删除</p></blockquote><h3 id="后端-1"><a href="#后端-1" class="headerlink" title="后端"></a>后端</h3><h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除课程</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">deleteCourse</span><span class="params">(<span class="meta">@PathVariable</span> String courseId)</span> </span>&#123;</span><br><span class="line">    courseService.deleteCourse(courseId);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据课程id删除课程及其描述和章节</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteCourse</span><span class="params">(String courseId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1、删除小节</span></span><br><span class="line">    videoService.removeByCourseId(courseId);</span><br><span class="line">    <span class="comment">// 2、删除章节</span></span><br><span class="line">    chapterService.removeByCourseId(courseId);</span><br><span class="line">    <span class="comment">// 3、删除描述</span></span><br><span class="line">    descriptionService.removeById(courseId);</span><br><span class="line">    <span class="comment">// 4、删除课程</span></span><br><span class="line">    <span class="keyword">int</span> row = baseMapper.deleteById(courseId);</span><br><span class="line">    <span class="keyword">if</span> (row == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;删除课程失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据课程id删除章节</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeByCourseId</span><span class="params">(String courseId)</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;EduChapter&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;course_id&quot;</span>, courseId);</span><br><span class="line">    baseMapper.delete(queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="前端-2"><a href="#前端-2" class="headerlink" title="前端"></a>前端</h3><h4 id="api-2"><a href="#api-2" class="headerlink" title="api"></a>api</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除课程</span></span><br><span class="line">    <span class="function"><span class="title">deleteCourse</span>(<span class="params">courseId</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/course/`</span> + courseId,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><h4 id="vue-1"><a href="#vue-1" class="headerlink" title="vue"></a>vue</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除课程</span></span><br><span class="line"><span class="function"><span class="title">deleteCourse</span>(<span class="params">courseId</span>)</span> &#123;</span><br><span class="line">  courseApi</span><br><span class="line">    .deleteCourse(courseId)</span><br><span class="line">    .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 显示提示信息</span></span><br><span class="line">      <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;删除成功!&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// 刷新页面</span></span><br><span class="line">      <span class="built_in">this</span>.getList()</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 显示提示信息</span></span><br><span class="line">      <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;删除失败!&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="阿里云视频点播"><a href="#阿里云视频点播" class="headerlink" title="阿里云视频点播"></a>阿里云视频点播</h2><blockquote><p><a href="https://www.aliyun.com/product/vod?spm=5176.10695662.5694434980.1.448751effMGKWo">视频点播_音视频点播解决方案_视频转码_媒体资源管理系统-阿里云 (aliyun.com)</a></p><p><a href="https://help.aliyun.com/product/29932.html?spm=5176.8413026.J_3895079540.5.72081029auUneg">视频点播 (aliyun.com)</a></p></blockquote><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><blockquote><p>依赖见官网（项目环境搭建的时候已经引入了）</p></blockquote><h4 id="创建模块"><a href="#创建模块" class="headerlink" title="创建模块"></a>创建模块</h4><blockquote><p>子子模块<code>service_vod</code></p></blockquote><h4 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h4><blockquote><p>注意这个aliyun-java-vod-upload.version依赖未开源，需要手动下载jar包，然后使用命令行安装</p><p>mvn install:install-file -DgroupId=com.aliyun -DartifactId=aliyun-java-vod-upload -Dversion=1.4.11 -Dpackaging=jar -Dfile=aliyun-java-vod-upload-1.4.14.jar</p><p>注意这里的版本要和下载的jar包对应，还有包名aliyun-java-vod-upload</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 阿里云视频点播所需依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-vod<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-vod-upload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.json<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><h4 id="根据视频id获取视频播放地址"><a href="#根据视频id获取视频播放地址" class="headerlink" title="根据视频id获取视频播放地址"></a>根据视频id获取视频播放地址</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestVod</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClientException </span>&#123;</span><br><span class="line">        <span class="comment">// 1、根据视频id获取视频播放地址</span></span><br><span class="line">        <span class="comment">// 创建初始化对象(传入oss的id和秘钥)</span></span><br><span class="line">        DefaultAcsClient client = InitObject.initVodClient(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="comment">// 创建获取视频地址的request</span></span><br><span class="line">        GetPlayInfoRequest request = <span class="keyword">new</span> GetPlayInfoRequest();</span><br><span class="line">        <span class="comment">// 向request中设置id</span></span><br><span class="line">        request.setVideoId(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="comment">// 调用初始化对象的方法，传递request，获取response</span></span><br><span class="line">        GetPlayInfoResponse acsResponse = client.getAcsResponse(request);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取response中的信息</span></span><br><span class="line">        List&lt;GetPlayInfoResponse.PlayInfo&gt; playInfoList = acsResponse.getPlayInfoList();</span><br><span class="line">        <span class="comment">//播放地址</span></span><br><span class="line">        <span class="keyword">for</span> (GetPlayInfoResponse.PlayInfo playInfo : playInfoList) &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;PlayInfo.PlayURL = &quot;</span> + playInfo.getPlayURL() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Base信息</span></span><br><span class="line">        System.out.print(<span class="string">&quot;VideoBase.Title = &quot;</span> + acsResponse.getVideoBase().getTitle() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        System.out.println(acsResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="根据视频id获取视频播放凭证"><a href="#根据视频id获取视频播放凭证" class="headerlink" title="根据视频id获取视频播放凭证"></a>根据视频id获取视频播放凭证</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClientException </span>&#123;</span><br><span class="line">    <span class="comment">// 根据视频id获得视频凭证</span></span><br><span class="line">    <span class="comment">// 创建初始化对象(传入oss的id和秘钥)</span></span><br><span class="line">    DefaultAcsClient client = InitObject.initVodClient(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">// 创建获取视频地址的request</span></span><br><span class="line">    GetVideoPlayAuthRequest request = <span class="keyword">new</span> GetVideoPlayAuthRequest();</span><br><span class="line">    <span class="comment">// 向request中设置id</span></span><br><span class="line">    request.setVideoId(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">// 调用初始化对象的方法，传递request，获取response</span></span><br><span class="line">    GetVideoPlayAuthResponse acsResponse = client.getAcsResponse(request);</span><br><span class="line">    System.out.println(<span class="string">&quot;视频凭证: &quot;</span> + acsResponse.getPlayAuth());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="上传视频"><a href="#上传视频" class="headerlink" title="上传视频"></a>上传视频</h4><blockquote><p>这里注意，如果使用upload的版本为1.4.14，那么根据官方文档说明，oss-sdk的版本必须为3.9及以上，否则会显示一直上传中</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClientException </span>&#123;</span><br><span class="line">    String accessKeyId = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    String accessKeySecret = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String title = <span class="string">&quot;6 - What If I Want to Move Faster - upload by sdk&quot;</span>;   <span class="comment">//上传之后文件名称</span></span><br><span class="line">    String fileName = <span class="string">&quot;D:/MyProject/6 - What If I Want to Move Faster.mp4&quot;</span>;  <span class="comment">//本地文件路径和名称</span></span><br><span class="line">    <span class="comment">//上传视频的方法</span></span><br><span class="line">    UploadVideoRequest request = <span class="keyword">new</span> UploadVideoRequest(accessKeyId, accessKeySecret, title, fileName);</span><br><span class="line">    <span class="comment">/* 可指定分片上传时每个分片的大小，默认为2M字节 */</span></span><br><span class="line">    request.setPartSize(<span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024L</span>);</span><br><span class="line">    <span class="comment">/* 可指定分片上传时的并发线程数，默认为1，(注：该配置会占用服务器CPU资源，需根据服务器情况指定）*/</span></span><br><span class="line">    request.setTaskNum(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    UploadVideoImpl uploader = <span class="keyword">new</span> UploadVideoImpl();</span><br><span class="line">    UploadVideoResponse response = uploader.uploadVideo(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (response.isSuccess()) &#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;VideoId=&quot;</span> + response.getVideoId() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/* 如果设置回调URL无效，不影响视频上传，可以返回VideoId同时会返回错误码。其他情况上传失败时，VideoId为空，此时需要根据返回错误码分析具体错误原因 */</span></span><br><span class="line">        System.out.print(<span class="string">&quot;VideoId=&quot;</span> + response.getVideoId() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;ErrorCode=&quot;</span> + response.getCode() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;ErrorMessage=&quot;</span> + response.getMessage() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="课程增加、删除小节（视频）功能（完善）"><a href="#课程增加、删除小节（视频）功能（完善）" class="headerlink" title="课程增加、删除小节（视频）功能（完善）"></a>课程增加、删除小节（视频）功能（完善）</h2><h3 id="后端-2"><a href="#后端-2" class="headerlink" title="后端"></a>后端</h3><h4 id="配置文件application-properties"><a href="#配置文件application-properties" class="headerlink" title="配置文件application.properties"></a>配置文件application.properties</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端口</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8003</span></span><br><span class="line"><span class="comment"># 服务名</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">service-vod</span></span><br><span class="line"><span class="comment"># 环境设置：dev、test、prod</span></span><br><span class="line"><span class="meta">spring.profiles.active</span>=<span class="string">dev</span></span><br><span class="line"><span class="comment">#阿里云 vod</span></span><br><span class="line"><span class="comment">#不同的服务器，地址不同</span></span><br><span class="line"><span class="meta">aliyun.vod.file.keyid</span>=<span class="string"></span></span><br><span class="line"><span class="meta">aliyun.vod.file.keysecret</span>=<span class="string"></span></span><br><span class="line"><span class="comment"># 最大上传单个文件大小：默认1M</span></span><br><span class="line"><span class="meta">spring.servlet.multipart.max-file-size</span>=<span class="string">1024MB</span></span><br><span class="line"><span class="comment"># 最大置总上传的数据大小 ：默认10M</span></span><br><span class="line"><span class="meta">spring.servlet.multipart.max-request-size</span>=<span class="string">1024MB</span></span><br></pre></td></tr></table></figure><h4 id="编写常量类"><a href="#编写常量类" class="headerlink" title="编写常量类"></a>编写常量类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类存储配置文件中的数据以便调用</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstantVodUtils</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.vod.file.keyid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keyid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.vod.file.keysecret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keysecret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESS_KEY_SECRET;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESS_KEY_ID;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ACCESS_KEY_ID = keyid;</span><br><span class="line">        ACCESS_KEY_SECRET = keysecret;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写初始化VodClient"><a href="#编写初始化VodClient" class="headerlink" title="编写初始化VodClient"></a>编写初始化VodClient</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitVodClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DefaultAcsClient <span class="title">initVodClient</span><span class="params">(String accessKeyId, String accessKeySecret)</span> <span class="keyword">throws</span> ClientException </span>&#123;</span><br><span class="line">        String regionId = <span class="string">&quot;cn-shanghai&quot;</span>;  <span class="comment">// 点播服务接入区域</span></span><br><span class="line">        DefaultProfile profile = DefaultProfile.getProfile(regionId, accessKeyId, accessKeySecret);</span><br><span class="line">        DefaultAcsClient client = <span class="keyword">new</span> DefaultAcsClient(profile);</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="创建启动类"><a href="#创建启动类" class="headerlink" title="创建启动类"></a>创建启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span> <span class="comment">// 不需要引入数据库的配置</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.atguigu&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VodApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(VodApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写controller-1"><a href="#编写controller-1" class="headerlink" title="编写controller"></a>编写controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduvod/video&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VodController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VodService vodService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上传视频至阿里云</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;uploadVideo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">uploadVideo</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line">        String videoId = vodService.uploadVideo(file);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据id删除视频</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;removeVideo/&#123;videoId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">removeVideo</span><span class="params">(<span class="meta">@PathVariable</span> String videoId)</span> </span>&#123;</span><br><span class="line">        vodService.removeVideo(videoId);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写service-1"><a href="#编写service-1" class="headerlink" title="编写service"></a>编写service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VodServiceImpl</span> <span class="keyword">implements</span> <span class="title">VodService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 上传视频至阿里云</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploadVideo</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//fileName：上传文件原始名称</span></span><br><span class="line">            String fileName = file.getOriginalFilename();</span><br><span class="line">            <span class="comment">//title：上传之后显示名称</span></span><br><span class="line">            String title = fileName.substring(<span class="number">0</span>, fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">            <span class="comment">//inputStream：上传文件输入流</span></span><br><span class="line">            InputStream inputStream = file.getInputStream();</span><br><span class="line">            <span class="comment">//accessKeyId, accessKeySecret</span></span><br><span class="line">            UploadStreamRequest request = <span class="keyword">new</span> UploadStreamRequest(ConstantVodUtils.ACCESS_KEY_ID, ConstantVodUtils.ACCESS_KEY_SECRET, title, fileName, inputStream);</span><br><span class="line"></span><br><span class="line">            UploadVideoImpl uploader = <span class="keyword">new</span> UploadVideoImpl();</span><br><span class="line">            UploadStreamResponse response = uploader.uploadStream(request);</span><br><span class="line"></span><br><span class="line">            String videoId = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (response.isSuccess()) &#123;</span><br><span class="line">                videoId = response.getVideoId();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">//如果设置回调URL无效，不影响视频上传，可以返回VideoId同时会返回错误码。其他情况上传失败时，VideoId为空，此时需要根据返回错误码分析具体错误原因</span></span><br><span class="line">                System.out.print(<span class="string">&quot;VideoId=&quot;</span> + response.getVideoId() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                System.out.print(<span class="string">&quot;ErrorCode=&quot;</span> + response.getCode() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                System.out.print(<span class="string">&quot;ErrorMessage=&quot;</span> + response.getMessage() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> videoId;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据id删除视频</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeVideo</span><span class="params">(String videoId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 初始化对象</span></span><br><span class="line">            DefaultAcsClient client = InitVodClient.initVodClient(ConstantVodUtils.ACCESS_KEY_ID, ConstantVodUtils.ACCESS_KEY_SECRET);</span><br><span class="line">            <span class="comment">// 创建删除video的request对象,并设置id</span></span><br><span class="line">            DeleteVideoRequest request = <span class="keyword">new</span> DeleteVideoRequest();</span><br><span class="line">            request.setVideoIds(videoId);</span><br><span class="line">            <span class="comment">// 调用初始化对象方法</span></span><br><span class="line">            DeleteVideoResponse acsResponse = client.getAcsResponse(request);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;删除视频失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="前端-3"><a href="#前端-3" class="headerlink" title="前端"></a>前端</h3><h4 id="api-3"><a href="#api-3" class="headerlink" title="api"></a>api</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除小节视频</span></span><br><span class="line">    deleteVideoAli(videoId) &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            url: `/eduvod/video/removeVideo/` + videoId,</span><br><span class="line">            method: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="vue模板"><a href="#vue模板" class="headerlink" title="vue模板"></a>vue模板</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-upload</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:on-success</span>=<span class="string">&quot;handleVodUploadSuccess&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:on-remove</span>=<span class="string">&quot;handleVodRemove&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:before-remove</span>=<span class="string">&quot;beforeVodRemove&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:on-exceed</span>=<span class="string">&quot;handleUploadExceed&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:file-list</span>=<span class="string">&quot;fileList&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:action</span>=<span class="string">&quot;BASE_API+&#x27;/eduvod/video/uploadVideo&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:limit</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;upload-demo&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>上传视频<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-tooltip</span> <span class="attr">placement</span>=<span class="string">&quot;right-end&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;content&quot;</span>&gt;</span>最大支持1G，<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        支持3GP、ASF、AVI、DAT、DV、FLV、F4V、<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        GIF、M2T、M4V、MJ2、MJPEG、MKV、MOV、MP4、<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        MPE、MPG、MPEG、MTS、OGG、QT、RM、RMVB、<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        SWF、TS、VOB、WMV、WEBM 等视频格式上传<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-question&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-tooltip</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="调用方法"><a href="#调用方法" class="headerlink" title="调用方法"></a>调用方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除之前</span></span><br><span class="line"><span class="function"><span class="title">beforeVodRemove</span>(<span class="params">file, fileList</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.$confirm(<span class="string">`确定移除<span class="subst">$&#123;file.name&#125;</span>?`</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 删除上传视频</span></span><br><span class="line"><span class="function"><span class="title">handleVodRemove</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 调用接口</span></span><br><span class="line">  videoApi.deleteVideoAli(<span class="built_in">this</span>.video.videoSourceId).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 提示</span></span><br><span class="line">    <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;删除成功!&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 刷新fileList 和 resourceId</span></span><br><span class="line">    <span class="built_in">this</span>.fileList = []</span><br><span class="line">    <span class="built_in">this</span>.video.videoSourceId = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 上传vod成功</span></span><br><span class="line"><span class="function"><span class="title">handleVodUploadSuccess</span>(<span class="params">response, file, fileList</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.video.videoSourceId = response.data.videoId</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 重新上传提示</span></span><br><span class="line"><span class="function"><span class="title">handleUploadExceed</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.$message.warning(<span class="string">&#x27;想要重新上传视频，请先删除已上传的视频&#x27;</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><blockquote><p>注意这里，要修改nginx的上传文件大小</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    client_max_body_size 1024m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ol><li>由于controller中返回data只有videoId，所以从后端拿不到原始文件吗，所以从前端赋值即可</li><li>删除视频后要清空sourceId，要不然不上传视频也有id存留</li></ol></blockquote><h2 id="springcloud微服务（删除小节功能完善）"><a href="#springcloud微服务（删除小节功能完善）" class="headerlink" title="springcloud微服务（删除小节功能完善）"></a>springcloud微服务（删除小节功能完善）</h2><h3 id="springcloud"><a href="#springcloud" class="headerlink" title="springcloud"></a>springcloud</h3><blockquote><p>服务集合，TODO</p></blockquote><h4 id="springcloud调用接口过程"><a href="#springcloud调用接口过程" class="headerlink" title="springcloud调用接口过程"></a>springcloud调用接口过程</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210927131506299.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210927131506299.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210927131506299"></p><h3 id="Nacos服务注册"><a href="#Nacos服务注册" class="headerlink" title="Nacos服务注册"></a>Nacos服务注册</h3><blockquote><p>注册中心</p><p><a href="https://nacos.io/zh-cn/">home (nacos.io)</a></p></blockquote><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><blockquote><p>下载并解压，然后启动startup.cmd即可，可能会启动失败，需要修改MODE为standalone</p><p><a href="https://blog.csdn.net/CC1014524900/article/details/109073654">Nacos 启动失败_RookieMZL 的博客-CSDN博客_nacos启动失败</a></p></blockquote><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><blockquote><p>先引入依赖</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--服务注册--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><blockquote><p>在要注册的服务的配置文件application.properties中配置</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nacos服务地址</span></span><br><span class="line"><span class="meta">spring.cloud.nacos.discovery.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br></pre></td></tr></table></figure><h4 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h4><blockquote><p>在启动类上添加注解</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span>  <span class="comment">// nacos注册</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EduApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a>测试</h4><blockquote><p>致命bug，springboot的版本要2.2.x才行，要不然application启动不起来</p><p><a href="http://localhost:8848/nacos">http://localhost:8848/nacos</a></p></blockquote><h3 id="Feign服务调用"><a href="#Feign服务调用" class="headerlink" title="Feign服务调用"></a>Feign服务调用</h3><blockquote><p>前提条件：将互相调用的服务在nacos注册完毕</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210927094513074.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210927094513074.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210927094513074"></p><h4 id="依赖-1"><a href="#依赖-1" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--服务调用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="添加注解"><a href="#添加注解" class="headerlink" title="添加注解"></a>添加注解</h4><blockquote><p>在需要调用服务的启动类上添加注解如下</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.atguigu&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span>  <span class="comment">// nacos注册</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span>     <span class="comment">// 使用Feign</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EduApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="创建接口"><a href="#创建接口" class="headerlink" title="创建接口"></a>创建接口</h4><blockquote><p>在调用端创建接口，使用注解指定需要调用哪一个服务，并定义调用的方法和路径</p><p>注意结构（service_edu要调用service_vod的功能）</p><p>@ Feignclient注解用于指定从哪个服务中调用功能,名称与被调用的服务名保持致。<br>@ GetMapping注解用于对被调用的微服务进行地址映射<br>@ PathVariable注解定要指定参数名称,否则出错<br>@ Component注解防止,在其他位置注入 Codclient时idea报错</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210927095233245.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210927095233245.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210927095233245"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;service-vod&quot;)</span> <span class="comment">// 调用服务（服务名），这里的服务名要和对应服务的配置文件中的spring.application.name对应</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">VodClient</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义要调用的方法的路径（注意要完全路径）</span></span><br><span class="line">    <span class="comment">// 根据id删除视频</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/eduvod/video/removeVideo/&#123;videoId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">removeVideo</span><span class="params">(<span class="meta">@PathVariable(&quot;videoId&quot;)</span> String videoId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意这里的@FeignClient(“service-vod”)，服务名不能使用下划线</p></blockquote><h4 id="实现调用（删除小节）"><a href="#实现调用（删除小节）" class="headerlink" title="实现调用（删除小节）"></a>实现调用（删除小节）</h4><blockquote><p>注入接口，调用接口方法即可</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/video&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span>    <span class="comment">// 跨域</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduVideoController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VodClient vodClient;    <span class="comment">// 注入接口调用其他服务</span></span><br><span class="line">    <span class="comment">// TODO 删除小节</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;&#123;videoId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">deleteVideo</span><span class="params">(<span class="meta">@PathVariable(&quot;videoId&quot;)</span> String videoId)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 实现调用删除阿里云视频，这里需要的是sourceID</span></span><br><span class="line">        EduVideo eduVideo = videoService.getById(videoId);</span><br><span class="line">        String videoSourceId = eduVideo.getVideoSourceId();</span><br><span class="line">        vodClient.removeVideo(videoSourceId);</span><br><span class="line">        <span class="comment">// 删除数据库视频</span></span><br><span class="line">        videoService.removeById(videoId);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>如果不成功rerun一下就行了</p></blockquote><h3 id="Hystrix熔断器"><a href="#Hystrix熔断器" class="headerlink" title="Hystrix熔断器"></a>Hystrix熔断器</h3><blockquote><p>提供延迟与容错功能</p></blockquote><h4 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ribbn负载均衡 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--hystrix依赖，主要是用  @HystrixCommand --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="调用端配置"><a href="#调用端配置" class="headerlink" title="调用端配置"></a>调用端配置</h4><blockquote><p>注意是在调用端，开启熔断器配置，也可使设置超时时间</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hytrix开启熔断机制</span></span><br><span class="line"><span class="meta">feign.hystrix.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><h4 id="创建接口对应实现类"><a href="#创建接口对应实现类" class="headerlink" title="创建接口对应实现类"></a>创建接口对应实现类</h4><blockquote><p>编写出错时的输出信息，实现FeignClient接口</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VodFileDegradeFeignClient</span> <span class="keyword">implements</span> <span class="title">VodClient</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">removeVideo</span><span class="params">(String videoId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> R.error().message(<span class="string">&quot;出错了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">deleteVideoBatch</span><span class="params">(List&lt;String&gt; videoIdList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> R.error().message(<span class="string">&quot;出错了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="接口添加属性"><a href="#接口添加属性" class="headerlink" title="接口添加属性"></a>接口添加属性</h4><blockquote><p>feignClient添加注解和属性</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fallback = &quot;实现类的class&quot;，熔断器</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;service-vod&quot;, fallback = VodFileDegradeFeignClient.class)</span></span><br><span class="line"><span class="comment">// 调用服务（服务名），这里的服务名要和对应服务的配置文件中的spring.application.name对应</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">VodClient</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="删除课程（功能完善）"><a href="#删除课程（功能完善）" class="headerlink" title="删除课程（功能完善）"></a>删除课程（功能完善）</h2><blockquote><p>删除视频，删除视频下的章节和小节</p></blockquote><h3 id="后端-3"><a href="#后端-3" class="headerlink" title="后端"></a>后端</h3><blockquote><p>video中的删除小节功能需要调用vod中的删除</p></blockquote><h4 id="VodController"><a href="#VodController" class="headerlink" title="VodController"></a>VodController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除多个阿里云视频</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;deleteVideoBatch&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">deleteVideoBatch</span><span class="params">(<span class="meta">@RequestParam(&quot;videoIdList&quot;)</span> List&lt;String&gt; videoIdList)</span> </span>&#123;</span><br><span class="line">    vodService.removeBatch(videoIdList);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="VodService"><a href="#VodService" class="headerlink" title="VodService"></a>VodService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除多个阿里云视频</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeVideoBatch</span><span class="params">(List&lt;String&gt; videoIdList)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 初始化对象</span></span><br><span class="line">        DefaultAcsClient client = InitVodClient.initVodClient(ConstantVodUtils.ACCESS_KEY_ID, ConstantVodUtils.ACCESS_KEY_SECRET);</span><br><span class="line">        <span class="comment">// 创建删除video的request对象,并设置id</span></span><br><span class="line">        DeleteVideoRequest request = <span class="keyword">new</span> DeleteVideoRequest();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将list转化成1,2,3的格式</span></span><br><span class="line">        String list = StringUtils.join(videoIdList.toArray(), <span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">        request.setVideoIds(list);</span><br><span class="line">        <span class="comment">// 调用初始化对象方法</span></span><br><span class="line">        DeleteVideoResponse acsResponse = client.getAcsResponse(request);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;删除视频失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Feign调用接口"><a href="#Feign调用接口" class="headerlink" title="Feign调用接口"></a>Feign调用接口</h4><blockquote><p>这是service_edu中的</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;service-vod&quot;)</span> <span class="comment">// 调用服务（服务名），这里的服务名要和对应服务的配置文件中的spring.application.name对应</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">VodClient</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义要调用的方法的路径（注意要完全路径）</span></span><br><span class="line">    <span class="comment">// 根据id删除视频</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/eduvod/video/removeVideo/&#123;videoId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">removeVideo</span><span class="params">(<span class="meta">@PathVariable(&quot;videoId&quot;)</span> String videoId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除多个阿里云视频</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/eduvod/video/deleteVideoBatch&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">deleteVideoBatch</span><span class="params">(<span class="meta">@RequestParam(&quot;videoIdList&quot;)</span> List&lt;String&gt; videoIdList)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="videoMapper"><a href="#videoMapper" class="headerlink" title="videoMapper"></a>videoMapper</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.atguigu.eduservice.mapper.EduVideoMapper&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getVideoIdListByCourse&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span><br><span class="line">        SELECT video_source_id</span><br><span class="line">        FROM `edu_video`</span><br><span class="line">        WHERE course_id = #&#123;courseId&#125;</span><br><span class="line">          AND video_source_id IS NOT NULL</span><br><span class="line">          AND video_source_id != &#x27;&#x27;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="videoService"><a href="#videoService" class="headerlink" title="videoService"></a>videoService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduVideoServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">EduVideoMapper</span>, <span class="title">EduVideo</span>&gt; <span class="keyword">implements</span> <span class="title">EduVideoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VodClient vodClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据课程id删除小节</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeByCourseId</span><span class="params">(String courseId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 删除该课程下的所有视频（阿里云）</span></span><br><span class="line">        List&lt;String&gt; idList = baseMapper.getVideoIdListByCourse(courseId);</span><br><span class="line">        vodClient.deleteVideoBatch(idList);</span><br><span class="line">        <span class="comment">// 删除小节（数据库）</span></span><br><span class="line">        QueryWrapper wrapper = <span class="keyword">new</span> QueryWrapper();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;course_id&quot;</span>, courseId);</span><br><span class="line">        baseMapper.delete(wrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试-3"><a href="#测试-3" class="headerlink" title="测试"></a>测试</h4><blockquote><p>OK</p></blockquote><h3 id="前端-4"><a href="#前端-4" class="headerlink" title="前端"></a>前端</h3><blockquote><p>TODO</p></blockquote><blockquote><p>注意这里有个问题，由于我确定按钮没有绑定是否能够按下的boolean值，所有在文件上传完成之前按下会没有sourceId，之后再改</p></blockquote><h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2><blockquote><p>后台还有好多TODO和完善，竟然就直接进入前台了，好吧还得靠自己</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】在线教育项目实战3</title>
      <link href="/2021/09/24/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-3/"/>
      <url>/2021/09/24/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-3/</url>
      
        <content type="html"><![CDATA[<blockquote><h2 id="课程管理模块"><a href="#课程管理模块" class="headerlink" title="课程管理模块"></a>课程管理模块</h2></blockquote><h2 id="数据库表关系"><a href="#数据库表关系" class="headerlink" title="数据库表关系"></a>数据库表关系</h2><blockquote><p>course相关表、chapter、video、teacher、subject……这些表都需要</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210924111116027.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210924111116027.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210924111116027"></p><h2 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h2><blockquote><p>熟悉的操作，run就完事了</p><p>贴一下项目结构</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210924112051971.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210924112051971.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210924112051971"></p><blockquote><p>controller记得加下跨域注释，entity记得加下自动填充注释……</p></blockquote><h2 id="添加课程信息（后端）"><a href="#添加课程信息（后端）" class="headerlink" title="添加课程信息（后端）"></a>添加课程信息（后端）</h2><h3 id="vo表单数据封装类"><a href="#vo表单数据封装类" class="headerlink" title="vo表单数据封装类"></a>vo表单数据封装类</h3><blockquote><p>需要用到表单提交数据，所以写一个vo类封装</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.eduservice.entity.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表单提交数据封装对象</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseInfoVo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程讲师ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String teacherId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程专业ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subjectId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程销售价格，设置为0则可免费观看&quot;)</span></span><br><span class="line">    <span class="comment">// 0.01</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;总课时&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer lessonNum;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程封面图片路径&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String cover;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程简介&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="编写controller"><a href="#编写controller" class="headerlink" title="编写controller"></a>编写controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/course&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span>    <span class="comment">// 跨域</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduCourseController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduCourseService courseService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加课程基本信息</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;addCourseInfo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">addCourseInfo</span><span class="params">(<span class="meta">@RequestBody</span> CourseInfoVo courseInfoVo)</span> </span>&#123;</span><br><span class="line">        courseService.saveCourseInfo(courseInfoVo);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="编写service"><a href="#编写service" class="headerlink" title="编写service"></a>编写service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduCourseServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">EduCourseMapper</span>, <span class="title">EduCourse</span>&gt; <span class="keyword">implements</span> <span class="title">EduCourseService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduCourseDescriptionService courseDescriptionService;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 添加课程基本信息</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveCourseInfo</span><span class="params">(CourseInfoVo courseInfoVo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 向课程表中添加课程基本信息</span></span><br><span class="line">        EduCourse eduCourse = <span class="keyword">new</span> EduCourse();</span><br><span class="line">        BeanUtils.copyProperties(courseInfoVo, eduCourse);</span><br><span class="line">        <span class="keyword">int</span> affectRow = baseMapper.insert(eduCourse);</span><br><span class="line">        <span class="keyword">if</span> (affectRow &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;添加课程失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 向课程简介表中添加课程简介信息</span></span><br><span class="line">        <span class="comment">// 注意baseMapper添加的是当前service对应的表,使用对应的service即可</span></span><br><span class="line">        EduCourseDescription courseDescription = <span class="keyword">new</span> EduCourseDescription();</span><br><span class="line">        courseDescription.setId(eduCourse.getId()); <span class="comment">// 这里要保证两张表id相同（1-1关系）</span></span><br><span class="line">        courseDescription.setDescription(courseInfoVo.getDescription());</span><br><span class="line">        courseDescriptionService.save(courseDescription);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>同时需要实体类中的id属性为手动输入，而不是自动生成</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduCourseDescription</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;课程ID&quot;)</span></span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.INPUT)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><blockquote><p>course和description表中id一样</p></blockquote><h2 id="添加课程信息（前端）"><a href="#添加课程信息（前端）" class="headerlink" title="添加课程信息（前端）"></a>添加课程信息（前端）</h2><h3 id="添加router"><a href="#添加router" class="headerlink" title="添加router"></a>添加router</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 课程信息管理模块路由</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/course&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: Layout,</span><br><span class="line">  <span class="attr">redirect</span>: <span class="string">&#x27;/course/list&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;课程管理&#x27;</span>,</span><br><span class="line">  <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;课程管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;example&#x27;</span> &#125;,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;课程列表&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/edu/course/list&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;课程分类列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;添加课程&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/edu/course/info&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;添加课程&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;info/:id&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;EduCourseInfoEdit&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/edu/course/info&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;编辑课程基本信息&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;,</span><br><span class="line">      <span class="comment">// 不显示该路由(隐藏路由)</span></span><br><span class="line">      <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;chapter/:id&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;EduCourseChapterEdit&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/edu/course/chapter&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;编辑课程大纲&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;,</span><br><span class="line">      <span class="comment">// 不显示该路由(隐藏路由)</span></span><br><span class="line">      <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;publish/:id&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;EduCoursePublishEdit&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/edu/course/publish&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;发布课程&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;,</span><br><span class="line">      <span class="comment">// 不显示该路由(隐藏路由)</span></span><br><span class="line">      <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="创建vue视图模板"><a href="#创建vue视图模板" class="headerlink" title="创建vue视图模板"></a>创建vue视图模板</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210924121256036.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210924121256036.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210924121256036"></p><blockquote><p> 使用element-ui的步骤条和表单即可</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;h2 style=&quot;text-align: center&quot;&gt;发布新课程&lt;/h2&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-steps</span><br><span class="line">            :active=&quot;1&quot;</span><br><span class="line">            process-status=&quot;wait&quot;</span><br><span class="line">            align-center</span><br><span class="line">            style=&quot;margin-bottom: 40px&quot;</span><br><span class="line">        &gt;</span><br><span class="line">            &lt;el-step title=&quot;填写课程基本信息&quot; /&gt;</span><br><span class="line">            &lt;el-step title=&quot;创建课程大纲&quot; /&gt;</span><br><span class="line">            &lt;el-step title=&quot;最终发布&quot; /&gt;</span><br><span class="line">        &lt;/el-steps&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form label-width=&quot;120px&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;课程标题&quot;&gt;</span><br><span class="line">                &lt;el-input</span><br><span class="line">                    v-model=&quot;courseInfo.title&quot;</span><br><span class="line">                    placeholder=&quot; 示例：机器学习项目课：从基础到搭建项目视频课程。专业名称注意大小写&quot;</span><br><span class="line">                /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 所属分类 TODO --&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;课程分类&quot;&gt;</span><br><span class="line">                &lt;el-select</span><br><span class="line">                    v-model=&quot;courseInfo.subjectParentId&quot;</span><br><span class="line">                    placeholder=&quot;一级分类&quot;</span><br><span class="line">                    @change=&quot;subjectLevelOneChanged&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                    &lt;el-option</span><br><span class="line">                        v-for=&quot;subject in subjectOneList&quot;</span><br><span class="line">                        :key=&quot;subject.id&quot;</span><br><span class="line">                        :label=&quot;subject.title&quot;</span><br><span class="line">                        :value=&quot;subject.id&quot;</span><br><span class="line">                    /&gt;</span><br><span class="line">                &lt;/el-select&gt;</span><br><span class="line"></span><br><span class="line">                &lt;!-- 二级分类 --&gt;</span><br><span class="line">                &lt;el-select</span><br><span class="line">                    v-model=&quot;courseInfo.subjectId&quot;</span><br><span class="line">                    placeholder=&quot;二级分类&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                    &lt;el-option</span><br><span class="line">                        v-for=&quot;subject in subjectTwoList&quot;</span><br><span class="line">                        :key=&quot;subject.id&quot;</span><br><span class="line">                        :label=&quot;subject.title&quot;</span><br><span class="line">                        :value=&quot;subject.id&quot;</span><br><span class="line">                    /&gt;</span><br><span class="line">                &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 课程讲师 TODO --&gt;</span><br><span class="line">            &lt;!-- 课程讲师 --&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;课程讲师&quot;&gt;</span><br><span class="line">                &lt;el-select v-model=&quot;courseInfo.teacherId&quot; placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">                    &lt;el-option</span><br><span class="line">                        v-for=&quot;teacher in teacherList&quot;</span><br><span class="line">                        :key=&quot;teacher.id&quot;</span><br><span class="line">                        :label=&quot;teacher.name&quot;</span><br><span class="line">                        :value=&quot;teacher.id&quot;</span><br><span class="line">                    /&gt;</span><br><span class="line">                &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-form-item label=&quot;总课时&quot;&gt;</span><br><span class="line">                &lt;el-input-number</span><br><span class="line">                    :min=&quot;0&quot;</span><br><span class="line">                    v-model=&quot;courseInfo.lessonNum&quot;</span><br><span class="line">                    controls-position=&quot;right&quot;</span><br><span class="line">                    placeholder=&quot;请填写课程的总课时数&quot;</span><br><span class="line">                /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 课程简介 TODO --&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;课程简介&quot;&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;courseInfo.description&quot; placeholder=&quot; &quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- 课程封面 TODO --&gt;</span><br><span class="line">            &lt;!-- 课程封面--&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;课程封面&quot;&gt;</span><br><span class="line">                &lt;el-upload</span><br><span class="line">                    :show-file-list=&quot;false&quot;</span><br><span class="line">                    :on-success=&quot;handleAvatarSuccess&quot;</span><br><span class="line">                    :before-upload=&quot;beforeAvatarUpload&quot;</span><br><span class="line">                    :action=&quot;BASE_API + &#x27;/eduoss/fileoss&#x27;&quot;</span><br><span class="line">                    class=&quot;avatar-uploader&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                    &lt;img :src=&quot;courseInfo.cover&quot; /&gt;</span><br><span class="line">                &lt;/el-upload&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-form-item label=&quot;课程价格&quot;&gt;</span><br><span class="line">                &lt;el-input-number</span><br><span class="line">                    :min=&quot;0&quot;</span><br><span class="line">                    v-model=&quot;courseInfo.price&quot;</span><br><span class="line">                    controls-position=&quot;right&quot;</span><br><span class="line">                    placeholder=&quot;免费课程请设置为0元&quot;</span><br><span class="line">                /&gt;</span><br><span class="line">                元</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-form-item&gt;</span><br><span class="line">                &lt;el-button</span><br><span class="line">                    :disabled=&quot;saveBtnDisabled&quot;</span><br><span class="line">                    type=&quot;primary&quot;</span><br><span class="line">                    @click=&quot;saveOrUpdate&quot;</span><br><span class="line">                    &gt;保存并下一步&lt;/el-button</span><br><span class="line">                &gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    // import course from &#x27;@/api/edu/course&#x27;</span><br><span class="line">    import subject from &#x27;@/api/edu/subject&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          saveBtnDisabled: false,</span><br><span class="line">          courseInfo: &#123;</span><br><span class="line">            title: &#x27;&#x27;,</span><br><span class="line">            subjectId: &#x27;&#x27;, // 二级分类id</span><br><span class="line">            subjectParentId: &#x27;&#x27;, // 一级分类id</span><br><span class="line">            teacherId: &#x27;&#x27;,</span><br><span class="line">            lessonNum: 0,</span><br><span class="line">            description: &#x27;&#x27;,</span><br><span class="line">            cover: &#x27;/static/01.jpg&#x27;,</span><br><span class="line">            price: 0</span><br><span class="line">          &#125;,</span><br><span class="line">          BASE_API: process.env.BASE_API, // 接口API地址</span><br><span class="line">          teacherList: [], // 封装所有的讲师</span><br><span class="line">          subjectOneList: [], // 一级分类</span><br><span class="line">          subjectTwoList: [] // 二级分类</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      created() &#123;&#125;,</span><br><span class="line">      methods: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h2 style=&quot;text-align: center;&quot;&gt;发布新课程&lt;/h2&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-steps :active=&quot;2&quot; process-status=&quot;wait&quot; align-center style=&quot;margin-bottom: 40px;&quot;&gt;</span><br><span class="line">      &lt;el-step title=&quot;填写课程基本信息&quot;/&gt;</span><br><span class="line">      &lt;el-step title=&quot;创建课程大纲&quot;/&gt;</span><br><span class="line">      &lt;el-step title=&quot;最终发布&quot;/&gt;</span><br><span class="line">    &lt;/el-steps&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-form label-width=&quot;120px&quot;&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-button @click=&quot;previous&quot;&gt;上一步&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button :disabled=&quot;saveBtnDisabled&quot; type=&quot;primary&quot; @click=&quot;next&quot;&gt;下一步&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            saveBtnDisabled:false</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line">        previous() &#123;</span><br><span class="line">            this.$router.push(&#123;path:&#x27;/course/info/1&#x27;&#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        next() &#123;</span><br><span class="line">            //跳转到第二步</span><br><span class="line">            this.$router.push(&#123;path:&#x27;/course/publish/1&#x27;&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;h2 style=&quot;text-align: center&quot;&gt;发布新课程&lt;/h2&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-steps</span><br><span class="line">            :active=&quot;3&quot;</span><br><span class="line">            process-status=&quot;wait&quot;</span><br><span class="line">            align-center</span><br><span class="line">            style=&quot;margin-bottom: 40px&quot;</span><br><span class="line">        &gt;</span><br><span class="line">            &lt;el-step title=&quot;填写课程基本信息&quot; /&gt;</span><br><span class="line">            &lt;el-step title=&quot;创建课程大纲&quot; /&gt;</span><br><span class="line">            &lt;el-step title=&quot;最终发布&quot; /&gt;</span><br><span class="line">        &lt;/el-steps&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-form label-width=&quot;120px&quot;&gt;</span><br><span class="line">            &lt;el-form-item&gt;</span><br><span class="line">                &lt;el-button @click=&quot;previous&quot;&gt;返回修改&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button</span><br><span class="line">                    :disabled=&quot;saveBtnDisabled&quot;</span><br><span class="line">                    type=&quot;primary&quot;</span><br><span class="line">                    @click=&quot;publish&quot;</span><br><span class="line">                    &gt;发布课程&lt;/el-button</span><br><span class="line">                &gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          saveBtnDisabled: false // 保存按钮是否禁用</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      created() &#123;</span><br><span class="line">        console.log(&#x27;publish created&#x27;)</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      methods: &#123;</span><br><span class="line">        previous() &#123;</span><br><span class="line">          console.log(&#x27;previous&#x27;)</span><br><span class="line">          this.$router.push(&#123; path: &#x27;/course/chapter/1&#x27; &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        publish() &#123;</span><br><span class="line">          console.log(&#x27;publish&#x27;)</span><br><span class="line">          this.$router.push(&#123; path: &#x27;/course/list&#x27; &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="创建课程相关接口"><a href="#创建课程相关接口" class="headerlink" title="创建课程相关接口"></a>创建课程相关接口</h3><blockquote><p>api -&gt; edu -&gt; course.js</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 新增课程信息</span></span><br><span class="line">    <span class="function"><span class="title">addCourseInfo</span>(<span class="params">courseInfo</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/course/addCourseInfo`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: courseInfo</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意这里在后端把之前的代码修改一下，返回新增课程的id，然后重启</p></blockquote><h3 id="编写按钮方法（简单编写未实现功能）"><a href="#编写按钮方法（简单编写未实现功能）" class="headerlink" title="编写按钮方法（简单编写未实现功能）"></a>编写按钮方法（简单编写未实现功能）</h3><blockquote><p>由于表单中显示课程分类和讲师还没有写，所以先简单写一下方法</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 调用后端接口传入数据</span></span><br><span class="line">  courseApi.addCourseInfo(<span class="built_in">this</span>.courseInfo).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 显示提示信息</span></span><br><span class="line">    <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;添加成功!&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 跳转到第二步，同时传递id值</span></span><br><span class="line">    <span class="built_in">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/course/chapter/&#x27;</span> + result.data.courseId &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="添加课程信息（更多完善）"><a href="#添加课程信息（更多完善）" class="headerlink" title="添加课程信息（更多完善）"></a>添加课程信息（更多完善）</h2><h3 id="显示讲师下拉列表（后端）"><a href="#显示讲师下拉列表（后端）" class="headerlink" title="显示讲师下拉列表（后端）"></a>显示讲师下拉列表（后端）</h3><blockquote><p>讲师模块写过了，不带分页查询所有讲师</p></blockquote><h3 id="显示讲师下拉列表（前端）"><a href="#显示讲师下拉列表（前端）" class="headerlink" title="显示讲师下拉列表（前端）"></a>显示讲师下拉列表（前端）</h3><blockquote><p>注意这里要现在api中创建所得所有讲师的接口（如果之前讲师模块没写的话）</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询所有讲师（不带分页）</span></span><br><span class="line">  <span class="function"><span class="title">getTeacherList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/eduservice/teacher/findAll`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><blockquote><p>下拉列表模板，使用循环的方法</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 课程讲师 TODO --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 课程讲师 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;课程讲师&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;courseInfo.teacherId&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-option</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-for</span>=<span class="string">&quot;teacher in teacherList&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:key</span>=<span class="string">&quot;teacher.id&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:label</span>=<span class="string">&quot;teacher.name&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:value</span>=<span class="string">&quot;teacher.id&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p> 然后编写vue中对应方法即可</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">getListTeacher</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  teacherApi.getTeacherList().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.teacherList = result.data.teacherList</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="显示二级联动下拉列表（前端）"><a href="#显示二级联动下拉列表（前端）" class="headerlink" title="显示二级联动下拉列表（前端）"></a>显示二级联动下拉列表（前端）</h3><blockquote><p>后端课程分类模块写好了，使用之前的即可</p></blockquote><blockquote><p>先获得并保存并初始化显示所有一级分类</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">getOneSubject</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  subjectApi.getSubjectList().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.subjectOneList = result.data.list</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><blockquote><p>实现二级联动，为一级分类下拉列表添加@change对应方法</p></blockquote><blockquote><p>注意此处el-option绑定了value值赋值为id，所以直接获取即可</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 二级联动,value为绑定的数据（:value=&quot;subject.id&quot;）</span></span><br><span class="line"><span class="function"><span class="title">subjectLevelOneChanged</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 根据id便利subjectOneList获得其children赋值给二级分类</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.subjectOneList.length; i++) &#123;</span><br><span class="line">    <span class="comment">// 判断：所有一级分类id 和 点击一级分类id是否一样</span></span><br><span class="line">    <span class="keyword">if</span> (value === <span class="built_in">this</span>.subjectOneList[i].id) &#123;</span><br><span class="line">      <span class="comment">// 从一级分类获取里面所有的二级分类</span></span><br><span class="line">      <span class="built_in">this</span>.subjectTwoList = <span class="built_in">this</span>.subjectOneList[i].children</span><br><span class="line">      <span class="comment">// 把二级分类id值清空</span></span><br><span class="line">      <span class="built_in">this</span>.courseInfo.subjectId = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><blockquote><p>测试是有一个错误，course表上添加的数据没有父分类id，看了下是我在vo对象把这个属性注释了（因为之前有null错误），记得重启</p></blockquote><h2 id="富文本编辑器"><a href="#富文本编辑器" class="headerlink" title="富文本编辑器"></a>富文本编辑器</h2><blockquote><p>直接整合，指cv</p></blockquote><h3 id="复制组件和静态资源"><a href="#复制组件和静态资源" class="headerlink" title="复制组件和静态资源"></a>复制组件和静态资源</h3><blockquote><p>字面意思</p></blockquote><h3 id="配置变量"><a href="#配置变量" class="headerlink" title="配置变量"></a>配置变量</h3><blockquote><p>再配置html变量，build -&gt; webpack.dev.conf.js 中如下添加（注意所在位置，其他不要变）</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">      <span class="string">&#x27;process.env&#x27;</span>: <span class="built_in">require</span>(<span class="string">&#x27;../config/dev.env&#x27;</span>)</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class="line">    <span class="comment">// https://github.com/ampedandwired/html-webpack-plugin</span></span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">      <span class="attr">inject</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">favicon</span>: resolve(<span class="string">&#x27;favicon.ico&#x27;</span>),</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;vue-admin-template&#x27;</span>,</span><br><span class="line">      <span class="comment">// 修改配置</span></span><br><span class="line">      <span class="attr">templateParameters</span>: &#123;</span><br><span class="line">        <span class="attr">BASE_URL</span>: config.dev.assetsPublicPath + config.dev.assetsSubDirectory</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="引入脚本文件"><a href="#引入脚本文件" class="headerlink" title="引入脚本文件"></a>引入脚本文件</h3><blockquote><p>在index.html引入脚本文件，报错是找不到BASE_URL，之前改了配置重启就行</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=&lt;%=<span class="string">BASE_URL</span> %&gt;</span>/tinymce4.7.5/tinymce.min.js &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=&lt;%=<span class="string">BASE_URL</span> %&gt;</span>/tinymce4.7.5/langs/zh_CN.js &gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="引入声明组件"><a href="#引入声明组件" class="headerlink" title="引入声明组件"></a>引入声明组件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Tinymce <span class="keyword">from</span> <span class="string">&#x27;@/components/Tinymce&#x27;</span> <span class="comment">//引入组件</span></span><br><span class="line"> <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">        <span class="comment">// 声明组件</span></span><br><span class="line">        <span class="attr">components</span>: &#123; Tinymce &#125;,</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="使用组件"><a href="#使用组件" class="headerlink" title="使用组件"></a>使用组件</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tinymce</span> <span class="attr">:height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;courseInfo.description&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>测试了一下，注意数据库中的字段属性改为longtext，要不然图片传上去后端报错<code>Data truncation: Data too long for column &#39;description&#39;</code> </p></blockquote><h2 id="显示课程章节（后端）"><a href="#显示课程章节（后端）" class="headerlink" title="显示课程章节（后端）"></a>显示课程章节（后端）</h2><h3 id="创建章节实体类"><a href="#创建章节实体类" class="headerlink" title="创建章节实体类"></a>创建章节实体类</h3><blockquote><p>类似于一级二级分类即可</p></blockquote><h3 id="编写controller-1"><a href="#编写controller-1" class="headerlink" title="编写controller"></a>编写controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/chapter&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span>    <span class="comment">// 跨域</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduChapterController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduChapterService chapterService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得课程大纲列表(根据id</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getChapterVideo/&#123;courseId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getChapterVideo</span><span class="params">(<span class="meta">@PathVariable(&quot;courseId&quot;)</span> String courseId)</span> </span>&#123;</span><br><span class="line">        List&lt;ChapterVo&gt; list = chapterService.getChapterVideoByCourseId(courseId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;chapterVideoList&quot;</span>, list);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="编写service-1"><a href="#编写service-1" class="headerlink" title="编写service"></a>编写service</h3><blockquote><p>不优雅</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduChapterServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">EduChapterMapper</span>, <span class="title">EduChapter</span>&gt; <span class="keyword">implements</span> <span class="title">EduChapterService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduVideoService videoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ChapterVo&gt; <span class="title">getChapterVideoByCourseId</span><span class="params">(String courseId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获得对应id课程的所有章节</span></span><br><span class="line">        QueryWrapper&lt;EduChapter&gt; chapterWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        chapterWrapper.eq(<span class="string">&quot;course_id&quot;</span>, courseId);</span><br><span class="line">        List&lt;EduChapter&gt; chapterList = baseMapper.selectList(chapterWrapper);</span><br><span class="line">        <span class="comment">// 获得对应id课程的所有小节</span></span><br><span class="line">        QueryWrapper&lt;EduVideo&gt; videoWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        videoWrapper.eq(<span class="string">&quot;course_id&quot;</span>, courseId);</span><br><span class="line">        List&lt;EduVideo&gt; videoList = videoService.list(videoWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 封装</span></span><br><span class="line">        List&lt;ChapterVo&gt; finalList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; chapterList.size(); i++) &#123;</span><br><span class="line">            EduChapter eduChapter = chapterList.get(i);</span><br><span class="line">            ChapterVo chapterVo = <span class="keyword">new</span> ChapterVo();</span><br><span class="line">            BeanUtils.copyProperties(eduChapter, chapterVo);</span><br><span class="line"></span><br><span class="line">            List&lt;VideoVo&gt; children = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; videoList.size(); j++) &#123;</span><br><span class="line">                EduVideo eduVideo = videoList.get(j);</span><br><span class="line">                <span class="keyword">if</span> (eduVideo.getChapterId().equals(chapterVo.getId())) &#123;</span><br><span class="line">                    VideoVo videoVo = <span class="keyword">new</span> VideoVo();</span><br><span class="line">                    BeanUtils.copyProperties(eduVideo, videoVo);</span><br><span class="line">                    children.add(videoVo);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            chapterVo.setChildren(children);</span><br><span class="line">            finalList.add(chapterVo);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> finalList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="显示课程章节（前端）"><a href="#显示课程章节（前端）" class="headerlink" title="显示课程章节（前端）"></a>显示课程章节（前端）</h2><h3 id="api"><a href="#api" class="headerlink" title="api"></a>api</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">//  获得所有以及分类</span></span><br><span class="line">    <span class="function"><span class="title">getChapterVideo</span>(<span class="params">courseId</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/chapter/getChapterVideo/<span class="subst">$&#123;courseId&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="vue视图模板和初始化"><a href="#vue视图模板和初始化" class="headerlink" title="vue视图模板和初始化"></a>vue视图模板和初始化</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;h2 style=&quot;text-align: center&quot;&gt;发布新课程&lt;/h2&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 步骤条 --&gt;</span><br><span class="line">        &lt;el-steps</span><br><span class="line">            :active=&quot;2&quot;</span><br><span class="line">            process-status=&quot;wait&quot;</span><br><span class="line">            align-center</span><br><span class="line">            style=&quot;margin-bottom: 40px&quot;</span><br><span class="line">        &gt;</span><br><span class="line">            &lt;el-step title=&quot;填写课程基本信息&quot; /&gt;</span><br><span class="line">            &lt;el-step title=&quot;创建课程大纲&quot; /&gt;</span><br><span class="line">            &lt;el-step title=&quot;最终发布&quot; /&gt;</span><br><span class="line">        &lt;/el-steps&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-button type=&quot;text&quot; @click=&quot;openChapterDialog()&quot;&gt;添加章节&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--  章节列表 --&gt;</span><br><span class="line">        &lt;ul class=&quot;chapterList&quot;&gt;</span><br><span class="line">            &lt;li v-for=&quot;chapter in chapterVideoList&quot; :key=&quot;chapter.id&quot;&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &#123;&#123; chapter.title &#125;&#125;</span><br><span class="line"></span><br><span class="line">                    &lt;span class=&quot;acts&quot;&gt;</span><br><span class="line">                        &lt;el-button</span><br><span class="line">                            style=&quot;&quot;</span><br><span class="line">                            type=&quot;text&quot;</span><br><span class="line">                            @click=&quot;openVideo(chapter.id)&quot;</span><br><span class="line">                            &gt;添加小节&lt;/el-button</span><br><span class="line">                        &gt;</span><br><span class="line">                        &lt;el-button</span><br><span class="line">                            style=&quot;&quot;</span><br><span class="line">                            type=&quot;text&quot;</span><br><span class="line">                            @click=&quot;openEditChatper(chapter.id)&quot;</span><br><span class="line">                            &gt;编辑&lt;/el-button</span><br><span class="line">                        &gt;</span><br><span class="line">                        &lt;el-button</span><br><span class="line">                            type=&quot;text&quot;</span><br><span class="line">                            @click=&quot;removeChapter(chapter.id)&quot;</span><br><span class="line">                            &gt;删除&lt;/el-button</span><br><span class="line">                        &gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">                &lt;!-- 视频 --&gt;</span><br><span class="line">                &lt;ul class=&quot;chapterList videoList&quot;&gt;</span><br><span class="line">                    &lt;li v-for=&quot;video in chapter.children&quot; :key=&quot;video.id&quot;&gt;</span><br><span class="line">                        &lt;p&gt;</span><br><span class="line">                            &#123;&#123; video.title &#125;&#125;</span><br><span class="line"></span><br><span class="line">                            &lt;span class=&quot;acts&quot;&gt;</span><br><span class="line">                                &lt;el-button style=&quot;&quot; type=&quot;text&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">                                &lt;el-button</span><br><span class="line">                                    type=&quot;text&quot;</span><br><span class="line">                                    @click=&quot;removeVideo(video.id)&quot;</span><br><span class="line">                                    &gt;删除&lt;/el-button</span><br><span class="line">                                &gt;</span><br><span class="line">                            &lt;/span&gt;</span><br><span class="line">                        &lt;/p&gt;</span><br><span class="line">                    &lt;/li&gt;</span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">        &lt;!-- 操作 --&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;el-button @click=&quot;previous&quot;&gt;上一步&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button :disabled=&quot;saveBtnDisabled&quot; type=&quot;primary&quot; @click=&quot;next&quot;</span><br><span class="line">                &gt;下一步&lt;/el-button</span><br><span class="line">            &gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import chapterApi from &#x27;@/api/edu/chapter&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          saveBtnDisabled: false,</span><br><span class="line">          courseId: &#x27;&#x27;, // 课程id</span><br><span class="line">          chapterVideoList: []</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      created() &#123;</span><br><span class="line">        // 获取到路由中的id值</span><br><span class="line">        if (this.$route.params &amp;&amp; this.$route.params.id) &#123;</span><br><span class="line">          this.courseId = this.$route.params.id</span><br><span class="line">          this.getChapterVideo()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        // 根据id查询章节和小节</span><br><span class="line">        getChapterVideo() &#123;</span><br><span class="line">          chapterApi.getChapterVideo(this.courseId).then(result =&gt; &#123;</span><br><span class="line">            this.chapterVideoList = result.data.chapterVideoList</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        previous() &#123;</span><br><span class="line">          this.$router.push(&#123; path: &#x27;/course/info/&#x27; + this.courseId &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        next() &#123;</span><br><span class="line">          // 跳转到第二步</span><br><span class="line">          this.$router.push(&#123; path: &#x27;/course/publish/&#x27; + this.courseId &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .chapterList &#123;</span><br><span class="line">        position: relative;</span><br><span class="line">        list-style: none;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">    &#125;</span><br><span class="line">    .chapterList li &#123;</span><br><span class="line">        position: relative;</span><br><span class="line">    &#125;</span><br><span class="line">    .chapterList p &#123;</span><br><span class="line">        float: left;</span><br><span class="line">        font-size: 20px;</span><br><span class="line">        margin: 10px 0;</span><br><span class="line">        padding: 10px;</span><br><span class="line">        height: 70px;</span><br><span class="line">        line-height: 50px;</span><br><span class="line">        width: 100%;</span><br><span class="line">        border: 1px solid #ddd;</span><br><span class="line">    &#125;</span><br><span class="line">    .chapterList .acts &#123;</span><br><span class="line">        float: right;</span><br><span class="line">        font-size: 14px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .videoList &#123;</span><br><span class="line">        padding-left: 50px;</span><br><span class="line">    &#125;</span><br><span class="line">    .videoList p &#123;</span><br><span class="line">        float: left;</span><br><span class="line">        font-size: 14px;</span><br><span class="line">        margin: 10px 0;</span><br><span class="line">        padding: 10px;</span><br><span class="line">        height: 50px;</span><br><span class="line">        line-height: 30px;</span><br><span class="line">        width: 100%;</span><br><span class="line">        border: 1px dotted #ddd;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h2 id="修改课程信息（后端）"><a href="#修改课程信息（后端）" class="headerlink" title="修改课程信息（后端）"></a>修改课程信息（后端）</h2><blockquote><ol><li>“上一步”回显方法：根据id查询课程基本信息</li><li>修改课程信息</li></ol></blockquote><h3 id="回显课程信息"><a href="#回显课程信息" class="headerlink" title="回显课程信息"></a>回显课程信息</h3><h4 id="编写controller-2"><a href="#编写controller-2" class="headerlink" title="编写controller"></a>编写controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据id查询基本信息</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getCourseInfo/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getCourseInfo</span><span class="params">(<span class="meta">@PathVariable</span> String courseId)</span> </span>&#123;</span><br><span class="line">    CourseInfoVo courseInfoVo = courseService.getCourseInfoById(courseId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;courseInfo&quot;</span>, courseInfoVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写service-2"><a href="#编写service-2" class="headerlink" title="编写service"></a>编写service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据id获得课程Vo</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CourseInfoVo <span class="title">getCourseInfoById</span><span class="params">(String courseId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 先查课程表</span></span><br><span class="line">    EduCourse eduCourse = baseMapper.selectById(courseId);</span><br><span class="line">    <span class="comment">// 再查课程描述表</span></span><br><span class="line">    EduCourseDescription courseDescription = courseDescriptionService.getById(courseId);</span><br><span class="line">    <span class="comment">// 封装</span></span><br><span class="line">    CourseInfoVo courseInfoVo = <span class="keyword">new</span> CourseInfoVo();</span><br><span class="line">    BeanUtils.copyProperties(eduCourse, courseInfoVo);</span><br><span class="line">    courseInfoVo.setDescription(courseDescription.getDescription());</span><br><span class="line">    <span class="keyword">return</span> courseInfoVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="修改课程信息"><a href="#修改课程信息" class="headerlink" title="修改课程信息"></a>修改课程信息</h3><h4 id="编写controller-3"><a href="#编写controller-3" class="headerlink" title="编写controller"></a>编写controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改课程信息</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;updateCourseInfo&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">updateCourseInfo</span><span class="params">(<span class="meta">@RequestBody</span> CourseInfoVo courseInfoVo)</span> </span>&#123;</span><br><span class="line">    courseService.updateCourseInfo(courseInfoVo);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写service-3"><a href="#编写service-3" class="headerlink" title="编写service"></a>编写service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改课程信息</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCourseInfo</span><span class="params">(CourseInfoVo courseInfoVo)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 修改课程表</span></span><br><span class="line">    EduCourse eduCourse = <span class="keyword">new</span> EduCourse();</span><br><span class="line">    BeanUtils.copyProperties(courseInfoVo, eduCourse);</span><br><span class="line">    <span class="keyword">int</span> affectRow = baseMapper.updateById(eduCourse);</span><br><span class="line">    <span class="keyword">if</span> (affectRow &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;修改课程失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 修改课程描述表</span></span><br><span class="line">    EduCourseDescription courseDescription = <span class="keyword">new</span> EduCourseDescription();</span><br><span class="line">    BeanUtils.copyProperties(courseInfoVo, courseDescription);</span><br><span class="line">    courseDescriptionService.updateById(courseDescription);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="修改课程信息（前端）"><a href="#修改课程信息（前端）" class="headerlink" title="修改课程信息（前端）"></a>修改课程信息（前端）</h2><h3 id="api-1"><a href="#api-1" class="headerlink" title="api"></a>api</h3><blockquote><p>src -&gt; api -&gt; edu -&gt; course.js</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据id获得课程信息</span></span><br><span class="line">   <span class="function"><span class="title">getCourseInfoById</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> request(&#123;</span><br><span class="line">           <span class="attr">url</span>: <span class="string">`/eduservice/course/getCourseInfo/`</span> + id,</span><br><span class="line">           <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">       &#125;)</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="comment">// 修改课程信息</span></span><br><span class="line">   <span class="function"><span class="title">updateCourseInfo</span>(<span class="params">courseInfo</span>)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> request(&#123;</span><br><span class="line">           <span class="attr">url</span>: <span class="string">`/eduservice/course/updateCourseInfo`</span>,</span><br><span class="line">           <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">           <span class="attr">data</span>: courseInfo</span><br><span class="line">       &#125;)</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure><h3 id="回显vue视图和方法"><a href="#回显vue视图和方法" class="headerlink" title="回显vue视图和方法"></a>回显vue视图和方法</h3><h4 id="表单回显数据"><a href="#表单回显数据" class="headerlink" title="表单回显数据"></a>表单回显数据</h4><blockquote><p>记得在跳转到info页面的按钮上添加id的值</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    import courseApi from &#x27;@/api/edu/course&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">      &#125;,</span><br><span class="line">      created() &#123;</span><br><span class="line">        // 判断是否需要数据回显</span><br><span class="line">        if (this.$route.params &amp;&amp; this.$route.params.id) &#123;</span><br><span class="line">          this.courseId = this.$route.params.id</span><br><span class="line">          this.getCourseInfo()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        // 根据id获得课程信息</span><br><span class="line">        getCourseInfo() &#123;</span><br><span class="line">          courseApi.getCourseInfoById(this.courseId).then(result =&gt; &#123;</span><br><span class="line">            this.courseInfo = result.data.courseInfo</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p>这里需要注意，返回该页面回显数据中，courseInfo的二级分类列表subjectTwoList只有在一级分类change的时候才会重新显示，否则该列表会显示绑定的courseInfo.subjectId，所以需要完善</p></blockquote><h4 id="下拉列表数据回显"><a href="#下拉列表数据回显" class="headerlink" title="下拉列表数据回显"></a>下拉列表数据回显</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">      watch: &#123;</span><br><span class="line">        // 监听路由是否发生了变化，如果是则清除当前页面的数据</span><br><span class="line">        $route(to, from) &#123;</span><br><span class="line">          if (!this.$route.params || !this.$route.params.id) &#123;</span><br><span class="line">            this.courseInfo = &#123;&#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      created() &#123;</span><br><span class="line">        // 获取路由id值</span><br><span class="line">        if (this.$route.params &amp;&amp; this.$route.params.id) &#123;</span><br><span class="line">          this.courseId = this.$route.params.id</span><br><span class="line">          // 调用根据id查询课程的方法</span><br><span class="line">          this.getCourseInfo()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          // 初始化所有讲师</span><br><span class="line">          this.getListTeacher()</span><br><span class="line">          // 初始化一级分类</span><br><span class="line">          this.getOneSubject()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        // 根据id获得课程信息</span><br><span class="line">        getCourseInfo() &#123;</span><br><span class="line">          courseApi.getCourseInfoById(this.courseId).then(response =&gt; &#123;</span><br><span class="line">            // 在courseInfo课程基本信息，包含 一级分类id 和 二级分类id</span><br><span class="line">            this.courseInfo = response.data.courseInfo</span><br><span class="line">            // 1 查询所有的分类，包含一级和二级</span><br><span class="line">            subjectApi.getSubjectList().then(response =&gt; &#123;</span><br><span class="line">              // 2 获取所有一级分类</span><br><span class="line">              this.subjectOneList = response.data.list</span><br><span class="line">              // 3 把所有的一级分类数组进行遍历，</span><br><span class="line">              for (var i = 0; i &lt; this.subjectOneList.length; i++) &#123;</span><br><span class="line">                // 获取每个一级分类</span><br><span class="line">                var oneSubject = this.subjectOneList[i]</span><br><span class="line">                // 比较当前courseInfo里面一级分类id和所有的一级分类id</span><br><span class="line">                if (this.courseInfo.subjectParentId == oneSubject.id) &#123;</span><br><span class="line">                  // 获取一级分类所有的二级分类</span><br><span class="line">                  this.subjectTwoList = oneSubject.children</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            // 初始化所有讲师</span><br><span class="line">            this.getListTeacher()</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p>测试，这里很奇怪，我把获得二级列表方法封装了出来，结构顺序都一样的但是测试的时候一开始能显示，后面又不行了，我不理解</p></blockquote><h3 id="修改vue视图和方法"><a href="#修改vue视图和方法" class="headerlink" title="修改vue视图和方法"></a>修改vue视图和方法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击下一步</span></span><br><span class="line"><span class="function"><span class="title">next</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 判断是添加还是修改</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.courseInfo.id) &#123;</span><br><span class="line">    <span class="built_in">this</span>.updateCourse()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.addCourse()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 添加course</span></span><br><span class="line"><span class="function"><span class="title">addCourse</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 调用后端接口传入数据</span></span><br><span class="line">  courseApi.addCourseInfo(<span class="built_in">this</span>.courseInfo).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 显示提示信息</span></span><br><span class="line">    <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;添加成功!&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 跳转到第二步，同时传递id值</span></span><br><span class="line">    <span class="built_in">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/course/chapter/&#x27;</span> + result.data.courseId &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 修改course</span></span><br><span class="line"><span class="function"><span class="title">updateCourse</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  courseApi.updateCourseInfo(<span class="built_in">this</span>.courseInfo).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 显示提示信息</span></span><br><span class="line">    <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,s</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;修改成功!&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 跳转到第二步，同时传递id值</span></span><br><span class="line">    <span class="built_in">this</span>.$router.push(&#123; <span class="attr">path</span>: <span class="string">&#x27;/course/chapter/&#x27;</span> + <span class="built_in">this</span>.courseId &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="增、删、改课程章节（后端）"><a href="#增、删、改课程章节（后端）" class="headerlink" title="增、删、改课程章节（后端）"></a>增、删、改课程章节（后端）</h2><h3 id="编写controller-4"><a href="#编写controller-4" class="headerlink" title="编写controller"></a>编写controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/chapter&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span>    <span class="comment">// 跨域</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduChapterController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduChapterService chapterService;</span><br><span class="line">    <span class="comment">// 根据章节id查询章节</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getChapterInfo/&#123;chapterId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getChapterInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;chapterId&quot;)</span> String chapterId)</span> </span>&#123;</span><br><span class="line">        EduChapter chapter = chapterService.getById(chapterId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;chapterInfo&quot;</span>, chapter);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加章节</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;addChapter&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">addChapter</span><span class="params">(<span class="meta">@RequestBody</span> EduChapter eduChapter)</span> </span>&#123;</span><br><span class="line">        chapterService.save(eduChapter);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 修改章节</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;updateChapter&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">updateChapter</span><span class="params">(<span class="meta">@RequestBody</span> EduChapter eduChapter)</span> </span>&#123;</span><br><span class="line">        chapterService.updateById(eduChapter);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 删除章节</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;&#123;chapterId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">deleteChapter</span><span class="params">(<span class="meta">@PathVariable(&quot;chapterId&quot;)</span> String chapterId)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 自定义方法，如果有小节则不让删</span></span><br><span class="line">        Boolean b = chapterService.deleteChapter(chapterId);</span><br><span class="line">        <span class="keyword">return</span> b ? R.ok() : R.error();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="编写service-4"><a href="#编写service-4" class="headerlink" title="编写service"></a>编写service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除章节</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">deleteChapter</span><span class="params">(String chapterId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 根据id判断是否有小节</span></span><br><span class="line">    QueryWrapper&lt;EduVideo&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;chapter_id&quot;</span>, chapterId);</span><br><span class="line">    <span class="comment">// 获得小节数</span></span><br><span class="line">    <span class="keyword">int</span> count = videoService.count(queryWrapper);</span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;含有小节无法删除&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> row = baseMapper.deleteById(chapterId);</span><br><span class="line">        <span class="keyword">return</span> row &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="增、删、改课程章节（前端）"><a href="#增、删、改课程章节（前端）" class="headerlink" title="增、删、改课程章节（前端）"></a>增、删、改课程章节（前端）</h2><h3 id="api-2"><a href="#api-2" class="headerlink" title="api"></a>api</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 添加章节</span></span><br><span class="line">    <span class="function"><span class="title">addChapter</span>(<span class="params">chapter</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/chapter/addChapter`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: chapter</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 根据id查询章节</span></span><br><span class="line">    <span class="function"><span class="title">getChapterInfo</span>(<span class="params">chapterId</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/chapter/getChapterInfo/`</span> + chapterId,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 修改章节</span></span><br><span class="line">    <span class="function"><span class="title">updateChapter</span>(<span class="params">chapter</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/chapter/updateChapter`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: chapter</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 删除章节</span></span><br><span class="line">    <span class="function"><span class="title">deleteChapter</span>(<span class="params">chapterId</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/chapter/`</span> + chapterId,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="vue视图模板"><a href="#vue视图模板" class="headerlink" title="vue视图模板"></a>vue视图模板</h3><blockquote><p>element-ui dialog cv就完事了</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;!-- 添加章节按钮 --&gt;</span><br><span class="line">        &lt;el-button type=&quot;text&quot; @click=&quot;dialogChapterFormVisible = true&quot;</span><br><span class="line">            &gt;添加章节&lt;/el-button</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;!-- 添加和修改章节表单 --&gt;</span><br><span class="line">        &lt;el-dialog :visible.sync=&quot;dialogChapterFormVisible&quot; title=&quot;添加章节&quot;&gt;</span><br><span class="line">            &lt;el-form :model=&quot;chapter&quot; label-width=&quot;120px&quot;&gt;</span><br><span class="line">                &lt;el-form-item label=&quot;章节标题&quot;&gt;</span><br><span class="line">                    &lt;el-input v-model=&quot;chapter.title&quot; /&gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line">                &lt;el-form-item label=&quot;章节排序&quot;&gt;</span><br><span class="line">                    &lt;el-input-number</span><br><span class="line">                        v-model=&quot;chapter.sort&quot;</span><br><span class="line">                        :min=&quot;0&quot;</span><br><span class="line">                        controls-position=&quot;right&quot;</span><br><span class="line">                    /&gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line">            &lt;/el-form&gt;</span><br><span class="line">            &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">                &lt;el-button @click=&quot;dialogChapterFormVisible = false&quot;</span><br><span class="line">                    &gt;取 消&lt;/el-button</span><br><span class="line">                &gt;</span><br><span class="line">                &lt;el-button type=&quot;primary&quot; @click=&quot;saveOrUpdate&quot;</span><br><span class="line">                    &gt;确 定&lt;/el-button</span><br><span class="line">                &gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/el-dialog&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import chapterApi from &#x27;@/api/edu/chapter&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          saveBtnDisabled: false,</span><br><span class="line">          courseId: &#x27;&#x27;, // 课程id</span><br><span class="line">          chapterVideoList: [],</span><br><span class="line">          chapter: &#123;</span><br><span class="line">            // 封装章节数据</span><br><span class="line">            title: &#x27;&#x27;,</span><br><span class="line">            sort: 0</span><br><span class="line">          &#125;,</span><br><span class="line">          video: &#123;</span><br><span class="line">            title: &#x27;&#x27;,</span><br><span class="line">            sort: 0,</span><br><span class="line">            free: 0,</span><br><span class="line">            videoSourceId: &#x27;&#x27;</span><br><span class="line">          &#125;,</span><br><span class="line">          dialogChapterFormVisible: false, // 章节弹框</span><br><span class="line">          dialogVideoFormVisible: false // 小节弹框</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="vue方法"><a href="#vue方法" class="headerlink" title="vue方法"></a>vue方法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">saveOrUpdate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.chapter.id) &#123;</span><br><span class="line">    <span class="built_in">this</span>.updateChapter()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.addChapter()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 添加章节</span></span><br><span class="line"><span class="function"><span class="title">addChapter</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 记得添加id</span></span><br><span class="line">  <span class="built_in">this</span>.chapter.courseId = <span class="built_in">this</span>.courseId</span><br><span class="line">  <span class="comment">// 调用api</span></span><br><span class="line">  chapterApi.addChapter(<span class="built_in">this</span>.chapter).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 关闭弹框</span></span><br><span class="line">    <span class="built_in">this</span>.dialogChapterFormVisible = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// 显示提示信息</span></span><br><span class="line">    <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;添加章节成功!&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 刷新页面</span></span><br><span class="line">    <span class="built_in">this</span>.getChapterVideo()</span><br><span class="line">    <span class="comment">// 清空弹框表单内容</span></span><br><span class="line">    <span class="built_in">this</span>.chapter = &#123; <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">sort</span>: <span class="number">0</span> &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 修改章节,显示弹框，数据回显</span></span><br><span class="line"><span class="function"><span class="title">openEditChatper</span>(<span class="params">chapterId</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 弹框</span></span><br><span class="line">  <span class="built_in">this</span>.openChapterDialog()</span><br><span class="line">  <span class="comment">// api</span></span><br><span class="line">  chapterApi.getChapterInfo(chapterId).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.chapter = result.data.chapterInfo</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 修改章节</span></span><br><span class="line"><span class="function"><span class="title">updateChapter</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 调用api</span></span><br><span class="line">  chapterApi.updateChapter(<span class="built_in">this</span>.chapter).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 关闭弹框</span></span><br><span class="line">    <span class="built_in">this</span>.dialogChapterFormVisible = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// 显示提示信息</span></span><br><span class="line">    <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;修改章节成功!&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 刷新页面</span></span><br><span class="line">    <span class="built_in">this</span>.getChapterVideo()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 删除章节</span></span><br><span class="line"><span class="function"><span class="title">removeChapter</span>(<span class="params">chapterId</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.$confirm(<span class="string">&#x27;此操作将永久删除该章节记录, 是否继续?&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">  &#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    chapterApi</span><br><span class="line">      .deleteChapter(chapterId)</span><br><span class="line">      .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 显示提示信息</span></span><br><span class="line">        <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;删除成功!&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// 刷新页面</span></span><br><span class="line">        <span class="built_in">this</span>.getChapterVideo()</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 显示提示信息</span></span><br><span class="line">        <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;删除失败!&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 弹出章节弹框</span></span><br><span class="line"><span class="function"><span class="title">openChapterDialog</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 弹框</span></span><br><span class="line">  <span class="built_in">this</span>.dialogChapterFormVisible = <span class="literal">true</span></span><br><span class="line">  <span class="comment">// 清空弹框表单内容</span></span><br><span class="line">  <span class="built_in">this</span>.chapter = &#123; <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">sort</span>: <span class="number">0</span> &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 根据id查询章节和小节</span></span><br><span class="line"><span class="function"><span class="title">getChapterVideo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  chapterApi.getChapterVideo(<span class="built_in">this</span>.courseId).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.chapterVideoList = result.data.chapterVideoList</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h2 id="增、删、改小节（后端）（待完善）"><a href="#增、删、改小节（后端）（待完善）" class="headerlink" title="增、删、改小节（后端）（待完善）"></a>增、删、改小节（后端）（待完善）</h2><blockquote><p>已完善，详见项目笔记4</p></blockquote><h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/video&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span>    <span class="comment">// 跨域</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduVideoController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduVideoService videoService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加小节</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;addVideo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">addVideo</span><span class="params">(<span class="meta">@RequestBody</span> EduVideo eduVideo)</span> </span>&#123;</span><br><span class="line">        videoService.save(eduVideo);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除小节</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;&#123;videoId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">deleteVideo</span><span class="params">(<span class="meta">@PathVariable(&quot;videoId&quot;)</span> String videoId)</span> </span>&#123;</span><br><span class="line">        videoService.removeById(videoId);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改小节</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;updateVideo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">updateVideo</span><span class="params">(<span class="meta">@RequestBody</span> EduVideo eduVideo)</span> </span>&#123;</span><br><span class="line">        videoService.updateById(eduVideo);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据小节id查询小节</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getVideoInfo/&#123;videoId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getVideoInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;videoId&quot;)</span> String videoId)</span> </span>&#123;</span><br><span class="line">        EduVideo video = videoService.getById(videoId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;videoInfo&quot;</span>, video);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="增、删、改小节（前端）（待完善）"><a href="#增、删、改小节（前端）（待完善）" class="headerlink" title="增、删、改小节（前端）（待完善）"></a>增、删、改小节（前端）（待完善）</h2><h3 id="api-3"><a href="#api-3" class="headerlink" title="api"></a>api</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 添加小节</span></span><br><span class="line">    <span class="function"><span class="title">addVideo</span>(<span class="params">video</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/video/addVideo`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: video</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 删除小节</span></span><br><span class="line">    <span class="function"><span class="title">deleteVideo</span>(<span class="params">videoId</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/video/`</span> + videoId,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 修改小节</span></span><br><span class="line">    <span class="function"><span class="title">updateVideo</span>(<span class="params">video</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/video/updateVideo`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: video</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 根据id获得小节信息</span></span><br><span class="line">    <span class="function"><span class="title">getVideoInfo</span>(<span class="params">videoId</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/video/getVideoInfo/`</span> + videoId,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="vue模板"><a href="#vue模板" class="headerlink" title="vue模板"></a>vue模板</h3><blockquote><p>和章节类似，有一个添加或者删除的弹窗</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加和修改小节表单 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;dialogVideoFormVisible&quot;</span> <span class="attr">title</span>=<span class="string">&quot;添加课时&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:model</span>=<span class="string">&quot;video&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;120px&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;课时标题&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;video.title&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;课时排序&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input-number</span></span></span><br><span class="line"><span class="tag">                <span class="attr">v-model</span>=<span class="string">&quot;video.sort&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:min</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">controls-position</span>=<span class="string">&quot;right&quot;</span></span></span><br><span class="line"><span class="tag">            /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;是否免费&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-radio-group</span> <span class="attr">v-model</span>=<span class="string">&quot;video.free&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-radio</span> <span class="attr">:label</span>=<span class="string">&quot;true&quot;</span>&gt;</span>免费<span class="tag">&lt;/<span class="name">el-radio</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-radio</span> <span class="attr">:label</span>=<span class="string">&quot;false&quot;</span>&gt;</span>默认<span class="tag">&lt;/<span class="name">el-radio</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-radio-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;上传视频&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- TODO --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;dialogVideoFormVisible = false&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span>取 消&lt;/el-button</span><br><span class="line">        &gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:disabled</span>=<span class="string">&quot;saveVideoBtnDisabled&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">click</span>=<span class="string">&quot;saveOrUpdateVideo&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span>确 定&lt;/el-button</span><br><span class="line">        &gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="vue方法-1"><a href="#vue方法-1" class="headerlink" title="vue方法"></a>vue方法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line"><span class="comment">// ++++++++++++++++++小节操作+++++++++++++++++++++</span></span><br><span class="line"><span class="comment">// 打开小节编辑弹框</span></span><br><span class="line"><span class="function"><span class="title">openEditVideo</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 弹框</span></span><br><span class="line">  <span class="built_in">this</span>.dialogVideoFormVisible = <span class="literal">true</span></span><br><span class="line">  <span class="comment">// 设置章节id</span></span><br><span class="line">  <span class="built_in">this</span>.video.chapterId = id</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 添加小节</span></span><br><span class="line"><span class="function"><span class="title">addVideo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 设置课程id</span></span><br><span class="line">  <span class="built_in">this</span>.video.courseId = <span class="built_in">this</span>.courseId</span><br><span class="line">  videoApi.addVideo(<span class="built_in">this</span>.video).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 关闭弹框</span></span><br><span class="line">    <span class="built_in">this</span>.dialogVideoFormVisible = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// 提示</span></span><br><span class="line">    <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;添加小节成功!&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 刷新页面</span></span><br><span class="line">    <span class="built_in">this</span>.getChapterVideo()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 修改小节</span></span><br><span class="line"><span class="function"><span class="title">updateVideo</span>(<span class="params"></span>)</span> &#123;&#125;,</span><br><span class="line"><span class="comment">// 删除小节</span></span><br><span class="line"><span class="function"><span class="title">removeVideo</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.$confirm(<span class="string">&#x27;此操作将删除小节, 是否继续?&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">  &#125;).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 点击确定，执行then方法</span></span><br><span class="line">    <span class="comment">// 调用删除的方法</span></span><br><span class="line">    videoApi.deleteVideo(id).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 删除成功</span></span><br><span class="line">      <span class="comment">// 提示信息</span></span><br><span class="line">      <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;删除小节成功!&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// 刷新页面</span></span><br><span class="line">      <span class="built_in">this</span>.getChapterVideo()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;) <span class="comment">// 点击取消，执行catch方法</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="function"><span class="title">saveOrUpdateVideo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 先写add，学了视频上传在修改</span></span><br><span class="line">  <span class="built_in">this</span>.addVideo()</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// ++++++++++++++++++小节操作+++++++++++++++++++++</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】在线教育项目实战2</title>
      <link href="/2021/09/21/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-2/"/>
      <url>/2021/09/21/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-2/</url>
      
        <content type="html"><![CDATA[<h2 id="前端技术点简单介绍"><a href="#前端技术点简单介绍" class="headerlink" title="前端技术点简单介绍"></a>前端技术点简单介绍</h2><blockquote><p>一下技术点详见其官方文档或者课件，我就瞄了几眼，之前多多少少也学过了 </p><ol><li>ES6</li><li>Vue</li><li>axios</li><li>node.js</li><li>babel</li><li>模块化</li><li>webpack</li></ol></blockquote><h2 id="搭建前端环境与框架开发过程"><a href="#搭建前端环境与框架开发过程" class="headerlink" title="搭建前端环境与框架开发过程"></a>搭建前端环境与框架开发过程</h2><h3 id="vscode创建工作区"><a href="#vscode创建工作区" class="headerlink" title="vscode创建工作区"></a>vscode创建工作区</h3><blockquote><ol><li>新建一个空文件夹</li><li>用VSCode打开该文件夹</li><li>选择菜单栏 <code>文件 -&gt; 将文件夹另存为工作区</code> 即可</li></ol></blockquote><h3 id="测试运行npm"><a href="#测试运行npm" class="headerlink" title="测试运行npm"></a>测试运行npm</h3><blockquote><ol><li>复制template文件夹至工作区</li><li>安装依赖<code>npm install</code></li><li><code>npm run dev</code>测试</li><li><code>config -&gt; index.js -&gt; useEslint = false</code>关闭代码检查</li></ol></blockquote><h3 id="vue项目实现"><a href="#vue项目实现" class="headerlink" title="vue项目实现"></a>vue项目实现</h3><blockquote><ol><li>src -&gt; router -&gt; index.js 添加路由</li><li>views -&gt; xxx -&gt; xxx.vue 创建vue页面</li><li>api -&gt; xxx.js 定义接口地址和参数</li><li>在vue页面引入js文件，调用方法实现功能</li></ol></blockquote><h2 id="用户登录和跨域（后端-前端）"><a href="#用户登录和跨域（后端-前端）" class="headerlink" title="用户登录和跨域（后端+前端）"></a>用户登录和跨域（后端+前端）</h2><h3 id="修改BASE-API（请求路径前缀）"><a href="#修改BASE-API（请求路径前缀）" class="headerlink" title="修改BASE_API（请求路径前缀）"></a>修改BASE_API（请求路径前缀）</h3><blockquote><p>config -&gt; dev.env.js文件</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = merge(prodEnv, &#123;</span><br><span class="line">  <span class="attr">NODE_ENV</span>: <span class="string">&#x27;&quot;development&quot;&#x27;</span>,</span><br><span class="line">  <span class="comment">// BASE_API: &#x27;&quot;https://easy-mock.com/mock/5950a2419adc231f356a6636/vue-admin&quot;&#x27;,</span></span><br><span class="line">  <span class="comment">// 注意这里要使用http</span></span><br><span class="line">  <span class="attr">BASE_API</span>: <span class="string">&#x27;&quot;http://localhost:8001&quot;&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="编写loginController"><a href="#编写loginController" class="headerlink" title="编写loginController"></a>编写loginController</h3><blockquote><p>先跳过数据库验证</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.eduservice.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.commonutils.R;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api(&quot;后台登录&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/user&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span>    <span class="comment">// 解决跨域问题</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduLoginController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 先跳过验证</span></span><br><span class="line">        <span class="comment">// 此处token需要与前端对应</span></span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;token&quot;</span>, <span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得用户数据</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;info&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">info</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;roles&quot;</span>, <span class="string">&quot;[admin]&quot;</span>).data(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;admin&quot;</span>).data(<span class="string">&quot;avatar&quot;</span>, <span class="string">&quot;https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="修改前端访问路径"><a href="#修改前端访问路径" class="headerlink" title="修改前端访问路径"></a>修改前端访问路径</h3><blockquote><p>修改api文件夹下的login.js里的接口路径即可</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">username, password</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/eduservice/user/login&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      username,</span><br><span class="line">      password</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params">token</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/eduservice/user/info&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: &#123; token &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="跨域问题"><a href="#跨域问题" class="headerlink" title="跨域问题"></a>跨域问题</h2><blockquote><p>访问地址的时候，以下任何一个地方不同，会产生跨域问题：</p><ol><li>访问协议</li><li>IP地址</li><li>端口号</li></ol></blockquote><blockquote><ol><li>在后端controller接口上添加注解@CrossOrigin即可（常用）</li><li>使用网关解决</li></ol></blockquote><h2 id="讲师管理模块（前端）"><a href="#讲师管理模块（前端）" class="headerlink" title="讲师管理模块（前端）"></a>讲师管理模块（前端）</h2><h3 id="讲师列表"><a href="#讲师列表" class="headerlink" title="讲师列表"></a>讲师列表</h3><h4 id="添加路由"><a href="#添加路由" class="headerlink" title="添加路由"></a>添加路由</h4><blockquote><p>src\router\index.js  -&gt;  constantRouterMap  -&gt;  children  -&gt;  component</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> constantRouterMap = [</span><br><span class="line">    <span class="comment">// ……</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/teacher&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: Layout,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/teacher/table&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;讲师管理&#x27;</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;讲师管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;example&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;讲师列表&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/edu/teacher/list&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;讲师列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;save&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;添加讲师&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/edu/teacher/save&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;添加讲师&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">    <span class="comment">// ……</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="创建并编写js文件（调用接口）"><a href="#创建并编写js文件（调用接口）" class="headerlink" title="创建并编写js文件（调用接口）"></a>创建并编写js文件（调用接口）</h4><blockquote><p>src\api\edu\teacher.js</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询讲师列表（带条件分页）</span></span><br><span class="line">    <span class="function"><span class="title">getTeacherListPage</span>(<span class="params">current, limit, teacherQuery</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="comment">// url可使用字符串拼接，但是最好用反引号</span></span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/teacher/pageTeacherCondition/<span class="subst">$&#123;current&#125;</span>/<span class="subst">$&#123;limit&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="comment">// 后端使用requestBody获取teacherQuery，此时需要用data（将teacherQuery转换为JSON格式传输）</span></span><br><span class="line">            <span class="attr">data</span>: teacherQuery</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="创建vue页面，通过接口获取数据"><a href="#创建vue页面，通过接口获取数据" class="headerlink" title="创建vue页面，通过接口获取数据"></a>创建vue页面，通过接口获取数据</h4><blockquote><p>注意routerMap中的对应对象（即创建的router）中component对应的地址，就是vue组件的地址，在该地址下创建vue文件</p><p>src\views\edu\teacher\list.vue</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;讲师列表&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    // 引入调用接口的js文件</span><br><span class="line">    import teacher from &quot;@/api/edu/teacher.js&quot;;</span><br><span class="line"></span><br><span class="line">    export default &#123;</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                list: null, // 查询接口之后获得的列表</span><br><span class="line">                page: 1, // 当前页</span><br><span class="line">                limit: 10, // 每页记录数</span><br><span class="line">                total: 0, // 总记录数</span><br><span class="line">                teacherQuery: &#123;&#125;, // 条件值对象</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        created() &#123;</span><br><span class="line">            this.getList();</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            // 获得讲师列表</span><br><span class="line">            getList() &#123;</span><br><span class="line">                teacher</span><br><span class="line">                    .getTeacherListPage(this.page, this.limit, this.teacherQuery)</span><br><span class="line">                    .then((response) =&gt; &#123;</span><br><span class="line">                        // console.log(response);</span><br><span class="line">                        this.list = response.data.records;</span><br><span class="line">                        this.total = response.data.total;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .catch((error) =&gt; &#123;</span><br><span class="line">                        console.log(error);</span><br><span class="line">                    &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="编写列表格式代码"><a href="#编写列表格式代码" class="headerlink" title="编写列表格式代码"></a>编写列表格式代码</h4><blockquote><p>使用element-ui表格即可</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;!-- 表格 --&gt;</span><br><span class="line">        &lt;el-table :data=&quot;list&quot; border fit highlight-current-row&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;序号&quot; width=&quot;70&quot; header-align=&quot;center&quot;&gt;</span><br><span class="line">                &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">                    &#123;&#123; (page - 1) * limit + scope.$index + 1 &#125;&#125;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-table-column prop=&quot;name&quot; label=&quot;名称&quot; width=&quot;80&quot; header-align=&quot;center&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-table-column label=&quot;头衔&quot; width=&quot;80&quot; header-align=&quot;center&quot;&gt;</span><br><span class="line">                &lt;!-- 使用template slot-scope 进行判断显示 --&gt;</span><br><span class="line">                &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">                    &#123;&#123; scope.row.level === 1 ? &quot;高级讲师&quot; : &quot;首席讲师&quot; &#125;&#125;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-table-column prop=&quot;intro&quot; label=&quot;资历&quot; header-align=&quot;center&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-table-column prop=&quot;gmtCreate&quot; label=&quot;添加时间&quot; width=&quot;160&quot; header-align=&quot;center&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-table-column prop=&quot;sort&quot; label=&quot;排序&quot; width=&quot;60&quot; header-align=&quot;center&quot;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-table-column label=&quot;操作&quot; width=&quot;200&quot; align=&quot;center&quot;&gt;</span><br><span class="line">                &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;router-link :to=&quot;&#x27;/teacher/edit/&#x27; + scope.row.id&quot;&gt;</span><br><span class="line">                        &lt;el-button</span><br><span class="line">                            type=&quot;primary&quot;</span><br><span class="line">                            size=&quot;mini&quot;</span><br><span class="line">                            icon=&quot;el-icon-edit&quot;</span><br><span class="line">                            &gt;修改&lt;/el-button</span><br><span class="line">                        &gt;</span><br><span class="line">                    &lt;/router-link&gt;</span><br><span class="line">                    &lt;el-button</span><br><span class="line">                        type=&quot;danger&quot;</span><br><span class="line">                        size=&quot;mini&quot;</span><br><span class="line">                        icon=&quot;el-icon-delete&quot;</span><br><span class="line">                        @click=&quot;removeDataById(scope.row.id)&quot;</span><br><span class="line">                        &gt;删除&lt;/el-button</span><br><span class="line">                    &gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="添加分页条"><a href="#添加分页条" class="headerlink" title="添加分页条"></a>添加分页条</h4><blockquote><p>使用element-ui分页即可</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;!-- 表格 --&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 分页条 --&gt;</span><br><span class="line">        &lt;!--  @current-change=&quot;getList&quot; 只需要写方法名即可，自动传入需要跳转的页数 --&gt;</span><br><span class="line">        &lt;el-pagination</span><br><span class="line">            :current-page=&quot;page&quot;</span><br><span class="line">            :page-size=&quot;limit&quot;</span><br><span class="line">            :total=&quot;total&quot;</span><br><span class="line">            style=&quot;padding: 30px 0; text-align: center&quot;</span><br><span class="line">            layout=&quot;total, prev, pager, next, jumper&quot;</span><br><span class="line">            @current-change=&quot;getList&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    // 引入调用接口的js文件</span><br><span class="line">    import teacher from &quot;@/api/edu/teacher.js&quot;;</span><br><span class="line"></span><br><span class="line">    export default &#123;</span><br><span class="line">// ……</span><br><span class="line">        methods: &#123;</span><br><span class="line">            // 获得讲师列表，page默认为1</span><br><span class="line">            getList(page = 1) &#123;</span><br><span class="line">                this.page = page;</span><br><span class="line">                teacher</span><br><span class="line">                    .getTeacherListPage(this.page, this.limit, this.teacherQuery)</span><br><span class="line">                    .then((response) =&gt; &#123;</span><br><span class="line">                        // console.log(response);</span><br><span class="line">                        this.list = response.data.records;</span><br><span class="line">                        this.total = response.data.total;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .catch((error) =&gt; &#123;</span><br><span class="line">                        console.log(error);</span><br><span class="line">                    &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="条件查询分页"><a href="#条件查询分页" class="headerlink" title="条件查询分页"></a>条件查询分页</h4><blockquote><p>使用element-ui表单即可</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;!--查询表单--&gt;</span><br><span class="line">        &lt;el-form :inline=&quot;true&quot; class=&quot;demo-form-inline&quot;&gt;</span><br><span class="line">            &lt;el-form-item&gt;</span><br><span class="line">                &lt;el-input v-model=&quot;teacherQuery.name&quot; placeholder=&quot;讲师名&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-form-item&gt;</span><br><span class="line">                &lt;el-select</span><br><span class="line">                    v-model=&quot;teacherQuery.level&quot;</span><br><span class="line">                    clearable</span><br><span class="line">                    placeholder=&quot;讲师头衔&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                    &lt;el-option :value=&quot;1&quot; label=&quot;高级讲师&quot; /&gt;</span><br><span class="line">                    &lt;el-option :value=&quot;2&quot; label=&quot;首席讲师&quot; /&gt;</span><br><span class="line">                &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-form-item label=&quot;添加时间&quot;&gt;</span><br><span class="line">                &lt;el-date-picker</span><br><span class="line">                    v-model=&quot;teacherQuery.begin&quot;</span><br><span class="line">                    type=&quot;datetime&quot;</span><br><span class="line">                    placeholder=&quot;选择开始时间&quot;</span><br><span class="line">                    value-format=&quot;yyyy-MM-dd HH:mm:ss&quot;</span><br><span class="line">                    default-time=&quot;00:00:00&quot;</span><br><span class="line">                /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item&gt;</span><br><span class="line">                &lt;el-date-picker</span><br><span class="line">                    v-model=&quot;teacherQuery.end&quot;</span><br><span class="line">                    type=&quot;datetime&quot;</span><br><span class="line">                    placeholder=&quot;选择截止时间&quot;</span><br><span class="line">                    value-format=&quot;yyyy-MM-dd HH:mm:ss&quot;</span><br><span class="line">                    default-time=&quot;00:00:00&quot;</span><br><span class="line">                /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-button type=&quot;primary&quot; icon=&quot;el-icon-search&quot; @click=&quot;getList()&quot;</span><br><span class="line">                &gt;查询&lt;/el-button</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;el-button type=&quot;default&quot; @click=&quot;resetData()&quot;&gt;清空&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-form&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    // 引入调用接口的js文件</span><br><span class="line">    import teacher from &quot;@/api/edu/teacher.js&quot;;</span><br><span class="line"></span><br><span class="line">    export default &#123;</span><br><span class="line">        methods: &#123;</span><br><span class="line">            // 获得讲师列表，page默认为1</span><br><span class="line">            getList(page = 1) &#123;</span><br><span class="line">            &#125;,</span><br><span class="line">            //清空表单输入项数据</span><br><span class="line">            resetData() &#123;</span><br><span class="line">                this.teacherQuery = &#123;&#125;;</span><br><span class="line">                //查询所有讲师数据</span><br><span class="line">                this.getList();</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="删除讲师"><a href="#删除讲师" class="headerlink" title="删除讲师"></a>删除讲师</h3><h4 id="添加页面结构按钮"><a href="#添加页面结构按钮" class="headerlink" title="添加页面结构按钮"></a>添加页面结构按钮</h4><blockquote><p>记得绑定对应方法名</p><p>slot插槽，<a href="https://www.cnblogs.com/500m/p/11597377.html">Vue - slot-scope=”scope” 的意义 - 武卡卡 - 博客园 (cnblogs.com)</a></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table-column label=&quot;操作&quot; width=&quot;200&quot; align=&quot;center&quot;&gt;</span><br><span class="line">    &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;router-link :to=&quot;&#x27;/teacher/edit/&#x27; + scope.row.id&quot;&gt;</span><br><span class="line">            &lt;el-button</span><br><span class="line">                type=&quot;primary&quot;</span><br><span class="line">                size=&quot;mini&quot;</span><br><span class="line">                icon=&quot;el-icon-edit&quot;</span><br><span class="line">                &gt;修改&lt;/el-button</span><br><span class="line">            &gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">            type=&quot;danger&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            icon=&quot;el-icon-delete&quot;</span><br><span class="line">            @click=&quot;removeDataById(scope.row.id)&quot;</span><br><span class="line">            &gt;删除&lt;/el-button</span><br><span class="line">        &gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">&lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure><h4 id="编写接口调用方法"><a href="#编写接口调用方法" class="headerlink" title="编写接口调用方法"></a>编写接口调用方法</h4><blockquote><p>先去api文件夹下编写调用接口的方法 teacher.js</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id删除讲师</span></span><br><span class="line">    <span class="function"><span class="title">deleteTeacherById</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/teacher/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写按钮对应方法"><a href="#编写按钮对应方法" class="headerlink" title="编写按钮对应方法"></a>编写按钮对应方法</h4><blockquote><p>编写按钮对应方法，考虑到用户体验，添加element-ui弹框提示</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">removeDataById</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.$confirm(<span class="string">&#x27;此操作将永久删除该讲师记录, 是否继续?&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 调用删除接口</span></span><br><span class="line">      teacher</span><br><span class="line">        .deleteTeacherById(id)</span><br><span class="line">        .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 显示提示信息</span></span><br><span class="line">          <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;删除成功!&#x27;</span></span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="comment">// 刷新列表信息</span></span><br><span class="line">          <span class="comment">// 如果是最后一页最后一个记录（total-(page-1)*limit == 1）</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">this</span>.total - (<span class="built_in">this</span>.page - <span class="number">1</span>) * <span class="built_in">this</span>.limit == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.getList(<span class="built_in">this</span>.page - <span class="number">1</span>)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.getList(<span class="built_in">this</span>.page)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;已取消删除&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="当前项目结构"><a href="#当前项目结构" class="headerlink" title="当前项目结构"></a>当前项目结构</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210922181723945.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210922181723945.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210922181723945"></p><h3 id="添加讲师"><a href="#添加讲师" class="headerlink" title="添加讲师"></a>添加讲师</h3><h4 id="添加页面结构"><a href="#添加页面结构" class="headerlink" title="添加页面结构"></a>添加页面结构</h4><blockquote><p>src\views\edu\teacher\save.vue</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">            &lt;el-form label-width=&quot;120px&quot;&gt;</span><br><span class="line">                &lt;el-form-item label=&quot;讲师名称&quot;&gt;</span><br><span class="line">                    &lt;el-input v-model=&quot;teacher.name&quot; /&gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line">                &lt;el-form-item label=&quot;讲师排序&quot;&gt;</span><br><span class="line">                    &lt;el-input-number</span><br><span class="line">                        v-model=&quot;teacher.sort&quot;</span><br><span class="line">                        controls-position=&quot;right&quot;</span><br><span class="line">                        min=&quot;0&quot;</span><br><span class="line">                    /&gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line">                &lt;el-form-item label=&quot;讲师头衔&quot;&gt;</span><br><span class="line">                    &lt;el-select</span><br><span class="line">                        v-model=&quot;teacher.level&quot;</span><br><span class="line">                        clearable</span><br><span class="line">                        placeholder=&quot;请选择&quot;</span><br><span class="line">                    &gt;</span><br><span class="line">                        &lt;el-option :value=&quot;1&quot; label=&quot;高级讲师&quot; /&gt;</span><br><span class="line">                        &lt;el-option :value=&quot;2&quot; label=&quot;首席讲师&quot; /&gt;</span><br><span class="line">                    &lt;/el-select&gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line">                &lt;el-form-item label=&quot;讲师资历&quot;&gt;</span><br><span class="line">                    &lt;el-input v-model=&quot;teacher.career&quot; /&gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line">                &lt;el-form-item label=&quot;讲师简介&quot;&gt;</span><br><span class="line">                    &lt;el-input</span><br><span class="line">                        v-model=&quot;teacher.intro&quot;</span><br><span class="line">                        :rows=&quot;10&quot;</span><br><span class="line">                        type=&quot;textarea&quot;</span><br><span class="line">                    /&gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">                &lt;!-- 讲师头像：TODO --&gt;</span><br><span class="line">                &lt;el-form-item&gt;</span><br><span class="line">                    &lt;el-button</span><br><span class="line">                        :disabled=&quot;saveBtnDisabled&quot;</span><br><span class="line">                        type=&quot;primary&quot;</span><br><span class="line">                        @click=&quot;saveOrUpdate&quot;</span><br><span class="line">                        &gt;保存&lt;/el-button</span><br><span class="line">                    &gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line">            &lt;/el-form&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    // 引入调用接口的js文件</span><br><span class="line">    import teacherApi from &#x27;@/api/edu/teacher.js&#x27;</span><br><span class="line"></span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          teacher: &#123;</span><br><span class="line">            name: &#x27;&#x27;,</span><br><span class="line">            sort: 0,</span><br><span class="line">            level: 1,</span><br><span class="line">            career: &#x27;&#x27;,</span><br><span class="line">            intro: &#x27;&#x27;,</span><br><span class="line">            avatar: &#x27;&#x27;</span><br><span class="line">          &#125;,</span><br><span class="line">          saveBtnDisabled: false</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      created() &#123;&#125;,</span><br><span class="line">      methods: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="编写接口调用方法-1"><a href="#编写接口调用方法-1" class="headerlink" title="编写接口调用方法"></a>编写接口调用方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加讲师</span></span><br><span class="line"><span class="function"><span class="title">addTeacher</span>(<span class="params">teacher</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/eduservice/teacher/addTeacher`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: teacher</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写按钮对应方法-1"><a href="#编写按钮对应方法-1" class="headerlink" title="编写按钮对应方法"></a>编写按钮对应方法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    // 引入调用接口的js文件</span><br><span class="line">    import teacherApi from &#x27;@/api/edu/teacher.js&#x27;</span><br><span class="line"></span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          teacher: &#123;</span><br><span class="line">            name: &#x27;&#x27;,</span><br><span class="line">            sort: 0,</span><br><span class="line">            level: 1,</span><br><span class="line">            career: &#x27;&#x27;,</span><br><span class="line">            intro: &#x27;&#x27;,</span><br><span class="line">            avatar: &#x27;&#x27;</span><br><span class="line">          &#125;,</span><br><span class="line">          saveBtnDisabled: false</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      created() &#123;&#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        // 添加和修改使用同一个页面</span><br><span class="line">        saveOrUpdate() &#123;</span><br><span class="line">          this.saveTeacher()</span><br><span class="line">        &#125;,</span><br><span class="line">        saveTeacher() &#123;</span><br><span class="line">          teacherApi.addTeacher(this.teacher).then(response =&gt; &#123;</span><br><span class="line">            // 显示提示信息</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              type: &#x27;success&#x27;,</span><br><span class="line">              message: &#x27;添加成功!&#x27;</span><br><span class="line">            &#125;)</span><br><span class="line">            // 路由跳转到列表页面</span><br><span class="line">            this.$router.push(&#123; path: &#x27;/teacher/list&#x27; &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="优化讲师列表排序"><a href="#优化讲师列表排序" class="headerlink" title="优化讲师列表排序"></a>优化讲师列表排序</h4><blockquote><p>根据添加时间降序</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;多条件组合分页&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;pageTeacherCondition/&#123;current&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">pageListTeacherCondition</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">long</span> current,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="meta">@PathVariable</span> <span class="keyword">long</span> limit,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="meta">@RequestBody(required = false)</span> TeacherQuery teacherQuery)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ……</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加排序条件</span></span><br><span class="line">    wrapper.orderByDesc(<span class="string">&quot;gmt_create&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用service方法将page对象根据条件分页</span></span><br><span class="line">    teacherService.page(pageTeacher, wrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ……</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="修改讲师"><a href="#修改讲师" class="headerlink" title="修改讲师"></a>修改讲师</h3><h4 id="编写页面结构"><a href="#编写页面结构" class="headerlink" title="编写页面结构"></a>编写页面结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table-column label=&quot;操作&quot; width=&quot;200&quot; align=&quot;center&quot;&gt;</span><br><span class="line">    &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">        &lt;!-- router跳转 --&gt;</span><br><span class="line">        &lt;router-link :to=&quot;&#x27;/teacher/edit/&#x27; + scope.row.id&quot;&gt;</span><br><span class="line">            &lt;el-button</span><br><span class="line">                type=&quot;primary&quot;</span><br><span class="line">                size=&quot;mini&quot;</span><br><span class="line">                icon=&quot;el-icon-edit&quot;</span><br><span class="line">                &gt;修改&lt;/el-button</span><br><span class="line">            &gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">            type=&quot;danger&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            icon=&quot;el-icon-delete&quot;</span><br><span class="line">            @click=&quot;removeDataById(scope.row.id)&quot;</span><br><span class="line">            &gt;删除&lt;/el-button</span><br><span class="line">        &gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">&lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure><h4 id="隐藏路由"><a href="#隐藏路由" class="headerlink" title="隐藏路由"></a>隐藏路由</h4><blockquote><p>此处需要额外添加router，且不显示</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> constantRouterMap = [</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/teacher&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: Layout,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/teacher/table&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;讲师管理&#x27;</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;讲师管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;example&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;讲师列表&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/edu/teacher/list&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;讲师列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;save&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;添加讲师&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/edu/teacher/save&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;添加讲师&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 带有id参数，：为占位符</span></span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;edit/:id&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;EduTeacherEdit&#x27;</span>,</span><br><span class="line">        <span class="comment">// 此处进入的vue组件为save.vue</span></span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/edu/teacher/save&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;编辑讲师&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span> &#125;,</span><br><span class="line">        <span class="comment">// 不显示该路由</span></span><br><span class="line">        <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="数据回显"><a href="#数据回显" class="headerlink" title="数据回显"></a>数据回显</h4><blockquote><p>编写后端接口调用方法</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据id获取讲师信息</span></span><br><span class="line"><span class="function"><span class="title">getTeacherInfo</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/eduservice/teacher/getTeacher/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>编写调用该方法，注意要在需要显示该信息的组件中调用该方法</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    created() &#123;</span><br><span class="line">        // 判断当前路径是否含有id，有则为修改，否则为添加</span><br><span class="line">        if (this.$route.params &amp;&amp; this.$route.params.id) &#123;</span><br><span class="line">          // 从路径中获取参数值</span><br><span class="line">          const id = this.$route.params.id</span><br><span class="line">          this.getTeacherInfo(id)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">  // 根据id获得讲师信息</span><br><span class="line">  getTeacherInfo(id) &#123;</span><br><span class="line">    teacherApi.getTeacherInfo(id).then(response =&gt; &#123;</span><br><span class="line">      this.teacher = response.data.teacher</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="保存修改"><a href="#保存修改" class="headerlink" title="保存修改"></a>保存修改</h4><blockquote><p>编写后端接口调用方法</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改讲师信息</span></span><br><span class="line"><span class="function"><span class="title">updateTeacher</span>(<span class="params">teacher</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`/eduservice/teacher/updateTeacher`</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: teacher</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>页面调用该方法，需要判断是修改还是添加</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">      methods: &#123;</span><br><span class="line">        // 添加和修改使用同一个页面</span><br><span class="line">        saveOrUpdate() &#123;</span><br><span class="line">          // 判断是否有id</span><br><span class="line">          if (this.teacher.id) &#123;</span><br><span class="line">            this.updateTeacher()</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.saveTeacher()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        // 修改讲师信息</span><br><span class="line">        updateTeacher() &#123;</span><br><span class="line">          teacherApi.updateTeacher(this.teacher).then(response =&gt; &#123;</span><br><span class="line">            // 显示提示信息</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              type: &#x27;success&#x27;,</span><br><span class="line">              message: &#x27;修改成功!&#x27;</span><br><span class="line">            &#125;)</span><br><span class="line">            // 路由跳转到列表页面</span><br><span class="line">            this.$router.push(&#123; path: &#x27;/teacher/list&#x27; &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="路由切换存留信息问题"><a href="#路由切换存留信息问题" class="headerlink" title="路由切换存留信息问题"></a>路由切换存留信息问题</h4><blockquote><p>感谢弹幕提醒，使用监听路由的方法，可以防止当点击修改后在edit页面再次点击添加讲师，显示后的页面仍然留存讲师信息的小问题</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">      // 监听</span><br><span class="line">      watch: &#123;</span><br><span class="line">        // 监听路由是否发生了变化，如果是则清除当前页面的数据</span><br><span class="line">        $route: &#123;</span><br><span class="line">          handler: function(val, oldVal) &#123;</span><br><span class="line">            this.resetData()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        // 清空数据</span><br><span class="line">        resetData() &#123;</span><br><span class="line">           this.teacher = &#123;</span><br><span class="line">            name: &#x27;&#x27;,</span><br><span class="line">            sort: 0,</span><br><span class="line">            level: 1,</span><br><span class="line">            career: &#x27;&#x27;,</span><br><span class="line">            intro: &#x27;&#x27;,</span><br><span class="line">            avatar: &#x27;&#x27;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p>好吧原来下一集就把这个问题解决了，原因是多次跳转至同一个页面created钩子函数只会执行一次</p><p>以下是老师的方案</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">      // 监听</span><br><span class="line">      watch: &#123;</span><br><span class="line">        // 监听路由是否发生了变化，如果是则清除当前页面的数据</span><br><span class="line">        $route(to, from) &#123;</span><br><span class="line">          this.init()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      created() &#123;</span><br><span class="line">         // 这里可以不用调用初始化方法，已经设置了监听</span><br><span class="line">        this.init()</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        // 初始化</span><br><span class="line">        init() &#123;</span><br><span class="line">          // 判断当前路径是否含有id，有则为修改，否则为添加</span><br><span class="line">          if (this.$route.params &amp;&amp; this.$route.params.id) &#123;</span><br><span class="line">            // 从路径中获取参数值</span><br><span class="line">            const id = this.$route.params.id</span><br><span class="line">            this.getTeacherInfo(id)</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.teacher = &#123;</span><br><span class="line">              name: &#x27;&#x27;,</span><br><span class="line">              sort: 0,</span><br><span class="line">              level: 1,</span><br><span class="line">              career: &#x27;&#x27;,</span><br><span class="line">              intro: &#x27;&#x27;,</span><br><span class="line">              avatar: &#x27;&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><blockquote><p>反向代理服务器，功能如下：</p><ol><li>请求转发</li><li>负载均衡</li><li>动静分离</li></ol></blockquote><h3 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h3><blockquote><ol><li>启动：nginx.exe</li><li>关闭：nginx.exe -s stop</li><li>重启：nginx.exe -s reload</li></ol></blockquote><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><blockquote><p>nginx.conf文件中配置</p><ol><li>修改第一个server下的listen端口号 -&gt; 81 （最好改一下）</li><li>添加自己的server，其中listen监听的端口号要和前端config中的端口号(BASE_PATH)对应</li></ol><p>例如相当于访问9001下的xxx，就会转发到8001下的xxx或者其他</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       9001;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    location ~ /eduservice/ &#123;</span><br><span class="line">        proxy_pass http://localhost:8001;</span><br><span class="line">    &#125;</span><br><span class="line">     location ~ /eduoss/ &#123;</span><br><span class="line">        proxy_pass http://localhost:8002;</span><br><span class="line">    &#125;</span><br><span class="line">     location ~ /eduvod/ &#123;</span><br><span class="line">        proxy_pass http://localhost:8003;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>记得修改前端中的BASE_PATH和监听端口一致</p></blockquote><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><blockquote><p>application和npm都打开，前端测试一下，查看network中的header是否为nginx中的监听端口号</p></blockquote><h2 id="上传头像功能（后端-前端）"><a href="#上传头像功能（后端-前端）" class="headerlink" title="上传头像功能（后端+前端）"></a>上传头像功能（后端+前端）</h2><h3 id="阿里云OSS"><a href="#阿里云OSS" class="headerlink" title="阿里云OSS"></a>阿里云OSS</h3><blockquote><p>简单来说：解决海量数据存储与弹性扩容</p></blockquote><h4 id="简单入门"><a href="#简单入门" class="headerlink" title="简单入门"></a>简单入门</h4><blockquote><ol><li>开通就能进控制台了</li><li>创建bucket</li><li>文件管理中可以进行上传文件等操作</li><li>创建access key获得id和秘钥</li></ol></blockquote><blockquote><p>小小的吐槽：当天给我的账户里充了1rmb（巨额，确信），配置了一些OSS的东西，第二天就来了个专属客服打电话给我，向我介绍各种产品（上次刚注册的时候也给我打了电话，里面的小姐姐说话都好好听）服务太热情了！</p></blockquote><h3 id="后端阿里云OSS搭建"><a href="#后端阿里云OSS搭建" class="headerlink" title="后端阿里云OSS搭建"></a>后端阿里云OSS搭建</h3><blockquote><p>去官方文档查看详细介绍</p><p><a href="https://help.aliyun.com/document_detail/32011.html">快速入门 (aliyun.com)</a></p></blockquote><h4 id="创建对应子模块"><a href="#创建对应子模块" class="headerlink" title="创建对应子模块"></a>创建对应子模块</h4><blockquote><p>service模块 -&gt; service_oss子模块即可</p></blockquote><h4 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 阿里云oss依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 日期工具栏依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置application-properties"><a href="#配置application-properties" class="headerlink" title="配置application.properties"></a>配置application.properties</h4><blockquote><p>aliyun.oss.file后配置阿里云OSS和AccessKey相关信息</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8002</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">service-oss</span></span><br><span class="line"><span class="meta">spring.profiles.active</span>=<span class="string">dev</span></span><br><span class="line"><span class="meta">aliyun.oss.file.endpoint</span>=<span class="string">oss-cn-beijing.aliyuncs.com</span></span><br><span class="line"><span class="meta">aliyun.oss.file.keyid</span>=<span class="string"></span></span><br><span class="line"><span class="meta">aliyun.oss.file.keysecret</span>=<span class="string"></span></span><br><span class="line"><span class="meta">aliyun.oss.file.bucketname</span>=<span class="string">demo-edu-guli</span></span><br></pre></td></tr></table></figure><h4 id="创建启动类"><a href="#创建启动类" class="headerlink" title="创建启动类"></a>创建启动类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.oss;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.atguigu&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OssApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(OssApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>由于只使用上传的功能，所以不需要操作数据库，需要配置默认不加载数据库（否则会报错）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span> <span class="comment">// exclude排除这个数据源配置类</span></span><br></pre></td></tr></table></figure><h3 id="编写常量类"><a href="#编写常量类" class="headerlink" title="编写常量类"></a>编写常量类</h3><blockquote><p>用于获取配置文件中的常量</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.oss.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstantPropertiesUtils</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 读取配置文件内容</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.endpoint&#125;&quot;)</span>    <span class="comment">// 自动属性注入(注意此处属性名要与properties文件中的名字对应)</span></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.keyid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keyid;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.keysecret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keysecret;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.bucketname&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bucketname;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义公开静态常量</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String END_POINT;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESS_KEY_ID;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESS_KEY_SECRET;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String BUCKET_NAME;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当初始化properties完成后该方法会执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        END_POINT = endpoint;</span><br><span class="line">        ACCESS_KEY_ID = keyid;</span><br><span class="line">        ACCESS_KEY_SECRET = keysecret;</span><br><span class="line">        BUCKET_NAME = bucketname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="编写Controller"><a href="#编写Controller" class="headerlink" title="编写Controller"></a>编写Controller</h3><blockquote><p>实现文件获取和回传url和页面跳转</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.oss.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.commonutils.R;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.oss.service.OssService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduoss/fileoss&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span>    <span class="comment">// 解决跨域</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OssController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OssService ossService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上传头像</span></span><br><span class="line">    <span class="meta">@PostMapping()</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">uploadOssFile</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取到上传的文件(MultipartFile)</span></span><br><span class="line">        String url = ossService.uploadFileAvatar(file);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;url&quot;</span>, url);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="主要业务逻辑编写"><a href="#主要业务逻辑编写" class="headerlink" title="主要业务逻辑编写"></a>主要业务逻辑编写</h3><h4 id="编写Service实现类"><a href="#编写Service实现类" class="headerlink" title="编写Service实现类"></a>编写Service实现类</h4><blockquote><p>先创建接口和实现类，实现类中实现上传业务</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.oss.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSS;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSSClientBuilder;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.oss.service.OssService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.oss.utils.ConstantPropertiesUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OssServiceImpl</span> <span class="keyword">implements</span> <span class="title">OssService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploadFileAvatar</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 简单上传文件格式（oss文档修改即可）</span></span><br><span class="line">        String endpoint = ConstantPropertiesUtils.END_POINT;</span><br><span class="line">        String accessKeyId = ConstantPropertiesUtils.ACCESS_KEY_ID;</span><br><span class="line">        String accessKeySecret = ConstantPropertiesUtils.ACCESS_KEY_SECRET;</span><br><span class="line">        String bucketName = ConstantPropertiesUtils.BUCKET_NAME;</span><br><span class="line">        String fileName = file.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建OSSClient实例。</span></span><br><span class="line">        OSS ossClient = <span class="keyword">new</span> OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 上传文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//依次填写Bucket名称、Object完整路径（文件路径+文件名称）、文件流。Object完整路径中不能包含Bucket名称。</span></span><br><span class="line">            ossClient.putObject(bucketName, fileName, file.getInputStream());</span><br><span class="line">            <span class="comment">// 拼接oss中文件路径</span></span><br><span class="line">            String url = <span class="string">&quot;https://&quot;</span> + bucketName + <span class="string">&quot;.&quot;</span> + endpoint + <span class="string">&quot;/&quot;</span> + fileName;</span><br><span class="line">            <span class="keyword">return</span> url;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭OSSClient。</span></span><br><span class="line">            ossClient.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="完善Service"><a href="#完善Service" class="headerlink" title="完善Service"></a>完善Service</h4><blockquote><p>防止文件名重复</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为文件名添加唯一的值</span></span><br><span class="line">String uuid = UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">fileName = uuid + fileName;</span><br><span class="line"><span class="comment">// 将文件进行分类管理,按照日期分类，使用工具类</span></span><br><span class="line">String datePath = <span class="keyword">new</span> DateTime().toString(<span class="string">&quot;yyyy/MM/dd&quot;</span>);</span><br><span class="line">fileName = datePath + <span class="string">&quot;/&quot;</span> + fileName;</span><br></pre></td></tr></table></figure><h3 id="上传头像功能（前端）"><a href="#上传头像功能（前端）" class="headerlink" title="上传头像功能（前端）"></a>上传头像功能（前端）</h3><h4 id="添加页面结构-1"><a href="#添加页面结构-1" class="headerlink" title="添加页面结构"></a>添加页面结构</h4><blockquote><p>element-UI里有相关组件（ImageCropper、PanThumb），cv即可</p><p>注意要把组件复制到conponents里</p><p>注意修改image-cropper中绑定的url、filed中属性值要与后端接口方法中参数名对应</p></blockquote><blockquote><p>在添加讲师的页面添加如下标签及代码</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">            &lt;el-form label-width=&quot;120px&quot;&gt;</span><br><span class="line">                &lt;!-- 讲师头像 --&gt;</span><br><span class="line">                &lt;el-form-item label=&quot;讲师头像&quot;&gt;</span><br><span class="line">                    &lt;!-- 头衔缩略图 --&gt;</span><br><span class="line">                    &lt;pan-thumb :image=&quot;teacher.avatar&quot; /&gt;</span><br><span class="line">                    &lt;!-- 文件上传按钮 --&gt;</span><br><span class="line">                    &lt;el-button</span><br><span class="line">                        type=&quot;primary&quot;</span><br><span class="line">                        icon=&quot;el-icon-upload&quot;</span><br><span class="line">                        @click=&quot;imagecropperShow = true&quot;</span><br><span class="line">                        &gt;更换头像</span><br><span class="line">                    &lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;!--</span><br><span class="line">                      v-show：是否显示上传组件</span><br><span class="line">                      :key：类似于id，如果一个页面多个图片上传控件，可以做区分</span><br><span class="line">                      :url：后台上传的url地址</span><br><span class="line">                      @close：关闭上传组件</span><br><span class="line">                      @crop-upload-success：上传成功后的回调 </span><br><span class="line">                        &lt;input type=&quot;file&quot; name=&quot;file&quot;/&gt;</span><br><span class="line">                    --&gt;</span><br><span class="line">                    &lt;image-cropper</span><br><span class="line">                        v-show=&quot;imagecropperShow&quot;</span><br><span class="line">                        :width=&quot;300&quot;</span><br><span class="line">                        :height=&quot;300&quot;</span><br><span class="line">                        :key=&quot;imagecropperKey&quot;</span><br><span class="line">                        :url=&quot;BASE_API + &#x27;/eduoss/fileoss&#x27;&quot;</span><br><span class="line">                        field=&quot;file&quot;</span><br><span class="line">                        @close=&quot;close&quot;</span><br><span class="line">                        @crop-upload-success=&quot;cropSuccess&quot;</span><br><span class="line">                    /&gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line">            &lt;/el-form&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    // 上传头像所需组件</span><br><span class="line">    import ImageCropper from &#x27;@/components/ImageCropper&#x27;</span><br><span class="line">    import PanThumb from &#x27;@/components/PanThumb&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">      // 声明组件</span><br><span class="line">      components: &#123; ImageCropper, PanThumb &#125;,</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          // 上传弹框组件是否显示</span><br><span class="line">          imagecropperShow: false,</span><br><span class="line">          // 上传组件key值</span><br><span class="line">          imagecropperKey: 0,</span><br><span class="line">          // 获取接口API，固定写法</span><br><span class="line">          BASE_API: process.env.BASE_API</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        // 关闭上传弹框</span><br><span class="line">        close() &#123;&#125;,</span><br><span class="line">        // 上传成功</span><br><span class="line">        cropSuccess() &#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="使用组件"><a href="#使用组件" class="headerlink" title="使用组件"></a>使用组件</h4><blockquote><p>import以及声明即可</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">// 上传头像所需组件</span><br><span class="line">import ImageCropper from &#x27;@/components/ImageCropper&#x27;</span><br><span class="line">import PanThumb from &#x27;@/components/PanThumb&#x27;</span><br><span class="line"> export default &#123;</span><br><span class="line">      // 声明组件</span><br><span class="line">      components: &#123; ImageCropper, PanThumb &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="编写按钮方法"><a href="#编写按钮方法" class="headerlink" title="编写按钮方法"></a>编写按钮方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关闭上传弹框</span></span><br><span class="line"><span class="function"><span class="title">close</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.imagecropperShow = <span class="literal">false</span></span><br><span class="line">  <span class="comment">// 上传组件初始化</span></span><br><span class="line">  <span class="built_in">this</span>.imagecropperKey = <span class="built_in">this</span>.imagecropperKey + <span class="number">1</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 上传成功(获得头像url并显示)</span></span><br><span class="line"><span class="function"><span class="title">cropSuccess</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.teacher.avatar = data.url</span><br><span class="line">  <span class="built_in">this</span>.close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试，报错与解决✅"><a href="#测试，报错与解决✅" class="headerlink" title="测试，报错与解决✅"></a>测试，报错与解决✅</h4><blockquote><p>报了一个错，显示上传失败，去看network里的请求URL里的地址不对，中间多了一个undefined，想到可能变量名写错了，稍微对比了一下，BASE_API写成BASE_PATH了，改了就可以了</p></blockquote><h2 id="课程分类管理模块（后端-前端）"><a href="#课程分类管理模块（后端-前端）" class="headerlink" title="课程分类管理模块（后端+前端）"></a>课程分类管理模块（后端+前端）</h2><blockquote><p>记得先导入数据库</p><p>添加使用上传excel文件的形式</p></blockquote><h3 id="EasyExcel入门"><a href="#EasyExcel入门" class="headerlink" title="EasyExcel入门"></a>EasyExcel入门</h3><blockquote><p><a href="https://www.yuque.com/easyexcel/doc/easyexcel">EasyExcel · 语雀 (yuque.com)</a></p><p>记得引入依赖坐标，同时需要poi的，不过父模块已经引入了</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- EasyExcel依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/easyexcel --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!--以下是父模块中的相关依赖--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--xls--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="写Excel"><a href="#写Excel" class="headerlink" title="写Excel"></a>写Excel</h4><blockquote><p>先创建实体类（一级分类、二级分类）</p><p>属性需要全小写</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoData</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实体类，其中属性和Excel表格对应</span></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;学生编号&quot;)</span>  <span class="comment">// 该注释用于定义表头</span></span><br><span class="line">    <span class="keyword">private</span> Integer sno;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;学生姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String sname;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>测试代码</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestEasyExcel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 写Excel</span></span><br><span class="line">        <span class="comment">// 1、设置文件地址和名称</span></span><br><span class="line">        String filename = <span class="string">&quot;D:\\MyProject\\excel\\test.xlsx&quot;</span>;</span><br><span class="line">        <span class="comment">// 调用easyExcel方法写入, 可以设置sheet, 执行doWrite传入数据</span></span><br><span class="line">        EasyExcel.write(filename, DemoData.class).sheet(<span class="string">&quot;学生列表&quot;</span>).doWrite(getData());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;DemoData&gt; <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;DemoData&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            DemoData data = <span class="keyword">new</span> DemoData();</span><br><span class="line">            data.setSname(<span class="string">&quot;aaa&quot;</span> + i);</span><br><span class="line">            data.setSno(i);</span><br><span class="line">            list.add(data);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="读Excel"><a href="#读Excel" class="headerlink" title="读Excel"></a>读Excel</h4><blockquote><p>稍微修改一下实体类</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoData</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实体类，其中属性和Excel表格对应</span></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;学生编号&quot;, index = 0)</span>  <span class="comment">// 该注释用于定义表头</span></span><br><span class="line">    <span class="keyword">private</span> Integer sno;</span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;学生姓名&quot;, index = 1)</span>   <span class="comment">// index标记第几列，读操作需要</span></span><br><span class="line">    <span class="keyword">private</span> String sname;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>创建监听器对excel文件的读取（一行一行的读取需要）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelListener</span> <span class="keyword">extends</span> <span class="title">AnalysisEventListener</span>&lt;<span class="title">DemoData</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// 读取行数据到实体类对象中</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(DemoData demoData, AnalysisContext analysisContext)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;*****&quot;</span> + demoData + <span class="string">&quot;*****&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取完成之后执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext analysisContext)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取表头内容</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invokeHeadMap</span><span class="params">(Map&lt;Integer, String&gt; headMap, AnalysisContext context)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;表头：&quot;</span> + headMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>测试代码</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String filename = <span class="string">&quot;D:\\MyProject\\excel\\test.xlsx&quot;</span>;</span><br><span class="line">EasyExcel.read(filename, DemoData.class, <span class="keyword">new</span> ExcelListener()).sheet().doRead();</span><br></pre></td></tr></table></figure><h3 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h3><blockquote><p>先生成entity、service、mapper、controller再说</p><p>操作还是一样，详细代码见1，只需要修改表名运行即可</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一半不同模块需要修改的地方就是表名</span></span><br><span class="line">strategy.setInclude(<span class="string">&quot;edu_subject&quot;</span>); <span class="comment">//加载表</span></span><br></pre></td></tr></table></figure><blockquote><p>记得为自动生成的实体类添加自动填充（@TableField(fill = FieldFill.INSERT)等）的注解</p><p>注意controller添加注释@CrossOrigin解决跨域</p></blockquote><h3 id="添加课程分类（后端）"><a href="#添加课程分类（后端）" class="headerlink" title="添加课程分类（后端）"></a>添加课程分类（后端）</h3><h4 id="创建表格实体类"><a href="#创建表格实体类" class="headerlink" title="创建表格实体类"></a>创建表格实体类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * subject表格实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubjectData</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 0)</span></span><br><span class="line">    <span class="keyword">private</span> String oneSubjectName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 1)</span></span><br><span class="line">    <span class="keyword">private</span> String twoSubjectName;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写service"><a href="#编写service" class="headerlink" title="编写service"></a>编写service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduSubjectServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">EduSubjectMapper</span>, <span class="title">EduSubject</span>&gt; <span class="keyword">implements</span> <span class="title">EduSubjectService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSubject</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获得文件输入流</span></span><br><span class="line">            InputStream inputStream = file.getInputStream();</span><br><span class="line">            <span class="comment">// 调用方法读取</span></span><br><span class="line">            EasyExcel.read(inputStream, SubjectData.class, <span class="keyword">new</span> SubjectExcelListener()).sheet().doRead();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写监听器"><a href="#编写监听器" class="headerlink" title="编写监听器"></a>编写监听器</h4><blockquote><p>注意DataListener 不能被spring管理（官方说的），如果使用spring需要使用特定构造器</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.eduservice.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.context.AnalysisContext;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.excel.event.AnalysisEventListener;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.eduservice.entity.EduSubject;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.eduservice.entity.excel.SubjectData;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.eduservice.service.EduSubjectService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.servicebase.ExceptionHandler.GuliException;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubjectExcelListener</span> <span class="keyword">extends</span> <span class="title">AnalysisEventListener</span>&lt;<span class="title">SubjectData</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> EduSubjectService subjectService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SubjectExcelListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当new当前对象的时候同时注入service</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SubjectExcelListener</span><span class="params">(EduSubjectService subjectService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subjectService = subjectService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取excel内容，写入数据库</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(SubjectData subjectData, AnalysisContext analysisContext)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (subjectData == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;文件数据为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 添加一级分类，先判断一级分类是否已经存在</span></span><br><span class="line">        EduSubject existOneSubject = <span class="keyword">this</span>.existSubject(subjectData.getOneSubjectName(), <span class="string">&quot;0&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (existOneSubject == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 此时没有相同的一级分类，需要添加</span></span><br><span class="line">            EduSubject eduSubject = <span class="keyword">new</span> EduSubject();</span><br><span class="line">            eduSubject.setParentId(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">            eduSubject.setTitle(subjectData.getOneSubjectName());</span><br><span class="line">            subjectService.save(eduSubject);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//添加二级分类，先判断</span></span><br><span class="line">            EduSubject eduTwoSubject = <span class="keyword">this</span>.existSubject(subjectData.getTwoSubjectName(), existOneSubject.getId());</span><br><span class="line">            <span class="keyword">if</span> (eduTwoSubject == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 此时没有相同的一级分类，需要添加</span></span><br><span class="line">                EduSubject eduSubject = <span class="keyword">new</span> EduSubject();</span><br><span class="line">                eduSubject.setParentId(existOneSubject.getId());</span><br><span class="line">                eduSubject.setTitle(subjectData.getTwoSubjectName());</span><br><span class="line">                subjectService.save(eduSubject);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext analysisContext)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用于判断分类是否存在</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> EduSubject <span class="title">existSubject</span><span class="params">(String title, String pid)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 添加查询条件</span></span><br><span class="line">        QueryWrapper&lt;EduSubject&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;title&quot;</span>, title);</span><br><span class="line">        <span class="comment">// pid=0为一级分类</span></span><br><span class="line">        wrapper.eq(<span class="string">&quot;parent_id&quot;</span>, pid);</span><br><span class="line">        <span class="keyword">return</span> subjectService.getOne(wrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>同时修改一下service中方法的参数</p><p>其实这里有点奇怪，listener做了主要业务逻辑，等做完了再试试别的方法</p></blockquote><h4 id="编写controller"><a href="#编写controller" class="headerlink" title="编写controller"></a>编写controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/subject&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduSubjectController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduSubjectService subjectService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加课程分类</span></span><br><span class="line">    <span class="comment">// 获取上传过来的文件，把文件内容读取出来即可</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;addSubject&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">addSubject</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获得上传过来的excel文件</span></span><br><span class="line">        subjectService.saveSubject(file, subjectService);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试，报错与解决✅-1"><a href="#测试，报错与解决✅-1" class="headerlink" title="测试，报错与解决✅"></a>测试，报错与解决✅</h4><blockquote><p>swagger成功，后台报错，看了下说gtm_time没有默认值，然后想到自动注入可能没加，果然。</p><p>然后是能够写入数据库了但是一级写到二级去了，看了下是添加二级分类的时候的get方法成getOneSubjectName而不是getTwoSubjectName，改一下就解决了</p></blockquote><h3 id="添加课程分类（前端）"><a href="#添加课程分类（前端）" class="headerlink" title="添加课程分类（前端）"></a>添加课程分类（前端）</h3><h4 id="配置router"><a href="#配置router" class="headerlink" title="配置router"></a>配置router</h4><blockquote><p>src -&gt; router -&gt; index.js 当中添加即可</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 课程管理模块路由</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/subject&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: Layout,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/subject/list&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;课程分类管理&#x27;</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;课程分类管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;example&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;课程分类列表&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/edu/subject/list&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;课程分类列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;save&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;添加课程分类&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/edu/subject/add&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;添加课程分类&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h4 id="编写添加课程分类视图"><a href="#编写添加课程分类视图" class="headerlink" title="编写添加课程分类视图"></a>编写添加课程分类视图</h4><blockquote><p>element-ui 中 cv一下（文件上传相关）</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;el-form label-width=&quot;120px&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;信息描述&quot;&gt;</span><br><span class="line">                &lt;el-tag type=&quot;info&quot;&gt;excel模版说明&lt;/el-tag&gt;</span><br><span class="line">                &lt;el-tag&gt;</span><br><span class="line">                    &lt;i class=&quot;el-icon-download&quot; /&gt;</span><br><span class="line">                    &lt;!-- 这里模板放在了本地static文件夹里，也可以放在OSS当中 --&gt;</span><br><span class="line">                    &lt;a :href=&quot;&#x27;/static/demo.xlsx&#x27;&quot;&gt;点击下载模版&lt;/a&gt;</span><br><span class="line">                &lt;/el-tag&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;el-form-item label=&quot;选择Excel&quot;&gt;</span><br><span class="line">                &lt;el-upload</span><br><span class="line">                    ref=&quot;upload&quot;</span><br><span class="line">                    :auto-upload=&quot;false&quot;</span><br><span class="line">                    :on-success=&quot;fileUploadSuccess&quot;</span><br><span class="line">                    :on-error=&quot;fileUploadError&quot;</span><br><span class="line">                    :disabled=&quot;importBtnDisabled&quot;</span><br><span class="line">                    :limit=&quot;1&quot;</span><br><span class="line">                    :action=&quot;BASE_API + &#x27;/eduservice/subject/addSubject&#x27;&quot;</span><br><span class="line">                    name=&quot;file&quot;</span><br><span class="line">                    accept=&quot;application/vnd.ms-excel&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                    &lt;el-button slot=&quot;trigger&quot; size=&quot;small&quot; type=&quot;primary&quot;</span><br><span class="line">                        &gt;选取文件&lt;/el-button</span><br><span class="line">                    &gt;</span><br><span class="line">                    &lt;el-button</span><br><span class="line">                        :loading=&quot;loading&quot;</span><br><span class="line">                        style=&quot;margin-left: 10px&quot;</span><br><span class="line">                        size=&quot;small&quot;</span><br><span class="line">                        type=&quot;success&quot;</span><br><span class="line">                        @click=&quot;submitUpload&quot;</span><br><span class="line">                        &gt;上传到服务器&lt;/el-button</span><br><span class="line">                    &gt;</span><br><span class="line">                &lt;/el-upload&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          BASE_API: process.env.BASE_API, // 接口API地址</span><br><span class="line">          OSS_PATH: process.env.OSS_PATH,    // 阿里云OSS地址</span><br><span class="line">          importBtnDisabled: false, // 按钮是否禁用,</span><br><span class="line">          loading: false</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      created() &#123;&#125;,</span><br><span class="line">      methods: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="编写调用方法"><a href="#编写调用方法" class="headerlink" title="编写调用方法"></a>编写调用方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  <span class="comment">// 上传文件</span></span><br><span class="line">  <span class="function"><span class="title">submitUpload</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.importBtnDisabled = <span class="literal">true</span></span><br><span class="line">    <span class="built_in">this</span>.loading = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// 使用vue的提交，而不是Ajax请求</span></span><br><span class="line">    <span class="built_in">this</span>.$refs.upload.submit()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 上传成功</span></span><br><span class="line">  <span class="function"><span class="title">fileUploadSuccess</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.loading = <span class="literal">false</span></span><br><span class="line">    <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;添加课程分类成功！&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 上传失败</span></span><br><span class="line">  <span class="function"><span class="title">fileUploadError</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.loading = <span class="literal">false</span></span><br><span class="line">    <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;添加课程分类失败！&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="完善"><a href="#完善" class="headerlink" title="完善"></a>完善</h4><blockquote><ol><li>el-upload添加一个 :before-upload=”beforeUpload”，用于上传前判断文件后缀格式</li><li>上传文件时判断文件是否为空</li></ol></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;el-form label-width=&quot;120px&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;选择Excel&quot;&gt;</span><br><span class="line">                &lt;el-upload</span><br><span class="line">                    ref=&quot;upload&quot;</span><br><span class="line">                    :auto-upload=&quot;true&quot;</span><br><span class="line">                    :before-upload=&quot;beforeUpload&quot;</span><br><span class="line">                    :on-success=&quot;fileUploadSuccess&quot;</span><br><span class="line">                    :on-error=&quot;fileUploadError&quot;</span><br><span class="line">                    :disabled=&quot;importBtnDisabled&quot;</span><br><span class="line">                    :limit=&quot;1&quot;</span><br><span class="line">                    :action=&quot;BASE_API + &#x27;/eduservice/subject/addSubject&#x27;&quot;</span><br><span class="line">                    name=&quot;file&quot;</span><br><span class="line">                    accept=&quot;application.xlsx&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                    &lt;el-button slot=&quot;trigger&quot; size=&quot;small&quot; type=&quot;primary&quot;</span><br><span class="line">                        &gt;选取文件&lt;/el-button</span><br><span class="line">                    &gt;</span><br><span class="line">                    &lt;el-button</span><br><span class="line">                        :loading=&quot;loading&quot;</span><br><span class="line">                        style=&quot;margin-left: 10px&quot;</span><br><span class="line">                        size=&quot;small&quot;</span><br><span class="line">                        type=&quot;success&quot;</span><br><span class="line">                        @click=&quot;submitUpload&quot;</span><br><span class="line">                        &gt;上传到服务器&lt;/el-button</span><br><span class="line">                    &gt;</span><br><span class="line">                &lt;/el-upload&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">      methods: &#123;</span><br><span class="line">        // 上传前判断格式</span><br><span class="line">        beforeUpload() &#123;</span><br><span class="line">          const fileName = this.$refs.upload.uploadFiles[0].name</span><br><span class="line">          const suffix = fileName.substring(fileName.lastIndexOf(&#x27;.&#x27;) + 1)</span><br><span class="line">          if (suffix != &#x27;xlsx&#x27;) &#123;</span><br><span class="line">            this.fileSuffixError()</span><br><span class="line">            return false</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        // 上传文件</span><br><span class="line">        submitUpload() &#123;</span><br><span class="line">          if (this.$refs.upload.uploadFiles.length == 0) &#123;</span><br><span class="line">            this.fileUploadError()</span><br><span class="line">            return</span><br><span class="line">          &#125;</span><br><span class="line">          this.importBtnDisabled = true</span><br><span class="line">          this.loading = true</span><br><span class="line">          // 使用vue的提交，而不是Ajax请求</span><br><span class="line">          this.$refs.upload.submit()</span><br><span class="line">        &#125;,</span><br><span class="line">        // 文件格式错误失败</span><br><span class="line">        fileSuffixError() &#123;</span><br><span class="line">          this.loading = false</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &#x27;error&#x27;,</span><br><span class="line">            message: &#x27;文件格式错误！&#x27;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="课程分类列表（后端）"><a href="#课程分类列表（后端）" class="headerlink" title="课程分类列表（后端）"></a>课程分类列表（后端）</h3><h4 id="针对返回的数据创建对应实体类"><a href="#针对返回的数据创建对应实体类" class="headerlink" title="针对返回的数据创建对应实体类"></a>针对返回的数据创建对应实体类</h4><blockquote><p>一级分类、二级分类都要创建对应实体类</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一级分类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OneSubject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> List&lt;TwoSubject&gt; children = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 二级分类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TwoSubject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写controller-1"><a href="#编写controller-1" class="headerlink" title="编写controller"></a>编写controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 课程分类列表（树形）</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getAllSubjects&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getAllSubjects</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;OneSubject&gt; list = subjectService.getAllSubjects();</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;list&quot;</span>, <span class="string">&quot;list&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写service-1"><a href="#编写service-1" class="headerlink" title="编写service"></a>编写service</h4><blockquote><p>service继承的ServiceImpl已经自动注入了baseMapper</p><p>这里的代码不够优雅</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;OneSubject&gt; <span class="title">getAllSubjects</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查询所有一级分类</span></span><br><span class="line">    QueryWrapper&lt;EduSubject&gt; wrapperOne = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapperOne.eq(<span class="string">&quot;parent_id&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">    List&lt;EduSubject&gt; oneSubjectList = baseMapper.selectList(wrapperOne);</span><br><span class="line">    <span class="comment">// 查询所有二级分类</span></span><br><span class="line">    QueryWrapper&lt;EduSubject&gt; wrapperTwo = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapperTwo.ne(<span class="string">&quot;parent_id&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">    List&lt;EduSubject&gt; twoSubjectList = baseMapper.selectList(wrapperTwo);</span><br><span class="line"></span><br><span class="line">    List&lt;OneSubject&gt; finalList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; oneSubjectList.size(); i++) &#123;</span><br><span class="line">        <span class="comment">// 封装一级</span></span><br><span class="line">        EduSubject eduSubjectOne = oneSubjectList.get(i);</span><br><span class="line">        OneSubject oneSubject = <span class="keyword">new</span> OneSubject();</span><br><span class="line">        BeanUtils.copyProperties(eduSubjectOne, oneSubject);</span><br><span class="line">        finalList.add(oneSubject);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装二级分类</span></span><br><span class="line">        List&lt;TwoSubject&gt; childrenList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">//遍历二级分类list集合</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> m = <span class="number">0</span>; m &lt; twoSubjectList.size(); m++) &#123;</span><br><span class="line">            <span class="comment">//获取每个二级分类</span></span><br><span class="line">            EduSubject eduSubjectTwo = twoSubjectList.get(m);</span><br><span class="line">            <span class="comment">//判断二级分类parentid和一级分类id是否一样</span></span><br><span class="line">            <span class="keyword">if</span> (eduSubjectTwo.getParentId().equals(eduSubjectOne.getId())) &#123;</span><br><span class="line">                <span class="comment">//把tSubject值复制到TwoSubject里面，放到twoFinalSubjectList里面</span></span><br><span class="line">                TwoSubject twoSubject = <span class="keyword">new</span> TwoSubject();</span><br><span class="line">                BeanUtils.copyProperties(eduSubjectTwo, twoSubject);</span><br><span class="line">                childrenList.add(twoSubject);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//把一级下面所有二级分类放到一级分类里面</span></span><br><span class="line">        oneSubject.setChildren(childrenList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> finalList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="课程分类列表（前端）"><a href="#课程分类列表（前端）" class="headerlink" title="课程分类列表（前端）"></a>课程分类列表（前端）</h3><h4 id="树形结构模板"><a href="#树形结构模板" class="headerlink" title="树形结构模板"></a>树形结构模板</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;!-- 检索 --&gt;</span><br><span class="line">        &lt;el-input</span><br><span class="line">            v-model=&quot;filterText&quot;</span><br><span class="line">            placeholder=&quot;Filter keyword&quot;</span><br><span class="line">            style=&quot;margin-bottom: 30px&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;!-- 树形结构 --&gt;</span><br><span class="line">        &lt;el-tree</span><br><span class="line">            ref=&quot;tree2&quot;</span><br><span class="line">            :data=&quot;data2&quot;</span><br><span class="line">            :props=&quot;defaultProps&quot;</span><br><span class="line">            :filter-node-method=&quot;filterNode&quot;</span><br><span class="line">            class=&quot;filter-tree&quot;</span><br><span class="line">            default-expand-all</span><br><span class="line">        /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          filterText: &#x27;&#x27;,</span><br><span class="line">          data2: [</span><br><span class="line">            &#123;</span><br><span class="line">              id: 1,</span><br><span class="line">              label: &#x27;Level one 1&#x27;,</span><br><span class="line">              children: [</span><br><span class="line">                &#123;</span><br><span class="line">                  id: 4,</span><br><span class="line">                  label: &#x27;Level two 1-1&#x27;,</span><br><span class="line">                  children: [</span><br><span class="line">                    &#123;</span><br><span class="line">                      id: 9,</span><br><span class="line">                      label: &#x27;Level three 1-1-1&#x27;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                      id: 10,</span><br><span class="line">                      label: &#x27;Level three 1-1-2&#x27;</span><br><span class="line">                    &#125;</span><br><span class="line">                  ]</span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              id: 2,</span><br><span class="line">              label: &#x27;Level one 2&#x27;,</span><br><span class="line">              children: [</span><br><span class="line">                &#123;</span><br><span class="line">                  id: 5,</span><br><span class="line">                  label: &#x27;Level two 2-1&#x27;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                  id: 6,</span><br><span class="line">                  label: &#x27;Level two 2-2&#x27;</span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              id: 3,</span><br><span class="line">              label: &#x27;Level one 3&#x27;,</span><br><span class="line">              children: [</span><br><span class="line">                &#123;</span><br><span class="line">                  id: 7,</span><br><span class="line">                  label: &#x27;Level two 3-1&#x27;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                  id: 8,</span><br><span class="line">                  label: &#x27;Level two 3-2&#x27;</span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          defaultProps: &#123;</span><br><span class="line">            children: &#x27;children&#x27;,</span><br><span class="line">            label: &#x27;label&#x27;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      watch: &#123;</span><br><span class="line">        filterText(val) &#123;</span><br><span class="line">          this.$refs.tree2.filter(val)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      methods: &#123;</span><br><span class="line">        filterNode(value, data) &#123;</span><br><span class="line">          if (!value) return true</span><br><span class="line">          return data.label.indexOf(value) !== -1</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><blockquote><p>需要稍微修改</p></blockquote><h4 id="后端接口调用"><a href="#后端接口调用" class="headerlink" title="后端接口调用"></a>后端接口调用</h4><blockquote><p>api -&gt; edu -&gt; subject.js</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 课程分类列表</span></span><br><span class="line">    <span class="function"><span class="title">getSubjectList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">`/eduservice/subject/getAllSubjects`</span>,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>记得在vue视图中引入</p></blockquote><h4 id="vue视图和方法"><a href="#vue视图和方法" class="headerlink" title="vue视图和方法"></a>vue视图和方法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">        &lt;!-- 检索 --&gt;</span><br><span class="line">        &lt;el-input</span><br><span class="line">            v-model=&quot;filterText&quot;</span><br><span class="line">            placeholder=&quot;Filter keyword&quot;</span><br><span class="line">            style=&quot;margin-bottom: 30px&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;!-- 树形结构 --&gt;</span><br><span class="line">        &lt;el-tree</span><br><span class="line">            ref=&quot;tree2&quot;</span><br><span class="line">            :data=&quot;list&quot;</span><br><span class="line">            :props=&quot;defaultProps&quot;</span><br><span class="line">            :filter-node-method=&quot;filterNode&quot;</span><br><span class="line">            class=&quot;filter-tree&quot;</span><br><span class="line">            default-expand-all</span><br><span class="line">        /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    // 引入调用接口的js文件</span><br><span class="line">    import subjectApi from &#x27;@/api/edu/subject.js&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">      data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          // 索引文本</span><br><span class="line">          filterText: &#x27;&#x27;,</span><br><span class="line">          list: [],</span><br><span class="line">          defaultProps: &#123;</span><br><span class="line">            children: &#x27;children&#x27;,</span><br><span class="line">            label: &#x27;title&#x27;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      watch: &#123;</span><br><span class="line">        filterText(val) &#123;</span><br><span class="line">          this.$refs.tree2.filter(val)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      created() &#123;</span><br><span class="line">        this.getAllSubjectList()</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        // 获得所有subject</span><br><span class="line">        getAllSubjectList() &#123;</span><br><span class="line">          subjectApi.getSubjectList().then(result =&gt; &#123;</span><br><span class="line">            this.list = result.data.list</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        // 过滤文本（不区分大小写）</span><br><span class="line">        filterNode(value, data) &#123;</span><br><span class="line">          if (!value) return true</span><br><span class="line">          return data.title.toLowerCase().indexOf(value.toLowerCase()) !== -1</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><blockquote><p>记得开nginx</p></blockquote><h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2><blockquote><p>进度1/3</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【学习笔记】MyBatisPlus</title>
      <link href="/2021/09/20/xue-xi-bi-ji-mybatisplus/"/>
      <url>/2021/09/20/xue-xi-bi-ji-mybatisplus/</url>
      
        <content type="html"><![CDATA[<h2 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h2><p><a href="https://mp.baomidou.com/">MyBatis-Plus (baomidou.com)</a></p><h2 id="创建并初始化数据库"><a href="#创建并初始化数据库" class="headerlink" title="创建并初始化数据库"></a>创建并初始化数据库</h2><p>见课件</p><h2 id="快速创建工程"><a href="#快速创建工程" class="headerlink" title="快速创建工程"></a>快速创建工程</h2><h3 id="创建springboot工程"><a href="#创建springboot工程" class="headerlink" title="创建springboot工程"></a>创建springboot工程</h3><blockquote><p>new project -&gt; spring Initializr</p></blockquote><h3 id="mybatisplus依赖"><a href="#mybatisplus依赖" class="headerlink" title="mybatisplus依赖"></a>mybatisplus依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- velocity 模板引擎, Mybatis Plus 代码生成器需要 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="配置application-properties"><a href="#配置application-properties" class="headerlink" title="配置application.properties"></a>配置application.properties</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis_plus?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">123456789</span></span><br><span class="line"><span class="comment"># mybatis日志，可以查看更多详细信息</span></span><br><span class="line"><span class="meta">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><h3 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplus_demo.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="创建Mapepr接口"><a href="#创建Mapepr接口" class="headerlink" title="创建Mapepr接口"></a>创建Mapepr接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplus_demo.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.mybatisplus_demo.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="mapper扫描"><a href="#mapper扫描" class="headerlink" title="mapper扫描"></a>mapper扫描</h3><blockquote><p>注意这里有个易错点，mappersan内填写到Mapper文件存放的文件夹，而不是mapper文件</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.example.mybatisplus_demo.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisplusDemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MybatisplusDemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplus_demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mybatisplus_demo.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MybatisplusDemoApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    <span class="comment">// 此处如果报错，则在UserMapper接口处添加注释@Repository即可</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="当前项目结构"><a href="#当前项目结构" class="headerlink" title="当前项目结构"></a>当前项目结构</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210920125342626.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210920125342626.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210920125342626"></p><h2 id="基础CRUD接口"><a href="#基础CRUD接口" class="headerlink" title="基础CRUD接口"></a>基础CRUD接口</h2><h3 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h3><blockquote><p>不需要设置id主键的值，mybatisplus自动生成19位id</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> insert = userMapper.insert(<span class="keyword">new</span> User(<span class="keyword">null</span>, <span class="string">&quot;爱丽丝&quot;</span>, <span class="number">12</span>, <span class="string">&quot;Alice@qq.com&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;insert: &quot;</span> + insert);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="主键生成策略"><a href="#主键生成策略" class="headerlink" title="主键生成策略"></a>主键生成策略</h4><p><a href="https://www.cnblogs.com/haoxinyue/p/5208136.html">分布式系统唯一ID生成方案汇总 - nick hao - 博客园 (cnblogs.com)</a></p><ol><li>自动增长</li><li>UUID</li><li>Redis生成</li><li>snowflake雪花算法</li></ol><p>mybatisplus中指定策略如下</p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210920132148411.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210920132148411.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210920132148411"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure><h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    userMapper.updateById(<span class="keyword">new</span> User(<span class="number">2L</span>, <span class="string">&quot;Jacks&quot;</span>, <span class="number">11</span>, <span class="string">&quot;Jacks@qq.com&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="自动填充"><a href="#自动填充" class="headerlink" title="自动填充"></a>自动填充</h4><blockquote><p>为实体类添加带有注解的属性</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//create_time</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">//update_time  注意这里是INSERT_UPDATE</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> Date updateTime;</span><br></pre></td></tr></table></figure><blockquote><p>创建handler类，并实现接口MetaObjectHandler的方法</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mybatisplus_demo.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要交给spring</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title">MetaObjectHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当使用mp实现添加操作时，这个方法会执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>测试</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setName(<span class="string">&quot;岳不群1&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">70</span>);</span><br><span class="line">        user.setEmail(<span class="string">&quot;lucy@qq.com&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        user.setCreateTime(new Date());</span></span><br><span class="line"><span class="comment">//        user.setUpdateTime(new Date());</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> insert = userMapper.insert(user);</span><br><span class="line">        System.out.println(<span class="string">&quot;insert:&quot;</span> + insert);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">1439818355027558402L</span>);</span><br><span class="line">        user.setAge(<span class="number">120</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> row = userMapper.updateById(user);</span><br><span class="line">        System.out.println(row);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h4><blockquote><p>主要解决：丢失更新</p></blockquote><blockquote><p>为实体类添加带注解的属性</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Version</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Integer version;</span><br></pre></td></tr></table></figure><blockquote><p>配置乐观锁插件，可以写在独立的配置类中（MapperScan也可以写在该配置类中）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.example.mybatisplus_demo.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MpConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 乐观锁插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MybatisPlusInterceptor interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> OptimisticLockerInnerInterceptor());</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>编写handler类</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">    <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">    <span class="comment">// 默认初始值1</span></span><br><span class="line">    <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;version&quot;</span>, <span class="number">1</span>, metaObject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>测试</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testOptimisticLockerInnerInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 先查</span></span><br><span class="line">    User user = userMapper.selectById(<span class="number">1439842460539846658L</span>);</span><br><span class="line">    <span class="comment">// 后改</span></span><br><span class="line">    user.setAge(<span class="number">44</span>);</span><br><span class="line">    userMapper.updateById(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><h4 id="批量查询"><a href="#批量查询" class="headerlink" title="批量查询"></a>批量查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testSelect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectBatchIds(Arrays.asList(<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">3L</span>));</span><br><span class="line">    System.out.println(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h4><blockquote><p>在配置类中配置分页插件</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.example.mybatisplus_demo.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MpConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MybatisPlusInterceptor interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> OptimisticLockerInnerInterceptor());</span><br><span class="line">       <span class="comment">// 分页插件</span></span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> PaginationInnerInterceptor(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>测试</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建page对象</span></span><br><span class="line">    Page&lt;User&gt; page = <span class="keyword">new</span> Page&lt;&gt;(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 查询</span></span><br><span class="line">    Page&lt;User&gt; page1 = userMapper.selectPage(page, <span class="keyword">null</span>);</span><br><span class="line">    System.out.println(page1);</span><br><span class="line">    <span class="comment">// 获得的page对象有许多方法可以获得对应值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><blockquote><p>物理删除：真实删除，将数据从数据库中删除<br>逻辑删除：假删除，根据字段状态判断</p></blockquote><h4 id="批量删除（物理删除）"><a href="#批量删除（物理删除）" class="headerlink" title="批量删除（物理删除）"></a>批量删除（物理删除）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    userMapper.deleteBatchIds(Arrays.asList(<span class="number">1L</span>, <span class="number">2L</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="逻辑删除"><a href="#逻辑删除" class="headerlink" title="逻辑删除"></a>逻辑删除</h4><blockquote><p>在实体类中添加带注释的属性（可以再加上TableField设置默认值等）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableLogic</span></span><br><span class="line"><span class="keyword">private</span> Integer deleted;</span><br></pre></td></tr></table></figure><blockquote><p>高版本已不需要在配置文件中添加插件</p></blockquote><blockquote><p>测试</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    userMapper.deleteBatchIds(Arrays.asList(<span class="number">1L</span>, <span class="number">2L</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>逻辑删除之后的数据在查询的时候不会被查询到（添加了额外的条件deleted=0）</p></blockquote><h2 id="条件构造器"><a href="#条件构造器" class="headerlink" title="条件构造器"></a>条件构造器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testWrapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建对象</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    <span class="comment">// 设置条件(更多条件详见官网)</span></span><br><span class="line">    wrapper.ge(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>).le(<span class="string">&quot;age&quot;</span>, <span class="number">40</span>);</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">    System.out.println(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210920153358406.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210920153358406.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210920153358406"></p><h2 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h2>]]></content>
      
      
      
        <tags>
            
            <tag> MyBatisPlus </tag>
            
            <tag> 学习 </tag>
            
            <tag> ssm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】在线教育项目实战1</title>
      <link href="/2021/09/19/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-1/"/>
      <url>/2021/09/19/xiang-mu-bi-ji-zai-xian-jiao-yu-xiang-mu-shi-zhan-1/</url>
      
        <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>​    今天准备写一个ssm整合的crud简单项目，然后顺便应付一下学校课程，然后被spring的注释气到了（注释代码什么都写得一模一样，就是idea报找不到bean，结果我重写了几遍之后莫名的好了，离谱！），被jsp气到了（这个错误之前遇到好几次了，也是代码一模一样，就是报404，离谱！），实在是不想在这些上面折腾了，今天在实验室有一半的时间都在叹气，于是果断放弃了它，投入了springboot+vue的怀抱。</p><h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><h3 id="项目商业模式"><a href="#项目商业模式" class="headerlink" title="项目商业模式"></a>项目商业模式</h3><h4 id="B2C（当前项目）"><a href="#B2C（当前项目）" class="headerlink" title="B2C（当前项目）"></a>B2C（当前项目）</h4><blockquote><p>Business To Customers</p><p>两个角色：<br>    管理员：添加、修改、删除<br>    普通用户：查询</p></blockquote><h4 id="B2B2C"><a href="#B2B2C" class="headerlink" title="B2B2C"></a>B2B2C</h4><blockquote><p>Business To Business To Customers</p><p>例子：淘宝</p></blockquote><h3 id="项目实现功能模块"><a href="#项目实现功能模块" class="headerlink" title="项目实现功能模块"></a>项目实现功能模块</h3><h4 id="后台（管理员）"><a href="#后台（管理员）" class="headerlink" title="后台（管理员）"></a>后台（管理员）</h4><blockquote><ol><li>讲师管理</li><li>课程分类管理</li><li>课程管理<ul><li>视频</li></ul></li><li>统计分析<ul><li>课程相关</li></ul></li><li>订单管理</li><li>banner（轮播图）管理</li><li>权限管理</li></ol></blockquote><h4 id="前台（普通用户）"><a href="#前台（普通用户）" class="headerlink" title="前台（普通用户）"></a>前台（普通用户）</h4><blockquote><ol><li>首页数据显示</li><li>讲师列表和详情</li><li>课程列表和详情<ul><li>视频在线播放</li></ul></li><li>登录和注册</li><li>微信扫码登录</li><li>微信支付</li></ol></blockquote><h3 id="项目使用的技术点"><a href="#项目使用的技术点" class="headerlink" title="项目使用的技术点"></a>项目使用的技术点</h3><h4 id="后端技术"><a href="#后端技术" class="headerlink" title="后端技术"></a>后端技术</h4><blockquote><ol><li>SpringBoot</li><li>SpringCloud</li><li>MyBatisPlus</li><li>SpringSecurity</li><li>redis，maven，easyExcel，jwt，OAuth2</li><li>……</li></ol></blockquote><h4 id="前端技术"><a href="#前端技术" class="headerlink" title="前端技术"></a>前端技术</h4><blockquote><ol><li>vue</li><li>element-ui</li><li>axios</li><li>node.js</li><li>……</li></ol></blockquote><h4 id="其他技术"><a href="#其他技术" class="headerlink" title="其他技术"></a>其他技术</h4><blockquote><ol><li>阿里云oss</li><li>阿里云视频点播服务</li><li>阿里云短信服务</li><li>微信支付和登录</li><li>docker，git，Jenkins</li><li>……</li></ol></blockquote><h2 id="MyBatisPlus介绍"><a href="#MyBatisPlus介绍" class="headerlink" title="MyBatisPlus介绍"></a>MyBatisPlus介绍</h2><blockquote><p>详见单独的文档说明</p></blockquote><h2 id="搭建项目环境"><a href="#搭建项目环境" class="headerlink" title="搭建项目环境"></a>搭建项目环境</h2><h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><blockquote><p>详见资料</p></blockquote><h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><blockquote><p>父工程：pom类型，用于管理以来版本和放公共依赖</p><p>子模块n：实现各个模块</p></blockquote><h3 id="创建springboot父项目"><a href="#创建springboot父项目" class="headerlink" title="创建springboot父项目"></a>创建springboot父项目</h3><h4 id="配置父项目的pom-xml"><a href="#配置父项目的pom-xml" class="headerlink" title="配置父项目的pom.xml"></a>配置父项目的pom.xml</h4><blockquote><p>配置打包方式、删除dependencies、添加properties和dependencyManagement、删除src文件夹等</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span> /&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guli_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>guli_parent<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>guli_parent<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">guli.version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">guli.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>3.0.5<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">velocity.version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">velocity.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">swagger.version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">swagger.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aliyun.oss.version</span>&gt;</span>2.8.3<span class="tag">&lt;/<span class="name">aliyun.oss.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jodatime.version</span>&gt;</span>2.10.1<span class="tag">&lt;/<span class="name">jodatime.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">poi.version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">poi.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commons-fileupload.version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">commons-fileupload.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commons-io.version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">commons-io.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">httpclient.version</span>&gt;</span>4.5.1<span class="tag">&lt;/<span class="name">httpclient.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jwt.version</span>&gt;</span>0.7.0<span class="tag">&lt;/<span class="name">jwt.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aliyun-java-sdk-core.version</span>&gt;</span>4.3.3<span class="tag">&lt;/<span class="name">aliyun-java-sdk-core.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aliyun-sdk-oss.version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">aliyun-sdk-oss.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aliyun-java-sdk-vod.version</span>&gt;</span>2.15.2<span class="tag">&lt;/<span class="name">aliyun-java-sdk-vod.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aliyun-java-vod-upload.version</span>&gt;</span>1.4.11<span class="tag">&lt;/<span class="name">aliyun-java-vod-upload.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aliyun-sdk-vod-upload.version</span>&gt;</span>1.4.11<span class="tag">&lt;/<span class="name">aliyun-sdk-vod-upload.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fastjson.version</span>&gt;</span>1.2.28<span class="tag">&lt;/<span class="name">fastjson.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">gson.version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">gson.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">json.version</span>&gt;</span>20170516<span class="tag">&lt;/<span class="name">json.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commons-dbutils.version</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">commons-dbutils.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">canal.client.version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">canal.client.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">docker.image.prefix</span>&gt;</span>zx<span class="tag">&lt;/<span class="name">docker.image.prefix</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">cloud-alibaba.version</span>&gt;</span>0.2.2.RELEASE<span class="tag">&lt;/<span class="name">cloud-alibaba.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--Spring Cloud--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;cloud-alibaba.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--mybatis-plus 持久层--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!-- velocity 模板引擎, Mybatis Plus 代码生成器需要 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;velocity.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--swagger ui--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!--aliyunOSS--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun.oss.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!--日期时间工具--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jodatime.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!--xls--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;poi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--xlsx--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;poi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!--文件上传--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-fileupload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!--commons-io--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-io.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!--httpclient--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;httpclient.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;gson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!-- JWT --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jwt.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!--aliyun--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-java-sdk-core.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-sdk-oss.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-vod<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-java-sdk-vod.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-vod-upload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-java-vod-upload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-vod-upload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-sdk-vod-upload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;fastjson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.json<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;json.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-dbutils.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.otter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>canal.client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;canal.client.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="创建子模块"><a href="#创建子模块" class="headerlink" title="创建子模块"></a>创建子模块</h3><blockquote><p>右键new model创建即可，子项目service等</p></blockquote><h4 id="配置pom-xml"><a href="#配置pom-xml" class="headerlink" title="配置pom.xml"></a>配置pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;groupId&gt;com.atguigu&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;artifactId&gt;service_base&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--&lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--hystrix依赖，主要是用  @HystrixCommand --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--服务注册--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">             &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">             &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">         &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--服务调用--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">             &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">             &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">         &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--mybatis-plus--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- velocity 模板引擎, Mybatis Plus 代码生成器需要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--lombok用来简化实体类：需要安装lombok插件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--xls--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--httpclient--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--commons-io--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--gson--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="创建子子模块"><a href="#创建子子模块" class="headerlink" title="创建子子模块"></a>创建子子模块</h3><blockquote><p>service_edu、service_vod</p></blockquote><h3 id="当前项目结构"><a href="#当前项目结构" class="headerlink" title="当前项目结构"></a>当前项目结构</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210920162644497.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210920162644497.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210920162644497"></p><h2 id="common模块"><a href="#common模块" class="headerlink" title="common模块"></a>common模块</h2><h3 id="swagger工具"><a href="#swagger工具" class="headerlink" title="swagger工具"></a>swagger工具</h3><h4 id="创建子模块-1"><a href="#创建子模块-1" class="headerlink" title="创建子模块"></a>创建子模块</h4><blockquote><p>命名为common，该模块不需要src文件夹</p></blockquote><h4 id="配置依赖"><a href="#配置依赖" class="headerlink" title="配置依赖"></a>配置依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guli_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--mybatis-plus--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--lombok用来简化实体类：需要安装lombok插件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- redis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- spring2.X集成redis所需common-pool2</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;2.6.0&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="创建子子模块-1"><a href="#创建子子模块-1" class="headerlink" title="创建子子模块"></a>创建子子模块</h4><blockquote><p>service_base</p></blockquote><h4 id="创建SwaggerConfig-java配置类"><a href="#创建SwaggerConfig-java配置类" class="headerlink" title="创建SwaggerConfig.java配置类"></a>创建SwaggerConfig.java配置类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.servicebase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Predicates;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span> <span class="comment">// swagger注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一些固定配置</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">webApiConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;webApi&quot;</span>)</span><br><span class="line">                .apiInfo(webApiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/admin/.*&quot;</span>)))</span><br><span class="line">                .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/error.*&quot;</span>)))</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 文档提示信息</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">webApiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">&quot;网站-课程中心API文档&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;本文档描述了课程中心微服务接口定义&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">&quot;java&quot;</span>, <span class="string">&quot;http://atguigu.com&quot;</span>, <span class="string">&quot;1123@qq.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="引入swagger子模块"><a href="#引入swagger子模块" class="headerlink" title="引入swagger子模块"></a>引入swagger子模块</h4><blockquote><p>需要在service模块中引入swagger模块的子模块servicebase模块，即在service模块的pom.xml文件中添加依赖即可（因为想要在service模块的子模块中使用，且都写上了pom打包，所以只要在service模块的pom.xml中添加即可）</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>service_base<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="启动类添加组件扫描"><a href="#启动类添加组件扫描" class="headerlink" title="启动类添加组件扫描"></a>启动类添加组件扫描</h4><blockquote><p>EduApplication是service_edu模块下的启动类，由于service_base模块中的swaggerconfig配置类所在包地址也是com.atguigu.xxx，所以可以通过这个扫描到，否则只会扫描启动类所在及子包下的类（所以启动类要放在所有package的同级），如果是别的地址再额外添加即可（{“com.atguigu”,”com.xxx”}）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.atguigu&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EduApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试（访问）swagger"><a href="#测试（访问）swagger" class="headerlink" title="测试（访问）swagger"></a>测试（访问）swagger</h4><blockquote><p>启动xxxApplication启动类</p><p><a href="http://localhost:8001/swagger-ui.html">http://localhost:8001/swagger-ui.html</a></p></blockquote><h4 id="API文档提示编写"><a href="#API文档提示编写" class="headerlink" title="API文档提示编写"></a>API文档提示编写</h4><blockquote><p>一下以controller为例</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.eduservice.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.eduservice.entity.EduTeacher;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.eduservice.service.EduTeacherService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 讲师 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> testjava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-09-20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Api(tags = &#123;&quot;讲师管理&quot;&#125;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/edu-teacher&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduTeacherController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduTeacherService teacherService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// REST风格</span></span><br><span class="line">    <span class="comment">// 1、查询讲师表的所有数据</span></span><br><span class="line">    <span class="comment">// 地址：localhost:8001//eduservice/edu-teacher/findAll</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;所有讲师列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;findAll&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;EduTeacher&gt; <span class="title">findAllTeacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 调用Service的方法</span></span><br><span class="line">        List&lt;EduTeacher&gt; list = teacherService.list(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、逻辑删除讲师</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据id逻辑删除讲师&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeTeacher</span><span class="params">(<span class="meta">@ApiParam(name = &quot;id&quot;, value = &quot;讲师ID&quot;, required = true)</span> <span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = teacherService.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="当前项目结构-1"><a href="#当前项目结构-1" class="headerlink" title="当前项目结构"></a>当前项目结构</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210921130942041.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210921130942041.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210921130942041"></p><h3 id="统一结果返回格式"><a href="#统一结果返回格式" class="headerlink" title="统一结果返回格式"></a>统一结果返回格式</h3><h4 id="统一结果的格式"><a href="#统一结果的格式" class="headerlink" title="统一结果的格式"></a>统一结果的格式</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;success&quot;</span>: 布尔, <span class="comment">//响应是否成功</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: 数字, <span class="comment">//响应码</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span>: 字符串, <span class="comment">//返回消息</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: HashMap <span class="comment">//返回数据，放在键值对中</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="创建子模块-2"><a href="#创建子模块-2" class="headerlink" title="创建子模块"></a>创建子模块</h4><blockquote><p>common模块下创建common_utils模块</p></blockquote><h4 id="设定状态码"><a href="#设定状态码" class="headerlink" title="设定状态码"></a>设定状态码</h4><blockquote><p>可以写成接口，或者其他形式</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.commonutils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ResultCode</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 状态码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Integer SUCCESS = <span class="number">20000</span>; <span class="comment">//成功</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Integer ERROR = <span class="number">20001</span>; <span class="comment">//失败</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="定义返回数据格式"><a href="#定义返回数据格式" class="headerlink" title="定义返回数据格式"></a>定义返回数据格式</h4><blockquote><p>创建一个统一返回结果类</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.commonutils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//统一返回结果的类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">R</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 以下属性为返回内容key</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;是否成功&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回消息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回数据&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; data = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把构造方法私有</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">R</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//成功静态方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">ok</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(<span class="keyword">true</span>);</span><br><span class="line">        r.setCode(ResultCode.SUCCESS);</span><br><span class="line">        r.setMessage(<span class="string">&quot;成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//失败静态方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">error</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(<span class="keyword">false</span>);</span><br><span class="line">        r.setCode(ResultCode.ERROR);</span><br><span class="line">        r.setMessage(<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 以下的return this返回的是r</span></span><br><span class="line">    <span class="comment">// 可以实现链式编程（R.success().message().……）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">success</span><span class="params">(Boolean success)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setSuccess(success);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">message</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setMessage(message);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">code</span><span class="params">(Integer code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setCode(code);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">data</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">data</span><span class="params">(Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setData(map);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="使用统一返回结果格式"><a href="#使用统一返回结果格式" class="headerlink" title="使用统一返回结果格式"></a>使用统一返回结果格式</h4><blockquote><p>先在模块的pom.xml中引入已经定义好的统一返回结果类所在</p></blockquote><blockquote><p>将接口方法（controller中的方法）返回结果改为R即可</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 未使用统一结果格式</span></span><br><span class="line"><span class="meta">@Api(tags = &#123;&quot;讲师管理&quot;&#125;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/edu-teacher&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduTeacherController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduTeacherService teacherService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// REST风格</span></span><br><span class="line">    <span class="comment">// 1、查询讲师表的所有数据</span></span><br><span class="line">    <span class="comment">// 地址：localhost:8001//eduservice/edu-teacher/findAll</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;所有讲师列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;findAll&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;EduTeacher&gt; <span class="title">findAllTeacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 调用Service的方法</span></span><br><span class="line">        List&lt;EduTeacher&gt; list = teacherService.list(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、逻辑删除讲师</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据id逻辑删除讲师&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeTeacher</span><span class="params">(<span class="meta">@ApiParam(name = &quot;id&quot;, value = &quot;讲师ID&quot;, required = true)</span> <span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = teacherService.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用统一结果格式</span></span><br><span class="line"><span class="meta">@Api(tags = &#123;&quot;讲师管理&quot;&#125;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/edu-teacher&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduTeacherController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduTeacherService teacherService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// REST风格</span></span><br><span class="line">    <span class="comment">// 1、查询讲师表的所有数据</span></span><br><span class="line">    <span class="comment">// 地址：localhost:8001//eduservice/edu-teacher/findAll</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;所有讲师列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;findAll&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">findAllTeacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 调用Service的方法</span></span><br><span class="line">        List&lt;EduTeacher&gt; list = teacherService.list(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;teacherList&quot;</span>, list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、逻辑删除讲师</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据id逻辑删除讲师&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">removeTeacher</span><span class="params">(<span class="meta">@ApiParam(name = &quot;id&quot;, value = &quot;讲师ID&quot;, required = true)</span> <span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = teacherService.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> flag ? R.ok() : R.error();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="当前项目结构-2"><a href="#当前项目结构-2" class="headerlink" title="当前项目结构"></a>当前项目结构</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210921131024571.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210921131024571.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210921131024571"></p><h3 id="统一异常处理"><a href="#统一异常处理" class="headerlink" title="统一异常处理"></a>统一异常处理</h3><h4 id="统一异常处理类"><a href="#统一异常处理类" class="headerlink" title="统一异常处理类"></a>统一异常处理类</h4><blockquote><p>在common模块中的service_base中添加即可</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统一异常处理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span>   <span class="comment">// 增强的controller，可以用于全局异常处理</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 全局异常处理</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span> <span class="comment">// 指定出现什么异常才会执行这个方法</span></span><br><span class="line">    <span class="meta">@ResponseBody</span>                      <span class="comment">// 用于返回数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> R.error().message(<span class="string">&quot;产生了异常!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里有一个依赖的问题，需要注意</p></blockquote><h4 id="特定异常处理"><a href="#特定异常处理" class="headerlink" title="特定异常处理"></a>特定异常处理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统一异常处理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span>   <span class="comment">// 增强的controller，可以用于全局异常处理</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 全局异常处理</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span> <span class="comment">// 指定出现什么异常才会执行这个方法</span></span><br><span class="line">    <span class="meta">@ResponseBody</span>                      <span class="comment">// 用于返回数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> R.error().message(<span class="string">&quot;产生了异常!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 特定异常处理</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(ArithmeticException.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(ArithmeticException e)</span> </span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> R.error().message(<span class="string">&quot;产生了ArithmeticException异常!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="自定义异常处理"><a href="#自定义异常处理" class="headerlink" title="自定义异常处理"></a>自定义异常处理</h4><blockquote><p>创建自定义异常类</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GuliException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;   <span class="comment">// 状态码</span></span><br><span class="line">    <span class="keyword">private</span> String msg;     <span class="comment">// 异常信息</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//……</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在统一异常处理类中创建方法</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义异常处理</span></span><br><span class="line"><span class="meta">@ExceptionHandler(GuliException.class)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(GuliException e)</span> </span>&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="keyword">return</span> R.error().code(e.getCode()).message(e.getMsg());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>抛出自定义异常</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(<span class="number">20001</span>, <span class="string">&quot;zzzzz&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="当前项目结构-3"><a href="#当前项目结构-3" class="headerlink" title="当前项目结构"></a>当前项目结构</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210921154934229.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210921154934229.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210921154934229"></p><h3 id="统一日志处理"><a href="#统一日志处理" class="headerlink" title="统一日志处理"></a>统一日志处理</h3><h4 id="配置日志级别"><a href="#配置日志级别" class="headerlink" title="配置日志级别"></a>配置日志级别</h4><blockquote><p>application.properties文件中配置即可</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">logging.level.root</span>=<span class="string">INFO</span></span><br></pre></td></tr></table></figure><h4 id="logback日志工具"><a href="#logback日志工具" class="headerlink" title="logback日志工具"></a>logback日志工具</h4><blockquote><p>log4j，logback等可以将日志输出到文件中</p><p>注意：需要先将application.properties中的有关日志的配置注释掉</p></blockquote><h4 id="配置工具的配置文件"><a href="#配置工具的配置文件" class="headerlink" title="配置工具的配置文件"></a>配置工具的配置文件</h4><blockquote><p>在resource文件夹下创建logback-spring.xml配置文件</p><p>  注意 <property name="log.path" value="D:/MyProject/log/guli_edu" /> 的路径即可</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;10 seconds&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志级别从低到高分为TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL，如果设置为WARN，则低于WARN的信息都不会输出 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- scan:当此属性设置为true时，配置文件如果发生改变，将会被重新加载，默认值为true --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- scanPeriod:设置监测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认单位是毫秒。当scan为true时，此属性生效。默认的时间间隔为1分钟。 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- de<span class="doctag">bug:</span>当此属性设置为true时，将打印出logback内部日志信息，实时查看logback运行状态。默认值为false。 --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">contextName</span>&gt;</span>logback<span class="tag">&lt;/<span class="name">contextName</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- name的值是变量的名称，value的值时变量定义的值。通过定义的值会被插入到logger上下文中。定义变量后，可以使“$&#123;&#125;”来使用变量。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;log.path&quot;</span> <span class="attr">value</span>=<span class="string">&quot;D:/MyProject/log/guli_edu&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 彩色日志 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置格式变量：CONSOLE_LOG_PATTERN 彩色日志格式 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- magenta:洋红 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- boldMagenta:粗红--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- cyan:青色 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- white:白色 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- magenta:洋红 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE_LOG_PATTERN&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">&quot;%yellow(%date&#123;yyyy-MM-dd HH:mm:ss&#125;) |%highlight(%-5level) |%blue(%thread) |%blue(%file:%line) |%green(%logger) |%cyan(%msg%n)&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--输出到控制台--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--此日志appender是为开发使用，只配置最底级别，控制台输出的日志级别是大于或等于此级别的日志信息--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 例如：如果此处配置了INFO级别，则后面其他位置即使配置了DEBUG级别的日志，也不会被输出 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 设置字符集 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--输出到文件--&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 时间滚动输出 level为 INFO 日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;INFO_FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/log_info.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志文件输出格式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 每天日志归档路径以及格式 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/info/log-info-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件保留天数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 此日志文件只记录info级别的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 时间滚动输出 level为 WARN 日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;WARN_FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/log_warn.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志文件输出格式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span> <span class="comment">&lt;!-- 此处设置字符集 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/warn/log-warn-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件保留天数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 此日志文件只记录warn级别的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>warn<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 时间滚动输出 level为 ERROR 日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;ERROR_FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/log_error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志文件输出格式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span> <span class="comment">&lt;!-- 此处设置字符集 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/error/log-error-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件保留天数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 此日志文件只记录ERROR级别的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;logger&gt;用来设置某一个包或者具体的某一个类的日志打印级别、以及指定&lt;appender&gt;。</span></span><br><span class="line"><span class="comment">        &lt;logger&gt;仅有一个name属性，</span></span><br><span class="line"><span class="comment">        一个可选的level和一个可选的addtivity属性。</span></span><br><span class="line"><span class="comment">        name:用来指定受此logger约束的某一个包或者具体的某一个类。</span></span><br><span class="line"><span class="comment">        level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF，</span></span><br><span class="line"><span class="comment">              如果未设置此属性，那么当前logger将会继承上级的级别。</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        使用mybatis的时候，sql语句是debug下才会打印，而这里我们只配置了info，所以想要查看sql语句的话，有以下两种操作：</span></span><br><span class="line"><span class="comment">        第一种把&lt;root level=&quot;INFO&quot;&gt;改成&lt;root level=&quot;DEBUG&quot;&gt;这样就会打印sql，不过这样日志那边会出现很多其他消息</span></span><br><span class="line"><span class="comment">        第二种就是单独给mapper下目录配置DEBUG模式，代码如下，这样配置sql语句会打印，其他还是正常DEBUG级别：</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开发环境:打印控制台--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--可以输出项目中的debug日志，包括mybatis的sql日志--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.guli&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> /&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            root节点是必选节点，用来指定最基础的日志输出级别，只有一个level属性</span></span><br><span class="line"><span class="comment">            level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF，默认是DEBUG</span></span><br><span class="line"><span class="comment">            可以包含零个或多个appender元素。</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;INFO_FILE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;WARN_FILE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ERROR_FILE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--生产环境:输出到文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;pro&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;DEBUG_FILE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;INFO_FILE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ERROR_FILE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;WARN_FILE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="输出错误日志"><a href="#输出错误日志" class="headerlink" title="输出错误日志"></a>输出错误日志</h4><blockquote><p>在统一异常处理类上添加注释，并且在异常处理的时候调用log.error()</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统一异常处理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span>   <span class="comment">// 增强的controller，可以用于全局异常处理</span></span><br><span class="line"><span class="meta">@Slf4j</span>              <span class="comment">// 输出错误日志</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 特定异常处理</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(ArithmeticException.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">error</span><span class="params">(ArithmeticException e)</span> </span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        log.error(e.getMessage());  <span class="comment">// 将错误日志的内容输出到文件当中</span></span><br><span class="line">        <span class="keyword">return</span> R.error().message(<span class="string">&quot;产生了ArithmeticException异常!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ……</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在配置的路径中即可看到日志文件</p></blockquote><h4 id="当前目录结构"><a href="#当前目录结构" class="headerlink" title="当前目录结构"></a>当前目录结构</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210921155023827.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210921155023827.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210921155023827"></p><h2 id="service-edu讲师管理模块（后端）"><a href="#service-edu讲师管理模块（后端）" class="headerlink" title="service_edu讲师管理模块（后端）"></a>service_edu讲师管理模块（后端）</h2><h3 id="快速前置配置"><a href="#快速前置配置" class="headerlink" title="快速前置配置"></a>快速前置配置</h3><h4 id="配置文件application-properties"><a href="#配置文件application-properties" class="headerlink" title="配置文件application.properties"></a>配置文件application.properties</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 端口号</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8001</span></span><br><span class="line"><span class="comment"># 服务名</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">service-edu</span></span><br><span class="line"><span class="comment"># 环境</span></span><br><span class="line"><span class="meta">spring.profiles.active</span>=<span class="string">dev</span></span><br><span class="line"><span class="comment"># mysql数据库信息</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">123456789</span></span><br><span class="line"><span class="comment"># 返回JSON的全局时间格式</span></span><br><span class="line"><span class="meta">spring.jackson.date-format</span>=<span class="string">yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="meta">spring.jackson.time-zone</span>=<span class="string">GMT+8</span></span><br><span class="line"><span class="comment">#mybatis日志</span></span><br><span class="line"><span class="meta">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><h4 id="mybatisplus代码生成器"><a href="#mybatisplus代码生成器" class="headerlink" title="mybatisplus代码生成器"></a>mybatisplus代码生成器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.DataSourceConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.GlobalConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.PackageConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.StrategyConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.DateType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodeGenerator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建代码生成器</span></span><br><span class="line">        AutoGenerator mpg = <span class="keyword">new</span> AutoGenerator();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、全局配置</span></span><br><span class="line">        GlobalConfig gc = <span class="keyword">new</span> GlobalConfig();</span><br><span class="line">        <span class="comment">// String projectPath = System.getProperty(&quot;user.dir&quot;);</span></span><br><span class="line">        <span class="comment">// gc.setOutputDir(projectPath + &quot;/src/main/java&quot;);</span></span><br><span class="line">        <span class="comment">// 建议写成绝对路径</span></span><br><span class="line">        gc.setOutputDir(<span class="string">&quot;D:\\MyProject\\springboot\\guli_parent\\service\\service_edu&quot;</span> + <span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line"></span><br><span class="line">        gc.setAuthor(<span class="string">&quot;testjava&quot;</span>);</span><br><span class="line">        gc.setOpen(<span class="keyword">false</span>); <span class="comment">//生成后是否打开资源管理器</span></span><br><span class="line">        gc.setFileOverride(<span class="keyword">false</span>); <span class="comment">//重新生成时文件是否覆盖</span></span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);<span class="comment">//去掉Service接口的首字母I</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// id类型如果是Long则改为ID_WORKER</span></span><br><span class="line">        gc.setIdType(IdType.ID_WORKER_STR); <span class="comment">//主键策略</span></span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);<span class="comment">//定义生成的实体类中日期类型</span></span><br><span class="line">        gc.setSwagger2(<span class="keyword">true</span>);<span class="comment">//开启Swagger2模式</span></span><br><span class="line"></span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、数据源配置</span></span><br><span class="line">        DataSourceConfig dsc = <span class="keyword">new</span> DataSourceConfig();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;123456789&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、包配置</span></span><br><span class="line">        PackageConfig pc = <span class="keyword">new</span> PackageConfig();</span><br><span class="line">        pc.setModuleName(<span class="string">&quot;eduservice&quot;</span>); <span class="comment">//模块名</span></span><br><span class="line">        pc.setParent(<span class="string">&quot;com.atguigu&quot;</span>);</span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、策略配置</span></span><br><span class="line">        StrategyConfig strategy = <span class="keyword">new</span> StrategyConfig();</span><br><span class="line">        </span><br><span class="line">        strategy.setInclude(<span class="string">&quot;edu_teacher&quot;</span>); <span class="comment">//加载表</span></span><br><span class="line">        </span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);<span class="comment">//数据库表映射到实体的命名策略</span></span><br><span class="line">        strategy.setTablePrefix(pc.getModuleName() + <span class="string">&quot;_&quot;</span>); <span class="comment">//生成实体时去掉表前缀</span></span><br><span class="line"></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);<span class="comment">//数据库表字段映射到实体的命名策略</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="keyword">true</span>); <span class="comment">// lombok 模型 @Accessors(chain = true) setter链式操作</span></span><br><span class="line"></span><br><span class="line">        strategy.setRestControllerStyle(<span class="keyword">true</span>); <span class="comment">//restful api风格控制器</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="keyword">true</span>); <span class="comment">//url中驼峰转连字符</span></span><br><span class="line"></span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、执行</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="当前项目结构-4"><a href="#当前项目结构-4" class="headerlink" title="当前项目结构"></a>当前项目结构</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210920164803926.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210920164803926.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210920164803926"></p><h4 id="创建配置类"><a href="#创建配置类" class="headerlink" title="创建配置类"></a>创建配置类</h4><blockquote><p>配置包扫描等</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.eduservice.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.eduservice.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="创建启动类"><a href="#创建启动类" class="headerlink" title="创建启动类"></a>创建启动类</h4><blockquote><p>启动类位置要放在controller、entity等package的同级，然后run即可启动</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.eduservice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EduApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="简单查询所有讲师"><a href="#简单查询所有讲师" class="headerlink" title="简单查询所有讲师"></a>简单查询所有讲师</h3><h4 id="编写controller"><a href="#编写controller" class="headerlink" title="编写controller"></a>编写controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.eduservice.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.eduservice.entity.EduTeacher;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.eduservice.service.EduTeacherService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 讲师 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> testjava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-09-20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduservice/edu-teacher&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduTeacherController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EduTeacherService teacherService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// REST风格</span></span><br><span class="line">    <span class="comment">// 1、查询讲师表的所有数据</span></span><br><span class="line">    <span class="comment">// 地址：localhost:8001//eduservice/edu-teacher/findAll</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;findAll&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;EduTeacher&gt; <span class="title">findAllTeacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 调用Service的方法</span></span><br><span class="line">        List&lt;EduTeacher&gt; list = teacherService.list(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p><code>localhost:8001//eduservice/edu-teacher/findAll</code></p><h3 id="逻辑删除讲师"><a href="#逻辑删除讲师" class="headerlink" title="逻辑删除讲师"></a>逻辑删除讲师</h3><h4 id="实体类属性添加注解"><a href="#实体类属性添加注解" class="headerlink" title="实体类属性添加注解"></a>实体类属性添加注解</h4><blockquote><p>为EduTeacher实体类添加相应的注释@TableLogic</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModelProperty(value = &quot;逻辑删除 1（true）已删除， 0（false）未删除&quot;)</span></span><br><span class="line"><span class="meta">@TableLogic</span></span><br><span class="line"><span class="keyword">private</span> Integer isDeleted;</span><br></pre></td></tr></table></figure><h4 id="创建mybatisplus配置类"><a href="#创建mybatisplus配置类" class="headerlink" title="创建mybatisplus配置类"></a>创建mybatisplus配置类</h4><blockquote><p>添加逻辑删除插件（注意mybatis版本，低版本是需要添加的，高版本不用，而且TableId自动识别Type AutoGenerator写法也有区别等）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.eduservice.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.injector.ISqlInjector;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.injector.LogicSqlInjector;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.eduservice.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 逻辑删除插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ISqlInjector <span class="title">sqlInjector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LogicSqlInjector();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写controller-1"><a href="#编写controller-1" class="headerlink" title="编写controller"></a>编写controller</h4><blockquote><p>注意使用REST风格URI，pathVariable对应路径参数</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2、逻辑删除讲师</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeTeacher</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> flag = teacherService.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试（swagger工具）"><a href="#测试（swagger工具）" class="headerlink" title="测试（swagger工具）"></a>测试（swagger工具）</h4><blockquote><p>整合swagger可以用于接口测试、生成在线接口文档等</p></blockquote><h3 id="分页功能"><a href="#分页功能" class="headerlink" title="分页功能"></a>分页功能</h3><h4 id="配置类导入插件"><a href="#配置类导入插件" class="headerlink" title="配置类导入插件"></a>配置类导入插件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.eduservice.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 逻辑删除插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ISqlInjector <span class="title">sqlInjector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LogicSqlInjector();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写controller-2"><a href="#编写controller-2" class="headerlink" title="编写controller"></a>编写controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 3、分页功能</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> current 当前页</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> limit   每页记录数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;pageTeacher/&#123;current&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">pageListTeacher</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">long</span> current,</span></span></span><br><span class="line"><span class="params"><span class="function">                         <span class="meta">@PathVariable</span> <span class="keyword">long</span> limit)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建page对象</span></span><br><span class="line">    Page&lt;EduTeacher&gt; pageTeacher = <span class="keyword">new</span> Page&lt;&gt;(current, limit);</span><br><span class="line">    <span class="comment">// 调用方法实现分类</span></span><br><span class="line">    teacherService.page(pageTeacher, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">long</span> total = pageTeacher.getTotal();</span><br><span class="line">    List&lt;EduTeacher&gt; records = pageTeacher.getRecords();</span><br><span class="line">    HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;total&quot;</span>, total);</span><br><span class="line">    map.put(<span class="string">&quot;records&quot;</span>, records);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="多条件组合查询分页"><a href="#多条件组合查询分页" class="headerlink" title="多条件组合查询分页"></a>多条件组合查询分页</h3><h4 id="创建VO实体对象"><a href="#创建VO实体对象" class="headerlink" title="创建VO实体对象"></a>创建VO实体对象</h4><blockquote><p>把条件值传递到接口里（将条件值封装到VO(ViewObject)实体对象当中，再把对象vo传递到接口中）<br><a href="https://blog.csdn.net/zjrbiancheng/article/details/6253232">浅析VO、DTO、DO、PO的概念、区别和用处_zjrbiancheng的专栏-CSDN博客</a><br><a href="https://blog.csdn.net/wangxin1982314/article/details/51954264/">实体类（VO，DO，DTO）的划分_xin.wang的博客-CSDN博客</a></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.eduservice.entity.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 条件封装对象</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherQuery</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一下属性是对应的可被依据的查询条件（注意和表中字段名对应）</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;教师名称,模糊查询&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;头衔 1高级讲师 2首席讲师&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer level;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;查询开始时间&quot;, example = &quot;2019-01-01 10:10:10&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String begin;<span class="comment">//注意，这里使用的是String类型，前端传过来的数据无需进行类型转换</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;查询结束时间&quot;, example = &quot;2019-12-01 10:10:10&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String end;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="编写controller-3"><a href="#编写controller-3" class="headerlink" title="编写controller"></a>编写controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 4、多条件组合分页</span></span><br><span class="line"><span class="comment"> * 参数中可以使用<span class="doctag">@RequestBody</span> TeacherQuery teacherQuery</span></span><br><span class="line"><span class="comment"> * 该注释表示使用JSON格式向后端传递数据，会自动封装到对应对象中，</span></span><br><span class="line"><span class="comment"> * 且需要使用POSTMapping才能获取数据，且如果数据有空需要加上(required = false)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> current      当前页</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> limit        每页记录数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> teacherQuery 条件值（以对象的形式）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;多条件组合分页&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;pageTeacherCondition/&#123;current&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">pageListTeacherCondition</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">long</span> current,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="meta">@PathVariable</span> <span class="keyword">long</span> limit,</span></span></span><br><span class="line"><span class="params"><span class="function">                                  <span class="meta">@RequestBody(required = false)</span> TeacherQuery teacherQuery)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建page对象</span></span><br><span class="line">    Page&lt;EduTeacher&gt; pageTeacher = <span class="keyword">new</span> Page&lt;&gt;(current, limit);</span><br><span class="line">    <span class="comment">// 创建wrapper对象</span></span><br><span class="line">    QueryWrapper&lt;EduTeacher&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    <span class="comment">// 设定条件</span></span><br><span class="line">    String name = teacherQuery.getName();</span><br><span class="line">    Integer level = teacherQuery.getLevel();</span><br><span class="line">    String begin = teacherQuery.getBegin();</span><br><span class="line">    String end = teacherQuery.getEnd();</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasLength(name)) &#123;</span><br><span class="line">        wrapper.like(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (level != <span class="keyword">null</span>) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;level&quot;</span>, level);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasLength(begin)) &#123;</span><br><span class="line">        wrapper.ge(<span class="string">&quot;gmt_create&quot;</span>, begin);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasLength(end)) &#123;</span><br><span class="line">        wrapper.le(<span class="string">&quot;gmt_create&quot;</span>, end);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 调用service方法将page对象根据条件分页</span></span><br><span class="line">    teacherService.page(pageTeacher, wrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> total = pageTeacher.getTotal();</span><br><span class="line">    List&lt;EduTeacher&gt; records = pageTeacher.getRecords();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;total&quot;</span>, total).data(<span class="string">&quot;records&quot;</span>, records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="添加讲师"><a href="#添加讲师" class="headerlink" title="添加讲师"></a>添加讲师</h3><h4 id="实体类属性添加注解-1"><a href="#实体类属性添加注解-1" class="headerlink" title="实体类属性添加注解"></a>实体类属性添加注解</h4><blockquote><p>@TableField（fill = FieldFill.xxx）自动填充注解</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModelProperty(value = &quot;创建时间&quot;)</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> Date gmtCreate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiModelProperty(value = &quot;更新时间&quot;)</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> Date gmtModified;</span><br></pre></td></tr></table></figure><h4 id="创建自定义handler类"><a href="#创建自定义handler类" class="headerlink" title="创建自定义handler类"></a>创建自定义handler类</h4><blockquote><p>可以放到service_base模块，然后需要使用导入依赖即可</p><p>当对应方法被使用的使用会被调用</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.servicebase.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title">MetaObjectHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;gmtCreate&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;gmtModified&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;gmtModified&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意结构</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210921131439930.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210921131439930.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210921131439930"></p><h4 id="编写controller-4"><a href="#编写controller-4" class="headerlink" title="编写controller"></a>编写controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 5、添加讲师</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> eduTeacher</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;添加讲师&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;addTeacher&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">addTeacher</span><span class="params">(<span class="meta">@RequestBody</span> EduTeacher eduTeacher)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> save = teacherService.save(eduTeacher);</span><br><span class="line">    <span class="keyword">return</span> save ? R.ok() : R.error();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="修改讲师"><a href="#修改讲师" class="headerlink" title="修改讲师"></a>修改讲师</h3><h4 id="编写controller-5"><a href="#编写controller-5" class="headerlink" title="编写controller"></a>编写controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;根据id查询讲师&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getTeacher/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getTeacher</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> </span>&#123;</span><br><span class="line">    EduTeacher teacher = teacherService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;teacher&quot;</span>, teacher);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiOperation(&quot;修改讲师&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;updateTeacher&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">updateTeacher</span><span class="params">(<span class="meta">@RequestBody</span> EduTeacher teacher)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> flag = teacherService.updateById(teacher);</span><br><span class="line">    <span class="keyword">return</span> flag ? R.ok() : R.error();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>使用@PutMapping如下</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;修改讲师&quot;)</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;&#123;id&#125;&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">updateTeacher</span><span class="params">(<span class="meta">@PathVariable</span> String id,</span></span></span><br><span class="line"><span class="params"><span class="function">                       <span class="meta">@RequestBody</span> EduTeacher teacher)</span> </span>&#123;</span><br><span class="line">    teacher.setId(id);</span><br><span class="line">    <span class="keyword">boolean</span> flag = teacherService.updateById(teacher);</span><br><span class="line">    <span class="keyword">return</span> flag ? R.ok() : R.error();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
            <tag> 项目 </tag>
            
            <tag> SpringCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【Unity】从独立游戏学习开发</title>
      <link href="/2021/08/24/unity2d-cong-du-li-you-xi-xue-xi-kai-fa/"/>
      <url>/2021/08/24/unity2d-cong-du-li-you-xi-xue-xi-kai-fa/</url>
      
        <content type="html"><![CDATA[<h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><p>感谢bilibili视频网站M_Studio麦口老师系列视频教学，Unity2D都是从他这学的。</p><h2 id="创建项目与导入素材"><a href="#创建项目与导入素材" class="headerlink" title="创建项目与导入素材"></a>创建项目与导入素材</h2><ol><li>创建新项目</li><li>导入素材，点击菜单栏<code>Assets -&gt; ImportPackage</code></li></ol><h3 id="导入并编辑Tiles"><a href="#导入并编辑Tiles" class="headerlink" title="导入并编辑Tiles"></a>导入并编辑Tiles</h3><ol><li>点击菜单栏<code>window -&gt; 2D -&gt; tile palette</code> ，点击<code>createNewPalette</code>创建palette</li><li>导入Level文件夹下Spirit文件夹中的素材，并且适当编辑</li></ol><h2 id="TileMap"><a href="#TileMap" class="headerlink" title="TileMap"></a>TileMap</h2><ol><li>在Hierarchy窗口，创建所需要的<code>2dObject -&gt; tilemap</code></li><li>在Tile Palette窗口，选中相应<code>Active Tile Map</code>并绘制</li></ol><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210818134102428.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210818134102428.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210818134102428"></p><ol start="3"><li>在Inspector窗口设置<code>Sorting Layer</code>，如下</li></ol><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210818193555665.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210818193555665.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210818193555665"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210818193335243.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210818193335243.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210818193335243"></p><p>​    Sorting Layer中Layer越靠下越显示在前方，位于同一Layer中Order in Layer数值越大越显示在前方</p><ol start="4"><li>其中 <code> Background Details</code>用于在Background中再添加相应tile（在同一个TileMap上绘制只能显示一个tile，即使tile是含有透明背景，也会完全替换）</li></ol><h2 id="2D-Extra插件"><a href="#2D-Extra插件" class="headerlink" title="2D Extra插件"></a>2D Extra插件</h2><h3 id="RuleTile"><a href="#RuleTile" class="headerlink" title="RuleTile"></a>RuleTile</h3><ol><li>在Tiles文件夹下右键点击 <code> Create -&gt; tiles -&gt; rule tile</code>，并在Inspector窗口中设置<code> Default Sprite默认图片</code> </li><li>在Inspector窗口中，设置<code>Tiling Rules</code>，并将新tile拖拽进Tile Palette并绘制，如下</li></ol><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210818195734376.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210818195734376.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210818195734376"></p><p>​    每一个Tiling Rules中，右侧图片为符合该规则就显示的tile，九宫格中设置规则，绿色箭头表示在该方向上有tile，红色叉号表示不能有tile，同时列表中越靠上的rule优先级越高<br>​    如上设置可快速填充封闭图形的对应tile</p><ol start="3"><li>如下规则解决内角问题，注意这四个角的额外rule要放在横竖两个tile的上方</li></ol><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210818200334242.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210818200334242.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210818200334242"></p><h3 id="Brush"><a href="#Brush" class="headerlink" title="Brush"></a>Brush</h3><blockquote><p>想要添加贴合格子的物件prefab，可以使用创建brush的方式</p></blockquote><ol><li>创建brush，右键点击<code> create -&gt; Brush -&gt; prefab Brush</code></li><li>添加Element</li><li>在 <code> Tile Palette</code> 窗口中左下角使用自定义brush即可</li><li>添加的对象别忘了设置Layer以判断，同时可以使用Override使得同一物品相同设置</li></ol><h2 id="Collider和Rigidbody"><a href="#Collider和Rigidbody" class="headerlink" title="Collider和Rigidbody"></a>Collider和Rigidbody</h2><h3 id="Platform设置Collider和Rigidbody"><a href="#Platform设置Collider和Rigidbody" class="headerlink" title="Platform设置Collider和Rigidbody"></a>Platform设置Collider和Rigidbody</h3><ol><li>选中Platform对象，在Inspector窗口下方点击 <code> add component -&gt; Tilemap Collider 2D</code></li><li>勾选collider中的 <code> user By Composite</code>，即使用复合碰撞体，按照提示添加<code> Composite Collider 2D</code>，则整个Platform为一个整体碰撞体</li><li>将随之添加的<code> rigidbody -&gt; bodytype设置为static</code>，即可保持Platform固定，而不会因为gravity重力下落</li><li>同时也可以将Platform本身设置为static</li></ol><h3 id="Player设置Collider和Rigidbody"><a href="#Player设置Collider和Rigidbody" class="headerlink" title="Player设置Collider和Rigidbody"></a>Player设置Collider和Rigidbody</h3><ol><li>选中Player对象，点击 <code> add component -&gt; rigidbody 2D</code>，并设置参数如下</li></ol><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210819114945303.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210819114945303.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210819114945303"></p><p>​        注意<code>Colllision Detection 碰撞方式</code>设置为Continuous，即可持续判断是否产生碰撞；<code> Interpolate差值</code>设置为Interpolate，即可当下落碰撞时对碰撞体产生一定效果（基于上一帧物体位置来插值模拟）</p><ol start="2"><li>点击 <code> add component -&gt; Box Collider 2D</code>，并点击Edit设置碰撞体范围</li><li>同时在<code> Constraints限制</code>选项中选择<code>Freeze Rotation Z</code>，即可防止当角色处于Platform角上时会绕着Z轴旋转掉落</li><li>同时为Collider添加Materail</li></ol><h2 id="Layer"><a href="#Layer" class="headerlink" title="Layer"></a>Layer</h2><p>为Platform和Player添加不同的Layer，用于日后判断</p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210819120442875.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210819120442875.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210819120442875"></p><h2 id="Player左右移动和形象翻转"><a href="#Player左右移动和形象翻转" class="headerlink" title="Player左右移动和形象翻转"></a>Player左右移动和形象翻转</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">public class PlayerMovement : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">   // 通过 “Header”, “Tooltip” and “Space” 属性来组织Inspector中的属性显示，即在Inspector窗口上有小标题分区显示</span><br><span class="line">    // 创建rigidbody</span><br><span class="line">    private Rigidbody2D rb;</span><br><span class="line">    </span><br><span class="line">    [Header(&quot;移动参数&quot;)]</span><br><span class="line">    public float speed = 8f;    //</span><br><span class="line">    public float crouchSpeedDivisor = 3f;   // 蹲下速度减缓量</span><br><span class="line"></span><br><span class="line">    [Header(&quot;状态&quot;)]</span><br><span class="line">    public bool isCrouch;   // 是否下蹲</span><br><span class="line"></span><br><span class="line">    float xVelocity;    // 轴速度</span><br><span class="line">    </span><br><span class="line">void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        // 获取rigidbody</span><br><span class="line">        rb = GetComponent&lt;Rigidbody2D&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    void Update()</span><br><span class="line">    &#123;    &#125;</span><br><span class="line">    // 固定帧速率下每帧都调用该函数</span><br><span class="line">    private void FixedUpdate()</span><br><span class="line">    &#123;</span><br><span class="line">        GroundMovement();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 控制角色左右移动</span><br><span class="line">    void GroundMovement()</span><br><span class="line">    &#123;</span><br><span class="line">        // 获取键盘输入并设置移动</span><br><span class="line">        xVelocity = Input.GetAxis(&quot;Horizontal&quot;);    // 返回值-1f ~ 1f，当不按下方向键时为0</span><br><span class="line">        rb.velocity = new Vector2(xVelocity * speed, rb.velocity.y);</span><br><span class="line">        // 控制朝向</span><br><span class="line">        FlipDiraction();</span><br><span class="line">    &#125;</span><br><span class="line">    // 控制角色面向方向</span><br><span class="line">    void FlipDiraction()</span><br><span class="line">    &#123;</span><br><span class="line">        if(xVelocity &lt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.localScale = new Vector2(-1, 1);</span><br><span class="line">        &#125;else if(xVelocity &gt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.localScale = new Vector2(1, 1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Player下蹲"><a href="#Player下蹲" class="headerlink" title="Player下蹲"></a>Player下蹲</h2><p>点击<code> Edit -&gt; Project Setting -&gt; Input Manager -&gt; 复制JumpElement并修改为Crouch</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class PlayerMovement : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    // 通过 “Header”, “Tooltip” and “Space” 属性来组织Inspector中的属性显示，即在Inspector窗口上有小标题分区显示</span><br><span class="line">    </span><br><span class="line">    // rigidbody,collider</span><br><span class="line">    private Rigidbody2D rb;</span><br><span class="line">    private BoxCollider2D coll;     // 使用BoxCollider可以直接获得其中的size、offset参数</span><br><span class="line">    </span><br><span class="line">    [Header(&quot;移动参数&quot;)]</span><br><span class="line">    public float speed = 8f;    //</span><br><span class="line">    public float crouchSpeedDivisor = 3f;   // 蹲下时的速度减缓量</span><br><span class="line"></span><br><span class="line">    [Header(&quot;状态&quot;)]</span><br><span class="line">    public bool isCrouch;   // 是否下蹲</span><br><span class="line"></span><br><span class="line">    float xVelocity;    // 轴速度</span><br><span class="line"></span><br><span class="line">    // 碰撞体尺寸 (站立、下蹲时的大小、位置)</span><br><span class="line">    Vector2 colliderStandSize, colliderStandOffset,colliderCrouchSize, colliderCrouchOffset;</span><br><span class="line"></span><br><span class="line">    // 初始化参数</span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        // rigidbody,collider</span><br><span class="line">        rb = GetComponent&lt;Rigidbody2D&gt;();</span><br><span class="line">        coll = GetComponent&lt;BoxCollider2D&gt;();</span><br><span class="line"></span><br><span class="line">        // 碰撞体尺寸</span><br><span class="line">        colliderStandSize = coll.size;</span><br><span class="line">        colliderStandOffset = coll.offset;</span><br><span class="line">        colliderCrouchSize = new Vector2(coll.size.x, coll.size.y / 2f);</span><br><span class="line">        colliderCrouchOffset = new Vector2(coll.offset.x, coll.offset.y / 2f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Update is called once per frame</span><br><span class="line">    void Update()</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 固定帧速率下每帧都调用该函数</span><br><span class="line">    private void FixedUpdate()</span><br><span class="line">    &#123;</span><br><span class="line">        GroundMovement();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色左右移动</span><br><span class="line">    void GroundMovement()</span><br><span class="line">    &#123;</span><br><span class="line">        // 获取键盘输入</span><br><span class="line">        xVelocity = Input.GetAxis(&quot;Horizontal&quot;);    // 返回值-1f ~ 1f，当不按下方向键时为0</span><br><span class="line"></span><br><span class="line">        // 判断是否按下下蹲按钮、是否未按下按钮并处于下蹲状态</span><br><span class="line">        if (Input.GetButton(&quot;Crouch&quot;))</span><br><span class="line">        &#123;</span><br><span class="line">            // 控制角色下蹲</span><br><span class="line">            Crouch();</span><br><span class="line">        &#125;else if(isCrouch)</span><br><span class="line">        &#123;</span><br><span class="line">            // 控制角色起身</span><br><span class="line">            StandUp();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 控制角色速度以移动</span><br><span class="line">        rb.velocity = new Vector2(xVelocity * speed, rb.velocity.y);</span><br><span class="line">        // 控制朝向</span><br><span class="line">        FlipDiraction();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色面向方向</span><br><span class="line">    void FlipDiraction()</span><br><span class="line">    &#123;</span><br><span class="line">        if(xVelocity &lt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.localScale = new Vector2(-1, 1);</span><br><span class="line">        &#125;else if(xVelocity &gt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.localScale = new Vector2(1, 1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色下蹲</span><br><span class="line">    void Crouch()</span><br><span class="line">    &#123;</span><br><span class="line">        isCrouch = true;</span><br><span class="line">        // 下蹲时速度减缓</span><br><span class="line">        xVelocity /= crouchSpeedDivisor;</span><br><span class="line"></span><br><span class="line">        // 改变collider的尺寸</span><br><span class="line">        coll.size = colliderCrouchSize;</span><br><span class="line">        coll.offset = colliderCrouchOffset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色起立</span><br><span class="line">    void StandUp()</span><br><span class="line">    &#123;</span><br><span class="line">        isCrouch = false;</span><br><span class="line"></span><br><span class="line">        // 改变collider的尺寸</span><br><span class="line">        coll.size = colliderStandSize;</span><br><span class="line">        coll.offset = colliderStandOffset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Player跳跃"><a href="#Player跳跃" class="headerlink" title="Player跳跃"></a>Player跳跃</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class PlayerMovement : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    // 通过 “Header”, “Tooltip” and “Space” 属性来组织Inspector中的属性显示，即在Inspector窗口上有小标题分区显示</span><br><span class="line">    </span><br><span class="line">    // rigidbody,collider</span><br><span class="line">    private Rigidbody2D rb;</span><br><span class="line">    private BoxCollider2D coll;     // 使用BoxCollider可以直接获得其中的size、offset参数</span><br><span class="line">    </span><br><span class="line">    [Header(&quot;移动参数&quot;)]</span><br><span class="line">    public float speed = 8f;</span><br><span class="line">    public float crouchSpeedDivisor = 3f;   // 蹲下时的速度减缓量</span><br><span class="line"></span><br><span class="line">    [Header(&quot;跳跃参数&quot;)]</span><br><span class="line">    public float jumpForce = 6.3f;          // 跳跃力</span><br><span class="line">    public float jumpHoldForce = 1.9f;      // 长按跳跃的力</span><br><span class="line">    public float jumpHoldDuration = 0.1f;   // 长按跳跃加成</span><br><span class="line">    public float crouchJumpBoost = 2.5f;    // 下蹲跳跃的加成</span><br><span class="line"></span><br><span class="line">    [Header(&quot;状态&quot;)]</span><br><span class="line">    public bool isCrouch;   // 是否下蹲</span><br><span class="line">    public bool isOnGround; // 是否接触地面</span><br><span class="line">    public bool isJump;     // 是否跳跃</span><br><span class="line"></span><br><span class="line">    [Header(&quot;环境检测&quot;)]</span><br><span class="line">    public LayerMask groundLayer;   // 地面层</span><br><span class="line"></span><br><span class="line">    float xVelocity;    // 轴速度</span><br><span class="line">    float jumpTime;     // 跳跃时间，与duration相关</span><br><span class="line"></span><br><span class="line">    // 按键</span><br><span class="line">    bool jumpPressed, jumpHeld, crouchHeld;</span><br><span class="line"></span><br><span class="line">    // 碰撞体尺寸 (站立、下蹲时的大小、位置)</span><br><span class="line">    Vector2 colliderStandSize, colliderStandOffset,colliderCrouchSize, colliderCrouchOffset;</span><br><span class="line"></span><br><span class="line">    // 初始化参数</span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        // rigidbody,collider</span><br><span class="line">        rb = GetComponent&lt;Rigidbody2D&gt;();</span><br><span class="line">        coll = GetComponent&lt;BoxCollider2D&gt;();</span><br><span class="line"></span><br><span class="line">        // 碰撞体尺寸</span><br><span class="line">        colliderStandSize = coll.size;</span><br><span class="line">        colliderStandOffset = coll.offset;</span><br><span class="line">        colliderCrouchSize = new Vector2(coll.size.x, coll.size.y / 2f);</span><br><span class="line">        colliderCrouchOffset = new Vector2(coll.offset.x, coll.offset.y / 2f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 获取GetButton最好放在此函数中</span><br><span class="line">    void Update()</span><br><span class="line">    &#123;</span><br><span class="line">        // GetButton参数对应Project Setting -&gt; Input Manager的设置</span><br><span class="line">        jumpPressed = Input.GetButtonDown(&quot;Jump&quot;);</span><br><span class="line">        jumpHeld = Input.GetButton(&quot;Jump&quot;);</span><br><span class="line">        crouchHeld = Input.GetButton(&quot;Crouch&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 固定帧速率下每帧都调用该函数</span><br><span class="line">    private void FixedUpdate()</span><br><span class="line">    &#123;</span><br><span class="line">        // 相关物理控制</span><br><span class="line">        GroundMovement();</span><br><span class="line">        PhysicsCheck();</span><br><span class="line">        MidAirMovement();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 环境检测</span><br><span class="line">    void PhysicsCheck()</span><br><span class="line">    &#123;</span><br><span class="line">        // 是否接触地面层</span><br><span class="line">        if (coll.IsTouchingLayers(groundLayer))</span><br><span class="line">        &#123;</span><br><span class="line">            isOnGround = true;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            isOnGround = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色左右移动</span><br><span class="line">    void GroundMovement()</span><br><span class="line">    &#123;</span><br><span class="line">        // 获取键盘输入</span><br><span class="line">        xVelocity = Input.GetAxis(&quot;Horizontal&quot;);    // 返回值-1f ~ 1f，当不按下方向键时为0</span><br><span class="line"></span><br><span class="line">        // 判断是否</span><br><span class="line">        if (crouchHeld &amp;&amp; !isCrouch &amp;&amp; isOnGround)</span><br><span class="line">        &#123;</span><br><span class="line">            // 按下下蹲按钮，不处于下蹲状态，接触地面  --》 角色下蹲</span><br><span class="line">            Crouch();</span><br><span class="line">        &#125;</span><br><span class="line">        else if(!crouchHeld &amp;&amp; isCrouch)</span><br><span class="line">        &#123;</span><br><span class="line">            // 未按下按钮并处于下蹲状态 --》 角色起身</span><br><span class="line">            StandUp();</span><br><span class="line">        &#125;</span><br><span class="line">        else if(!isOnGround &amp;&amp; isCrouch)</span><br><span class="line">        &#123;</span><br><span class="line">            // 不接触地面但是处于下蹲状态  ——》 处于空中 --》 角色起身</span><br><span class="line">            StandUp();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 控制角色速度以移动</span><br><span class="line">        rb.velocity = new Vector2(xVelocity * speed, rb.velocity.y);</span><br><span class="line">        // 控制朝向</span><br><span class="line">        FlipDiraction();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色跳跃</span><br><span class="line">    void MidAirMovement()</span><br><span class="line">    &#123;</span><br><span class="line">        if(jumpPressed &amp;&amp; isOnGround &amp;&amp; !isJump)</span><br><span class="line">        &#123;</span><br><span class="line">            // isOnGround &amp;&amp; !isJump 防止蹭墙无限跳</span><br><span class="line">            // 按下了跳跃，接触地面，未处于跳跃状态 ——》 控制跳跃</span><br><span class="line"></span><br><span class="line">            // 下蹲状态跳跃，有额外力的加成</span><br><span class="line">            if (isCrouch)</span><br><span class="line">            &#123;</span><br><span class="line">                // 控制起身</span><br><span class="line">                StandUp();</span><br><span class="line">                // 添加额外力</span><br><span class="line">                rb.AddForce(new Vector2(0f, crouchJumpBoost), ForceMode2D.Impulse);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            isJump = true;</span><br><span class="line">            isOnGround = false;</span><br><span class="line"></span><br><span class="line">            // 计算跳跃时的时间，Time.time获取游戏真实持续时间(不断增长)</span><br><span class="line">            jumpTime = Time.time + jumpHoldDuration;</span><br><span class="line"></span><br><span class="line">            // 修改rb.velocity也可以实现</span><br><span class="line">            rb.AddForce(new Vector2(0f, jumpForce), ForceMode2D.Impulse);</span><br><span class="line">        &#125;</span><br><span class="line">        else if (isJump)</span><br><span class="line">        &#123;</span><br><span class="line">            // 长按跳跃，获得额外的力jumpHoldForce加成</span><br><span class="line">            if (jumpHeld)</span><br><span class="line">            &#123;</span><br><span class="line">                rb.AddForce(new Vector2(0f, jumpHoldForce), ForceMode2D.Impulse);</span><br><span class="line">            &#125;</span><br><span class="line">            // 当Time.time获取的时间比jumpTime大，即之间的时间差已经大于jumpHoldDuration的值时，即可恢复isJump</span><br><span class="line">            if (jumpTime &lt; Time.time)</span><br><span class="line">            &#123;</span><br><span class="line">                isJump = false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色面向方向</span><br><span class="line">    void FlipDiraction()</span><br><span class="line">    &#123;</span><br><span class="line">        if(xVelocity &lt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.localScale = new Vector2(-1, 1);</span><br><span class="line">        &#125;else if(xVelocity &gt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.localScale = new Vector2(1, 1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色下蹲</span><br><span class="line">    void Crouch()</span><br><span class="line">    &#123;</span><br><span class="line">        isCrouch = true;</span><br><span class="line">        // 下蹲时速度减缓</span><br><span class="line">        xVelocity /= crouchSpeedDivisor;</span><br><span class="line"></span><br><span class="line">        // 改变collider的尺寸</span><br><span class="line">        coll.size = colliderCrouchSize;</span><br><span class="line">        coll.offset = colliderCrouchOffset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色起立</span><br><span class="line">    void StandUp()</span><br><span class="line">    &#123;</span><br><span class="line">        isCrouch = false;</span><br><span class="line"></span><br><span class="line">        // 改变collider的尺寸</span><br><span class="line">        coll.size = colliderStandSize;</span><br><span class="line">        coll.offset = colliderStandOffset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Raycast射线检测"><a href="#Raycast射线检测" class="headerlink" title="Raycast射线检测"></a>Raycast射线检测</h2><h3 id="实现移动跳跃下蹲检测"><a href="#实现移动跳跃下蹲检测" class="headerlink" title="实现移动跳跃下蹲检测"></a>实现移动跳跃下蹲检测</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class PlayerMovement : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    // 通过 “Header”, “Tooltip” and “Space” 属性来组织Inspector中的属性显示，即在Inspector窗口上有小标题分区显示</span><br><span class="line">    </span><br><span class="line">    // rigidbody,collider</span><br><span class="line">    private Rigidbody2D rb;</span><br><span class="line">    private BoxCollider2D coll;     // 使用BoxCollider可以直接获得其中的size、offset参数</span><br><span class="line">    </span><br><span class="line">    [Header(&quot;移动参数&quot;)]</span><br><span class="line">    public float speed = 8f;</span><br><span class="line">    public float crouchSpeedDivisor = 3f;   // 蹲下时的速度减缓量</span><br><span class="line"></span><br><span class="line">    [Header(&quot;跳跃参数&quot;)]</span><br><span class="line">    public float jumpForce = 6.3f;          // 跳跃力</span><br><span class="line">    public float jumpHoldForce = 1.9f;      // 长按跳跃的力</span><br><span class="line">    public float jumpHoldDuration = 0.1f;   // 长按跳跃加成</span><br><span class="line">    public float crouchJumpBoost = 2.5f;    // 下蹲跳跃的加成</span><br><span class="line"></span><br><span class="line">    [Header(&quot;状态&quot;)]</span><br><span class="line">    public bool isCrouch;       // 是否下蹲</span><br><span class="line">    public bool isOnGround;     // 是否接触地面</span><br><span class="line">    public bool isHeadBlocked;  // 是否头顶遮挡</span><br><span class="line">    public bool isJump;         // 是否跳跃</span><br><span class="line"></span><br><span class="line">    [Header(&quot;环境检测&quot;)]</span><br><span class="line">    public float footOffset = 0.35f;     // 单脚的偏移值，即整体xoffset的一半</span><br><span class="line">    public float headClearance = 0.5f;  </span><br><span class="line">    public float groundDistance = 0.2f; </span><br><span class="line">    public LayerMask groundLayer;       // 地面层</span><br><span class="line"></span><br><span class="line">    float xVelocity;    // 轴速度</span><br><span class="line">    float jumpTime;     // 跳跃时间，与duration相关</span><br><span class="line"></span><br><span class="line">    // 按键</span><br><span class="line">    bool jumpPressed, jumpHeld, crouchHeld;</span><br><span class="line"></span><br><span class="line">    // 碰撞体尺寸 (站立、下蹲时的大小、位置)</span><br><span class="line">    Vector2 colliderStandSize, colliderStandOffset,colliderCrouchSize, colliderCrouchOffset;</span><br><span class="line"></span><br><span class="line">    // 初始化参数</span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        // rigidbody,collider</span><br><span class="line">        rb = GetComponent&lt;Rigidbody2D&gt;();</span><br><span class="line">        coll = GetComponent&lt;BoxCollider2D&gt;();</span><br><span class="line"></span><br><span class="line">        // 碰撞体尺寸</span><br><span class="line">        colliderStandSize = coll.size;</span><br><span class="line">        colliderStandOffset = coll.offset;</span><br><span class="line">        colliderCrouchSize = new Vector2(coll.size.x, coll.size.y / 2f);</span><br><span class="line">        colliderCrouchOffset = new Vector2(coll.offset.x, coll.offset.y / 2f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 获取GetButton最好放在此函数中</span><br><span class="line">    void Update()</span><br><span class="line">    &#123;</span><br><span class="line">        // GetButton参数对应Project Setting -&gt; Input Manager的设置</span><br><span class="line">        jumpPressed = Input.GetButtonDown(&quot;Jump&quot;);</span><br><span class="line">        jumpHeld = Input.GetButton(&quot;Jump&quot;);</span><br><span class="line">        crouchHeld = Input.GetButton(&quot;Crouch&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 固定帧速率下每帧都调用该函数</span><br><span class="line">    private void FixedUpdate()</span><br><span class="line">    &#123;</span><br><span class="line">        // 相关物理控制</span><br><span class="line">        GroundMovement();</span><br><span class="line">        PhysicsCheck();</span><br><span class="line">        MidAirMovement();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 环境检测</span><br><span class="line">    void PhysicsCheck()</span><br><span class="line">    &#123;</span><br><span class="line">        /* // 当前角色的位置和单脚左右点的offset</span><br><span class="line">         Vector2 pos = transform.position;</span><br><span class="line">         Vector2 offset = new Vector2(-footOffset, 0f);</span><br><span class="line">         // leftCheck/rightCheck即单脚左右点检测</span><br><span class="line">         RaycastHit2D leftCheck = Physics2D.Raycast(pos+offset,Vector2.down,groundDistance,groundLayer);</span><br><span class="line">         // 显示射线</span><br><span class="line">         Debug.DrawRay(pos + offset, Vector2.down, Color.red, 0.2f);</span><br><span class="line"> */</span><br><span class="line">        // 1、左右脚检测是否接触地面</span><br><span class="line">        // 获得射线检测</span><br><span class="line">        RaycastHit2D leftCheck = Raycast(new Vector2(-footOffset, 0f), Vector2.down, groundDistance, groundLayer);</span><br><span class="line">        RaycastHit2D rightCheck = Raycast(new Vector2(footOffset, 0f), Vector2.down, groundDistance, groundLayer);</span><br><span class="line"></span><br><span class="line">        // 是否接触地面层</span><br><span class="line">        //if (coll.IsTouchingLayers(groundLayer))</span><br><span class="line">        if (leftCheck || rightCheck)</span><br><span class="line">        &#123;</span><br><span class="line">            isOnGround = true;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            isOnGround = false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 2、头顶检测是否有阻挡</span><br><span class="line">        RaycastHit2D headCheck = Raycast(new Vector2(0f, coll.size.y), Vector2.up, headClearance, groundLayer);</span><br><span class="line">        if (headCheck)</span><br><span class="line">        &#123;</span><br><span class="line">            isHeadBlocked = true;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            isHeadBlocked = false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色左右移动</span><br><span class="line">    void GroundMovement()</span><br><span class="line">    &#123;</span><br><span class="line">        // 获取键盘输入</span><br><span class="line">        xVelocity = Input.GetAxis(&quot;Horizontal&quot;);    // 返回值-1f ~ 1f，当不按下方向键时为0</span><br><span class="line"></span><br><span class="line">        // 判断是否</span><br><span class="line">        if (crouchHeld &amp;&amp; !isCrouch &amp;&amp; isOnGround)</span><br><span class="line">        &#123;</span><br><span class="line">            // 按下下蹲按钮，不处于下蹲状态，接触地面  --》 角色下蹲</span><br><span class="line">            Crouch();</span><br><span class="line">        &#125;</span><br><span class="line">        else if(!crouchHeld &amp;&amp; isCrouch &amp;&amp; !isHeadBlocked)</span><br><span class="line">        &#123;</span><br><span class="line">            // 未按下按钮,处于下蹲状态,头顶无遮挡 --》 角色起身</span><br><span class="line">            StandUp();</span><br><span class="line">        &#125;</span><br><span class="line">        else if(!isOnGround &amp;&amp; isCrouch)</span><br><span class="line">        &#123;</span><br><span class="line">            // 不接触地面但是处于下蹲状态  ——》 处于空中 --》 角色起身</span><br><span class="line">            StandUp();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 控制角色速度以移动</span><br><span class="line">        rb.velocity = new Vector2(xVelocity * speed, rb.velocity.y);</span><br><span class="line">        // 控制朝向</span><br><span class="line">        FlipDiraction();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色跳跃</span><br><span class="line">    void MidAirMovement()</span><br><span class="line">    &#123;</span><br><span class="line">        if(jumpPressed &amp;&amp; isOnGround &amp;&amp; !isJump)</span><br><span class="line">        &#123;</span><br><span class="line">            // isOnGround &amp;&amp; !isJump 防止蹭墙无限跳</span><br><span class="line">            // 按下了跳跃，接触地面，未处于跳跃状态 ——》 控制跳跃</span><br><span class="line"></span><br><span class="line">            // 下蹲状态跳跃，有额外力的加成</span><br><span class="line">            if (isCrouch)</span><br><span class="line">            &#123;</span><br><span class="line">                // 控制起身</span><br><span class="line">                StandUp();</span><br><span class="line">                // 添加额外力</span><br><span class="line">                rb.AddForce(new Vector2(0f, crouchJumpBoost), ForceMode2D.Impulse);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            isJump = true;</span><br><span class="line">            isOnGround = false;</span><br><span class="line"></span><br><span class="line">            // 计算跳跃时的时间，Time.time获取游戏真实持续时间(不断增长)</span><br><span class="line">            jumpTime = Time.time + jumpHoldDuration;</span><br><span class="line"></span><br><span class="line">            // 修改rb.velocity也可以实现</span><br><span class="line">            rb.AddForce(new Vector2(0f, jumpForce), ForceMode2D.Impulse);</span><br><span class="line">        &#125;</span><br><span class="line">        else if (isJump)</span><br><span class="line">        &#123;</span><br><span class="line">            // 长按跳跃，获得额外的力jumpHoldForce加成</span><br><span class="line">            if (jumpHeld)</span><br><span class="line">            &#123;</span><br><span class="line">                rb.AddForce(new Vector2(0f, jumpHoldForce), ForceMode2D.Impulse);</span><br><span class="line">            &#125;</span><br><span class="line">            // 当Time.time获取的时间比jumpTime大，即之间的时间差已经大于jumpHoldDuration的值时，即可恢复isJump</span><br><span class="line">            if (jumpTime &lt; Time.time)</span><br><span class="line">            &#123;</span><br><span class="line">                isJump = false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色面向方向</span><br><span class="line">    void FlipDiraction()</span><br><span class="line">    &#123;</span><br><span class="line">        if(xVelocity &lt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.localScale = new Vector2(-1, 1);</span><br><span class="line">        &#125;else if(xVelocity &gt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.localScale = new Vector2(1, 1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色下蹲</span><br><span class="line">    void Crouch()</span><br><span class="line">    &#123;</span><br><span class="line">        isCrouch = true;</span><br><span class="line">        // 下蹲时速度减缓</span><br><span class="line">        xVelocity /= crouchSpeedDivisor;</span><br><span class="line"></span><br><span class="line">        // 改变collider的尺寸</span><br><span class="line">        coll.size = colliderCrouchSize;</span><br><span class="line">        coll.offset = colliderCrouchOffset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色起立</span><br><span class="line">    void StandUp()</span><br><span class="line">    &#123;</span><br><span class="line">        isCrouch = false;</span><br><span class="line"></span><br><span class="line">        // 改变collider的尺寸</span><br><span class="line">        coll.size = colliderStandSize;</span><br><span class="line">        coll.offset = colliderStandOffset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 增强Raycast函数</span><br><span class="line">    RaycastHit2D Raycast(Vector2 offset, Vector2 rayDirection, float length, LayerMask layer)</span><br><span class="line">    &#123;</span><br><span class="line">        // 当前角色的位置</span><br><span class="line">        Vector2 pos = transform.position;</span><br><span class="line">        // 创建射线</span><br><span class="line">        RaycastHit2D hit = Physics2D.Raycast(pos + offset, rayDirection, length, layer);</span><br><span class="line"></span><br><span class="line">        // 显示射线,hit返回是否碰撞布尔值</span><br><span class="line">        Color color = hit ? Color.red : Color.green;</span><br><span class="line">        Debug.DrawRay(pos + offset, rayDirection, color);</span><br><span class="line"></span><br><span class="line">        return hit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="实现悬挂功能以及下蹲跳跃的优化"><a href="#实现悬挂功能以及下蹲跳跃的优化" class="headerlink" title="实现悬挂功能以及下蹲跳跃的优化"></a>实现悬挂功能以及下蹲跳跃的优化</h3><blockquote><p>判断Raycast射线是否为TRUE的条件：为射线中有接触碰撞体，但是射线起点没有接触碰撞体；</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class PlayerMovement : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    // 通过 “Header”, “Tooltip” and “Space” 属性来组织Inspector中的属性显示，即在Inspector窗口上有小标题分区显示</span><br><span class="line">    </span><br><span class="line">    // rigidbody,collider</span><br><span class="line">    private Rigidbody2D rb;</span><br><span class="line">    private BoxCollider2D coll;     // 使用BoxCollider可以直接获得其中的size、offset参数</span><br><span class="line">    </span><br><span class="line">    [Header(&quot;移动参数&quot;)]</span><br><span class="line">    public float speed = 8f;</span><br><span class="line">    public float crouchSpeedDivisor = 3f;   // 蹲下时的速度减缓量</span><br><span class="line"></span><br><span class="line">    [Header(&quot;跳跃参数&quot;)]</span><br><span class="line">    public float jumpForce = 6.3f;          // 跳跃力</span><br><span class="line">    public float jumpHoldForce = 1.9f;      // 长按跳跃的力</span><br><span class="line">    public float jumpHoldDuration = 0.1f;   // 长按跳跃加成</span><br><span class="line">    public float crouchJumpBoost = 2.5f;    // 下蹲跳跃的加成</span><br><span class="line">    public float hangingJumpForce = 15f;     // 悬挂时跳跃的力</span><br><span class="line"></span><br><span class="line">    [Header(&quot;状态&quot;)]</span><br><span class="line">    public bool isCrouch;       // 是否下蹲</span><br><span class="line">    public bool isOnGround;     // 是否接触地面</span><br><span class="line">    public bool isHeadBlocked;  // 是否头顶遮挡</span><br><span class="line">    public bool isJump;         // 是否跳跃</span><br><span class="line">    public bool isHanging;      // 是否悬挂</span><br><span class="line"></span><br><span class="line">    [Header(&quot;环境检测&quot;)]</span><br><span class="line">    public LayerMask groundLayer;       // 地面层</span><br><span class="line">    public float headClearance = 0.25f;  </span><br><span class="line">    public float groundDistance = 0.2f; </span><br><span class="line">    public float grabDistance = 0.4f;   // 抓取距离</span><br><span class="line">    public float reachOffset = 0.7f;    // 接触偏移值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    float footOffset;     // 单脚的偏移值，即整体xsize的一半</span><br><span class="line">    float xVelocity;    // 轴加速度</span><br><span class="line">    float jumpTime;     // 跳跃时间，与duration相关</span><br><span class="line">    float playerHeight; // 角色高度</span><br><span class="line">    float eyeHeight;      // 角色眼睛高度</span><br><span class="line"></span><br><span class="line">    // 按键</span><br><span class="line">    bool jumpPressed, jumpHeld, crouchHeld, crouchPressed;</span><br><span class="line"></span><br><span class="line">    // 碰撞体尺寸 (站立、下蹲时的大小、位置)</span><br><span class="line">    Vector2 colliderStandSize, colliderStandOffset,colliderCrouchSize, colliderCrouchOffset;</span><br><span class="line"></span><br><span class="line">    // 初始化参数</span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        // rigidbody,collider</span><br><span class="line">        rb = GetComponent&lt;Rigidbody2D&gt;();</span><br><span class="line">        coll = GetComponent&lt;BoxCollider2D&gt;();</span><br><span class="line"></span><br><span class="line">        footOffset = coll.size.x / 2;</span><br><span class="line">        playerHeight = coll.size.y;</span><br><span class="line">        eyeHeight = playerHeight - 0.4f;</span><br><span class="line"></span><br><span class="line">        // 碰撞体尺寸</span><br><span class="line">        colliderStandSize = coll.size;</span><br><span class="line">        colliderStandOffset = coll.offset;</span><br><span class="line">        colliderCrouchSize = new Vector2(coll.size.x, coll.size.y / 2f);</span><br><span class="line">        colliderCrouchOffset = new Vector2(coll.offset.x, coll.offset.y / 2f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 获取GetButton最好放在此函数中</span><br><span class="line">    void Update()</span><br><span class="line">    &#123;</span><br><span class="line">        // GetButton参数对应Project Setting -&gt; Input Manager的设置</span><br><span class="line">        jumpPressed = Input.GetButtonDown(&quot;Jump&quot;);</span><br><span class="line">        jumpHeld = Input.GetButton(&quot;Jump&quot;);</span><br><span class="line">        crouchHeld = Input.GetButton(&quot;Crouch&quot;);</span><br><span class="line">        crouchPressed = Input.GetButtonDown(&quot;Crouch&quot;);</span><br><span class="line"></span><br><span class="line">        playerHeight = coll.size.y;</span><br><span class="line">        eyeHeight = playerHeight - 0.4f;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 固定帧速率下每帧都调用该函数</span><br><span class="line">    private void FixedUpdate()</span><br><span class="line">    &#123;</span><br><span class="line">        // 相关物理控制</span><br><span class="line">        GroundMovement();</span><br><span class="line">        PhysicsCheck();</span><br><span class="line">        MidAirMovement();</span><br><span class="line">        CrouchMovement();</span><br><span class="line">        HangdingMovement();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 环境检测</span><br><span class="line">    void PhysicsCheck()</span><br><span class="line">    &#123;</span><br><span class="line">        /* // 当前角色的位置和单脚左右点的offset</span><br><span class="line">         Vector2 pos = transform.position;</span><br><span class="line">         Vector2 offset = new Vector2(-footOffset, 0f);</span><br><span class="line">         // leftCheck/rightCheck即单脚左右点检测</span><br><span class="line">         RaycastHit2D leftCheck = Physics2D.Raycast(pos+offset,Vector2.down,groundDistance,groundLayer);</span><br><span class="line">         // 显示射线</span><br><span class="line">         Debug.DrawRay(pos + offset, Vector2.down, Color.red, 0.2f);</span><br><span class="line"> */</span><br><span class="line">        // 1、左右脚射线检测 是否接触地面</span><br><span class="line">        // 获得射线检测</span><br><span class="line">        RaycastHit2D leftCheck = Raycast(new Vector2(-footOffset, 0f), Vector2.down, groundDistance, groundLayer);</span><br><span class="line">        RaycastHit2D rightCheck = Raycast(new Vector2(footOffset, 0f), Vector2.down, groundDistance, groundLayer);</span><br><span class="line"></span><br><span class="line">        // 是否接触地面层</span><br><span class="line">        //if (coll.IsTouchingLayers(groundLayer))</span><br><span class="line">        if (leftCheck || rightCheck)</span><br><span class="line">            isOnGround = true;</span><br><span class="line">        else</span><br><span class="line">            isOnGround = false;</span><br><span class="line"></span><br><span class="line">        // 2、头顶射线检测 是否有阻挡</span><br><span class="line">        RaycastHit2D headCheck = Raycast(new Vector2(0f, playerHeight), Vector2.up, headClearance, groundLayer);</span><br><span class="line">        if (headCheck)</span><br><span class="line">            isHeadBlocked = true;</span><br><span class="line">        else</span><br><span class="line">            isHeadBlocked = false;</span><br><span class="line"></span><br><span class="line">        // 3、头前方区域射线检测 是否悬挂</span><br><span class="line">        float diraction = transform.localScale.x;</span><br><span class="line">        RaycastHit2D blockedCheck = Raycast(new Vector2(footOffset * diraction, playerHeight), new Vector2(diraction,0f), grabDistance, groundLayer);</span><br><span class="line">        RaycastHit2D wallCheck = Raycast(new Vector2(footOffset * diraction, eyeHeight), new Vector2(diraction, 0f), grabDistance, groundLayer);</span><br><span class="line">        RaycastHit2D ledgeCheck = Raycast(new Vector2(reachOffset * diraction, playerHeight), Vector2.down, grabDistance, groundLayer);</span><br><span class="line"></span><br><span class="line">        if (!isOnGround &amp;&amp; rb.velocity.y &lt; 0f &amp;&amp; ledgeCheck &amp;&amp; wallCheck &amp;&amp; !blockedCheck)</span><br><span class="line">        &#123;</span><br><span class="line">            // 将player固定在一个位置</span><br><span class="line">            Vector3 pos = transform.position;</span><br><span class="line">            pos.x += (wallCheck.distance - 0.05f) * diraction;    // RaycastHit2D下的distance为起始点到接触点的距离</span><br><span class="line">            pos.y -= ledgeCheck.distance;</span><br><span class="line">            transform.position = pos;</span><br><span class="line"></span><br><span class="line">            rb.bodyType = RigidbodyType2D.Static;   // 让角色静止</span><br><span class="line">            isHanging = true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色左右移动</span><br><span class="line">    void GroundMovement()</span><br><span class="line">    &#123;</span><br><span class="line">        // 悬挂时不允许移动</span><br><span class="line">        if (isHanging)</span><br><span class="line">            return;</span><br><span class="line"></span><br><span class="line">        // 获取键盘输入</span><br><span class="line">        xVelocity = Input.GetAxis(&quot;Horizontal&quot;);    // 返回值-1f ~ 1f，当不按下方向键时为0</span><br><span class="line">        // 控制角色速度以移动</span><br><span class="line">        rb.velocity = new Vector2(xVelocity * speed, rb.velocity.y);</span><br><span class="line">        // 控制朝向</span><br><span class="line">        FlipDiraction();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色下蹲起立</span><br><span class="line">    void CrouchMovement()</span><br><span class="line">    &#123;</span><br><span class="line">        if (crouchHeld &amp;&amp; !isCrouch &amp;&amp; isOnGround)</span><br><span class="line">        &#123;</span><br><span class="line">            // 按下下蹲按钮，不处于下蹲状态，接触地面  --》 角色下蹲</span><br><span class="line">            Crouch();</span><br><span class="line">        &#125;</span><br><span class="line">        else if (!crouchHeld &amp;&amp; isCrouch &amp;&amp; !isHeadBlocked)</span><br><span class="line">        &#123;</span><br><span class="line">            // 未按下按钮,处于下蹲状态,头顶无遮挡 --》 角色起身</span><br><span class="line">            StandUp();</span><br><span class="line">        &#125;</span><br><span class="line">        else if (!isOnGround &amp;&amp; isCrouch)</span><br><span class="line">        &#123;</span><br><span class="line">            // 不接触地面但是处于下蹲状态  ——》 处于空中 --》 角色起身</span><br><span class="line">            StandUp();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色跳跃</span><br><span class="line">    void MidAirMovement()</span><br><span class="line">    &#123;</span><br><span class="line">        // 跳跃检测</span><br><span class="line">        if(jumpPressed &amp;&amp; isOnGround &amp;&amp; !isJump &amp;&amp; !isHeadBlocked)</span><br><span class="line">        &#123;</span><br><span class="line">            // isOnGround &amp;&amp; !isJump 防止蹭墙无限跳</span><br><span class="line">            // 按下了跳跃，接触地面，未处于跳跃状态 ——》 控制跳跃</span><br><span class="line"></span><br><span class="line">            // 下蹲状态跳跃，有额外力的加成</span><br><span class="line">            if (isCrouch &amp;&amp; !isHeadBlocked)</span><br><span class="line">            &#123;</span><br><span class="line">                // 控制起身</span><br><span class="line">                StandUp();</span><br><span class="line">                // 添加额外力</span><br><span class="line">                rb.AddForce(new Vector2(0f, crouchJumpBoost), ForceMode2D.Impulse);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            isJump = true;</span><br><span class="line">            isOnGround = false;</span><br><span class="line"></span><br><span class="line">            // 计算跳跃时的时间，Time.time获取游戏真实持续时间(不断增长)</span><br><span class="line">            jumpTime = Time.time + jumpHoldDuration;</span><br><span class="line"></span><br><span class="line">            // 修改rb.velocity也可以实现</span><br><span class="line">            rb.AddForce(new Vector2(0f, jumpForce), ForceMode2D.Impulse);</span><br><span class="line">        &#125;</span><br><span class="line">        else if (isJump)</span><br><span class="line">        &#123;</span><br><span class="line">            // 长按跳跃，获得额外的力jumpHoldForce加成</span><br><span class="line">            if (jumpHeld)</span><br><span class="line">            &#123;</span><br><span class="line">                rb.AddForce(new Vector2(0f, jumpHoldForce), ForceMode2D.Impulse);</span><br><span class="line">            &#125;</span><br><span class="line">            // 当Time.time获取的时间比jumpTime大，即之间的时间差已经大于jumpHoldDuration的值时，即可恢复isJump</span><br><span class="line">            if (jumpTime &lt; Time.time)</span><br><span class="line">            &#123;</span><br><span class="line">                isJump = false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色悬挂时跳跃与下蹲</span><br><span class="line">    void HangdingMovement()</span><br><span class="line">    &#123;</span><br><span class="line">        // 悬挂时检测</span><br><span class="line">        if (isHanging)</span><br><span class="line">        &#123;</span><br><span class="line">            if (jumpPressed)</span><br><span class="line">            &#123;</span><br><span class="line">                rb.bodyType = RigidbodyType2D.Dynamic;</span><br><span class="line">                rb.AddForce(new Vector2(0f, hangingJumpForce), ForceMode2D.Impulse);</span><br><span class="line">                isHanging = false;</span><br><span class="line">            &#125;</span><br><span class="line">            else if (crouchPressed)</span><br><span class="line">            &#123;</span><br><span class="line">                rb.bodyType = RigidbodyType2D.Dynamic;</span><br><span class="line">                isHanging = false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色面向方向</span><br><span class="line">    void FlipDiraction()</span><br><span class="line">    &#123;</span><br><span class="line">        if(xVelocity &lt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.localScale = new Vector2(-1, 1);</span><br><span class="line">        &#125;else if(xVelocity &gt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.localScale = new Vector2(1, 1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色下蹲</span><br><span class="line">    void Crouch()</span><br><span class="line">    &#123;</span><br><span class="line">        isCrouch = true;</span><br><span class="line">        // 下蹲时速度减缓</span><br><span class="line">        xVelocity /= crouchSpeedDivisor;</span><br><span class="line"></span><br><span class="line">        // 改变collider的尺寸</span><br><span class="line">        coll.size = colliderCrouchSize;</span><br><span class="line">        coll.offset = colliderCrouchOffset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 控制角色起立</span><br><span class="line">    void StandUp()</span><br><span class="line">    &#123;</span><br><span class="line">        isCrouch = false;</span><br><span class="line"></span><br><span class="line">        // 改变collider的尺寸</span><br><span class="line">        coll.size = colliderStandSize;</span><br><span class="line">        coll.offset = colliderStandOffset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 增强Raycast函数</span><br><span class="line">    RaycastHit2D Raycast(Vector2 offset, Vector2 rayDirection, float length, LayerMask layer)</span><br><span class="line">    &#123;</span><br><span class="line">        // 当前角色的位置</span><br><span class="line">        Vector2 pos = transform.position;</span><br><span class="line">        // 创建射线</span><br><span class="line">        RaycastHit2D hit = Physics2D.Raycast(pos + offset, rayDirection, length, layer);</span><br><span class="line"></span><br><span class="line">        // 显示射线,hit返回是否碰撞布尔值</span><br><span class="line">        Color color = hit ? Color.red : Color.green;</span><br><span class="line">        Debug.DrawRay(pos + offset, rayDirection, color);</span><br><span class="line"></span><br><span class="line">        return hit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2D透视效果与摄像机"><a href="#2D透视效果与摄像机" class="headerlink" title="2D透视效果与摄像机"></a>2D透视效果与摄像机</h2><ol><li><code>PackageManager -&gt; CineMachines</code>插件导入，添加<code>Follow</code>选项</li><li><code>body -&gt; dead zone</code>锁死范围，在该范围内移动不会跟着移动摄像机</li><li><code>body -&gt; Screen</code> 设置follow角色在摄像机的哪个位置</li><li><code>body -&gt; CameraDistance</code> 设置摄像机包括范围</li><li><code> Main Camera -&gt; Projection -&gt; Perspective</code>，即可模拟正常摄像机效果（切换Scene 2D即可查看） </li><li><code>Extension -&gt; Confiner</code>添加摄像机移动边界，为Background添加Collider，注意一定要点选<code>is trigger</code>选项</li></ol><h2 id="灯光"><a href="#灯光" class="headerlink" title="灯光"></a>灯光</h2><ol><li>对Object右键<code>light -&gt; point light</code> 添加点光源</li><li>为Plateform、Background添加materail</li><li><code> Window -&gt; Rendering -&gt;light -&gt;Enviroment -&gt; Ambient Color</code>，设置主场景灯光</li></ol><h2 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h2><ol><li><code> Window -&gt; Animator/Animation</code>，打开窗口 </li><li>添加script：PlayerAnimation如下</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class PlayerAnimation : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    Animator animator;</span><br><span class="line">    PlayerMovement movement;</span><br><span class="line">    int groundID;</span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        animator = GetComponent&lt;Animator&gt;();</span><br><span class="line">        groundID = Animator.StringToHash(&quot;isOnGround&quot;);</span><br><span class="line">        // 获取父组件的脚本</span><br><span class="line">        movement = GetComponentInParent&lt;PlayerMovement&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void Update()</span><br><span class="line">    &#123;</span><br><span class="line">        // 设置animatior的状态值</span><br><span class="line">        animator.SetFloat(&quot;speed&quot;, Mathf.Abs(movement.xVelocity));</span><br><span class="line">        // 使用编号对应赋值、字符串对应赋值</span><br><span class="line">        animator.SetBool(groundID, movement.isOnGround);</span><br><span class="line">        animator.SetBool(&quot;isJumping&quot;, movement.isJump);</span><br><span class="line">        animator.SetBool(&quot;isCrouching&quot;, movement.isCrouch);</span><br><span class="line">        animator.SetBool(&quot;isHanging&quot;, movement.isHanging);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用BlendTree"><a href="#使用BlendTree" class="headerlink" title="使用BlendTree"></a>使用BlendTree</h3><ol><li>在Animator的BaseLayer中右键<code> Create State -&gt; From New Blend Tree</code></li><li>点击新的BlendTreeState，在<code>Inspector -&gt; Motion 添加Motion</code>，添加每一个motion对应的animation，且将Parameter设置为自定义的state</li><li><code>Threshold临界值</code>选项，当对应parameter值复合某一threshold值时会播放该animation，注意垂直向上水平向右为正</li></ol><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210820202829801.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210820202829801.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210820202829801"></p><p>​    上图中MidAir1~7为起跳到下落的动画</p><ol start="4"><li> 修改动画脚本如下</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class PlayerAnimation : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    Animator animator;</span><br><span class="line">    PlayerMovement movement;</span><br><span class="line">    Rigidbody2D rb;</span><br><span class="line">    int speedID, groundID, jumpingID, crouchingID, hangingID, fallId;</span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        animator = GetComponent&lt;Animator&gt;();</span><br><span class="line"></span><br><span class="line">        // animatior parameter对应编号</span><br><span class="line">        speedID = Animator.StringToHash(&quot;speed&quot;);</span><br><span class="line">        groundID = Animator.StringToHash(&quot;isOnGround&quot;);</span><br><span class="line">        jumpingID = Animator.StringToHash(&quot;isJumping&quot;);</span><br><span class="line">        crouchingID = Animator.StringToHash(&quot;isCrouching&quot;);</span><br><span class="line">        hangingID = Animator.StringToHash(&quot;isHanging&quot;);</span><br><span class="line">        fallId = Animator.StringToHash(&quot;verticalVelocity&quot;);</span><br><span class="line">        // 获取父组件的脚本</span><br><span class="line">        movement = GetComponentInParent&lt;PlayerMovement&gt;();</span><br><span class="line">        rb = GetComponentInParent&lt;Rigidbody2D&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void Update()</span><br><span class="line">    &#123;</span><br><span class="line">        // 设置animatior的状态值，两种方法（使用编号对应赋值、字符串对应赋值）</span><br><span class="line">        // animator.SetFloat(&quot;speed&quot;, Mathf.Abs(movement.xVelocity));</span><br><span class="line">        animator.SetFloat(speedID, Mathf.Abs(movement.xVelocity));</span><br><span class="line">        animator.SetBool(groundID, movement.isOnGround);</span><br><span class="line">        animator.SetBool(jumpingID, movement.isJump);</span><br><span class="line">        animator.SetBool(crouchingID, movement.isCrouch);</span><br><span class="line">        animator.SetBool(hangingID, movement.isHanging);</span><br><span class="line">        animator.SetFloat(fallId, rb.velocity.y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="音效"><a href="#音效" class="headerlink" title="音效"></a>音效</h2><ol><li>注意Animation窗口中对应动画，含有特定的<code>animation event</code>需要添加</li><li>添加<code>AudioManager(Prefab)</code>，并为其添加script如下</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using UnityEngine.Audio;</span><br><span class="line"></span><br><span class="line">public class AudioManager : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    static AudioManager current;</span><br><span class="line"></span><br><span class="line">    [Header(&quot;环境声音&quot;)]</span><br><span class="line">    public AudioClip ambientCilip; </span><br><span class="line">    public AudioClip musicClip;</span><br><span class="line"></span><br><span class="line">    [Header(&quot;角色音效&quot;)]</span><br><span class="line">    public AudioClip[] walkStepClips;</span><br><span class="line">    public AudioClip[] crouchStepClips;</span><br><span class="line">    public AudioClip jumpClip;</span><br><span class="line">    public AudioClip jumpVoiceClip;</span><br><span class="line"></span><br><span class="line">    public void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">        current = this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​        同时在<code>AudioManager(Prefab)</code>中选择相应的音效</p><ol start="3"><li>添加AudioSource</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using UnityEngine.Audio;</span><br><span class="line"></span><br><span class="line">public class AudioManager : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    // ...</span><br><span class="line"></span><br><span class="line">    AudioSource ambientSource, musicSource, fxSource, playerSource, voiceSource;</span><br><span class="line"></span><br><span class="line">    public void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">        // 单例模式</span><br><span class="line">        if(current != null)</span><br><span class="line">        &#123;</span><br><span class="line">            Destroy(gameObject);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        // 方便在static方法中使用this</span><br><span class="line">        current = this;</span><br><span class="line"></span><br><span class="line">        // 防止场景加载时被销毁</span><br><span class="line">        DontDestroyOnLoad(gameObject);</span><br><span class="line"></span><br><span class="line">        // 使用代码添加AudioSource组件</span><br><span class="line">        ambientSource = gameObject.AddComponent&lt;AudioSource&gt;();</span><br><span class="line">        musicSource = gameObject.AddComponent&lt;AudioSource&gt;();</span><br><span class="line">        fxSource = gameObject.AddComponent&lt;AudioSource&gt;();</span><br><span class="line">        playerSource = gameObject.AddComponent&lt;AudioSource&gt;();</span><br><span class="line">        voiceSource = gameObject.AddComponent&lt;AudioSource&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void PlayFootstepAudio()</span><br><span class="line">    &#123;</span><br><span class="line">        // 获得随机数</span><br><span class="line">        int index = Random.Range(0, current.walkStepClips.Length);</span><br><span class="line">        // 指定source的clip声音片段</span><br><span class="line">        current.playerSource.clip = current.walkStepClips[index];</span><br><span class="line">        // 播放</span><br><span class="line">        current.playerSource.Play();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>在<code>PlayerAnimation</code>中调用方法</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public void StepAudio()</span><br><span class="line">&#123;</span><br><span class="line">    AudioManager.PlayFootstepAudio();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>其他音效同理，完整如下</li></ol><p><code>AudioManager</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using UnityEngine.Audio;</span><br><span class="line"></span><br><span class="line">public class AudioManager : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    static AudioManager current;</span><br><span class="line"></span><br><span class="line">    [Header(&quot;环境声音&quot;)]</span><br><span class="line">    public AudioClip ambientClip; </span><br><span class="line">    public AudioClip musicClip;</span><br><span class="line"></span><br><span class="line">    [Header(&quot;角色音效&quot;)]</span><br><span class="line">    public AudioClip[] walkStepClips;</span><br><span class="line">    public AudioClip[] crouchStepClips;</span><br><span class="line">    public AudioClip jumpClip;</span><br><span class="line">    public AudioClip jumpVoiceClip;</span><br><span class="line"></span><br><span class="line">    // clip声音片段，source声音源</span><br><span class="line">    AudioSource ambientSource, musicSource, fxSource, playerSource, voiceSource;</span><br><span class="line"></span><br><span class="line">    public void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">        // 单例模式</span><br><span class="line">        if(current != null)</span><br><span class="line">        &#123;</span><br><span class="line">            Destroy(gameObject);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        // 方便在static方法中使用this</span><br><span class="line">        current = this;</span><br><span class="line"></span><br><span class="line">        // 防止场景加载时被销毁</span><br><span class="line">        DontDestroyOnLoad(gameObject);</span><br><span class="line"></span><br><span class="line">        // 使用代码添加AudioSource组件</span><br><span class="line">        ambientSource = gameObject.AddComponent&lt;AudioSource&gt;();</span><br><span class="line">        musicSource = gameObject.AddComponent&lt;AudioSource&gt;();</span><br><span class="line">        fxSource = gameObject.AddComponent&lt;AudioSource&gt;();</span><br><span class="line">        playerSource = gameObject.AddComponent&lt;AudioSource&gt;();</span><br><span class="line">        voiceSource = gameObject.AddComponent&lt;AudioSource&gt;();</span><br><span class="line"></span><br><span class="line">        // 背景音乐不需要触发，直接播放</span><br><span class="line">        StartLevelAudio();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 背景音乐</span><br><span class="line">    void StartLevelAudio()</span><br><span class="line">    &#123;</span><br><span class="line">        // 打开循环</span><br><span class="line">        current.ambientSource.clip = current.ambientClip;</span><br><span class="line">        current.ambientSource.loop = true;</span><br><span class="line">        current.ambientSource.Play();</span><br><span class="line"></span><br><span class="line">        current.musicSource.clip = current.musicClip;</span><br><span class="line">        current.musicSource.loop = true;</span><br><span class="line">        current.musicSource.Play();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 角色走动音效</span><br><span class="line">    public static void PlayFootstepAudio()</span><br><span class="line">    &#123;</span><br><span class="line">        // 获得随机数</span><br><span class="line">        int index = Random.Range(0, current.walkStepClips.Length);</span><br><span class="line">        // 指定source的clip声音片段</span><br><span class="line">        current.playerSource.clip = current.walkStepClips[index];</span><br><span class="line">        // 播放</span><br><span class="line">        current.playerSource.Play();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 角色下蹲音效</span><br><span class="line">    public static void PlayCrouchFootstepAudio()</span><br><span class="line">    &#123;</span><br><span class="line">        int index = Random.Range(0, current.crouchStepClips.Length);</span><br><span class="line">        current.playerSource.clip = current.crouchStepClips[index];</span><br><span class="line">        current.playerSource.Play();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 角色跳跃音效</span><br><span class="line">    public static void PlayJumpAudio()</span><br><span class="line">    &#123;</span><br><span class="line">        current.playerSource.clip = current.jumpClip;</span><br><span class="line">        current.playerSource.Play();</span><br><span class="line"></span><br><span class="line">        current.voiceSource.clip = current.jumpVoiceClip;</span><br><span class="line">        current.voiceSource.Play();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>PlayerAnimation</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class PlayerAnimation : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    Animator animator;</span><br><span class="line">    PlayerMovement movement;</span><br><span class="line">    Rigidbody2D rb;</span><br><span class="line">    int speedID, groundID, jumpingID, crouchingID, hangingID, fallId;</span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        animator = GetComponent&lt;Animator&gt;();</span><br><span class="line"></span><br><span class="line">        // animatior parameter对应编号</span><br><span class="line">        speedID = Animator.StringToHash(&quot;speed&quot;);</span><br><span class="line">        groundID = Animator.StringToHash(&quot;isOnGround&quot;);</span><br><span class="line">        jumpingID = Animator.StringToHash(&quot;isJumping&quot;);</span><br><span class="line">        crouchingID = Animator.StringToHash(&quot;isCrouching&quot;);</span><br><span class="line">        hangingID = Animator.StringToHash(&quot;isHanging&quot;);</span><br><span class="line">        fallId = Animator.StringToHash(&quot;verticalVelocity&quot;);</span><br><span class="line">        // 获取父组件的脚本</span><br><span class="line">        movement = GetComponentInParent&lt;PlayerMovement&gt;();</span><br><span class="line">        rb = GetComponentInParent&lt;Rigidbody2D&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void Update()</span><br><span class="line">    &#123;</span><br><span class="line">        // 设置animatior的状态值，两种方法（使用编号对应赋值、字符串对应赋值）</span><br><span class="line">        // animator.SetFloat(&quot;speed&quot;, Mathf.Abs(movement.xVelocity));</span><br><span class="line">        animator.SetFloat(speedID, Mathf.Abs(movement.xVelocity));</span><br><span class="line">        animator.SetBool(groundID, movement.isOnGround);</span><br><span class="line">        animator.SetBool(jumpingID, movement.isJump);</span><br><span class="line">        animator.SetBool(crouchingID, movement.isCrouch);</span><br><span class="line">        animator.SetBool(hangingID, movement.isHanging);</span><br><span class="line">        animator.SetFloat(fallId, rb.velocity.y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void StepAudio()</span><br><span class="line">    &#123;</span><br><span class="line">        AudioManager.PlayFootstepAudio();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void CrouchStepAudio()</span><br><span class="line">    &#123;</span><br><span class="line">        AudioManager.PlayCrouchFootstepAudio();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​        由于Animation中没有添加jump的event，所以直接在playerMovement中调用音效即可</p><h2 id="死亡机制"><a href="#死亡机制" class="headerlink" title="死亡机制"></a>死亡机制</h2><ol><li>添加新的cs代码如下，应用于角色，用于死亡条件判断</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class PlayerHealth : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    // 预制死亡特效</span><br><span class="line">    public GameObject deathVFXPrefab;</span><br><span class="line"></span><br><span class="line">    int trapsLayer;</span><br><span class="line"></span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        // 获得对应Layer的编号</span><br><span class="line">        trapsLayer = LayerMask.NameToLayer(&quot;Traps&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 如果一个碰撞体进入了触发器（当前角色已经被设定为isTrigger）则调用</span><br><span class="line">    private void OnTriggerEnter2D(Collider2D collision)</span><br><span class="line">    &#123;</span><br><span class="line">        if (collision.gameObject.layer == trapsLayer)</span><br><span class="line">        &#123;</span><br><span class="line">            // Instantiate实例化，此处让特效显示</span><br><span class="line">            Instantiate(deathVFXPrefab,transform.position,transform.rotation);</span><br><span class="line">            // 让角色消失</span><br><span class="line">            gameObject.SetActive(false);</span><br><span class="line">            // 播放死亡音效</span><br><span class="line">            AudioManager.PlayDeathAudio();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>添加死亡音效，注意在Inspector窗口中选择对应片段</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    [Header(&quot;角色音效&quot;)]</span><br><span class="line">    public AudioClip[] walkStepClips;</span><br><span class="line">    public AudioClip[] crouchStepClips;</span><br><span class="line">    public AudioClip jumpClip;</span><br><span class="line">    public AudioClip jumpVoiceClip;</span><br><span class="line">    public AudioClip deathClip;</span><br><span class="line">    public AudioClip deathVoiceClip;</span><br><span class="line"></span><br><span class="line">    [Header(&quot;特效音效&quot;)]</span><br><span class="line">    public AudioClip deathFXClip;</span><br><span class="line"></span><br><span class="line">// 死亡音效</span><br><span class="line">public static void PlayDeathAudio()</span><br><span class="line">&#123;</span><br><span class="line">    current.playerSource.clip = current.deathClip;</span><br><span class="line">    current.playerSource.Play();</span><br><span class="line"></span><br><span class="line">    current.voiceSource.clip = current.deathVoiceClip;</span><br><span class="line">    current.voiceSource.Play();</span><br><span class="line"></span><br><span class="line">    current.fxSource.clip = current.deathFXClip;</span><br><span class="line">    current.fxSource.Play();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>设置场景重置，在<code>file -&gt; build settings</code> 中设置scene</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine.SceneManagement;</span><br><span class="line">private void OnTriggerEnter2D(Collider2D collision)</span><br><span class="line">&#123;</span><br><span class="line">// 重置场景为当前场景</span><br><span class="line">SceneManager.LoadScene(SceneManager.GetActiveScene().buildIndex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="视觉效果与相机抖动"><a href="#视觉效果与相机抖动" class="headerlink" title="视觉效果与相机抖动"></a>视觉效果与相机抖动</h2><h3 id="Post-Processing"><a href="#Post-Processing" class="headerlink" title="Post Processing"></a>Post Processing</h3><ol><li><code> Window -&gt; PackageManager -&gt; 搜索插件Post Processing</code></li><li>为 Main Camera 添加<code>Component -&gt; Post-process Layer</code>，创建一个专门的Layer并添加</li><li>创建一个Empty Object，命名为<code>Global Post Processing</code>同时添加上一步骤中的Layer，用于承载视觉效果（如果是单独物件添加特效直接添加即可）</li><li>为该对象添加组件 <code>  Post-process Volume</code>，其中<code>is Global </code>用于影响全局，否则添加<code>collider</code>设置影响范围即可</li><li>为该对象添加<code>Profile</code>，同时<code>Add effect </code> </li></ol><h3 id="Camera-Shake"><a href="#Camera-Shake" class="headerlink" title="Camera Shake"></a>Camera Shake</h3><ol><li>在之前添加的<code>Cinemachine</code>中，<code> Inspector -&gt; Extension -&gt;Cinemachine Impulse Listener</code></li><li>在触发相机抖动效果的物件上添加组件<code>  Cinemachine Collision Impulse Source</code>(此为碰撞触发，可选其他source)，</li><li>为该组件添加<code>Raw Signal</code>即触发抖动时的效果，可以自行设置，选择TriggerObjectFilter中的LayerMask，即碰撞当前对象的Layer</li><li>其余如SignalShape中的FrequencyGain越大速度越快……</li></ol><h2 id="GameManager"><a href="#GameManager" class="headerlink" title="GameManager"></a>GameManager</h2><h3 id="死亡过渡以及相关计数"><a href="#死亡过渡以及相关计数" class="headerlink" title="死亡过渡以及相关计数"></a>死亡过渡以及相关计数</h3><ol><li>添加Script，一定命名为<code>GameManager</code>，如下编写</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using UnityEngine.SceneManagement;</span><br><span class="line"></span><br><span class="line">public class GameManager : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    static GameManager gm;</span><br><span class="line"></span><br><span class="line">    private void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">        if(gm != null)</span><br><span class="line">        &#123;</span><br><span class="line">            Destroy(gameObject);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        gm = this;</span><br><span class="line">        DontDestroyOnLoad(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void PlayerDied()</span><br><span class="line">    &#123;</span><br><span class="line">        // 经过一段时间后调用方法</span><br><span class="line">        gm.Invoke(&quot;RestartScene&quot;, 1.5f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 重启场景</span><br><span class="line">    void RestartScene()</span><br><span class="line">    &#123;</span><br><span class="line">        SceneManager.LoadScene(SceneManager.GetActiveScene().buildIndex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>添加Empty Object并应用GameManager Script</li><li>添加SceneFader Script，编写如下，应用于<code>Fader</code>(UI -&gt; Image对象，含有过渡动画，其中Animator中有Fade参数)</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class SceneFader : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    Animator anim;</span><br><span class="line">    int faderID;</span><br><span class="line"></span><br><span class="line">    private void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        anim = GetComponent&lt;Animator&gt;();</span><br><span class="line">        faderID = Animator.StringToHash(&quot;Fade&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void fadeOut()</span><br><span class="line">    &#123;</span><br><span class="line">        anim.SetTrigger(faderID);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>在GameManager中添加如下代码，这里mark一下，上网搜了其他的模式和方法，都可以实现，视频里讲的是观察者模式</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using UnityEngine.SceneManagement;</span><br><span class="line"></span><br><span class="line">public class GameManager : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    static GameManager gm;</span><br><span class="line">    SceneFader sceneFader;</span><br><span class="line"></span><br><span class="line">    private void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">        if(gm != null)</span><br><span class="line">        &#123;</span><br><span class="line">            Destroy(gameObject);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        gm = this;</span><br><span class="line">        DontDestroyOnLoad(this);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 用于通知GameManager接收一个SceneFader实例</span><br><span class="line">    //public static void RegisterSceneFader(SceneFader fader)</span><br><span class="line">    //&#123;</span><br><span class="line">    //    gm.sceneFader = fader;</span><br><span class="line">    //&#125;</span><br><span class="line"></span><br><span class="line">    public static void PlayerDied()</span><br><span class="line">    &#123;</span><br><span class="line">        //SceneFader.sf.fadeOut();</span><br><span class="line">        SceneFader.sf.fadeOut();</span><br><span class="line"></span><br><span class="line">        // 以下为另一种调用其他类的方法实现方法，还有其他方法或模式可以实现</span><br><span class="line">        //GameObject.Find(&quot;Fader&quot;).SendMessage(&quot;fadeOut&quot;);</span><br><span class="line"></span><br><span class="line">        // 经过一段时间后调用方法</span><br><span class="line">        gm.Invoke(&quot;RestartScene&quot;, 1.2f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 重启场景</span><br><span class="line">    void RestartScene()</span><br><span class="line">    &#123;</span><br><span class="line">        SceneManager.LoadScene(SceneManager.GetActiveScene().buildIndex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class SceneFader : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    // 这里使用单例模式，能让其他类调用</span><br><span class="line">    public static SceneFader sf;</span><br><span class="line"></span><br><span class="line">    Animator anim;</span><br><span class="line">    int faderID;</span><br><span class="line"></span><br><span class="line">    private void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">        if (sf != null)</span><br><span class="line">        &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        sf = this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        anim = GetComponent&lt;Animator&gt;();</span><br><span class="line">        faderID = Animator.StringToHash(&quot;Fade&quot;);</span><br><span class="line"></span><br><span class="line">        //GameManager.RegisterSceneFader(this);</span><br><span class="line">    &#125;</span><br><span class="line">    public void fadeOut()</span><br><span class="line">    &#123;</span><br><span class="line">        anim.SetTrigger(faderID);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>添加收集物的相关脚本</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using UnityEngine.SceneManagement;</span><br><span class="line"></span><br><span class="line">public class GameManager : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    static GameManager gm;</span><br><span class="line">    //SceneFader sceneFader;</span><br><span class="line">    List&lt;Orb&gt; orbs;</span><br><span class="line"></span><br><span class="line">    public int orbNum,deathNum;</span><br><span class="line"></span><br><span class="line">    private void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">        if(gm != null)</span><br><span class="line">        &#123;</span><br><span class="line">            Destroy(gameObject);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        gm = this;</span><br><span class="line">        orbs = new List&lt;Orb&gt;();</span><br><span class="line">        DontDestroyOnLoad(this);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void Update()</span><br><span class="line">    &#123;</span><br><span class="line">        orbNum = gm.orbs.Count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 用于通知GameManager接收一个SceneFader实例</span><br><span class="line">    //public static void RegisterSceneFader(SceneFader fader)</span><br><span class="line">    //&#123;</span><br><span class="line">    //    gm.sceneFader = fader;</span><br><span class="line">    //&#125;</span><br><span class="line"></span><br><span class="line">    public static void RegisterOrb(Orb orb)</span><br><span class="line">    &#123;</span><br><span class="line">        if (!gm.orbs.Contains(orb))</span><br><span class="line">        &#123;</span><br><span class="line">            gm.orbs.Add(orb);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void PlayerDied()</span><br><span class="line">    &#123;</span><br><span class="line">        //SceneFader.sf.fadeOut();</span><br><span class="line">        SceneFader.sf.fadeOut();</span><br><span class="line"></span><br><span class="line">        // 以下为另一种调用其他类的方法实现方法，还有其他方法或模式可以实现</span><br><span class="line">        //GameObject.Find(&quot;Fader&quot;).SendMessage(&quot;fadeOut&quot;);</span><br><span class="line"></span><br><span class="line">        // 经过一段时间后调用方法</span><br><span class="line">        gm.Invoke(&quot;RestartScene&quot;, 1.2f);</span><br><span class="line"></span><br><span class="line">        gm.deathNum++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void PlayerGetOrb(Orb orb)</span><br><span class="line">    &#123;</span><br><span class="line">        if (gm.orbs.Count == 0 || !gm.orbs.Contains(orb))</span><br><span class="line">            return;</span><br><span class="line">        gm.orbs.Remove(orb);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 重启场景</span><br><span class="line">    void RestartScene()</span><br><span class="line">    &#123;</span><br><span class="line">        gm.orbs.Clear();</span><br><span class="line">        SceneManager.LoadScene(SceneManager.GetActiveScene().buildIndex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class Orb : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    int playerLayer;</span><br><span class="line"></span><br><span class="line">    public GameObject explosionVFXPrefab;</span><br><span class="line"></span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        playerLayer = LayerMask.NameToLayer(&quot;Player&quot;);</span><br><span class="line">        GameManager.RegisterOrb(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void OnTriggerEnter2D(Collider2D collision)</span><br><span class="line">    &#123;</span><br><span class="line">        if(collision.gameObject.layer == playerLayer)</span><br><span class="line">        &#123;</span><br><span class="line">            GameManager.PlayerGetOrb(this);</span><br><span class="line">            Instantiate(explosionVFXPrefab, transform.position, transform.rotation);</span><br><span class="line">            gameObject.SetActive(false);</span><br><span class="line">            AudioManager.PlayOrbAudio();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Door机关"><a href="#Door机关" class="headerlink" title="Door机关"></a>Door机关</h3><p>收集物品到一定数量后打开机关</p><ol><li>编写Door Script</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class Door : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    Animator anim;</span><br><span class="line">    int openID;</span><br><span class="line"></span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        anim = GetComponent&lt;Animator&gt;();</span><br><span class="line">        openID = Animator.StringToHash(&quot;Open&quot;);</span><br><span class="line">        GameManager.RegisterDoor(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void Open()</span><br><span class="line">    &#123;</span><br><span class="line">        anim.SetTrigger(openID);</span><br><span class="line">        AudioManager.PlayOpenDoorAudio();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>编写AudioManager</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 打开门音效</span><br><span class="line">    public static void PlayOpenDoorAudio()</span><br><span class="line">    &#123;</span><br><span class="line">        current.fxSource.clip = current.doorFXClip;</span><br><span class="line">        current.fxSource.PlayDelayed(1f);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="UI-Manager"><a href="#UI-Manager" class="headerlink" title="UI Manager"></a>UI Manager</h2><h3 id="显示text"><a href="#显示text" class="headerlink" title="显示text"></a>显示text</h3><ol><li>编写一个UI Manager Object，添加script如下</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using TMPro;</span><br><span class="line"></span><br><span class="line">public class UIManager : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    static UIManager instance;</span><br><span class="line"></span><br><span class="line">    // 获得Text文本框,记得在Inspector中选择相应的text</span><br><span class="line">    public TextMeshProUGUI orbText, timeText, deathText, gameOverText;</span><br><span class="line"></span><br><span class="line">    private void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">        if(instance != null)</span><br><span class="line">        &#123;</span><br><span class="line">            Destroy(gameObject);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        instance = this;</span><br><span class="line">        DontDestroyOnLoad(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 更新Orb数量</span><br><span class="line">    public static void UpdateOrbUI(int orbCount)</span><br><span class="line">    &#123;</span><br><span class="line">        // 设置text</span><br><span class="line">        instance.orbText.text = orbCount.ToString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 其余text类似</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在GameManager中适当位置调用UIManager相应方法即可</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using TMPro;</span><br><span class="line"></span><br><span class="line">public class UIManager : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    static UIManager instance;</span><br><span class="line"></span><br><span class="line">    // 获得Text文本框,记得在Inspector中选择相应的text</span><br><span class="line">    public TextMeshProUGUI orbText, timeText, deathText, gameOverText;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private void Awake()</span><br><span class="line">    &#123;</span><br><span class="line">        if(instance != null)</span><br><span class="line">        &#123;</span><br><span class="line">            Destroy(gameObject);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        instance = this;</span><br><span class="line">        DontDestroyOnLoad(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 更新Orb数量</span><br><span class="line">    public static void UpdateOrbUI(int orbCount)</span><br><span class="line">    &#123;</span><br><span class="line">        // 设置text</span><br><span class="line">        instance.orbText.text = orbCount.ToString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 更新Death数量</span><br><span class="line">    public static void UpdateDeathUI(int deathNum)</span><br><span class="line">    &#123;</span><br><span class="line">        // 设置text</span><br><span class="line">        instance.deathText.text = deathNum.ToString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 更新Time</span><br><span class="line">    public static void UpdateTimeUI(int time)</span><br><span class="line">    &#123;</span><br><span class="line">        int minutes = time / 60;</span><br><span class="line">        int seconds = time % 60;</span><br><span class="line"></span><br><span class="line">        // 设置text</span><br><span class="line">        instance.timeText.text = minutes.ToString(&quot;00&quot;)+&quot;:&quot;+seconds.ToString(&quot;00&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Unity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 学习 </tag>
            
            <tag> Unity2D </tag>
            
            <tag> 游戏开发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【学习笔记】Vue</title>
      <link href="/2021/08/04/xue-xi-bi-ji-vue/"/>
      <url>/2021/08/04/xue-xi-bi-ji-vue/</url>
      
        <content type="html"><![CDATA[<h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><p><a href="https://www.bilibili.com/video/BV1Zy4y1K7SH">【尚硅谷】2021最新Vue迅速上手教程丨vue3.0入门到精通_张天禹老师</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​        昨天看完springboot2的教学视频，计划着接下来要学什么，毕竟休息一天，就会一直偷懒下去。早上刚看到群里发企业项目要找个会vue，再结合结合vue的热度，虽然自己并不像和前端有太多纠葛<del>（因为强迫症）</del>，但是大势所趋，都向着全栈靠呢，而且个人项目肯定也得自己做，所以学了都是好处没坏处。        其实七月初的时候看过两天的vue语法视频<del>（为了暑假集训教学，其实并没有什么用，还忘光了）</del>，也没有记笔记，现在正式的看，好好学，好好记，目测两个星期看完？<del>（毕竟也是学了点vue和微信小程序的，上手应该快）</del>看完之后得做个项目了，vue+springboot，不过学期开学也要做个人项目，到时候做也是可以的。</p><h2 id="Vue简介"><a href="#Vue简介" class="headerlink" title="Vue简介"></a>Vue简介</h2><h3 id="什么是Vue"><a href="#什么是Vue" class="headerlink" title="什么是Vue"></a>什么是Vue</h3><blockquote><p>一套用于构建用户界面的渐进式JavaScript框架。</p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210804144318448.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210804144318448.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210804144318448"></p></blockquote><h3 id="Vue特点"><a href="#Vue特点" class="headerlink" title="Vue特点"></a>Vue特点</h3><blockquote><ol><li>采用<strong>组件化</strong>模式, 提高代码复用率、且让代码更好维护。</li><li><strong>声明式</strong>编码,让编码人员无需直接操作DOM, 提高开发效率。</li><li>使用虛拟DOM+优秀的Diff算法, 尽量复用DOM节点。</li></ol></blockquote><h2 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h2><h3 id="容器与Vue实例"><a href="#容器与Vue实例" class="headerlink" title="容器与Vue实例"></a>容器与Vue实例</h3><blockquote><p>其实感觉不用写什么，直接看官方文档或者看代码👌</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">初识Vue：</span></span><br><span class="line"><span class="comment">1.想让Vue工作，就必须创建一个Vue实例，且要传入一个配置对象；</span></span><br><span class="line"><span class="comment">2.root容器里的代码依然符合html规范，只不过混入了一些特殊的Vue语法；</span></span><br><span class="line"><span class="comment">3.root容器里的代码被称为【Vue模板】；</span></span><br><span class="line"><span class="comment">4.Vue实例和容器是一一对应的；</span></span><br><span class="line"><span class="comment">5.真实开发中只有一个Vue实例，并且会配合着组件一起使用；</span></span><br><span class="line"><span class="comment">6.&#123;&#123;xxx&#125;&#125;中的xxx要写js表达式，且xxx可以自动读取到data中的所有属性；</span></span><br><span class="line"><span class="comment">7.一旦data中的数据发生改变，那么页面中用到该数据的地方也会自动更新；</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">注意区分：js表达式 和 js代码(语句)</span></span><br><span class="line"><span class="comment">1.表达式：一个表达式会产生一个值，可以放在任何一个需要值的地方：</span></span><br><span class="line"><span class="comment">(1). a</span></span><br><span class="line"><span class="comment">(2). a+b</span></span><br><span class="line"><span class="comment">(3). demo(1)</span></span><br><span class="line"><span class="comment">(4). x === y ? &#x27;a&#x27; : &#x27;b&#x27;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2.js代码(语句)</span></span><br><span class="line"><span class="comment">(1). if()&#123;&#125;</span></span><br><span class="line"><span class="comment">(2). for()&#123;&#125;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 准备好一个容器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;demo&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello，&#123;&#123;name.toUpperCase()&#125;&#125;，&#123;&#123;address&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> &gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">Vue.config.productionTip = <span class="literal">false</span> <span class="comment">//阻止 vue 在启动时生成生产提示。</span></span></span><br><span class="line"><span class="javascript"><span class="comment">//创建Vue实例</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript"><span class="attr">el</span>:<span class="string">&#x27;#demo&#x27;</span>, <span class="comment">//el用于指定当前Vue实例为哪个容器服务，值通常为css选择器字符串。</span></span></span><br><span class="line"><span class="javascript"><span class="attr">data</span>:&#123; <span class="comment">//data中用于存储数据，数据供el所指定的容器去使用，值我们暂时先写成一个对象。</span></span></span><br><span class="line"><span class="javascript"><span class="attr">name</span>:<span class="string">&#x27;atguigu&#x27;</span>,</span></span><br><span class="line"><span class="javascript"><span class="attr">address</span>:<span class="string">&#x27;北京&#x27;</span></span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript">&#125;)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="单向双向绑定"><a href="#单向双向绑定" class="headerlink" title="单向双向绑定"></a>单向双向绑定</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">Vue模板语法有2大类：</span></span><br><span class="line"><span class="comment">1.插值语法：</span></span><br><span class="line"><span class="comment">功能：用于解析标签体内容。</span></span><br><span class="line"><span class="comment">写法：&#123;&#123;xxx&#125;&#125;，xxx是js表达式，且可以直接读取到data中的所有属性。</span></span><br><span class="line"><span class="comment">2.指令语法：</span></span><br><span class="line"><span class="comment">功能：用于解析标签（包括：标签属性、标签体内容、绑定事件.....）。</span></span><br><span class="line"><span class="comment">举例：v-bind:href=&quot;xxx&quot; 或  简写为 :href=&quot;xxx&quot;，xxx同样要写js表达式，</span></span><br><span class="line"><span class="comment"> 且可以直接读取到data中的所有属性。</span></span><br><span class="line"><span class="comment">备注：Vue中有很多的指令，且形式都是：v-????，此处我们只是拿v-bind举个例子。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 准备好一个容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>插值语法<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>你好，&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>指令语法<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">&quot;school.url.toUpperCase()&quot;</span> <span class="attr">x</span>=<span class="string">&quot;hello&quot;</span>&gt;</span>点我去&#123;&#123;school.name&#125;&#125;学习1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">&quot;school.url&quot;</span> <span class="attr">x</span>=<span class="string">&quot;hello&quot;</span>&gt;</span>点我去&#123;&#123;school.name&#125;&#125;学习2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">Vue.config.productionTip = <span class="literal">false</span> <span class="comment">//阻止 vue 在启动时生成生产提示。</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript"><span class="attr">el</span>:<span class="string">&#x27;#root&#x27;</span>,</span></span><br><span class="line"><span class="javascript"><span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="javascript"><span class="attr">name</span>:<span class="string">&#x27;jack&#x27;</span>,</span></span><br><span class="line"><span class="javascript"><span class="attr">school</span>:&#123;</span></span><br><span class="line"><span class="javascript"><span class="attr">name</span>:<span class="string">&#x27;尚硅谷&#x27;</span>,</span></span><br><span class="line"><span class="javascript"><span class="attr">url</span>:<span class="string">&#x27;http://www.atguigu.com&#x27;</span>,</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript">&#125;)</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210804201111181.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210804201111181.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210804201111181"></p><h2 id="后面写代码去了没写笔记，笔记都在代码上"><a href="#后面写代码去了没写笔记，笔记都在代码上" class="headerlink" title="后面写代码去了没写笔记，笔记都在代码上"></a>后面写代码去了没写笔记，笔记都在代码上</h2>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 学习 </tag>
            
            <tag> 前端 </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【集训】微信小程序(二)</title>
      <link href="/2021/07/22/ji-xun-wei-xin-xiao-cheng-xu-er/"/>
      <url>/2021/07/22/ji-xun-wei-xin-xiao-cheng-xu-er/</url>
      
        <content type="html"><![CDATA[<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="系统信息"><a href="#系统信息" class="headerlink" title="系统信息"></a>系统信息</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/base/system/wx.getSystemInfoSync.html">Object wx.getSystemInfoSync() | 微信开放文档 (qq.com)</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取系统信息</span></span><br><span class="line">wx.getSystemInfo(&#123;</span><br><span class="line">  <span class="attr">success</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="built_in">console</span>.log(result.model);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="交互"><a href="#交互" class="headerlink" title="交互"></a>交互</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/ui/interaction/wx.showToast.html">wx.showToast(Object object) | 微信开放文档 (qq.com)</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loading提示框</span></span><br><span class="line">wx.showLoading(&#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;数据加载中&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  wx.hideLoading(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;加载完成&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消息提示</span></span><br><span class="line">wx.showToast(&#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;提示信息&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><h4 id="跳转页面"><a href="#跳转页面" class="headerlink" title="跳转页面"></a>跳转页面</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateTo.html">wx.navigateTo(Object object) | 微信开放文档 (qq.com)</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;clickBtn&quot;</span>&gt;</span>跳转到demo01<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">clickBtn</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"><span class="comment">// 可带参数,调用 navigateTo 跳转时，调用该方法的页面会被加入堆栈，而 redirectTo 方法则不会</span></span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/pages/demo05/demo05?id=111&#x27;</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(res);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="返回页面"><a href="#返回页面" class="headerlink" title="返回页面"></a>返回页面</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateBack.html">wx.navigateBack(Object object) | 微信开放文档 (qq.com)</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">&quot;clickBack&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>返回上一页<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">clickBack</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   wx.navigateBack(&#123;</span><br><span class="line">     <span class="attr">delta</span>: <span class="number">1</span>,</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h4 id="事件传值"><a href="#事件传值" class="headerlink" title="事件传值"></a>事件传值</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/EventChannel.html">EventChannel | 微信开放文档 (qq.com)</a></p><p><code>demo04.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">clickBtn</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 可带参数,调用 navigateTo 跳转时，调用该方法的页面会被加入堆栈，而 redirectTo 方法则不会</span></span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/pages/demo05/demo05?id=111&#x27;</span>,</span><br><span class="line">      <span class="attr">events</span>: &#123;</span><br><span class="line">        <span class="comment">// 为指定事件添加一个监听器</span></span><br><span class="line">        <span class="function"><span class="title">myBackData</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(data);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 成功的回调函数</span></span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 触发一个事件</span></span><br><span class="line">        res.eventChannel.emit(<span class="string">&quot;myGetData&quot;</span>, &#123; <span class="attr">data</span>: <span class="string">&quot;传递的数据&quot;</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><code>demo05.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">onLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 获取所有打开的EventChannel事件</span></span><br><span class="line">  <span class="keyword">const</span> eventChannel = <span class="built_in">this</span>.getOpenerEventChannel();</span><br><span class="line">  <span class="comment">// 监听index页面的myGetData事件</span></span><br><span class="line">  eventChannel.on(<span class="string">&quot;myGetData&quot;</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 被触发后的操作</span></span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">  &#125;);</span><br><span class="line">  eventChannel.emit(<span class="string">&quot;myBackData&quot;</span>, &#123; <span class="attr">data</span>: <span class="string">&quot;返回的数据&quot;</span> &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">clickBack</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">//const eventChannel = this.getOpenerEventChannel();</span></span><br><span class="line">  <span class="comment">//eventChannel.emit(&quot;myBackData&quot;, &#123; data: &quot;返回的数据&quot; &#125;)</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过 getCurrentPages 获取当前的页面栈，决定需要返回几层。</span></span><br><span class="line">  wx.navigateBack(&#123;</span><br><span class="line">    <span class="attr">delta</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h3><h4 id="临时数据"><a href="#临时数据" class="headerlink" title="临时数据"></a>临时数据</h4><p><code>demo06.wxml</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--pages/demo06/demo06.wxml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;out&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;dataList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.url&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123;item.title&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;time&quot;</span>&gt;</span>&#123;&#123;item.time&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>demo06.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">data: &#123;</span><br><span class="line">  <span class="attr">dataList</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;标题1&quot;</span>,</span><br><span class="line">      <span class="attr">time</span>: <span class="string">&quot;2020-01-01&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/images/image1.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;标题2&quot;</span>,</span><br><span class="line">      <span class="attr">time</span>: <span class="string">&quot;2020-01-02&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/images/image1.png&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;标题3&quot;</span>,</span><br><span class="line">      <span class="attr">time</span>: <span class="string">&quot;2020-01-03&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/images/image1.png&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="请求数据"><a href="#请求数据" class="headerlink" title="请求数据"></a>请求数据</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html">RequestTask | 微信开放文档 (qq.com)</a></p><p>使用wx.request获取数据</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">  wx.request(&#123;</span><br><span class="line">    <span class="comment">// 接口地址</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;http://edu.newsight.cn/wxList.php&#x27;</span>,</span><br><span class="line">    <span class="comment">// 请求的参数</span></span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">num</span>: <span class="number">5</span>,</span><br><span class="line">      <span class="attr">page</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 接口调用成功的回调函数</span></span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res);</span><br><span class="line">      <span class="built_in">console</span>.log(res.data);</span><br><span class="line">        <span class="comment">// 设置数据</span></span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">reqData</span>: res.data</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>修改之前的代码</p><p><code>demo06.wxml</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--pages/demo06/demo06.wxml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;out&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;reqData&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;pic&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.picurl&#125;&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123;item.title&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;time&quot;</span>&gt;</span>&#123;&#123;item.posttime&#125;&#125; - &#123;&#123;item.author&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果域名检验不合法，可以在微信公众平台的开发中管理添加所需要使用的域名，或者开发者工具在设置不检测合法。</p><h4 id="事件绑定刷新数据"><a href="#事件绑定刷新数据" class="headerlink" title="事件绑定刷新数据"></a>事件绑定刷新数据</h4><p><code>demo06.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/demo06/demo06.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">reqData</span>: [],</span><br><span class="line">    <span class="attr">scrollTop</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">reqParam</span>: &#123;</span><br><span class="line">    <span class="attr">page</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onLoad</span>: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.getReqData(<span class="number">1</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 下一页</span></span><br><span class="line">  <span class="function"><span class="title">clickToNextPage</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.reqParam.page++;</span><br><span class="line">    <span class="built_in">this</span>.getReqData(<span class="built_in">this</span>.reqParam.page)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">getReqData</span>(<span class="params">page</span>)</span> &#123;</span><br><span class="line">    wx.request(&#123;</span><br><span class="line">      <span class="comment">// 接口地址</span></span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;http://edu.newsight.cn/wxList.php&#x27;</span>,</span><br><span class="line">      <span class="comment">// 请求的参数</span></span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">num</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">page</span>: page</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 接口调用成功的回调函数</span></span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res);</span><br><span class="line">        <span class="built_in">console</span>.log(res.data);</span><br><span class="line">        <span class="comment">// 设置数据</span></span><br><span class="line">        <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">          <span class="attr">reqData</span>: res.data</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>demo06.wxml</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">&quot;clickToNextPage&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="用户信息"><a href="#用户信息" class="headerlink" title="用户信息"></a>用户信息</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/wx.getUserProfile.html">wx.getUserProfile(Object object) | 微信开放文档 (qq.com)</a></p><p><code>demo07.wxml</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">&quot;login&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>授权登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;nickName&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;avatar&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>demo07.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">data: &#123;</span><br><span class="line">  <span class="attr">nickName</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">avatar</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 授权登录</span></span><br><span class="line"><span class="function"><span class="title">login</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  wx.getUserProfile(&#123;</span><br><span class="line">    <span class="comment">// 声明获取用户个人信息后的用途，不超过30个字符</span></span><br><span class="line">    <span class="attr">desc</span>: <span class="string">&#x27;声明获取用户信息后的用途&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res);</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">          <span class="attr">nickName</span>: res.userInfo.nickName,</span><br><span class="line">          <span class="attr">avatar</span>: res.userInfo.avatarUrl</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">fail</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.setStorageSync.html">wx.setStorageSync(string key, any data) | 微信开放文档 (qq.com)</a></p><h4 id="存"><a href="#存" class="headerlink" title="存"></a>存</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">login</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  wx.getUserProfile(&#123;</span><br><span class="line">    <span class="comment">// 声明获取用户个人信息后的用途，不超过30个字符</span></span><br><span class="line">    <span class="attr">desc</span>: <span class="string">&#x27;声明获取用户信息后的用途&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res);</span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        <span class="attr">nickName</span>: res.userInfo.nickName,</span><br><span class="line">        <span class="attr">avatar</span>: res.userInfo.avatarUrl</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 存信息</span></span><br><span class="line">      wx.setStorageSync(<span class="string">&#x27;userInfo&#x27;</span>, res.userInfo);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">fail</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="取"><a href="#取" class="headerlink" title="取"></a>取</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">&quot;login&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;!nickName&#125;&#125;&quot;</span>&gt;</span>授权登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;nickName&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;avatar&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 取缓存</span></span><br><span class="line">  <span class="keyword">let</span> userInfo = wx.getStorageSync(<span class="string">&#x27;userInfo&#x27;</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(userInfo);</span><br><span class="line">  <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">    <span class="attr">nickName</span>: userInfo.nickName,</span><br><span class="line">    <span class="attr">avatar</span>: userInfo.avatarUrl</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h2 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h2><p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/module.html">Object module | 微信开放文档 (qq.com)</a></p><p><code>public.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myPublic = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">fun1</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;执行fun1&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">fun2</span>(<span class="params">p</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;执行fun2,参数：&quot;</span> + p);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = myPublic</span><br></pre></td></tr></table></figure><p><code>demo08.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myPublic = <span class="built_in">require</span>(<span class="string">&#x27;../../utils/public.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="attr">onLoad</span>: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">  myPublic.fun1();</span><br><span class="line">  myPublic.fun2(<span class="string">&quot;param&quot;</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h2 id="小程序上线"><a href="#小程序上线" class="headerlink" title="小程序上线"></a>小程序上线</h2><ul><li><p>修改测试号为AppID</p><p><img src="https://gitee.com/ReRia/images/raw/master/img/image-20210719105719695.png" class="lazyload" data-srcset="https://gitee.com/ReRia/images/raw/master/img/image-20210719105719695.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210719105719695"></p></li><li><p><a href="https://mp.weixin.qq.com/wxamp/devprofile/get_profile?token=275217971&lang=zh_CN">小程序 (qq.com)</a>管理服务器域名，取消不检验合法域名</p></li><li><p>上传代码</p><p><img src="https://gitee.com/ReRia/images/raw/master/img/image-20210719105623275.png" class="lazyload" data-srcset="https://gitee.com/ReRia/images/raw/master/img/image-20210719105623275.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210719105623275"></p></li><li><p><a href="https://mp.weixin.qq.com/wxamp/wacodepage/getcodepage?token=275217971&lang=zh_CN">小程序 (qq.com)</a>提交审核</p><p><img src="https://gitee.com/ReRia/images/raw/master/img/image-20210719105802928.png" class="lazyload" data-srcset="https://gitee.com/ReRia/images/raw/master/img/image-20210719105802928.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210719105802928"></p><p><img src="https://gitee.com/ReRia/images/raw/master/img/image-20210719105814987.png" class="lazyload" data-srcset="https://gitee.com/ReRia/images/raw/master/img/image-20210719105814987.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210719105814987"></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 微信小程序 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 学习 </tag>
            
            <tag> 集训 </tag>
            
            <tag> 微信小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【集训】微信小程序(一)</title>
      <link href="/2021/07/22/ji-xun-wei-xin-xiao-cheng-xu-yi/"/>
      <url>/2021/07/22/ji-xun-wei-xin-xiao-cheng-xu-yi/</url>
      
        <content type="html"><![CDATA[<h2 id="自定义组件"><a href="#自定义组件" class="headerlink" title="自定义组件"></a>自定义组件</h2><p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/Component.html">Component(Object object) | 微信开放文档 (qq.com)</a></p><blockquote><p>将部分重复代码抽取出来</p><p><a href="https://market.m.taobao.com/app/tbsearchwireless-pages/new-catemap/p/s-nx-categories?spm=a215s.7406091.0.0.3cc36770f1SCN5&utparam=%7B%22ranger_buckets_native%22:%22tsp2584_31920%22%7D&scm=1007.home_icon.fenl.d&wh_weex=true">商品分类 (taobao.com)</a></p></blockquote><h3 id="创建自定义组件"><a href="#创建自定义组件" class="headerlink" title="创建自定义组件"></a>创建自定义组件</h3><blockquote><p>类似于页面，一个自定义组件由json、wxml、wxss、js 4个文件组成</p></blockquote><p>可以在微信开发者⼯具中快速创建组件的⽂件结构</p><p><img src="https://gitee.com/ReRia/images/raw/master/img/image-20210718102246185.png" class="lazyload" data-srcset="https://gitee.com/ReRia/images/raw/master/img/image-20210718102246185.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210718102246185"></p><h3 id="声明组件、引入组件"><a href="#声明组件、引入组件" class="headerlink" title="声明组件、引入组件"></a>声明组件、引入组件</h3><p><code>tabs.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;component&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>demo01.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;usingComponents&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;Tabs&quot;</span>: <span class="string">&quot;/components/Tabs/Tabs&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="简单编辑组件"><a href="#简单编辑组件" class="headerlink" title="简单编辑组件"></a>简单编辑组件</h3><p><code>Tabs.wxml</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--components/Tabs/Tabs.wxml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tabs&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tabs_title&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title_item active&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title_item&quot;</span>&gt;</span>原创<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title_item&quot;</span>&gt;</span>分类<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title_item&quot;</span>&gt;</span>关于<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tabs_content&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>Tabs.wxss</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* components/Tabs/Tabs.wxss */</span></span><br><span class="line"><span class="selector-class">.tabs</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tabs_title</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10</span>rpx <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.title_item</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 选中时的样式 */</span></span><br><span class="line"><span class="selector-class">.active</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#b81d24</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">5</span>rpx solid currentColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tabs_content</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>以上数据都写在组件的wxml中，接下来来实现js动态数据</p><h3 id="填入初始数据"><a href="#填入初始数据" class="headerlink" title="填入初始数据"></a>填入初始数据</h3><p><code>Tabs.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/Tabs/Tabs.js</span></span><br><span class="line">Component(&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件的属性列表</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">properties</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">tabs</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;原创&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      ,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;分类&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      ,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;关于&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 组件的方法列表</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>Tab.wxml</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tabs&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tabs_title&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 列表渲染 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- class中三元表达式，根据item的isActive属性判断是否选中，选中则添加类名以显示样式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;tabs&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">class</span>=<span class="string">&quot;title_item &#123;&#123;item.isActive?&#x27;active&#x27;:&#x27;&#x27;&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123;item.name&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tabs_content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="绑定点击事件"><a href="#绑定点击事件" class="headerlink" title="绑定点击事件"></a>绑定点击事件</h3><p><code>Tab.wxml</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tabs_title&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 列表渲染 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- class中三元表达式，根据item的isActive属性判断是否选中，选中则添加类名以显示样式 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- data-index自定义属性，用于传递当前的索引值 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;tabs&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">class</span>=<span class="string">&quot;title_item &#123;&#123;item.isActive?&#x27;active&#x27;:&#x27;&#x27;&#125;&#125;&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;handleItemTap&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">data-index</span>=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;item.name&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意自定义组件的方法写在methods中</p><p><code>Tabs.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    <span class="function"><span class="title">handleItemTap</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 查看索引所在的位置</span></span><br><span class="line">      <span class="built_in">console</span>.log(e);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 1.获取被点击的索引</span></span><br><span class="line">      <span class="comment">// ES6常量const,只读不可改</span></span><br><span class="line">      <span class="comment">// ES6解构赋值:const &#123; index &#125; = e.currentTarget.dataset;</span></span><br><span class="line">      <span class="keyword">const</span> index = e.currentTarget.dataset.index;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2.获取原数组</span></span><br><span class="line">      <span class="comment">// ES6变量let,块级作用域</span></span><br><span class="line">      <span class="comment">// ES6解构赋值:let &#123; tabs &#125; = this.data;</span></span><br><span class="line">      <span class="keyword">let</span> tabs = <span class="built_in">this</span>.data.tabs;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3.循环数组：为当前索引项设置isActive：true,其余false</span></span><br><span class="line">      <span class="comment">// ES6箭头函数</span></span><br><span class="line">      tabs.forEach(<span class="function">(<span class="params">v, i</span>) =&gt;</span> &#123;</span><br><span class="line">        i === index ? v.isActive = <span class="literal">true</span> : v.isActive = <span class="literal">false</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 修改数据</span></span><br><span class="line">      <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">        tabs</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上数据都写在组件中，接下来来实现父向子传递数据</p><h3 id="父向子传递数据"><a href="#父向子传递数据" class="headerlink" title="父向子传递数据"></a>父向子传递数据</h3><p><code>demo01.wxml</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">  父组件demo01，子组件Tabs</span></span><br><span class="line"><span class="comment">  父组件通过标签属性传递数据</span></span><br><span class="line"><span class="comment">  子组件在properties中接收</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">abc</span>=<span class="string">&quot;要传递的数据&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>Tabs.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">properties: &#123;</span><br><span class="line">  <span class="comment">// 属性名</span></span><br><span class="line">  <span class="attr">abc</span>: &#123;</span><br><span class="line">    <span class="comment">// 接收的数据的类型</span></span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="comment">// 默认值</span></span><br><span class="line">    <span class="attr">value</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><code>Tabs.wxml</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 相当于data中的数据使，用&#123;&#123;&#125;&#125;渲染 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;abc&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>接下来修改案例代码</p><ol><li><p>将要传递的数据放在父组件的data中，即原先写在Tabs.js的data中的数据放在demo01.js的data中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">data: &#123;</span><br><span class="line">    <span class="attr">tabs</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;原创&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      ,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;分类&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      ,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;关于&quot;</span>,</span><br><span class="line">        <span class="attr">isActive</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li><li><p>父组件通过标签属性传递数据</p><p><code>demo01.wxml</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">tabs</span>=<span class="string">&quot;&#123;&#123;tabs&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>子组件在properties中接收，最后效果与之前相同</p><p><code>Tabs.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">properties: &#123;</span><br><span class="line">  <span class="attr">tabs</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">Array</span>,</span><br><span class="line">    <span class="attr">value</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li></ol><p>此时<code>Tabs.js</code>中代码仍然是在子组件当中修改tab数组，而不是在父组件的data中修改tab（可以在AppData窗口查看）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this.data中找不到数据，则在properties中寻找</span></span><br><span class="line"><span class="keyword">let</span> tabs = <span class="built_in">this</span>.data.tabs;</span><br><span class="line"><span class="comment">// 将tabs放入data当中</span></span><br><span class="line"><span class="built_in">this</span>.setData(&#123;</span><br><span class="line">  tabs</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>所以需要将处理数据放在父组件当中，而所需要的索引值则由子组件传递给父组件（子向父传递数据）</p><h3 id="子向父传递数据"><a href="#子向父传递数据" class="headerlink" title="子向父传递数据"></a>子向父传递数据</h3><p><code>Tabs.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  <span class="function"><span class="title">handleItemTap</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.获取被点击的索引</span></span><br><span class="line">    <span class="keyword">const</span> index = e.currentTarget.dataset.index;</span><br><span class="line">    <span class="comment">// 2.触发父组件中的自定义事件，并传递数据</span></span><br><span class="line">    <span class="built_in">this</span>.triggerEvent(<span class="string">&quot;itemChange&quot;</span>, &#123; index &#125;); <span class="comment">//triggerEvent(&quot;自定义事件名&quot;, 要传递的数据)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>demo01.wxml</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">  子组件Tabs -&gt; 父组件demo01</span></span><br><span class="line"><span class="comment">  在子组件的标签中添加自定义事件</span></span><br><span class="line"><span class="comment">  编写父组件js事件方法</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">tabs</span>=<span class="string">&quot;&#123;&#123;tabs&#125;&#125;&quot;</span> <span class="attr">binditemChange</span>=<span class="string">&quot;handleItemChange&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>demo01.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义事件方法</span></span><br><span class="line"><span class="function"><span class="title">handleItemChange</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e);</span><br><span class="line">  <span class="comment">// 接收传递的数据</span></span><br><span class="line">  <span class="keyword">const</span> index = e.detail.index;</span><br><span class="line">  <span class="comment">// 以下代码相同</span></span><br><span class="line">  <span class="keyword">let</span> tabs = <span class="built_in">this</span>.data.tabs;</span><br><span class="line">  tabs.forEach(<span class="function">(<span class="params">v, i</span>) =&gt;</span> &#123;</span><br><span class="line">    i === index ? v.isActive = <span class="literal">true</span> : v.isActive = <span class="literal">false</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">    tabs</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>AppData窗口查看即可</p><h3 id="slot标签"><a href="#slot标签" class="headerlink" title="slot标签"></a>slot标签</h3><blockquote><p>slot占位符（插槽），父组件调用子组件传递一些标签来替换slot的位置</p></blockquote><p><code>Tabs.wxml</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;tabs_content&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>demo01.wxml</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Tabs</span> <span class="attr">tabs</span>=<span class="string">&quot;&#123;&#123;tabs&#125;&#125;&quot;</span> <span class="attr">binditemChange</span>=<span class="string">&quot;handleItemChange&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;tabs[0].isActive&#125;&#125;&quot;</span>&gt;</span>内容1<span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:elif</span>=<span class="string">&quot;&#123;&#123;tabs[1].isActive&#125;&#125;&quot;</span>&gt;</span>内容2<span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:elif</span>=<span class="string">&quot;&#123;&#123;tabs[2].isActive&#125;&#125;&quot;</span>&gt;</span>内容3<span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:else</span>&gt;</span>内容4<span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Tabs</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p><img src="https://gitee.com/ReRia/images/raw/master/img/image-20210718141859157.png" class="lazyload" data-srcset="https://gitee.com/ReRia/images/raw/master/img/image-20210718141859157.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210718141859157"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line">App(&#123;</span><br><span class="line">  <span class="comment">// 应用 第一次启动 的时候触发，可用于最开始获取用户的个人信息等</span></span><br><span class="line">  <span class="function"><span class="title">onLaunch</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onLaunch&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 应用 显示 的时候触发，可用于对页面数据、页面效果进行重置</span></span><br><span class="line">  <span class="function"><span class="title">onShow</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onShow&quot;</span>);</span><br><span class="line">    <span class="comment">// 可调用多次</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 应用 隐藏 的时候触发，可用于暂停或清除定时器</span></span><br><span class="line">  <span class="function"><span class="title">onHide</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onHide&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 应用 代码报错 的时候触发，可用于收集错误信息并发送到后台</span></span><br><span class="line">  <span class="function"><span class="title">onError</span>(<span class="params">error</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onError&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 应用 第一次启动找不到入口页面 的时候触发，可用于跳转</span></span><br><span class="line">  <span class="function"><span class="title">onPageNotFound</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onPageNotFound&quot;</span>);</span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/pages/demo01/demo01&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h3><p><img src="https://gitee.com/ReRia/images/raw/master/img/image-20210718141908133.png" class="lazyload" data-srcset="https://gitee.com/ReRia/images/raw/master/img/image-20210718141908133.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210718141908133"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/demo02/demo02.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">   * 发送异步请求初始化页面数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onLoad</span>: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onLoad&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面显示</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onShow</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onShow&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面初次渲染完成</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onReady</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onReady&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面隐藏</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onHide</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onHide&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面卸载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onUnload</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onUnload&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面相关事件处理函数--监听用户下拉动作</span></span><br><span class="line"><span class="comment">   * 对页面初始化</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onPullDownRefresh</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onPullDownRefresh&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面上拉触底事件的处理函数</span></span><br><span class="line"><span class="comment">   * 触底加载更多数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onReachBottom</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onReachBottom&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用户点击右上角分享</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onShareAppMessage</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onShareAppMessage&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面滚动</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">onPageScroll</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onPageScroll&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面尺寸改变</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">onResize</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onResize&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 当前是tab页，点击当前页的tab时触发</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">onTabItemTap</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onTabItemTap&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 微信小程序 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 学习 </tag>
            
            <tag> 集训 </tag>
            
            <tag> 微信小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【学习笔记】SpringBoot2</title>
      <link href="/2021/07/20/xue-xi-bi-ji-springboot2/"/>
      <url>/2021/07/20/xue-xi-bi-ji-springboot2/</url>
      
        <content type="html"><![CDATA[<h2 id="教程与文档"><a href="#教程与文档" class="headerlink" title="教程与文档"></a>教程与文档</h2><p><a href="https://www.yuque.com/atguigu/springboot">SpringBoot2核心技术与响应式编程 · 语雀 (yuque.com)</a></p><h2 id="Spring与SpringBoot2"><a href="#Spring与SpringBoot2" class="headerlink" title="Spring与SpringBoot2"></a>Spring与SpringBoot2</h2><p><a href="https://www.yuque.com/atguigu/springboot/na3pfd">01、Spring与SpringBoot · 语雀 (yuque.com)</a></p><h2 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h2><ol><li><p>导入依赖 <code>pom.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父项目配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- web场景启动器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>编写controller  <code>HelloController.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @Controller // 注明controller</span></span><br><span class="line"><span class="comment">// @ResponseBody // 注明将java对象转为json格式的数据</span></span><br><span class="line"><span class="meta">@RestController</span><span class="comment">// 代替以上两者</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 映射请求的地址</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handle1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello,SpringBoot2&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写主程序类并测试 <code>MainApplication.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主程序类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 表明这是一个SpringBoot应用</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// run声明主程序类，返回一个IoC容器</span></span><br><span class="line">        SpringApplication.run(MainApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>resources文件夹下application.properties，可根据文档自定义配置</p><p><a href="https://docs.spring.io/spring-boot/docs/2.3.12.RELEASE/reference/html/appendix-application-properties.html#common-application-properties">Common Application properties (spring.io)</a></p></li><li><p>创建可执行jar包，添加build依赖，然后点击maven中的lifecycle中的clean与package并执行  <code>pom.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>执行jar包，在target目录下执行以下命令</p><p><code>java -jar 包名.jar</code></p></li></ol><h2 id="依赖管理与自动配置特性"><a href="#依赖管理与自动配置特性" class="headerlink" title="依赖管理与自动配置特性"></a>依赖管理与自动配置特性</h2><p><a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=6&spm_id_from=pageDriver">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></p><h2 id="底层注解"><a href="#底层注解" class="headerlink" title="底层注解"></a>底层注解</h2><h3 id="Configuration、-Bean-配置对象"><a href="#Configuration、-Bean-配置对象" class="headerlink" title="@Configuration、@Bean 配置对象"></a>@Configuration、@Bean 配置对象</h3><h4 id="原"><a href="#原" class="headerlink" title="原"></a>原</h4><p>原Spring使用xml配置文件配置bean对象如下</p><p><code>bean.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.myspringboot2.bean.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.myspringboot2.bean.Pet&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mimi&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="现"><a href="#现" class="headerlink" title="现"></a>现</h4><p>编写配置<code>MyConfig.java</code></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1、配置类里面使用<span class="doctag">@Bean</span>添加对象，默认是单实例</span></span><br><span class="line"><span class="comment"> * 2、配置类本身也是对象</span></span><br><span class="line"><span class="comment"> * 3、proxyBeanMethods: 代理bean的方法。默认为true(full模式)，使用代理对象调用方法，保证对象是单实例；否则(lite模式)非单实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = true)</span>  <span class="comment">//声明这是一个配置类（即替换掉配置文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 无论外部对这个配置类中的方法调用多少次，获得的都是容器中的单实例对象</span></span><br><span class="line">    <span class="meta">@Bean</span>   <span class="comment">//向容器中添加组件，id为方法名(可以自定义)，组件类型为返回类型，组件在容器中的实例为返回地值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">user01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;zhangsan&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean(&quot;pet01&quot;)</span>  <span class="comment">//自定义id</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pet <span class="title">cat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Pet(<span class="string">&quot;mimi&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试类<code>MainApplication.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主程序类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 表明这是一个SpringBoot应用</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取IoC容器,run声明主程序类,返回一个IoC容器</span></span><br><span class="line">        ConfigurableApplicationContext run = SpringApplication.run(MainApplication.class, args);</span><br><span class="line">        <span class="comment">// 从容器中获取bean,默认是单实例</span></span><br><span class="line">        User user01 = run.getBean(<span class="string">&quot;user01&quot;</span>, User.class);</span><br><span class="line">        Pet pet01 = run.getBean(<span class="string">&quot;pet01&quot;</span>, Pet.class);</span><br><span class="line">        MyConfig myConfig = run.getBean(MyConfig.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Full模式与Lite模式"><a href="#Full模式与Lite模式" class="headerlink" title="Full模式与Lite模式"></a>Full模式与Lite模式</h4><ul><li>配置类组件之间无依赖关系用Lite模式加速客器启动过程,减少判断</li><li>配置类组件之间有依赖关系,方法会被调用得到之前单实例组件,用Full模式</li></ul><h3 id="ComponentScan-包扫描"><a href="#ComponentScan-包扫描" class="headerlink" title="@ComponentScan 包扫描"></a>@ComponentScan 包扫描</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一下三者相当于@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.myspringboot2&quot;)</span><span class="comment">//包扫描地址</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br></pre></td></tr></table></figure><h3 id="Import-注入对象"><a href="#Import-注入对象" class="headerlink" title="@Import 注入对象"></a>@Import 注入对象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;User.class, DBHelper.class&#125;)</span>   <span class="comment">//向容器中添加对应类型的对象,默认对象名为对应类的全类名</span></span><br></pre></td></tr></table></figure><h3 id="Conditional-条件装配"><a href="#Conditional-条件装配" class="headerlink" title="@Conditional 条件装配"></a>@Conditional 条件装配</h3><p>使用 <code>MyConfig.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span>  <span class="comment">//声明这是一个配置类（即替换掉配置文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ConditionalOnBean(name = &quot;pet02&quot;)</span>    <span class="comment">// 按条件执行向容器中注入对象,可放在类上(则按条件执行是否注入类中所有的对象)</span></span><br><span class="line">    <span class="meta">@Bean</span>   <span class="comment">//向容器中添加组件，id为方法名(可以自定义)，组件类型为返回类型，组件在容器中的实例为返回地值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">user01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;zhangsan&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试 <code>MainApplication.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取IoC容器,run声明主程序类，返回一个IoC容器</span></span><br><span class="line">        ConfigurableApplicationContext run = SpringApplication.run(MainApplication.class, args);</span><br><span class="line">        <span class="comment">// 由于user01配置的是由添加了ConditinalOnBean,而其中的条件pet02对象并不在容器当中，所以未注入user01</span></span><br><span class="line">        System.out.println(run.containsBean(<span class="string">&quot;user01&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ImportResource-导入xml配置文件"><a href="#ImportResource-导入xml配置文件" class="headerlink" title="@ImportResource 导入xml配置文件"></a>@ImportResource 导入xml配置文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ImportResource(&quot;classpath:beans.xml&quot;)</span>  <span class="comment">//兼容xml配置</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span>  <span class="comment">//声明这是一个配置类（即替换掉配置文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取IoC容器,run声明主程序类，返回一个IoC容器</span></span><br><span class="line">        ConfigurableApplicationContext run = SpringApplication.run(MainApplication.class, args);</span><br><span class="line">        <span class="comment">// 使用@ImportResource成功注入beans.xml中的对象</span></span><br><span class="line">        System.out.println(run.containsBean(<span class="string">&quot;user01&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ConfigurationProperties-配置绑定"><a href="#ConfigurationProperties-配置绑定" class="headerlink" title="@ConfigurationProperties 配置绑定"></a>@ConfigurationProperties 配置绑定</h3><p>编写属性， <code>application.properties</code>，注意使用全小写</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mycar.brand</span>=<span class="string">ABC</span></span><br><span class="line"><span class="meta">mycar.price</span>=<span class="string">100000</span></span><br></pre></td></tr></table></figure><p>第一种方法：需要在容器中的组件上使用，  <code>Car.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>  <span class="comment">//声明为组件，只有容器中的组件才能使用</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span>  <span class="comment">//绑定配置文件中的属性，prefix指定对应前缀</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    String brand;</span><br><span class="line">    Integer price;</span><br><span class="line"><span class="comment">// ……</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二种方法：不使用@Component声明Car为组件，而是在配置类种开启指定对象的属性配置功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(Car.class)</span>  <span class="comment">//开启指定对象的属性配置功能</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span>  <span class="comment">//声明这是一个配置类（即替换掉配置文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ……</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试， <code>HelloController.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Car car;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/car&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">car</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> car;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="自动配置原理（源码分析"><a href="#自动配置原理（源码分析" class="headerlink" title="自动配置原理（源码分析"></a>自动配置原理（源码分析</h2><p><a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=13&spm_id_from=pageDriver">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></p><h3 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h3><blockquote><p>声明当前是一个配置类</p></blockquote><h3 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a>@ComponentScan</h3><blockquote><p>指定扫描路径</p></blockquote><h3 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h3><h4 id="AutoConfigurationPackage"><a href="#AutoConfigurationPackage" class="headerlink" title="@AutoConfigurationPackage"></a>@AutoConfigurationPackage</h4><blockquote><p>利用Registrar将当前包下的所有组件全部导入进容器</p></blockquote><h4 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h4><blockquote><p>导入默认组件</p></blockquote><h2 id="便捷使用"><a href="#便捷使用" class="headerlink" title="便捷使用"></a>便捷使用</h2><h3 id="Lombok"><a href="#Lombok" class="headerlink" title="Lombok"></a>Lombok</h3><blockquote><p>简化JavaBean编写等</p></blockquote><ol><li><p>引入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>编写JavaBean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoArgsConstructor</span>  <span class="comment">//自动编写无参构造器</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span>  <span class="comment">//自动编写全参构造器</span></span><br><span class="line"><span class="meta">@Data</span>   <span class="comment">//自动编写set/get/toString方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    String brand;</span><br><span class="line">    Integer price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写controller的日志打印</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j//引入日志接口</span><br><span class="line">@RestController</span><br><span class="line">public class HelloController &#123;</span><br><span class="line">    // 映射请求的地址</span><br><span class="line">    @RequestMapping(&quot;/hello&quot;)</span><br><span class="line">    public String handle1() &#123;</span><br><span class="line">        log.info(&quot;hello&quot;);//日志打印信息</span><br><span class="line">        return &quot;Hello,SpringBoot2&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="Dev-tools、JRebel"><a href="#Dev-tools、JRebel" class="headerlink" title="Dev-tools、JRebel"></a>Dev-tools、JRebel</h3><blockquote><p>自动重启、热更新</p></blockquote><ol><li><p>引入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>使用 Ctrl+F9 更新</p></li></ol><h3 id="Spring-Initializr"><a href="#Spring-Initializr" class="headerlink" title="Spring Initializr"></a>Spring Initializr</h3><blockquote><p>快速创建springboot应用，创建应用时选择即可</p></blockquote><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><h3 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h3><h3 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h3><h4 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h4><ul><li>key: value    #注意空格</li><li>大小写敏感</li><li>使用缩进表示层级关系</li><li>缩进不允许使用tab，只允许空格</li><li>缩进空格数无影响，同层级的元素需要左对齐</li><li>#编写注释</li><li>“”双引号内\n等不转义，仍然是回车的本意显示为回车，’’单引号内转义，\n显示为字符串</li></ul><h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4><ul><li><p>字面量</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">key:</span> <span class="string">value</span></span><br></pre></td></tr></table></figure></li><li><p>对象</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">k:</span> &#123;<span class="attr">k1:</span> <span class="string">v1</span>,<span class="attr">k2:</span> <span class="string">v2</span>,<span class="attr">k3:</span> <span class="string">v3</span>&#125;</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line"><span class="attr">k:</span></span><br><span class="line">  <span class="attr">k1:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">k2:</span> <span class="string">v2</span></span><br><span class="line">  <span class="attr">k3:</span> <span class="string">v3</span></span><br></pre></td></tr></table></figure></li><li><p>数组</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">k:</span> [<span class="string">v1</span>,<span class="string">v2</span>,<span class="string">v3</span>]</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line"><span class="attr">k:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">v2</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">v3</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p><a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=20&spm_id_from=pageDriver">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></p><h4 id="configuration-processor"><a href="#configuration-processor" class="headerlink" title="configuration-processor"></a>configuration-processor</h4><blockquote><p>配置处理器</p></blockquote><ol><li><p>添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- 打包的时候不带这个包 --&gt;</span>   </span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="web开发"><a href="#web开发" class="headerlink" title="web开发"></a>web开发</h2><h3 id="简单功能"><a href="#简单功能" class="headerlink" title="简单功能"></a>简单功能</h3><h4 id="静态资源访问"><a href="#静态资源访问" class="headerlink" title="静态资源访问"></a>静态资源访问</h4><ul><li><p>静态资源目录</p><ul><li>存放路径：类路径(resources资源根目录)下的<code>/static</code> or <code>/public</code> or <code>/resources</code> or <code>/META-INF/resources</code></li><li>访问路径：项目根路径/静态资源名</li></ul></li><li><blockquote><p>原理： 静态映射/**。<br>请求进来，先去找Controller看能不能处理。不能处理的所有请求又都交给静态资源处理器。静态资源也找不到则响应404页面</p></blockquote></li><li><p>改变默认的静态资源访问路径和存放路径，在配置文件<code>application.yaml</code>中编写</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">/res/**</span><span class="comment">#res为自定义前缀，即访问地址须在项目根路径/res/静态资源名</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">static-locations:</span> [<span class="string">classpath:/自定义文件夹名/</span>]</span><br></pre></td></tr></table></figure></li></ul><h4 id="欢迎页"><a href="#欢迎页" class="headerlink" title="欢迎页"></a>欢迎页</h4><p>命名为index.html放在静态资源目录下即可。</p><h4 id="自定义Favicon"><a href="#自定义Favicon" class="headerlink" title="自定义Favicon"></a>自定义Favicon</h4><p>命名为favicon.ico 放在静态资源目录下即可。</p><h4 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h4><p><a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=25">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></p><h3 id="请求处理"><a href="#请求处理" class="headerlink" title="请求处理"></a>请求处理</h3><h4 id="xxxMapping-请求映射"><a href="#xxxMapping-请求映射" class="headerlink" title="@xxxMapping 请求映射"></a>@xxxMapping 请求映射</h4><blockquote><p>Rest风格支持（使用HTTP请求方式动词来表示对资源的操作）</p><ul><li>以前：**/getUser  获取用户    /deleteUser 删除用户   /editUser  修改用户      /saveUser 保存用户</li><li>现在： /user    GET-获取用户    DELETE-删除用户     PUT-修改用户      POST-保存用户</li></ul></blockquote><ol><li><p>编写controller类</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"><span class="meta">@GetMapping(&quot;/user&quot;)</span>    </span><br><span class="line">    <span class="comment">// 即@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.GET)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;getUser GET&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/user&quot;)</span>   </span><br><span class="line">    <span class="comment">// 即@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.POST)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">saveUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;saveUser POST&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PutMapping(&quot;/user&quot;)</span>    </span><br><span class="line">    <span class="comment">// 即@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.PUT)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">modifiedUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;modifiedUser PUT&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/user&quot;)</span> </span><br><span class="line">    <span class="comment">// 即@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.DELETE)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;deleteUser DELETE&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;get提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;post提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- form表单中method只能写get/post --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用隐藏域传递_method方法参数的值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;DELETE&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;DELETE提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在配置文件中开启hiddenmethod-filter(默认为false)，如果前端不是使用表单发送请求则不需要开启filter</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">hiddenmethod:</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="自定义HiddenMethodFilter"><a href="#自定义HiddenMethodFilter" class="headerlink" title="自定义HiddenMethodFilter"></a>自定义HiddenMethodFilter</h4><p>编写配置类，自定义filter</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebConfig</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HiddenHttpMethodFilter <span class="title">hiddenHttpMethodFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HiddenHttpMethodFilter filter = <span class="keyword">new</span> HiddenHttpMethodFilter();</span><br><span class="line">        filter.setMethodParam(<span class="string">&quot;_m&quot;</span>);    <span class="comment">//修改方法参数名为_m</span></span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="请求映射原理"><a href="#请求映射原理" class="headerlink" title="请求映射原理"></a>请求映射原理</h4><p><a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=28&spm_id_from=pageDriver">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></p><h4 id="参数注解"><a href="#参数注解" class="headerlink" title="参数注解"></a>参数注解</h4><h5 id="PathVariable、-RequestHeader、-RequestParam、-CookieValue、-RequestBody"><a href="#PathVariable、-RequestHeader、-RequestParam、-CookieValue、-RequestBody" class="headerlink" title="@PathVariable、@RequestHeader、@RequestParam、@CookieValue、@RequestBody"></a>@PathVariable、@RequestHeader、@RequestParam、@CookieValue、@RequestBody</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamTestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试url: http://localhost:8080/test1/1/lisi?age=10&amp;inters=%E5%90%83%E9%A5%AD&amp;inters=%E7%9D%A1%E8%A7%89</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test1/&#123;id&#125;/&#123;username&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">test1</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="meta">@PathVariable(&quot;username&quot;)</span> String name,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="meta">@PathVariable</span> Map&lt;String, String&gt; variables,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="meta">@RequestHeader(&quot;User-Agent&quot;)</span> String userAgent,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="meta">@RequestHeader</span> Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="meta">@RequestParam(&quot;age&quot;)</span> Integer age,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="meta">@RequestParam(&quot;inters&quot;)</span> List&lt;String&gt; inters,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="meta">@RequestParam</span> Map&lt;String,String&gt; params1,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="meta">@RequestParam</span> MultiValueMap&lt;String, String&gt; params2,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="meta">@CookieValue(&quot;_xsrf&quot;)</span> String _xsrf,</span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="meta">@CookieValue(&quot;_xsrf&quot;)</span> Cookie cookie)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@PathVariable</span>(&quot;&quot;) 获得指定路径变量名的值</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@PathVariable</span> 获得所有路径变量名以及值，存放到Map&lt;String, String&gt;中</span></span><br><span class="line"><span class="comment">         * 注意后者键值对对应的是地址栏中的username参数名，而前者是形参名name</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@RequestHeader</span>(&quot;&quot;) 获得请求头中指定key的值</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@RequestHeader</span> 获得请求头中所有的key及其值</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@RequestParam</span>(&quot;&quot;) 获得指定请求参数名的值</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@RequestParam</span> 获得所有请求参数名以及值，存放到Map&lt;String, String&gt;中</span></span><br><span class="line"><span class="comment">         * 注意后者存放在map中，kv只有一对，可使用MultiValueMap获取到一对多的键值对。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">// 以下是测试</span></span><br><span class="line">        map.put(<span class="string">&quot;id&quot;</span>, id);</span><br><span class="line">        map.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">        map.put(<span class="string">&quot;pv&quot;</span>, variables);</span><br><span class="line">        map.put(<span class="string">&quot;userAgent&quot;</span>, userAgent);</span><br><span class="line">        map.put(<span class="string">&quot;rh&quot;</span>, headers);</span><br><span class="line">        map.put(<span class="string">&quot;age&quot;</span>,age);</span><br><span class="line">        map.put(<span class="string">&quot;inters&quot;</span>,inters);</span><br><span class="line">        map.put(<span class="string">&quot;params1&quot;</span>,params1);</span><br><span class="line">        map.put(<span class="string">&quot;params2&quot;</span>,params2);</span><br><span class="line">        map.put(<span class="string">&quot;_xsrf&quot;</span>,_xsrf);</span><br><span class="line">        System.out.println(cookie.getName()+<span class="string">&quot;===&gt;&quot;</span>+cookie.getValue());</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/test2&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">test2</span><span class="params">(<span class="meta">@RequestBody</span> String content)</span></span>&#123;</span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@RequestBody</span> 获得请求体中所有的key及对应值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">// 以下是测试</span></span><br><span class="line">        map.put(<span class="string">&quot;content&quot;</span>, content);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="RequestAttribute-获取域对象参数值"><a href="#RequestAttribute-获取域对象参数值" class="headerlink" title="@RequestAttribute 获取域对象参数值"></a>@RequestAttribute 获取域对象参数值</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span> <span class="comment">//注意RestController写return &quot;forward:/success&quot;只会解析成字符串</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/goto&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">gotoPage</span><span class="params">(HttpServletRequest req)</span> </span>&#123;</span><br><span class="line">        req.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;信息&quot;</span>);</span><br><span class="line">        req.setAttribute(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;信息123123&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;forward:/success&quot;</span>;  <span class="comment">//转发到/success请求</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/success&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">success</span><span class="params">(<span class="meta">@RequestAttribute(&quot;msg&quot;)</span> String msg,</span></span></span><br><span class="line"><span class="params"><span class="function">                                       <span class="meta">@RequestAttribute(&quot;code&quot;)</span> String code)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@RequestAttribute</span> 获得request域对象中的指定值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;msg&quot;</span>, msg);</span><br><span class="line">        map.put(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="MatrixVariable-获取矩阵变量"><a href="#MatrixVariable-获取矩阵变量" class="headerlink" title="@MatrixVariable 获取矩阵变量"></a>@MatrixVariable 获取矩阵变量</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、矩阵变量语法： 请求路径：/cars/sell;low=34;brand=byd,audi,yd</span></span><br><span class="line">   <span class="comment">//2、SpringBoot默认是禁用了矩阵变量的功能</span></span><br><span class="line">   <span class="comment">//      手动开启：原理。对于路径的处理。UrlPathHelper进行解析。</span></span><br><span class="line">   <span class="comment">//              removeSemicolonContent（移除分号内容）支持矩阵变量的</span></span><br><span class="line">   <span class="comment">//3、矩阵变量必须有url路径变量才能被解析</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/cars/&#123;path&#125;&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Map <span class="title">carsSell</span><span class="params">(<span class="meta">@MatrixVariable(&quot;low&quot;)</span> Integer low,</span></span></span><br><span class="line"><span class="params"><span class="function">                       <span class="meta">@MatrixVariable(&quot;brand&quot;)</span> List&lt;String&gt; brand,</span></span></span><br><span class="line"><span class="params"><span class="function">                       <span class="meta">@PathVariable(&quot;path&quot;)</span> String path)</span></span>&#123;</span><br><span class="line">       Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">       map.put(<span class="string">&quot;low&quot;</span>,low);</span><br><span class="line">       map.put(<span class="string">&quot;brand&quot;</span>,brand);</span><br><span class="line">       map.put(<span class="string">&quot;path&quot;</span>,path);</span><br><span class="line">       <span class="keyword">return</span> map;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// /boss/1;age=20/2;age=10</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/boss/&#123;bossId&#125;/&#123;empId&#125;&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Map <span class="title">boss</span><span class="params">(<span class="meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;bossId&quot;)</span> Integer bossAge,</span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="meta">@MatrixVariable(value = &quot;age&quot;,pathVar = &quot;empId&quot;)</span> Integer empAge)</span></span>&#123;</span><br><span class="line">       Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">       map.put(<span class="string">&quot;bossAge&quot;</span>,bossAge);</span><br><span class="line">       map.put(<span class="string">&quot;empAge&quot;</span>,empAge);</span><br><span class="line">       <span class="keyword">return</span> map;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebConfig</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HiddenHttpMethodFilter <span class="title">hiddenHttpMethodFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HiddenHttpMethodFilter filter = <span class="keyword">new</span> HiddenHttpMethodFilter();</span><br><span class="line">        filter.setMethodParam(<span class="string">&quot;_m&quot;</span>);    <span class="comment">//修改_method</span></span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">// 自定义其中的功能,此处演示启用矩阵变量功能</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> </span>&#123;</span><br><span class="line">                UrlPathHelper urlPathHelper = <span class="keyword">new</span> UrlPathHelper();</span><br><span class="line">                <span class="comment">// 设置不删除分号内容</span></span><br><span class="line">                urlPathHelper.setRemoveSemicolonContent(<span class="keyword">false</span>);</span><br><span class="line">                configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ServletAPI"><a href="#ServletAPI" class="headerlink" title="ServletAPI"></a>ServletAPI</h4><blockquote><p>WebRequest、ServletRequest、MultipartRequest、 HttpSession、javax.servlet.http.PushBuilder、Principal、InputStream、Reader、HttpMethod、Locale、TimeZone、ZoneId</p></blockquote><h4 id="参数注解源码分析"><a href="#参数注解源码分析" class="headerlink" title="参数注解源码分析"></a>参数注解源码分析</h4><p><a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=32">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></p><p>直接看困了，以后再看吧。</p><h4 id="自定义参数绑定"><a href="#自定义参数绑定" class="headerlink" title="自定义参数绑定"></a>自定义参数绑定</h4><ol><li><p>编写两个bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    String username;</span><br><span class="line">    String password;</span><br><span class="line">    Integer age;</span><br><span class="line">    Date birthday;</span><br><span class="line">    Pet pet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pet</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写表单</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/saveuser&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>&gt;</span></span><br><span class="line">    生日：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;date&quot;</span> <span class="attr">name</span>=<span class="string">&quot;birthday&quot;</span>&gt;</span></span><br><span class="line">    宠物名字：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pet.name&quot;</span>&gt;</span></span><br><span class="line">    宠物年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pet.age&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;POST提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>编写controller测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/saveuser&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">saveuser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="自定义转换器"><a href="#自定义转换器" class="headerlink" title="自定义转换器"></a>自定义转换器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">// 自定义其中的功能</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFormatters</span><span class="params">(FormatterRegistry registry)</span> </span>&#123;</span><br><span class="line">                registry.addConverter(<span class="keyword">new</span> Converter&lt;String, Date&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Date <span class="title">convert</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                        SimpleDateFormat sf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">                        Date date = <span class="keyword">null</span>;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            date = sf.parse(s);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> date;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="数据响应与内容协商"><a href="#数据响应与内容协商" class="headerlink" title="数据响应与内容协商"></a>数据响应与内容协商</h3><h4 id="响应JSON数据"><a href="#响应JSON数据" class="headerlink" title="响应JSON数据"></a>响应JSON数据</h4><ol><li>引入jackson.jar，已包含在starter-web场景启动器中</li><li>使用注解@ResponseBody</li></ol><h4 id="响应原理"><a href="#响应原理" class="headerlink" title="响应原理"></a>响应原理</h4><p><a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=37">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></p><h4 id="内容协商"><a href="#内容协商" class="headerlink" title="内容协商"></a>内容协商</h4><blockquote><p>根据客户端接收能力不同，返回不同媒体类型的数据。</p></blockquote><ol><li><p>以xml为示例，引入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>请求头里accept字段，设置了接收数据以xml格式为优先</p></li><li><p>开启基于请求参数的内容协商原理，同时url中添加请求参数format=xxx即可</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">contentnegotiation:</span></span><br><span class="line">      <span class="attr">favor-parameter:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="内容协商原理"><a href="#内容协商原理" class="headerlink" title="内容协商原理"></a>内容协商原理</h4><p><a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=39">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></p><h4 id="自定义MessageConvertor"><a href="#自定义MessageConvertor" class="headerlink" title="自定义MessageConvertor"></a>自定义MessageConvertor</h4><p><a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=41">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></p><h3 id="视图解析与模板引擎"><a href="#视图解析与模板引擎" class="headerlink" title="视图解析与模板引擎"></a>视图解析与模板引擎</h3><h4 id="thymeleaf"><a href="#thymeleaf" class="headerlink" title="thymeleaf"></a>thymeleaf</h4><blockquote><p>java模板引擎</p></blockquote><ol start="0"><li><p><a href="https://www.yuque.com/atguigu/springboot/vgzmgh#E21jG">基本语法</a></p></li><li><p>引入依赖</p></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>编写模板</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span>默认的值<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;www.google.com&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;$&#123;link&#125;&quot;</span>&gt;</span>跳转百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;www.google.com&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;link&#125;&quot;</span>&gt;</span>跳转百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>编写controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewTestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testsuccess&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// model中的数据会被放在请求域中</span></span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;msgTest&quot;</span>);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;link&quot;</span>, <span class="string">&quot;https://www.baidu.com&quot;</span>);</span><br><span class="line">        <span class="comment">// 跳转页面写页面的前名</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><p><a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=49&spm_id_from=pageDriver">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></p><ol><li>编写Interceptor</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登陆检查</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 目标方法执行之前</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Run LoginInterceptor.preHandle&quot;</span>);</span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line">        Object loginUser = session.getAttribute(<span class="string">&quot;loginUser&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (loginUser != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            session.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;当前尚未登录&quot;</span>);</span><br><span class="line">            response.sendRedirect(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 目标方法执行之后</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Run LoginInterceptor.postHandle&quot;</span>,modelAndView);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 页面渲染以后</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Run LoginInterceptor.afterCompletion&quot;</span>,ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>编写WebConfig类，添加interceptor</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminWebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 添加拦截器，并且设置拦截地址与不拦截地址</span></span><br><span class="line">        <span class="comment">// /**拦截目录下所有资源，静态资源也会被拦截</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> LoginInterceptor()).addPathPatterns(<span class="string">&quot;/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/login&quot;</span>,<span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/js/**&quot;</span>,<span class="string">&quot;/font/**&quot;</span>,<span class="string">&quot;/images/**&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置exlucde不拦截，或者在配置文件中编写static-path-pattern=/static/**，注意此时需要修改标签中的href</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p><a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=51">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></p><ol><li>编写controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件上传测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FormTestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/form_layouts&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">formLayouts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;form/form_layouts&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * MultipartFile自动封装上传过来的文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;email&quot;)</span> String email,</span></span></span><br><span class="line"><span class="params"><span class="function">                         <span class="meta">@RequestParam(&quot;name&quot;)</span> String name,</span></span></span><br><span class="line"><span class="params"><span class="function">                         <span class="meta">@RequestPart(&quot;headImg&quot;)</span> MultipartFile headImg,</span></span></span><br><span class="line"><span class="params"><span class="function">                         <span class="meta">@RequestPart(&quot;photos&quot;)</span> MultipartFile[] photos)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取的信息</span></span><br><span class="line">        log.info(<span class="string">&quot;上传的信息：email=&#123;&#125;,name=&#123;&#125;,headImg=&#123;&#125;,photos=&#123;&#125;&quot;</span>, email, name, headImg.getSize(), photos.length);</span><br><span class="line">        <span class="keyword">if</span> (!headImg.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// 获取原文件名、保存到服务器</span></span><br><span class="line">            headImg.transferTo(<span class="keyword">new</span> File(<span class="string">&quot;C:\\Users\\卢荟\\Desktop\\test1\\&quot;</span>+headImg.getOriginalFilename()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (photos.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (MultipartFile photo : photos) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!photo.isEmpty()) &#123;</span><br><span class="line">                    photo.transferTo(<span class="keyword">new</span> File(<span class="string">&quot;C:\\Users\\卢荟\\Desktop\\test2\\&quot;</span>+photo.getOriginalFilename()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>编写配置文件</li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改上传文件的最大大小</span></span><br><span class="line"><span class="meta">spring.servlet.multipart.max-file-size</span>=<span class="string">10MB</span></span><br><span class="line"><span class="meta">spring.servlet.multipart.max-request-size</span>=<span class="string">100MB</span></span><br></pre></td></tr></table></figure><h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><blockquote><ul><li>默认情况下，Spring Boot提供<code>/error</code>处理所有错误的映射</li><li>对于机器客户端，它将生成JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。</li><li>对于浏览器客户端，响应一个“ whitelabel”错误视图，以HTML格式呈现相同的数据</li></ul></blockquote><h4 id="自定义错误页"><a href="#自定义错误页" class="headerlink" title="自定义错误页"></a>自定义错误页</h4><p>在将400.html、500.html等页面放在resources &gt; templates &gt;error下即可</p><h4 id="自定义异常处理"><a href="#自定义异常处理" class="headerlink" title="自定义异常处理"></a>自定义异常处理</h4><h5 id="ControllerAdvice-ExceptionHandler"><a href="#ControllerAdvice-ExceptionHandler" class="headerlink" title="@ControllerAdvice+@ExceptionHandler"></a>@ControllerAdvice+@ExceptionHandler</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理整个web controller的异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span>   <span class="comment">//注明这是一个增强的controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理数学异常、空指针异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(&#123;ArithmeticException.class, NullPointerException.class&#125;)</span>   <span class="comment">// 表明用于处理指定异常</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handleArithException</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;异常是：&#123;&#125;&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error/404&quot;</span>;      <span class="comment">// 指定返回视图的地址</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ResponseStatus-自定义Exception"><a href="#ResponseStatus-自定义Exception" class="headerlink" title="@ResponseStatus+自定义Exception"></a>@ResponseStatus+自定义Exception</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseStatus(value = HttpStatus.FORBIDDEN,reason = &quot;用户数量太多&quot;)</span>     <span class="comment">//注明异常返回状态码和原因</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserTooManyException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserTooManyException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserTooManyException</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="自定义HandlerExceptionResolver"><a href="#自定义HandlerExceptionResolver" class="headerlink" title="自定义HandlerExceptionResolver"></a>自定义HandlerExceptionResolver</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerHandlerExceptionResolver</span> <span class="keyword">implements</span> <span class="title">HandlerExceptionResolver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveException</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            httpServletResponse.sendError(<span class="number">511</span>, <span class="string">&quot;自定义错误&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="原生组件注入"><a href="#原生组件注入" class="headerlink" title="原生组件注入"></a>原生组件注入</h3><h4 id="ServletAPI-1"><a href="#ServletAPI-1" class="headerlink" title="ServletAPI"></a>ServletAPI</h4><h5 id="ServletComponentScan"><a href="#ServletComponentScan" class="headerlink" title="@ServletComponentScan"></a>@ServletComponentScan</h5><p>主应用类中使用@ServletComponentScan配置扫描路径</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@ServletComponentScan(basePackages = &quot;com.spb_adminex.servlet&quot;)//配置servlet、filter、listener扫描地址</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class SpbAdminexApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(SpbAdminexApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="WebServlet"><a href="#WebServlet" class="headerlink" title="@WebServlet"></a>@WebServlet</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/my&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        resp.getWriter().write(<span class="string">&quot;MyServlet running&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="WebFilter"><a href="#WebFilter" class="headerlink" title="@WebFilter"></a>@WebFilter</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &#123;&quot;/css/*&quot;,&quot;/images/*&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyFilter初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyFilter销毁&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyFilter running&quot;</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="WebListener"><a href="#WebListener" class="headerlink" title="@WebListener"></a>@WebListener</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyListener监听到项目初始化完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyListener监听到项目销毁&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RegisterBean"><a href="#RegisterBean" class="headerlink" title="RegisterBean"></a>RegisterBean</h4><p>编写一个配置类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRegisterConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">myServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> MyServlet(), <span class="string">&quot;/my&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">myFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FilterRegistrationBean filterRegistrationBean = <span class="keyword">new</span> FilterRegistrationBean(<span class="keyword">new</span> MyFilter());</span><br><span class="line">        filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/my&quot;</span>,<span class="string">&quot;/css/*&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletListenerRegistrationBean <span class="title">myListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServletListenerRegistrationBean(<span class="keyword">new</span> MyListener());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="数据访问"><a href="#数据访问" class="headerlink" title="数据访问"></a>数据访问</h2><h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><h4 id="使用默认数据源、jdbcTemplate"><a href="#使用默认数据源、jdbcTemplate" class="headerlink" title="使用默认数据源、jdbcTemplate"></a>使用默认数据源、jdbcTemplate</h4><ol><li>导入starter场景和数据库驱动</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>编写配置文件application.yaml</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/online_bookstore</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456789</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure><ol start="3"><li>使用jdbcTemplate测试</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpbAdminexApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Long count = jdbcTemplate.queryForObject(<span class="string">&quot;select count(*) from admin&quot;</span>, Long.class);</span><br><span class="line">        log.info(<span class="string">&quot;当前表的记录数为&quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="使用Druid数据源"><a href="#使用Druid数据源" class="headerlink" title="使用Druid数据源"></a>使用Druid数据源</h4><ol><li>引入数据源</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>编写数据源配置类</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDataSourceConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 引入自己的数据源之后，自动配置的默认DataSource失效</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource&quot;)</span>    <span class="comment">//将组件与配置文件中的属性绑定</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DruidDataSource druidDataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        <span class="keyword">return</span> druidDataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>测试</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpbAdminexApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DataSource dataSource;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;当前数据源类型为&#123;&#125;&quot;</span>, dataSource.getClass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>其他👉<a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=61&spm_id_from=pageDriver">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></li></ol><h4 id="使用xml配置文件整合MyBatis"><a href="#使用xml配置文件整合MyBatis" class="headerlink" title="使用xml配置文件整合MyBatis"></a>使用xml配置文件整合MyBatis</h4><ol><li>导入依赖</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>编写application.yaml配置文件</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span> <span class="comment">#全局配置文件位置</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span>      <span class="comment">#sql映射文件位置</span></span><br></pre></td></tr></table></figure><ol start="3"><li>编写mybatis-config.xml全局配置文件/或者编写application配置文件(此时不能同时配置全局配置文件位置)</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 开启下划线转驼峰命名法 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span>      <span class="comment">#sql映射文件位置</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span><span class="comment">#开启下划线转驼峰命名法</span></span><br></pre></td></tr></table></figure><ol start="4"><li>编写beanMapper接口</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span> <span class="comment">//注明这是一个mapper接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AdminMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Admin <span class="title">getAdmin</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">insertAdmin</span><span class="params">(Admin admin)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>编写beanMapper.xml配置文件</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.spb_adminex.mapper.AdminMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAdmin&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.spb_adminex.bean.Admin&quot;</span> &gt;</span></span><br><span class="line">        select * from admin where  id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertAdmin&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        insert into admin(`account`,`password`) values(#&#123;account&#125;,#&#123;password&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="6"><li>编写service层</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AdminMapper adminMapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Admin <span class="title">getAdminById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> adminMapper.getAdmin(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">insertAdmin</span><span class="params">(Admin admin)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> adminMapper.insertAdmin(admin);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="7"><li>编写controller层</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AdminService adminService;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getAdmin&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Admin <span class="title">getAdminById</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> adminService.getAdminById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="使用注解整合MyBatis"><a href="#使用注解整合MyBatis" class="headerlink" title="使用注解整合MyBatis"></a>使用注解整合MyBatis</h4><ol><li>其余文件，且不需要beanMapper.xml</li><li>编写beanMapper接口</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span> <span class="comment">//注明这是一个mapper接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AdminMapper</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from admin where id=#&#123;id&#125;&quot;)</span>   <span class="comment">//注解替换beanMapper.xml文件</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Admin <span class="title">getAdmin</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="整合MyBatis-Plus"><a href="#整合MyBatis-Plus" class="headerlink" title="整合MyBatis-Plus"></a>整合MyBatis-Plus</h4><p><a href="https://mp.baomidou.com/guide/quick-start.html#%E7%BC%96%E7%A0%81">快速开始 | MyBatis-Plus (baomidou.com)</a></p><h5 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h5><ol><li>导入依赖</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>为启动类添加@MapperScan，注明扫描Mapper文件的地址</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.baomidou.mybatisplus.samples.quickstart.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(QuickStartApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>编写全局配置文件</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/spb_adminex</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456789</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure><ol start="4"><li>编写Bean类</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;user&quot;)</span>  <span class="comment">//可以指定表名，不知道则默认为类名</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span>  <span class="comment">//注明当前字段在表中不存在</span></span><br><span class="line">    <span class="keyword">private</span> String test;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>编写BeanMapper接口</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public interface UserMapper extends BaseMapper&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li>编写BeanService接口</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="7"><li>编写BeanServiceImpl实现类</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">UserMapper</span>,<span class="title">User</span>&gt; <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="8"><li>编写controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/dynamic_table&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">dynamicTable</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; userList = userService.list();</span><br><span class="line">        model.addAttribute(<span class="string">&quot;userList&quot;</span>, userList);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;table/dynamic_table&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/responsive_table&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">responsiveTable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;table/responsive_table&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/editable_table&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">editableTable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;table/editable_table&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="分页操作"><a href="#分页操作" class="headerlink" title="分页操作"></a>分页操作</h5><ol><li>编写MybatisPlugConfig</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建MybatisPlusInterceptor</span></span><br><span class="line">        MybatisPlusInterceptor interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> PaginationInnerInterceptor(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>编写controller</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 进入dynamic_table并展示分页数据</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/dynamic_table&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">dynamicTable</span><span class="params">(<span class="meta">@RequestParam(value = &quot;pn&quot;,defaultValue = &quot;1&quot;)</span>Integer pn, Model model)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获得分页结果对象，并设置分页</span></span><br><span class="line">        Page&lt;User&gt; page = userService.page(<span class="keyword">new</span> Page&lt;User&gt;(pn, <span class="number">2</span>));</span><br><span class="line">        model.addAttribute(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">        <span class="comment">// page.getRecords获得所有记录，page.current获得当前页数，page.pages获得总页数，page.getTotal获得总条数……</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;table/dynamic_table&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/delete/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">// 删除用户功能</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteUser</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id,</span></span></span><br><span class="line"><span class="params"><span class="function">                             <span class="meta">@RequestParam(value = &quot;pn&quot;,defaultValue = &quot;1&quot;)</span> Integer pn,</span></span></span><br><span class="line"><span class="params"><span class="function">                             RedirectAttributes ra)</span> </span>&#123;</span><br><span class="line">        userService.removeById(id);</span><br><span class="line">        ra.addAttribute(<span class="string">&quot;pn&quot;</span>, pn);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/dynamic_table&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>编写html页面，thymeleaf语法详见<a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=67&spm_id_from=pageDriver">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>邮箱<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;gradeX&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;user,status:$&#123;page.getRecords()&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;status.count&#125;&quot;</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.name&#125;&quot;</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.age&#125;&quot;</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.email&#125;&quot;</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/user/delete/&#123;id&#125;(id=$&#123;user.id&#125;,pn=$&#123;page.current&#125;)&#125;&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row-fluid&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataTables_info&quot;</span>&gt;</span>当前第[[$&#123;page.current&#125;]]页 总计[[$&#123;page.pages&#125;]]页 总[[$&#123;page.getTotal&#125;]]条记录</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dataTables_paginate paging_bootstrap pagination&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;prev disabled&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>← Previous<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:class</span>=<span class="string">&quot;$&#123;num == page.current?&#x27;active&#x27;:&#x27;&#x27;&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;num:$&#123;#numbers.sequence(1,page.pages)&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/dynamic_table(pn=$&#123;num&#125;)&#125;&quot;</span>&gt;</span>[[$&#123;num&#125;]]<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;next disabled&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Next → <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="NoSQL-Redis"><a href="#NoSQL-Redis" class="headerlink" title="NoSQL(Redis)"></a>NoSQL(Redis)</h3><p>不尝试了没钱</p><h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><h3 id="SpringBootTest"><a href="#SpringBootTest" class="headerlink" title="@SpringBootTest"></a>@SpringBootTest</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h3><ul><li>**@Test :**表示方法是测试方法。但是与JUnit4的@Test不同，他的职责非常单一不能声明任何属性，拓展的测试将会由Jupiter提供额外测试</li><li>**@ParameterizedTest :**表示方法是参数化测试，下方会有详细介绍</li><li>**@RepeatedTest :**表示方法可重复执行，下方会有详细介绍</li><li>**@DisplayName :**为测试类或者测试方法设置展示名称</li><li>**@BeforeEach :**表示在每个单元测试之前执行</li><li>**@AfterEach :**表示在每个单元测试之后执行</li><li>**@BeforeAll :**表示在所有单元测试之前执行</li><li>**@AfterAll :**表示在所有单元测试之后执行</li><li>**@Tag :**表示单元测试类别，类似于JUnit4中的@Categories</li><li>**@Disabled :**表示测试类或测试方法不执行，类似于JUnit4中的@Ignore</li><li>**@Timeout :**表示测试方法运行如果超过了指定时间将会返回错误</li><li>**@ExtendWith :**为测试类或测试方法提供扩展类引用</li></ul><h3 id="断言机制"><a href="#断言机制" class="headerlink" title="断言机制"></a>断言机制</h3><p><a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=73">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></p><h3 id="……"><a href="#……" class="headerlink" title="……"></a>……</h3><h2 id="指标监控"><a href="#指标监控" class="headerlink" title="指标监控"></a>指标监控</h2><p><a href="https://www.bilibili.com/video/BV19K4y1L7MT?p=77">雷丰阳2021版SpringBoot2零基础入门springboot全套完整版（spring boot2）_哔哩哔哩_bilibili</a></p><h2 id="高级特性"><a href="#高级特性" class="headerlink" title="高级特性"></a>高级特性</h2><h2 id="后会有期"><a href="#后会有期" class="headerlink" title="后会有期"></a>后会有期</h2><p>源码和其他部分到时候<del>(也不知道啥时候)</del>会再去看的，but not today</p>]]></content>
      
      
      <categories>
          
          <category> ssm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> 学习 </tag>
            
            <tag> ssm </tag>
            
            <tag> javaEE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【学习笔记】MyBatis</title>
      <link href="/2021/07/16/xue-xi-bi-ji-mybatis/"/>
      <url>/2021/07/16/xue-xi-bi-ji-mybatis/</url>
      
        <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><blockquote><p>mybatis是一个优秀的基于java的持久层框架,它内部封装了<br>jdbc,使开发者只需要关注sq语句本身,而不需要花费精力<br>去处理加载驱动、创建连接、创建 statement等繁杂的过程。</p><p>mybatis通过xm或注解的方式将要执行的各种 statement配<br>置起来,并通过java对象和 statement中sq的动态参数进行<br>映射生成最终执行的sq语句。</p><p>最后 mybatis框架执行sql并将结果映射为java对象并返回。采用ORM思想解决了实体和数据库映射的问题,对jdbc进行了封装,屏蔽了 jdbc api底层访问细节,使我们不用与 jdbc api打交道,就可以完成对数据库的持久化操作。</p></blockquote><h2 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h2><ol><li><p>添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.46<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>编写数据表与Bean类</p></li><li><p>创建并编写mapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;userMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.myspring.bean.User&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建并编写sqlMapConfig.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置数据源环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456789&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>调用操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得核心配置文件</span></span><br><span class="line">InputStream resourceAsStream = Resources.getResourceAsStream(<span class="string">&quot;mybatis/sqlMapConfig.xml&quot;</span>);</span><br><span class="line"><span class="comment">// 获得session工厂对象</span></span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(resourceAsStream);</span><br><span class="line"><span class="comment">// 获得session会话对象</span></span><br><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line"><span class="comment">// 执行操作,参数即mapper.xml中的namespace.id</span></span><br><span class="line">List&lt;User&gt; userList = sqlSession.selectList(<span class="string">&quot;userMapper.findAll&quot;</span>);</span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line">System.out.println(userList);</span><br><span class="line"><span class="comment">// 释放资源</span></span><br><span class="line">sqlSession.close();</span><br></pre></td></tr></table></figure></li></ol><h2 id="增删改查操作代码"><a href="#增删改查操作代码" class="headerlink" title="增删改查操作代码"></a>增删改查操作代码</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;userMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.myspring.bean.User&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 插入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;save&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.myspring.bean.User&quot;</span>&gt;</span></span><br><span class="line">        insert into user</span><br><span class="line">        values (#&#123;name&#125;, #&#123;age&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 修改 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.myspring.bean.User&quot;</span>&gt;</span></span><br><span class="line">        update user</span><br><span class="line">        set age=#&#123;age&#125;</span><br><span class="line">        where name = #&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得核心配置文件</span></span><br><span class="line">InputStream resourceAsStream = Resources.getResourceAsStream(<span class="string">&quot;mybatis/sqlMapConfig.xml&quot;</span>);</span><br><span class="line"><span class="comment">// 获得session工厂对象</span></span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(resourceAsStream);</span><br><span class="line"><span class="comment">// 获得session会话对象</span></span><br><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询</span></span><br><span class="line">List&lt;User&gt; userList = sqlSession.selectList(<span class="string">&quot;userMapper.findAll&quot;</span>);</span><br><span class="line"><span class="comment">// 插入</span></span><br><span class="line">sqlSession.insert(<span class="string">&quot;userMapper.save&quot;</span>, <span class="keyword">new</span> User(<span class="string">&quot;李52四&quot;</span>, <span class="number">11</span>));</span><br><span class="line"><span class="comment">// 修改</span></span><br><span class="line">sqlSession.update(<span class="string">&quot;userMapper.update&quot;</span>, <span class="keyword">new</span> User(<span class="string">&quot;李52四&quot;</span>, <span class="number">110</span>));</span><br><span class="line"><span class="comment">// 删除</span></span><br><span class="line">sqlSession.delete(<span class="string">&quot;userMapper.delete&quot;</span>, <span class="string">&quot;李52四&quot;</span>);</span><br><span class="line"><span class="comment">// 执行更新操作需要提交事务</span></span><br><span class="line">sqlSession.commit();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放资源</span></span><br><span class="line">sqlSession.close();</span><br></pre></td></tr></table></figure><h2 id="配置文件常用标签"><a href="#配置文件常用标签" class="headerlink" title="配置文件常用标签"></a>配置文件常用标签</h2><h3 id="environments标签"><a href="#environments标签" class="headerlink" title="environments标签"></a>environments标签</h3><blockquote><p>配置数据库环境，支持多环境</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210717113103566.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210717113103566.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210717113103566"></p><h4 id="transactionManager事务管理器属性"><a href="#transactionManager事务管理器属性" class="headerlink" title="transactionManager事务管理器属性"></a>transactionManager事务管理器属性</h4><ul><li>JDBC: 这个配置就是直接使用了JDBC的提交和回滚设置,它依赖于从数据源得到的连接来管理事务作用域</li><li>MANAGED: 这个配置几乎没做什么。它从来不提交或回滚一个连接,而是让容器来管理事务的整个生命周期(比如JEE应用服务器的上下文)。默认情况下它会关闭连接,然而一些容器并不希望这样,因此需要将closeConnection属性设置为false来阻止它默认的关闭行为。</li></ul><h4 id="daraSource数据源属性"><a href="#daraSource数据源属性" class="headerlink" title="daraSource数据源属性"></a>daraSource数据源属性</h4><ul><li>UNPOOLED:这个数据源的实现只是每次被请求时打开和关闭连接。</li><li>POOLED:这种数据源的实现利用“池”的概念将JDBC连接对象组织起来。</li><li>JNDI:这个数据源的实现是为了能在如EJB或应用服务器这类容器中使用,容器可以集中或在外部配置数据源,然后放置一个JNDI上下文的引用。</li></ul><h3 id="Mapper标签"><a href="#Mapper标签" class="headerlink" title="Mapper标签"></a>Mapper标签</h3><blockquote><p>加载映射，加载方式有多种。</p></blockquote><ul><li>使用相对于类路径的资源引用,例如:&lt; mapper resource=”org/ mybatis/ builder/ AuthorMapperxm”/&gt;</li><li>使用完全限定资源定位符(URL),例如:&lt; mapper url=”file//ar/ mappers/ Author Mapper.xm”/</li><li>使用映射器接口实现类的完全限定类名,例如:&lt; mapper class=” org. mybatis builder. AuthorMapper”/&gt;</li><li>将包内的映射器接口实现全部注主册为映射器,例如:&lt; package name=” org. mybatis. builder”/&gt;</li></ul><h3 id="Properties标签"><a href="#Properties标签" class="headerlink" title="Properties标签"></a>Properties标签</h3><blockquote><p>实际开发中,习惯将数据源的配置信息单独抽取成个 properties文件,该标签可以加载额外配置的 properties文件</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 加载properties文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置数据源环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 加载映射文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mybatis/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="typeAliases标签"><a href="#typeAliases标签" class="headerlink" title="typeAliases标签"></a>typeAliases标签</h3><blockquote><p>起别名，有已经设置好的常用的类型的别名，也可自定义</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210717115049996.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210717115049996.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210717115049996"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 自定义别名，注意标签在config.xml中的顺序 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.myspring.bean.User&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;user&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="MyBatis相关API"><a href="#MyBatis相关API" class="headerlink" title="MyBatis相关API"></a>MyBatis相关API</h2><h3 id="SqlSession工厂构建器SqlSessionFactoryBuilder"><a href="#SqlSession工厂构建器SqlSessionFactoryBuilder" class="headerlink" title="SqlSession工厂构建器SqlSessionFactoryBuilder"></a>SqlSession工厂构建器SqlSessionFactoryBuilder</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210717115904738.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210717115904738.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210717115904738"></p><h3 id="SqlSession工厂对象SqlSessionFactory"><a href="#SqlSession工厂对象SqlSessionFactory" class="headerlink" title="SqlSession工厂对象SqlSessionFactory"></a>SqlSession工厂对象SqlSessionFactory</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210717120144619.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210717120144619.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210717120144619"></p><h3 id="SqlSession会话对象"><a href="#SqlSession会话对象" class="headerlink" title="SqlSession会话对象"></a>SqlSession会话对象</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210717120625651.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210717120625651.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210717120625651"></p><h2 id="DAO层实现"><a href="#DAO层实现" class="headerlink" title="DAO层实现"></a>DAO层实现</h2><blockquote><p>采用 Mybatis的代理开发方式实现DAO层的开发,这种方式是我们后面进入企业的主流。</p><p>Mapper接口开发方法只需要程序员编写 Mapper接口(相当于Dao接口),由 Mybatis框架根据接口定义创建接口的动态代理对象,代理对象的方法体同上边Dao接口实现类方法。</p></blockquote><p> <img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210717123055155.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210717123055155.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210717123055155"></p><ul><li>Mapper.xm文件中的 namespace与 mapper接口的全限定名相同</li><li>Mapper接口方法名和 Mapper. xm中定义的每个 statement的id相同</li><li>Mapper接口方法的输入参数类型和 mapper. xn中定义的毎个sql的 parameter Type的类型相同</li><li>Mapper接口方法的辅出参数类型和 mapper. xm中定义的每个sq的 resultType的类型相同</li></ul><ol><li><p>创建并编写Mapper.xml文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.myspring.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 查询所有 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 根据name查询所有 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByName&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from user</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建并编写Mapper接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查询所有</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">    <span class="comment">// 根据id查询所有</span></span><br><span class="line">     <span class="function">User <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>调用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">InputStream resourceAsStream = Resources.getResourceAsStream(<span class="string">&quot;myBatis/sqlMapConfig.xml&quot;</span>);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(resourceAsStream);</span><br><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">List&lt;User&gt; all = mapper.findAll();</span><br><span class="line">User user = mapper.findById(<span class="number">2</span>);</span><br></pre></td></tr></table></figure></li></ol><h2 id="映射文件：动态sql语句"><a href="#映射文件：动态sql语句" class="headerlink" title="映射文件：动态sql语句"></a>映射文件：动态sql语句</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- sql语句抽取 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;selectUser&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态条件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByCondition&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectUser&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id!=0&quot;</span>&gt;</span></span><br><span class="line">            and id=#&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null&quot;</span>&gt;</span></span><br><span class="line">            and name=#&#123;name&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age!=0&quot;</span>&gt;</span></span><br><span class="line">            and age=#&#123;age&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态条件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByIds&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectUser&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        -- select * from user where id in(?,?)</span><br><span class="line">        -- collection写list或array等</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;id in(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><h3 id="类型转换TypeHandler标签"><a href="#类型转换TypeHandler标签" class="headerlink" title="类型转换TypeHandler标签"></a>类型转换TypeHandler标签</h3><p><a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=173">黑马程序员最全SSM框架教程|Spring+SpringMVC+MyBatis全覆盖_SSM整合_哔哩哔哩_bilibili</a></p><h3 id="插件plugins标签"><a href="#插件plugins标签" class="headerlink" title="插件plugins标签"></a>插件plugins标签</h3><ol><li><p>添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.jsqlparser<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsqlparser<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在配置文件中添加标签</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageHelper&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dialect&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>调用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分页助手，设置分页信息以分页，startPage(pageNum,pageSize)</span></span><br><span class="line">PageHelper.startPage(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">// 当前页</span></span><br><span class="line">List&lt;User&gt; userList = mapper.findAll();</span><br><span class="line"><span class="comment">// 分页信息</span></span><br><span class="line">PageInfo&lt;User&gt; userPageInfo = <span class="keyword">new</span> PageInfo&lt;&gt;(userList);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;上一页：&quot;</span> + userPageInfo.getPrePage());</span><br><span class="line">System.out.println(<span class="string">&quot;当前页：&quot;</span> + userPageInfo.getPageNum());</span><br><span class="line">System.out.println(<span class="string">&quot;下一页：&quot;</span> + userPageInfo.getNextPage());</span><br><span class="line">System.out.println(<span class="string">&quot;总页数：&quot;</span> + userPageInfo.getPages());</span><br><span class="line">System.out.println(<span class="string">&quot;当前条数：&quot;</span> + userPageInfo.getPageSize());</span><br><span class="line">System.out.println(<span class="string">&quot;总条数：&quot;</span> + userPageInfo.getTotal());</span><br><span class="line">System.out.println(<span class="string">&quot;是否第一页：&quot;</span> + userPageInfo.isIsFirstPage());</span><br><span class="line">System.out.println(<span class="string">&quot;是否末页：&quot;</span> + userPageInfo.isIsLastPage());</span><br><span class="line">    </span><br></pre></td></tr></table></figure></li></ol><h2 id="多表操作"><a href="#多表操作" class="headerlink" title="多表操作"></a>多表操作</h2><p><a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=181">黑马程序员最全SSM框架教程|Spring+SpringMVC+MyBatis全覆盖_SSM整合_哔哩哔哩_bilibili</a></p><h2 id="注解开发"><a href="#注解开发" class="headerlink" title="注解开发"></a>注解开发</h2><h3 id="使用xml开发crud"><a href="#使用xml开发crud" class="headerlink" title="使用xml开发crud"></a>使用xml开发crud</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加载映射文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mybatis/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.myspring.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- sql语句抽取 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;selectUser&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectUser&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from user</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByIds&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectUser&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            -- select * from user where id in(?,?)</span><br><span class="line">            -- collection写list或array等</span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;id in(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">                #&#123;id&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByCondition&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectUser&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id!=0&quot;</span>&gt;</span></span><br><span class="line">                and id=#&#123;id&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null&quot;</span>&gt;</span></span><br><span class="line">                and name=#&#123;name&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age!=0&quot;</span>&gt;</span></span><br><span class="line">                and age=#&#123;age&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 插入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;save&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.myspring.bean.User&quot;</span>&gt;</span></span><br><span class="line">        insert into user (name, age)</span><br><span class="line">        values (#&#123;name&#125;, #&#123;age&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 修改 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.myspring.bean.User&quot;</span>&gt;</span></span><br><span class="line">        update user</span><br><span class="line">        set age=#&#123;age&#125;,</span><br><span class="line">            name=#&#123;name&#125;</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 删除 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delete&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        delete</span><br><span class="line">        from user</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findByCondition</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findByIds</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        InputStream resourceAsStream = Resources.getResourceAsStream(<span class="string">&quot;myBatis/sqlMapConfig.xml&quot;</span>);</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(resourceAsStream);</span><br><span class="line">        SqlSession sqlSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">        userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setName(<span class="string">&quot;钱老板&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">90</span>);</span><br><span class="line">        userMapper.save(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        User user = userMapper.findById(<span class="number">3</span>);</span><br><span class="line">        user.setAge(<span class="number">99</span>);</span><br><span class="line">        userMapper.update(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        userMapper.delete(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        User user = userMapper.findById(<span class="number">3</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="注解开发CRUD"><a href="#注解开发CRUD" class="headerlink" title="注解开发CRUD"></a>注解开发CRUD</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from user&quot;)</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from user where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">User <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into user (name, age) values (#&#123;name&#125;, #&#123;age&#125;)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update user set age=#&#123;age&#125;, name=#&#123;name&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot; delete from user where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加载映射关系 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定接口所在的包 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.myspring.dao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p>调用不变</p>]]></content>
      
      
      <categories>
          
          <category> ssm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 学习 </tag>
            
            <tag> ssm </tag>
            
            <tag> MyBatis </tag>
            
            <tag> javaEE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【项目笔记】ssm整合练习简单CRUD项目</title>
      <link href="/2021/07/16/xiang-mu-bi-ji-ssm-zheng-he-lian-xi/"/>
      <url>/2021/07/16/xiang-mu-bi-ji-ssm-zheng-he-lian-xi/</url>
      
        <content type="html"><![CDATA[<h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><h3 id="功能点"><a href="#功能点" class="headerlink" title="功能点"></a>功能点</h3><ol><li>分页</li><li>数据校验<ul><li>jQuery前端校验</li><li>JSR303后端校验</li></ul></li><li>AJAX</li><li>REST风格</li></ol><h3 id="技术点"><a href="#技术点" class="headerlink" title="技术点"></a>技术点</h3><ol><li>基础框架ssm</li><li>数据库MySQL</li><li>请阿丹框架bootstrap</li><li>项目管理maven</li><li>分页插件pagehelper</li><li>逆向工程mybatis generator</li></ol><h2 id="基础环境搭建"><a href="#基础环境搭建" class="headerlink" title="基础环境搭建"></a>基础环境搭建</h2><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>​    创建maven项目，添加javaee-web application framework support</p><h3 id="引入maven相关依赖"><a href="#引入maven相关依赖" class="headerlink" title="引入maven相关依赖"></a>引入maven相关依赖</h3><p>​    引入spring springmvc mybatis等相关依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ssm_crud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- spring springmvc --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- springmvc --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.16.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring jdbc --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.16.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring aspects aop面向切面编程 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.16.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- mybatis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库连接池、驱动 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.46<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 其他 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="引入前端框架"><a href="#引入前端框架" class="headerlink" title="引入前端框架"></a>引入前端框架</h3><p>​    引入jQuery、Bootstrap</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;!-- 最新版本的 Bootstrap 核心 CSS 文件 --&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css&quot;</span></span><br><span class="line">      integrity=<span class="string">&quot;sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu&quot;</span> crossorigin=<span class="string">&quot;anonymous&quot;</span>&gt;</span><br><span class="line">&lt;!-- 最新的 Bootstrap 核心 JavaScript 文件 --&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js&quot;</span></span><br><span class="line">        integrity=<span class="string">&quot;sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd&quot;</span></span><br><span class="line">        crossorigin=<span class="string">&quot;anonymous&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="ssm整合配置文件"><a href="#ssm整合配置文件" class="headerlink" title="ssm整合配置文件"></a>ssm整合配置文件</h2><h3 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 1、启动spring的容器 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置全局参数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置监听器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2、springmvc前端控制器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置xml地址 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3、全局字符编码过滤器，注意这个过滤器一定要放在所有过滤器之前 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceRequestEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceResponseEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 4、过滤器：使用REST风格的URI 将页面普通的POST请求转为指定的delete或者put请求 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="spring-mvc-xml"><a href="#spring-mvc-xml" class="headerlink" title="spring-mvc.xml"></a>spring-mvc.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- springMVC的配置文件 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置组件扫描路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.sss_crud&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 只扫描controller(即所有注释controller的类) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置视图解析器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/views&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 过滤静态资源 （将springmvc不能处理的请求交给Tomcat，该标签表示当spring找不到资源时交由原始容器(tomcat)寻找） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mvc注解驱动 以及其他一些功能支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="applicationContext-xml"><a href="#applicationContext-xml" class="headerlink" title="applicationContext.xml"></a>applicationContext.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- spring配置文件 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置组件扫描路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.sss_crud&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 不扫描controller(即所有注释controller的类) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 加载外部的properties文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置数据源，事务控制 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- mybatis整合 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- sqlSessionFactory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- mybatis全局配置文件、数据源、mapper配置文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mapper/*.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置扫描器，将mybatis接口的实现加入到IOC容器中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.sss_crud.mapper&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 事务控制 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 事务管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启基于注解的事务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 切入点表达式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;txPoint&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.sss_crud.service..*(..))&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置事务增强 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;txPoint&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置事务增强，事务如何切入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 切入点切入的所有方法（连接点）都是事务方法 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;get*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="jdbc-properties"><a href="#jdbc-properties" class="headerlink" title="jdbc.properties"></a>jdbc.properties</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/ssm</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">123456789</span></span><br></pre></td></tr></table></figure><h3 id="mybatis-config-xml"><a href="#mybatis-config-xml" class="headerlink" title="mybatis-config.xml"></a>mybatis-config.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启驼峰命名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置别名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 自动扫描路径下的类并且起别名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.sss_crud.bean&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="数据库构建"><a href="#数据库构建" class="headerlink" title="数据库构建"></a>数据库构建</h2><h3 id="ssm-crud-sql"><a href="#ssm-crud-sql" class="headerlink" title="ssm_crud.sql"></a>ssm_crud.sql</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for tbl_dept</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `tbl_dept`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tbl_dept`  (</span><br><span class="line">  `dept_id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;部门id&#x27;</span>,</span><br><span class="line">  `dept_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`dept_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for tbl_emp</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `tbl_emp`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tbl_emp`  (</span><br><span class="line">  `emp_id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;员工id&#x27;</span>,</span><br><span class="line">  `emp_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `gender` <span class="type">char</span>(<span class="number">1</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `email` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `d_id` <span class="type">int</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`emp_id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  INDEX `fk_emp_dept`(`d_id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `fk_emp_dept` <span class="keyword">FOREIGN</span> KEY (`d_id`) <span class="keyword">REFERENCES</span> `tbl_dept` (`dept_id`) <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT <span class="keyword">ON</span> UPDATE RESTRICT</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><h2 id="基础模块"><a href="#基础模块" class="headerlink" title="基础模块"></a>基础模块</h2><h3 id="mybatis逆向工程生成bean、mapper"><a href="#mybatis逆向工程生成bean、mapper" class="headerlink" title="mybatis逆向工程生成bean、mapper"></a>mybatis逆向工程生成bean、mapper</h3><h4 id="generatorConfig-xml"><a href="#generatorConfig-xml" class="headerlink" title="generatorConfig.xml"></a>generatorConfig.xml</h4><blockquote><p>mybatis generator的配置文件</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--注意targetProject中使用反斜杠，connectionURL需要添加useSSL=true--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置要链接的数据库的数据源--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    &lt;classPathEntry location=&quot;E:/GARBAGE_TEMP_SPACE/mysql-connector-java-5.1.46.jar&quot; /&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!---Mybatis上下文--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;MySqlContext&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 取消生成的文件的全部自动注释 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--配置数据库的链接信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/ssm_crud?useSSL=false&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">&quot;123456789&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--数据库BigDecimals字段在java中定义--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--实体类生成信息 指定javabean生成位置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.sss_crud.bean&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src\main\java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--指定mybatis的mapper.xml映射文件地址--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src\main\resources&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--指定mybatis的mapper接口生成地址--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.sss_crud.mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src\main\java&quot;</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--要生成的表结构--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;tbl_emp&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Employee&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;tbl_dept&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Department&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="MBGTest-class"><a href="#MBGTest-class" class="headerlink" title="MBGTest.class"></a>MBGTest.class</h4><blockquote><p>运行mybatis generator以自动生成bean和mapper，可能需要手动添加构造器</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.mybatis.generator.api.MyBatisGenerator;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.xml.ConfigurationParser;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.internal.DefaultShellCallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MBGTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        List&lt;String&gt; warnings = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">boolean</span> overwrite = <span class="keyword">true</span>;</span><br><span class="line">        File configFile = <span class="keyword">new</span> File(<span class="string">&quot;generatorConfig.xml&quot;</span>);</span><br><span class="line">        ConfigurationParser cp = <span class="keyword">new</span> ConfigurationParser(warnings);</span><br><span class="line">        Configuration config = cp.parseConfiguration(configFile);</span><br><span class="line">        DefaultShellCallback callback = <span class="keyword">new</span> DefaultShellCallback(overwrite);</span><br><span class="line">        MyBatisGenerator myBatisGenerator = <span class="keyword">new</span> MyBatisGenerator(config, callback, warnings);</span><br><span class="line">        myBatisGenerator.generate(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="当前项目结构"><a href="#当前项目结构" class="headerlink" title="当前项目结构"></a>当前项目结构</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210919161803065.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210919161803065.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210919161802860"></p><h3 id="MapperTest单元测试"><a href="#MapperTest单元测试" class="headerlink" title="MapperTest单元测试"></a>MapperTest单元测试</h3><h4 id="引入maven"><a href="#引入maven" class="headerlink" title="引入maven"></a>引入maven</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring test --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.16.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="添加可以批量操作的sqlSession"><a href="#添加可以批量操作的sqlSession" class="headerlink" title="添加可以批量操作的sqlSession"></a>添加可以批量操作的sqlSession</h4><blockquote><p>注意在applicationContext.xml文件中添加可以批量操作的sqlSession</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 一个可以执行批量操作的SQLSession --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;executorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;BATCH&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="MapperTest类编写"><a href="#MapperTest类编写" class="headerlink" title="MapperTest类编写"></a>MapperTest类编写</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sss_crud.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sss_crud.mapper.DepartmentMapper;</span><br><span class="line"><span class="keyword">import</span> com.sss_crud.mapper.EmployeeMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &#123;&quot;classpath:applicationContext.xml&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapperTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DepartmentMapper departmentMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    EmployeeMapper employeeMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SqlSession session;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// departmentMapper.insertSelective(new Department(null, &quot;开发&quot;));</span></span><br><span class="line">        <span class="comment">// departmentMapper.insertSelective(new Department(null, &quot;测试&quot;));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// employeeMapper.insertSelective(new Employee(null, &quot;Jerry&quot;, &quot;M&quot;, &quot;Jerry@qq.com&quot;, 1));</span></span><br><span class="line">        <span class="comment">// employeeMapper.insertSelective(new Employee(null, &quot;Cat&quot;, &quot;W&quot;, &quot;Cat@qq.com&quot;, 2));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用可以批量操作的session获得mapper,从而进行批量操作</span></span><br><span class="line">        EmployeeMapper mapper = session.getMapper(EmployeeMapper.class);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            String uid = UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">5</span>) + i;</span><br><span class="line">            mapper.insertSelective(<span class="keyword">new</span> Employee(<span class="keyword">null</span>, uid, <span class="string">&quot;M&quot;</span>, uid + <span class="string">&quot;@qq.com&quot;</span>, <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="查询功能"><a href="#查询功能" class="headerlink" title="查询功能"></a>查询功能</h2><blockquote><p>此功能需要使用分页插件pageHelper</p></blockquote><h3 id="pagehelper分页插件"><a href="#pagehelper分页插件" class="headerlink" title="pagehelper分页插件"></a>pagehelper分页插件</h3><h4 id="引入maven依赖"><a href="#引入maven依赖" class="headerlink" title="引入maven依赖"></a>引入maven依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置mybatis-config-xml以使用插件"><a href="#配置mybatis-config-xml以使用插件" class="headerlink" title="配置mybatis-config.xml以使用插件"></a>配置mybatis-config.xml以使用插件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ...... --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 插件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="views"><a href="#views" class="headerlink" title="views"></a>views</h3><h4 id="index-jsp"><a href="#index-jsp" class="headerlink" title="index.jsp"></a>index.jsp</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;$Title$&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;!-- 最新版本的 Bootstrap 核心 CSS 文件 --&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css&quot;</span></span><br><span class="line">          integrity=<span class="string">&quot;sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu&quot;</span> crossorigin=<span class="string">&quot;anonymous&quot;</span>&gt;</span><br><span class="line">    &lt;!-- 最新的 Bootstrap 核心 JavaScript 文件 --&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js&quot;</span></span><br><span class="line">            integrity=<span class="string">&quot;sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd&quot;</span></span><br><span class="line">            crossorigin=<span class="string">&quot;anonymous&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;%-- 跳转至展示所有员工信息 --%&gt;</span><br><span class="line">    &lt;jsp:forward page=<span class="string">&quot;/emps&quot;</span>&gt;&lt;/jsp:forward&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><h4 id="EmployeeServiceImpl-java"><a href="#EmployeeServiceImpl-java" class="headerlink" title="EmployeeServiceImpl.java"></a>EmployeeServiceImpl.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sss_crud.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sss_crud.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sss_crud.mapper.EmployeeMapper;</span><br><span class="line"><span class="keyword">import</span> com.sss_crud.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeServiceImpl</span> <span class="keyword">implements</span> <span class="title">EmployeeService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    EmployeeMapper employeeMapper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> employeeMapper.selectByExampleWithDept(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><h4 id="EmployeeController-java"><a href="#EmployeeController-java" class="headerlink" title="EmployeeController.java"></a>EmployeeController.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sss_crud.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageInfo;</span><br><span class="line"><span class="keyword">import</span> com.sss_crud.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sss_crud.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理员工CRUD请求</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    EmployeeService employeeService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询员工数据（分页）</span></span><br><span class="line"><span class="comment">     * url请求参数“pn”为请求页数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/emps&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">getEmps</span><span class="params">(<span class="meta">@RequestParam(value = &quot;pn&quot;, defaultValue = &quot;1&quot;)</span> Integer pn)</span> </span>&#123;</span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        <span class="comment">// 使用pageHelper实现分页功能</span></span><br><span class="line">        PageHelper.startPage(pn, <span class="number">5</span>);</span><br><span class="line">        <span class="comment">// 查询（此时的数据已经是分页后的数据）</span></span><br><span class="line">        List&lt;Employee&gt; emps = employeeService.getAll();</span><br><span class="line">        <span class="comment">// 使用pageInfo包装（加入其他更多的信息，所有页，当前页等等）</span></span><br><span class="line">        PageInfo pageInfo = <span class="keyword">new</span> PageInfo(emps, <span class="number">5</span>);</span><br><span class="line">        mav.addObject(<span class="string">&quot;pageInfo&quot;</span>, pageInfo);</span><br><span class="line">        mav.setViewName(<span class="string">&quot;list&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Test单元测试"><a href="#Test单元测试" class="headerlink" title="Test单元测试"></a>Test单元测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageInfo;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mock.web.MockHttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.web.WebAppConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MvcResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.setup.MockMvcBuilders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebAppConfiguration(value = &quot;src/main/web&quot;)</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &#123;&quot;classpath:applicationContext.xml&quot;, &quot;classpath:spring-mvc.xml&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MvcTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//传入springmvc的ioc</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    WebApplicationContext context;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 虚拟MVC请求 获得请求结果</span></span><br><span class="line">    MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initMockMvc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mockMvc = MockMvcBuilders.webAppContextSetup(context).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        MvcResult result = mockMvc.perform(MockMvcRequestBuilders.get(<span class="string">&quot;/emps&quot;</span>).param(<span class="string">&quot;pn&quot;</span>, <span class="string">&quot;1&quot;</span>)).andReturn();</span><br><span class="line">        MockHttpServletRequest request = result.getRequest();</span><br><span class="line">        PageInfo pageInfo = (PageInfo) request.getAttribute(<span class="string">&quot;pageInfo&quot;</span>);</span><br><span class="line">        System.out.println(pageInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>没有成功，返回为null，我不理解，都spring了还用nm的jsp呢，不弄了！反正结构都差不多了实现逻辑也就那样，拜拜了您嘞！</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ssm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssm </tag>
            
            <tag> javaEE </tag>
            
            <tag> 项目 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【学习笔记】SpringMVC</title>
      <link href="/2021/07/15/xue-xi-bi-ji-springmvc/"/>
      <url>/2021/07/15/xue-xi-bi-ji-springmvc/</url>
      
        <content type="html"><![CDATA[<h2 id="SpringMVC概述"><a href="#SpringMVC概述" class="headerlink" title="SpringMVC概述"></a>SpringMVC概述</h2><blockquote><p>SpringMVC是种基于Java的实现MVc设计模型的请求驱动类型的轻量级Web框架,属于Spring FrameWork的后续产品,已经融合在 Spring Web Flow中。</p><p>SpringMvC已经成为目前最主流的MVC框架之一,并且随着 Spring30的发布,全面超越 Struts2,成为最优秀的MVC框架。它通过一套注解,让一个简单的Java类成为处理请求的控制器,而无须实现任何接口。同时它还支持RESTful编程风格的请求。</p></blockquote><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210715135214321.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210715135214321.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210715135214321"></p><h2 id="SpringMVC快速开发步骤"><a href="#SpringMVC快速开发步骤" class="headerlink" title="SpringMVC快速开发步骤"></a>SpringMVC快速开发步骤</h2><ol><li><p>导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置web.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- springMVC前端控制器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置xml地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>编写controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用RequestMapping映射controller地址</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/myController&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Controller save running&quot;</span>);</span><br><span class="line">        <span class="comment">// return要跳转的视图页面</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在resources下新增spring-mvc.xmld的spring config文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context  http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- controller的组件扫描 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.myspring.controller&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="SpringMVC组件解析"><a href="#SpringMVC组件解析" class="headerlink" title="SpringMVC组件解析"></a>SpringMVC组件解析</h2><h3 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a>@RequestMapping</h3><p>用于建立请求URL和处理请求方法之间的对应关系</p><h4 id="位置"><a href="#位置" class="headerlink" title="位置"></a>位置</h4><ul><li>类上,请求URL的第一级访问目录。此处不写的话,就相当于应用的根目录</li><li>方法上,请求URL的第二级访问目录,与类上的使用@ ReqquestMapping标主的级目录起组成访问虚拟路径</li><li>return 后跟的路径：不加”/“，则从相对路径查询，否则从web路径下查询。</li></ul><h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><ul><li>value：用于指定请求的URL。它和path属性的作用是一样的</li><li>method：用于指定请求的方式</li><li>params：用于指定限制请求参数的条件。它支持简单的表达式。要求请求参数的key和vaue必须和配置的一模一样</li></ul><h4 id="MVC命名空间引入"><a href="#MVC命名空间引入" class="headerlink" title="MVC命名空间引入"></a>MVC命名空间引入</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 命名空间 --&gt;</span></span><br><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</span><br><span class="line"><span class="comment">&lt;!-- 约束地址 --&gt;</span></span><br><span class="line">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt; http://www.springframework.org/schema/mvc  http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt;</span><br></pre></td></tr></table></figure><h4 id="组件扫描"><a href="#组件扫描" class="headerlink" title="组件扫描"></a>组件扫描</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.myspring.controller&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="XML配置"><a href="#XML配置" class="headerlink" title="XML配置"></a>XML配置</h3><h4 id="return重定义与请求转发"><a href="#return重定义与请求转发" class="headerlink" title="return重定义与请求转发"></a>return重定义与请求转发</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">&quot;forward:/success.jsp&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;redirect:/success.jsp&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="内部资源（视图）解析器"><a href="#内部资源（视图）解析器" class="headerlink" title="内部资源（视图）解析器"></a>内部资源（视图）解析器</h4><ol><li><p>在spring-mvc.xml中配置如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 内部资源解析器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;viewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置前缀 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/jsp/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置后缀 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">2. 编写controller</span><br><span class="line"></span><br><span class="line">   ```java</span><br><span class="line">   // return &quot;/jsp/success.jsp&quot;;</span><br><span class="line">   return &quot;success&quot; //效果与上述相同</span><br></pre></td></tr></table></figure></li></ol><h2 id="SpringMVC数据响应"><a href="#SpringMVC数据响应" class="headerlink" title="SpringMVC数据响应"></a>SpringMVC数据响应</h2><h3 id="页面跳转"><a href="#页面跳转" class="headerlink" title="页面跳转"></a>页面跳转</h3><h4 id="返回字符串"><a href="#返回字符串" class="headerlink" title="返回字符串"></a>返回字符串</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">&quot;/jsp/success.jsp&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="返回ModelAndview对象"><a href="#返回ModelAndview对象" class="headerlink" title="返回ModelAndview对象"></a>返回ModelAndview对象</h4><p>在controller中编写如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一种</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/myController1&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">save2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">    <span class="comment">// 设置视图</span></span><br><span class="line">    modelAndView.setViewName(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    <span class="comment">// 设置模型</span></span><br><span class="line">    modelAndView.addObject(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;qqq&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第二种</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/myController2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">save3</span><span class="params">(ModelAndView modelAndView)</span> </span>&#123;</span><br><span class="line">    modelAndView.setViewName(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    modelAndView.addObject(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;qqq&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第三种</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/myController3&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">save4</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">    model.setAttribute(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;qqq&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第四种</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/myController4&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">save4</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    request.setAttribute(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;qqq&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="回写数据"><a href="#回写数据" class="headerlink" title="回写数据"></a>回写数据</h3><h4 id="返回字符串（-ResponseBody）"><a href="#返回字符串（-ResponseBody）" class="headerlink" title="返回字符串（@ResponseBody）"></a>返回字符串（@ResponseBody）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一种</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/myController1&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save1</span><span class="params">(HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    resp.getWriter().print(<span class="string">&quot;hello!!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第二种,使用ResponseBody，用于区分页面跳转</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/myController2&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">save2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello!!!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="返回JSON格式字符串"><a href="#返回JSON格式字符串" class="headerlink" title="返回JSON格式字符串"></a>返回JSON格式字符串</h4><ol><li><p>添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>转换为JSON</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/myController&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 获得bean</span></span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">18</span>);</span><br><span class="line">    <span class="comment">// 转换为JSON</span></span><br><span class="line">    String userJson = <span class="keyword">new</span> ObjectMapper().writeValueAsString(user);</span><br><span class="line">    <span class="keyword">return</span> userJson;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="返回Spring自动转换Bean-gt-JSON"><a href="#返回Spring自动转换Bean-gt-JSON" class="headerlink" title="返回Spring自动转换Bean-&gt;JSON"></a>返回Spring自动转换Bean-&gt;JSON</h4><ol><li><p>配置spring-mvc.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 处理器映射器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;messageConverters&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>   </span><br></pre></td></tr></table></figure><p>或者使用mvc注解驱动如下配置：</p>   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</span><br><span class="line"></span><br><span class="line">http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- mvc注解驱动 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>编写controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第二种,使用ResponseBody，用于区分页面跳转</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/myController&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">save</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">18</span>);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="SpringMVC请求"><a href="#SpringMVC请求" class="headerlink" title="SpringMVC请求"></a>SpringMVC请求</h2><h3 id="获取请求参数"><a href="#获取请求参数" class="headerlink" title="获取请求参数"></a>获取请求参数</h3><h4 id="获取基本类型参数"><a href="#获取基本类型参数" class="headerlink" title="获取基本类型参数"></a>获取基本类型参数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/myController&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(String username, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用形参接收数据，注意此处参数名与表单中input的name值对应</span></span><br><span class="line">    System.out.println(username);</span><br><span class="line">    System.out.println(age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取Bean类型参数"><a href="#获取Bean类型参数" class="headerlink" title="获取Bean类型参数"></a>获取Bean类型参数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/myController&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 实际上是使用了Bean对象里的set方法，所以要让参数的名字与set方法名对应，否则接收不到</span></span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取数据类型参数"><a href="#获取数据类型参数" class="headerlink" title="获取数据类型参数"></a>获取数据类型参数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/myController&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(String[] strs)</span> </span>&#123;</span><br><span class="line">    System.out.println(Arrays.toString(strs));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取集合类型参数"><a href="#获取集合类型参数" class="headerlink" title="获取集合类型参数"></a>获取集合类型参数</h4><ol><li><p>前端传输数据</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/js/jquery-1.7.2.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> userList = <span class="keyword">new</span> Array();</span><br><span class="line">    userList.push(&#123;name: <span class="string">&quot;张三&quot;</span>, age: <span class="number">10</span>&#125;);</span><br><span class="line">    userList.push(&#123;name: <span class="string">&quot;李四&quot;</span>, age: <span class="number">20</span>&#125;);</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        type: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        url: <span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/test/myController&quot;</span>,</span><br><span class="line">        data: JSON.stringify(userList),</span><br><span class="line">        contentType: <span class="string">&quot;application/json;charset=utf-8&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li><li><p>controller获得数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/myController&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;User&gt; userList)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 注意 @RequestBody List&lt;User&gt; userList</span></span><br><span class="line">    System.out.println(userList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="静态资源访问权限开放"><a href="#静态资源访问权限开放" class="headerlink" title="静态资源访问权限开放"></a>静态资源访问权限开放</h3><p>spring-mvc.xml中配置如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开放资源访问，设置可访问地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/js/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/js/&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 该标签表示当spring找不到时交由原始容器(tomcat)寻找 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="全局编码过滤（防止中文乱码）"><a href="#全局编码过滤（防止中文乱码）" class="headerlink" title="全局编码过滤（防止中文乱码）"></a>全局编码过滤（防止中文乱码）</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 全局编码过滤 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="参数绑定注解-RequestParam"><a href="#参数绑定注解-RequestParam" class="headerlink" title="参数绑定注解@RequestParam"></a>参数绑定注解@RequestParam</h3><ul><li>value: 与请求参数名称</li><li>required: 此在指定的请求参数是否必须包括,默认是true,提交时如果没有此参数则报错</li><li>defaultvalue: 当没有指定请求参数时,则使用指定的默认值赋值</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/myController&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(<span class="meta">@RequestParam(value=&quot;name&quot;, required=false，defaultvalue=&quot;000&quot;)</span> String username)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 将获得的参数name映射为所需要的username</span></span><br><span class="line">    System.out.println(username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="获得Restfil风格参数"><a href="#获得Restfil风格参数" class="headerlink" title="获得Restfil风格参数"></a>获得Restfil风格参数</h3><blockquote><p>Restful是一种软件架构风格、设计风格,而不是标准,只是提供了一组设计原则和约束条件。主要用于客户端和服务器交互类的软件,基于这个风格设计的软件可以更简洁,更有层次,更易于实现缓存机制等。</p><p>Restful风格的请求是使用“”ur+请求方式”表示次请求目的的,HTP协议里面四个表示操作方式的动词如下：</p><ul><li>GET: 用于获取资源</li><li>POST: 用于新建资源</li><li>PUT: 用于更新资源</li><li>DELETE: 用于删除资源</li></ul><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210715195834413.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210715195834413.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210715195834413" style="zoom: 67%;" /></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/myController/&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="comment">// 使用占位符&#123;&#125;</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(<span class="meta">@PathVariable(&quot;name&quot;)</span> String username)</span> </span>&#123;</span><br><span class="line">    System.out.println(username);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自定义类型转换器"><a href="#自定义类型转换器" class="headerlink" title="自定义类型转换器"></a>自定义类型转换器</h3><p><a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=71&spm_id_from=pageDriver">黑马程序员最全SSM框架教程|Spring+SpringMVC+MyBatis全覆盖_SSM整合_哔哩哔哩_bilibili</a></p><h3 id="获得请求头-RequestHeader"><a href="#获得请求头-RequestHeader" class="headerlink" title="获得请求头@RequestHeader"></a>获得请求头@RequestHeader</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210715203646312.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210715203646312.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210715203646312"></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210715204001905.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210715204001905.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210715204001905"></p><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><ol><li><p>导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dependency&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在spring-mvc.xml中配置文件上传解析器</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 上传文件的编码类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 上传文件总大小 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5242800&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 上传单个文件的大小 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSizePerFile&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5242800&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>编写controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/myController&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(MultipartFile uploadedFile)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    uploadedFile.transferTo(<span class="keyword">new</span> File(<span class="string">&quot;C:\\Users\\卢荟\\Desktop\\&quot;</span> + uploadedFile.getOriginalFilename()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/myController&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(MultipartFile[] files)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (MultipartFile file : files) &#123;</span><br><span class="line">        file.transferTo(<span class="keyword">new</span> File(<span class="string">&quot;C:\\Users\\卢荟\\Desktop\\&quot;</span> + file.getOriginalFilename()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## SpringMVC拦截器interceptor</span><br><span class="line"></span><br><span class="line">&gt; Spring Mvc的拦截器类似于 Servlet开发中的过滤器 Filter,用于对处理器进行预处理和后处理。</span><br><span class="line">&gt;</span><br><span class="line">&gt; 将拦截器按一定的顺序联结成条链,这条链称为拦截器链( interceptor Chain)。在访问被拦截的方法或字段时,拦截器链中的拦截器就会按其之前定义的顺序被调用。拦截器也是AOP思想的具体实现。</span><br><span class="line"></span><br><span class="line">### 开发步骤</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 编写interceptor</span><br><span class="line"></span><br><span class="line">   ```java</span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 在目标方法执行之前执行</span></span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;preHandle&quot;</span>);</span><br><span class="line">           String param = request.getParameter(<span class="string">&quot;param&quot;</span>);</span><br><span class="line">           <span class="keyword">if</span> (<span class="string">&quot;yes&quot;</span>.equals(param)) &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               request.getRequestDispatcher(<span class="string">&quot;/index.jsp&quot;</span>).forward(request, response);</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   </span><br><span class="line">       <span class="comment">// 在目标方法执行之后，试图返回之前执行</span></span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;postHandle&quot;</span>);</span><br><span class="line">           <span class="comment">// 可以对model进行修改</span></span><br><span class="line">           modelAndView.addObject(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;newName&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   </span><br><span class="line">       <span class="comment">// 在流程执行完毕之后执行</span></span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;afterCompletion&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li><li><p>在spring-mvc.xml中配置interceptor</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 对应执行顺序 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 对哪些资源执行拦截操作 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 对应interceptor --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.myspring.interceptor.MyInterceptor&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 对哪些资源执行拦截操作 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 对应interceptor --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.myspring.interceptor.MyInterceptor2&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="方法说明"><a href="#方法说明" class="headerlink" title="方法说明"></a>方法说明</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210716162523538.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210716162523538.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210716162523538"></p><h2 id="SpringMVC异常处理"><a href="#SpringMVC异常处理" class="headerlink" title="SpringMVC异常处理"></a>SpringMVC异常处理</h2><h3 id="简单异常处理器"><a href="#简单异常处理器" class="headerlink" title="简单异常处理器"></a>简单异常处理器</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 默认错误视图 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultErrorView&quot;</span> <span class="attr">value</span>=<span class="string">&quot;error1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionMappings&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- key:异常类型 value:错误视图 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;java.lang.ClassCastException&quot;</span> <span class="attr">value</span>=<span class="string">&quot;error2&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;java.io.IOException&quot;</span> <span class="attr">value</span>=<span class="string">&quot;error3&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="自定义异常处理器"><a href="#自定义异常处理器" class="headerlink" title="自定义异常处理器"></a>自定义异常处理器</h3><p> <a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=119&spm_id_from=pageDriver">黑马程序员最全SSM框架教程|Spring+SpringMVC+MyBatis全覆盖_SSM整合_哔哩哔哩_bilibili</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listener</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ssm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 学习 </tag>
            
            <tag> ssm </tag>
            
            <tag> javaEE </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【学习笔记】Spring</title>
      <link href="/2021/07/13/xue-xi-bi-ji-spring/"/>
      <url>/2021/07/13/xue-xi-bi-ji-spring/</url>
      
        <content type="html"><![CDATA[<h2 id="什么是Spring"><a href="#什么是Spring" class="headerlink" title="什么是Spring"></a>什么是Spring</h2><h3 id="Spring用来干什么"><a href="#Spring用来干什么" class="headerlink" title="Spring用来干什么"></a>Spring用来干什么</h3><blockquote><p>Spring是一个支持快速开发Java EE应用程序的框架。它提供了一系列底层容器和基础设施，并可以和大量常用的开源框架无缝集成。</p><p>Spring是分层的 Java SE/EE应用 full-stack轻量级开源框架,以loC(Inverse of Control:反转控制)和Aop(Aspect Oriented Programming:面向切面编程)为内核。</p><p>提供了展现层 Spring MVC和持久层 Spring JDBCTemplate以及业务层事务管理等众多的企业级应用技术，还能整合开源世界众多著名的第三方框架和类库,逐渐成为使用最多的 Java EE企业应用开源框架。</p></blockquote><h3 id="Spring发展历程"><a href="#Spring发展历程" class="headerlink" title="Spring发展历程"></a>Spring发展历程</h3><blockquote><p>1997年,BM提出了EB的思想<br>1998年,SUN制定开发标准规范E丿B1.0<br>1999年,EB1.1发布<br>2001年,EB2.0发布<br>2003年,EB2.1发布<br>2006年,EB3.0发布</p></blockquote><h3 id="Spring之父"><a href="#Spring之父" class="headerlink" title="Spring之父"></a>Spring之父</h3><blockquote><p>Rod Johnson( Spring之父)</p><p>《Expert One-to-One J2EE Design and development(2002)》<br>阐述了J2EE使用EB开发设计的优点及解决方案<br>《Expert One-to-One J2EE Development without EJB(2004)》<br>阐述了2E开发不使用EB的解决方式( Spring维形)</p></blockquote><h3 id="Spring的优势"><a href="#Spring的优势" class="headerlink" title="Spring的优势"></a>Spring的优势</h3><ol><li>方便解耦,简化开发<ul><li>通过 Spring提供的loC容器,可以将对象间的依赖关系交由 Spring进行控制,避免硬编码所造成的过度耦合。</li><li>用户也不必再为单例模式类、属性文件解析等这些很底层的需求编写代码,可以更专注于上层的应用。</li></ul></li><li>AOP编程的支持<ul><li>通过 Spring的AOP功能,方便进行面向切面编程,许多不容易用传统OOP实现的功能可以通过AOP轻松实现。</li></ul></li><li>声明式事务的支持<ul><li>可以将我们从单调烦闷的事务管理代码中解脱出来,通过声明式方式灵活的进行事务管理,提高发效率和质量。</li></ul></li><li>方便程序的测试<ul><li>可以用非容器依赖的编程方式进行几乎所有的测试工作,测试不再是昂贵的操作,而是随手可做的事情。</li></ul></li><li>方便集成各种优秀框架<ul><li>Spring对各种优秀框架( Struts、 Hibernate、 Hessian、Quartz等)的支持。</li></ul></li><li>降低 JavaEE AP的使用难度<ul><li>Spring对 JavaEE API(如JDBC、 JavaMail、远程调用等)进行了薄薄的封装层,使这些APl的使用难度大为降低。</li></ul></li></ol><h3 id="Spring体系结构"><a href="#Spring体系结构" class="headerlink" title="Spring体系结构"></a>Spring体系结构</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210713213335534.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210713213335534.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210713213335534"></p><h2 id="Spring快速开发步骤"><a href="#Spring快速开发步骤" class="headerlink" title="Spring快速开发步骤"></a>Spring快速开发步骤</h2><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210713213718215.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210713213718215.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210713213718215"></p><ol><li><p>导入maven依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建Spring conf配置文件（通常命名为applicationContext）</p></li><li><p>配置如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.myspring.dao.impl.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext app = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        UserDao userDao = (UserDao) app.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">        userDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="Spring配置文件"><a href="#Spring配置文件" class="headerlink" title="Spring配置文件"></a>Spring配置文件</h2><h3 id="Bean标签"><a href="#Bean标签" class="headerlink" title="Bean标签"></a>Bean标签</h3><blockquote><p>用于配置对象交由 Spring来创建。<br>默认情况下它调用的是类中的**无参构造函数,**如果没有无参构造函数则不能创建成功。</p></blockquote><h4 id="基本属性"><a href="#基本属性" class="headerlink" title="基本属性"></a>基本属性</h4><ul><li><p>id: Bean实例在 Spring容器中的唯一标识</p></li><li><p>class: Bean的全限定名称</p></li><li><p>scope：指对象的作用范围，取值如下</p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714123446604.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714123446604.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210714123446604"></p></li></ul><h3 id="singleton、prototype下bean对象的不同创建时间"><a href="#singleton、prototype下bean对象的不同创建时间" class="headerlink" title="singleton、prototype下bean对象的不同创建时间"></a>singleton、prototype下bean对象的不同创建时间</h3><p><a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=8&spm_id_from=pageDriver">singleton、prototype下bean对象的不同创建时间</a></p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714124755908.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714124755908.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210714124755908"></p><h3 id="Bean实例化三种方法"><a href="#Bean实例化三种方法" class="headerlink" title="Bean实例化三种方法"></a>Bean实例化三种方法</h3><ul><li><p>无参构造方法实例化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建容器</span></span><br><span class="line">ApplicationContext app = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="comment">// 从容器中获得对象</span></span><br><span class="line">UserDao userDao = (UserDao) app.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p>工厂静态方法实例化</p></li><li><p>工厂实例方法实例化</p></li><li><p><a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=10&spm_id_from=pageDriver">演示视频</a></p></li></ul><h3 id="Bean的依赖注入"><a href="#Bean的依赖注入" class="headerlink" title="Bean的依赖注入"></a>Bean的依赖注入</h3><blockquote><p>依赖注入( Dependency Injection)：它是 Spring框架核心|OC的具体实现<br>在编写程序时,通过控制反转,把对象的创健建交给了 Spring,但是代码中不可能出现没有依赖的情况。<br>OC解耦只是降低他们的依赖关系,但不会消除。例如:业务层仍会调用持久层的方法。<br>那这种业务层和持久层的依赖关系,在使用 Spring之后,就让 Spring来维护了<br>简单的说,就是坐等框架把持久层对象传入业务层,而不用我们自己去获取。</p></blockquote><h4 id="set方法（property标签）"><a href="#set方法（property标签）" class="headerlink" title="set方法（property标签）"></a>set方法（property标签）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第一种 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.myspring.service.impl.UserServiceImpl&quot;</span> &gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name属性值对应set方法名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 第二种 --&gt;</span></span><br><span class="line">xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.myspring.service.impl.UserServiceImpl&quot;</span> <span class="attr">p:userDao-ref</span>=<span class="string">&quot;userDao&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserServiceImpl中依赖注入，获得userDao对象</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="comment">// set方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserDao</span><span class="params">(UserDao userDao)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.userDao = userDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="构造（有参）方法（constructor-arg标签）"><a href="#构造（有参）方法（constructor-arg标签）" class="headerlink" title="构造（有参）方法（constructor-arg标签）"></a>构造（有参）方法（constructor-arg标签）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.myspring.service.impl.UserServiceImpl&quot;</span> &gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name属性值对应userServiceImpl内UserDao的属性名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 依赖注入，获得userDao对象</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="comment">// 构造方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">(UserDao userDao)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.userDao = userDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="注入数据的数据类型"><a href="#注入数据的数据类型" class="headerlink" title="注入数据的数据类型"></a>注入数据的数据类型</h4><ul><li>普通数据类型</li><li>引用数据类型</li><li>集合数据类型</li><li><a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=16&spm_id_from=pageDriver">演示视频</a></li></ul><h3 id="分模块开发（import标签）"><a href="#分模块开发（import标签）" class="headerlink" title="分模块开发（import标签）"></a>分模块开发（import标签）</h3><blockquote><p>实际开发中, Spring的配置内容非常多,这就导致 Spring配置很繁杂且体积很大,所以,可以将部分配置拆解到其他配置文件中,而在 Spring主配置文件通过impor标签进行加载。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;applicationContext-user.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">import</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Spring相关API"><a href="#Spring相关API" class="headerlink" title="Spring相关API"></a>Spring相关API</h2><h3 id="ApplicationContext"><a href="#ApplicationContext" class="headerlink" title="ApplicationContext"></a>ApplicationContext</h3><blockquote><p>application Context：接口类型,代表应用上下文,可以通过其实例获得 Spring容器中的Bean对象</p></blockquote><h4 id="三种实现类"><a href="#三种实现类" class="headerlink" title="三种实现类"></a>三种实现类</h4><ul><li><strong>ClassPathXmlApplicationContext</strong><br><strong>它是从类的根路径下加载配置文件推荐使用这种</strong></li><li>FileSystemXmlApplicationContext<br>它是从磁盘路径上加载配置文件,配置文件可以在磁盘的任意位置。</li><li><strong>AnnotationConfigApplicationContext</strong><br><strong>当使用注解配置容器对象时,需要使用此类来创建 spring容器。它用来读取注解。</strong></li></ul><h4 id="getBean-方法"><a href="#getBean-方法" class="headerlink" title="getBean()方法"></a>getBean()方法</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714143634260.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714143634260.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210714143634260"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserService userService1 = (UserService) app.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">UserService userService2 = app.getBean(UserService.class);</span><br></pre></td></tr></table></figure><h2 id="Spring配置数据源"><a href="#Spring配置数据源" class="headerlink" title="Spring配置数据源"></a>Spring配置数据源</h2><h3 id="数据源（连接池）的作用"><a href="#数据源（连接池）的作用" class="headerlink" title="数据源（连接池）的作用"></a>数据源（连接池）的作用</h3><blockquote><ul><li>数据源(连接池)是提高程序性能如出现的</li><li>事先实例化数据源,初始化部分连接资源</li><li>使用连接资源时从数据源中获取</li><li>使用完毕后将连接资源归还给数据源</li></ul></blockquote><h3 id="手动创建数据源的开发步骤"><a href="#手动创建数据源的开发步骤" class="headerlink" title="手动创建数据源的开发步骤"></a>手动创建数据源的开发步骤</h3><ol><li><p>导入Maven依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.46<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建jdbc.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/数据库名</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">123456789</span></span><br></pre></td></tr></table></figure></li><li><p>加载properties配置文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ResourceBundle rb = ResourceBundle.getBundle(<span class="string">&quot;jdbc&quot;</span>);</span><br><span class="line">String driver = rb.getString(<span class="string">&quot;jdbc.driver&quot;</span>);</span><br><span class="line">String url = rb.getString(<span class="string">&quot;jdbc.url&quot;</span>);</span><br><span class="line">String username = rb.getString(<span class="string">&quot;jdbc.username&quot;</span>);</span><br><span class="line">String password = rb.getString(<span class="string">&quot;jdbc.password&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p>创建数据源</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建c3p0数据源</span></span><br><span class="line">ComboPooledDataSource dataSource = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">dataSource.setDriverClass(driver);</span><br><span class="line">dataSource.setJdbcUrl(url);</span><br><span class="line">dataSource.setUser(username);</span><br><span class="line">dataSource.setPassword(password);</span><br><span class="line">Connection connection = dataSource.getConnection();</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建Druid数据源</span></span><br><span class="line">DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">dataSource.setDriverClassName(driver);</span><br><span class="line">dataSource.setUrl(url);</span><br><span class="line">dataSource.setUsername(username);</span><br><span class="line">dataSource.setPassword(password);</span><br><span class="line">DruidPooledConnection connection = dataSource.getConnection();</span><br></pre></td></tr></table></figure></li></ol><h3 id="使用Spring创建数据源的开发步骤"><a href="#使用Spring创建数据源的开发步骤" class="headerlink" title="使用Spring创建数据源的开发步骤"></a>使用Spring创建数据源的开发步骤</h3><ol><li><p>导入相关依赖</p></li><li><p>在applicationContext中配置数据源bean</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入context命名空间和约束路径 --&gt;</span></span><br><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 加载外部的properties文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- c3p0 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Driud --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714153548748.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714153548748.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210714153548748"></p></li><li><p>创建数据源对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">DataSource dataSource = applicationContext.getBean(DataSource.class);</span><br><span class="line">Connection connection = dataSource.getConnection();</span><br></pre></td></tr></table></figure></li></ol><h2 id="Spring注解开发"><a href="#Spring注解开发" class="headerlink" title="Spring注解开发"></a>Spring注解开发</h2><blockquote><p>Spring原始注解主要是替代<Bean>的配置</p></blockquote><h3 id="原始注解"><a href="#原始注解" class="headerlink" title="原始注解"></a>原始注解</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714154827196.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714154827196.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210714154827196"></p><h4 id="组件扫描"><a href="#组件扫描" class="headerlink" title="组件扫描"></a>组件扫描</h4><p>使用注解进行开发时,需要在 applicationContext. xm中配置组件扫描,作用是指定哪个包及其子包下的Bean，需要进行扫描以便识别使用注解配置的类、字段和方法。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置组件扫描 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.myspring&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Dao类"><a href="#Dao类" class="headerlink" title="Dao类"></a>Dao类</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置文件  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.myspring.dao.impl.UserDaoImpl&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注解配置，写在类名之上</span></span><br><span class="line"><span class="meta">@Component(&quot;userDao&quot;)</span></span><br><span class="line"><span class="comment">// 第二种可读性更强</span></span><br><span class="line"><span class="meta">@Repository(&quot;userDao&quot;)</span></span><br></pre></td></tr></table></figure><h4 id="Service类"><a href="#Service类" class="headerlink" title="Service类"></a>Service类</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置文件  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.myspring.service.impl.UserServiceImpl&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注解配置，写在类名之上</span></span><br><span class="line"><span class="meta">@Component(&quot;userService&quot;)</span></span><br><span class="line"><span class="comment">// 第二种可读性更强</span></span><br><span class="line"><span class="meta">@Service(&quot;userService&quot;)</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注解配置，写在字段之前</span></span><br><span class="line"><span class="comment">// Autowired从spring容器中根据 数据类型 进行匹配，所以同一数据类型只有单个bean可以只写Autowired</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="comment">// Qualifier从spring容器中根据 id值类型 进行匹配，但是必须结合Autowired一起使用</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;userDao&quot;)</span></span><br><span class="line"><span class="comment">// @Resource(name = &quot;userDao&quot;) 相当于前两者结合</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="comment">// 此时类中可以不写set方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserDao</span><span class="params">(UserDao userDao)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.userDao = userDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="普通属性注入"><a href="#普通属性注入" class="headerlink" title="普通属性注入"></a>普通属性注入</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String driver;</span><br></pre></td></tr></table></figure><h3 id="新注解"><a href="#新注解" class="headerlink" title="新注解"></a>新注解</h3><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714193700007.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714193700007.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210714193700007"></p><p>整合在一起的样子，如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 标志该类是Spring的核心配置类</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.myspring&quot;)</span> <span class="comment">// 配置组件扫描,替换&lt;context:component-scan base-package=&quot;com.myspring&quot;/&gt;</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span> <span class="comment">//  加载外部的properties文件,替换&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dataSource&quot;)</span> <span class="comment">// spring会将当前方法的返回值以指定名称存储到spring容器当中</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">getDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        dataSource.setDriverClassName(driver);</span><br><span class="line">        dataSource.setUrl(url);</span><br><span class="line">        dataSource.setUsername(username);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分模块如下（推荐）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 标志该类是Spring的核心配置类</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.myspring&quot;)</span> <span class="comment">// 配置组件扫描,替换&lt;context:component-scan base-package=&quot;com.myspring&quot;/&gt;</span></span><br><span class="line"><span class="meta">@Import(&#123;DataSourceConfiguration.class,&#125;)</span> <span class="comment">//括号内写数组&#123;xxx.class,xxx.class&#125;,替换&lt;import resource=&quot;&quot;/&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span> <span class="comment">//  加载外部的properties文件,替换&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dataSource&quot;)</span> <span class="comment">// spring会将当前方法的返回值以指定名称存储到spring容器当中</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">getDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        dataSource.setDriverClassName(driver);</span><br><span class="line">        dataSource.setUrl(url);</span><br><span class="line">        dataSource.setUsername(username);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Spring集成junit"><a href="#Spring集成junit" class="headerlink" title="Spring集成junit"></a>Spring集成junit</h2><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714200557371.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210714200557371.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210714200557371"></p><ol><li><p>添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>编写测试类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="comment">// @ContextConfiguration(&quot;classpath:applicationContext.xml&quot;) // 非注解方式注入配置</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = &#123;SpringConfiguration.class&#125;)</span>  <span class="comment">// 注解方式注入配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringJunitTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource(name = &quot;userService&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="Spring集成web环境"><a href="#Spring集成web环境" class="headerlink" title="Spring集成web环境"></a>Spring集成web环境</h2><blockquote><p>应用上下文对象是通过 new ClasspathXmlApplication Context( spring配置文件)方式获取的,但是每次从容器中获得Bean时都要编写 new ClasspathXmlApplication Context( spring配置文件),这样的弊端是配置<br>文件加载多次,应用上下文对象创建多次。</p><p>在Web项目中,可以使用 ServletcontextListener监听Web应用的启动,我们可以在Web应用启动时,就加载 Spring的配置文件,创建应用上下文对象 Application Context,在将其存储到最大的域 servletContext域中,这样就可以在任意位置从域中获得应用上下文 Application Context对象了</p></blockquote><h3 id="手动使用listener获取应用上下文对象"><a href="#手动使用listener获取应用上下文对象" class="headerlink" title="手动使用listener获取应用上下文对象"></a>手动使用listener获取应用上下文对象</h3><ol><li><p>创建listener类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextLoaderListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent servletContextEvent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ApplicationContext app = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;); //使用非注解时用该方法创建</span></span><br><span class="line">        ApplicationContext app = <span class="keyword">new</span> AnnotationConfigApplicationContext(SpringConfiguration.class); <span class="comment">// 使用注解时用该方法创建</span></span><br><span class="line">        <span class="comment">// 将Spring的应用上下文对象存储到ServletContext域对象中</span></span><br><span class="line">        servletContextEvent.getServletContext().setAttribute(<span class="string">&quot;app&quot;</span>, app);</span><br><span class="line">        System.out.println(<span class="string">&quot;spring容器创建完毕&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent servletContextEvent)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在web.xml中配置listener</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.myspring.listener.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>获取servletContext域对象中的应用上下文对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext app = (ApplicationContext) <span class="keyword">this</span>.getServletContext().getAttribute(<span class="string">&quot;app&quot;</span>);</span><br></pre></td></tr></table></figure></li></ol><h3 id="使用Spring获取应用上下文对象"><a href="#使用Spring获取应用上下文对象" class="headerlink" title="使用Spring获取应用上下文对象"></a>使用Spring获取应用上下文对象</h3><ol><li><p>导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置web.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 设置全局参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置监听器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>获取应用上下文对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WebApplicationContext app = WebApplicationContextUtils.getWebApplicationContext(req.getServletContext());</span><br></pre></td></tr></table></figure></li></ol><h2 id="JdbcTemplate"><a href="#JdbcTemplate" class="headerlink" title="JdbcTemplate"></a>JdbcTemplate</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote><p>它是 spring框架中提供的个对象,是对原始繁琐的 dbc API对象的简单封装。 spring框架为我们提供了很多的操作模板类。例如:操作关系型数据的 dbcTemplate和 bernate Template,操作nosq数据库的 RedisTemplate,操<br>作消息队列的 UmsTemplate等等。</p></blockquote><h3 id="手动开发步骤"><a href="#手动开发步骤" class="headerlink" title="手动开发步骤"></a>手动开发步骤</h3><ol><li><p>添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建数据库表和javaBean</p></li><li><p>创建jdbcTemplate对象、执行数据库操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcTemplateTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">// 测试dbcTemplate开发步骤</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建Druid数据源</span></span><br><span class="line">        DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        dataSource.setDriverClassName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        dataSource.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>);</span><br><span class="line">        dataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">&quot;123456789&quot;</span>);</span><br><span class="line">        <span class="comment">// 创建jdbcTemplate对象</span></span><br><span class="line">        JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">        <span class="comment">// 数据库操作</span></span><br><span class="line">        jdbcTemplate.update(<span class="string">&quot;insert into test1 values(?,?)&quot;</span>, <span class="string">&quot;张三&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="Spring使用JdbcTemplate开发步骤"><a href="#Spring使用JdbcTemplate开发步骤" class="headerlink" title="Spring使用JdbcTemplate开发步骤"></a>Spring使用JdbcTemplate开发步骤</h3><ol><li><p>添加依赖</p></li><li><p>编写jdbc.properties文件</p></li><li><p>编写spring-config文件applicationContext.xml，添加数据源对象，jdbcTemplate对象</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入context命名空间和约束路径 --&gt;</span></span><br><span class="line">xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 加载外部的properties文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Druid DataSource --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Spring JdbcTemplate --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>编写代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得applicationContext</span></span><br><span class="line">ApplicationContext app = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="comment">// 从容器中获得jdbcTemplate对象</span></span><br><span class="line">JdbcTemplate jdbcTemplate = app.getBean(JdbcTemplate.class);</span><br><span class="line"><span class="comment">// 数据库操作</span></span><br><span class="line">jdbcTemplate.update(<span class="string">&quot;insert into test1 values(?,?)&quot;</span>, <span class="string">&quot;张三&quot;</span>, <span class="number">18</span>);</span><br></pre></td></tr></table></figure></li></ol><h3 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbcTemplate.update(<span class="string">&quot;update test1 set age=? where name =?&quot;</span>, <span class="number">10</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">List&lt;User&gt; userList = jdbcTemplate.query(<span class="string">&quot;select * from test1&quot;</span>, <span class="keyword">new</span> BeanPropertyRowMapper&lt;&gt;(User.class));</span><br><span class="line">User user = jdbcTemplate.queryForObject(<span class="string">&quot;select * from test1 where age=?&quot;</span>, <span class="keyword">new</span> BeanPropertyRowMapper&lt;&gt;(User.class), <span class="number">18</span>);</span><br><span class="line">Long count = jdbcTemplate.queryForObject(<span class="string">&quot;select count(*) from test1&quot;</span>, Long.class);</span><br></pre></td></tr></table></figure><h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><blockquote><p>AOP为 Aspect Oriented Programming的缩写,意思为面向切面编程,是通过预编译方式和运行期动态代理现程序功能的同统一维护的一种技术。</p><p>AOP是OOP的延续,是软件开发中的一个热点,也是 Spring框架中的个重要内容,是函数式编程的种衍生范型。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p></blockquote><h4 id="作用与优势"><a href="#作用与优势" class="headerlink" title="作用与优势"></a>作用与优势</h4><p><a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=122&spm_id_from=pageDriver">黑马程序员最全SSM框架教程|Spring+SpringMVC+MyBatis全覆盖_SSM整合_哔哩哔哩_bilibili</a></p><h4 id="JDK动态代理、cglib动态代理"><a href="#JDK动态代理、cglib动态代理" class="headerlink" title="JDK动态代理、cglib动态代理"></a>JDK动态代理、cglib动态代理</h4><p><a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=124&spm_id_from=pageDriver">黑马程序员最全SSM框架教程|Spring+SpringMVC+MyBatis全覆盖_SSM整合_哔哩哔哩_bilibili</a></p><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><ul><li>Target(目标对象):代理的目标对象。</li><li>Proxy(代理):—个类被AOP织入增强后,就产生一个结果代理类。</li><li>Joinpoint(连接点):所谓连接点是指那些被拦截到的点。在 spring中这些点指的是方法,因为 spring只支持方法类型的连接点。</li><li>Pointcut(切入点):所谓切入点是指我们要对哪些 Joinpoint迸行拦截的定义。</li><li>Advice(通知/增强):所谓通知是指拦截到 Joinpoint之后所要做的事情就是通知。</li><li>Aspect(切面):是切入点和通知(引介个)的结合。</li><li>eaving(织入):是指把增强应用到目标对象来创建新的代理对象的过程。spring釆用动态代理织入,而Aspect采用编译期织入和类装载期织入。</li></ul><h3 id="基于XML开发AOP"><a href="#基于XML开发AOP" class="headerlink" title="基于XML开发AOP"></a>基于XML开发AOP</h3><h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ol><li><p>导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建目标接口和目标类</p><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210719181630532.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210719181630532.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210719181630532"></p></li><li><p>创建切面类（含增强方法）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置增强。。。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置增强。。。&quot;</span>);</span><br><span class="line">        Object proceed = pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;后置增强。。。&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>配置applicationContext.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 目标对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;target&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.myspring.aop.Target&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 切面对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myAspect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.myspring.aop.MyAspect&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置织入，即哪些方法需要哪些增强(前置后置增强等) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 声明切面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAspect&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 切点+通知(增强) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.myspring.aop.*.*(..))&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;around&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.myspring.aop.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(&quot;classpath:applicationContext.xml&quot;)</span> <span class="comment">// 非注解方式注入配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringJunitTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TargetInterface target;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        target.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="切点表达式"><a href="#切点表达式" class="headerlink" title="切点表达式"></a>切点表达式</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210719184702337.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210719184702337.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210719184702337"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 声明切面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAspect&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 切点表达式的抽取 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;myPointcut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.myspring.aop.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 切点+通知(增强) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;around&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="通知类型"><a href="#通知类型" class="headerlink" title="通知类型"></a>通知类型</h4><p><img src="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210719184903397.png" class="lazyload" data-srcset="https://reria-images.oss-cn-hangzhou.aliyuncs.com/img01/images-master/img/image-20210719184903397.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210719184903397"></p><h3 id="基于注解开发AOP"><a href="#基于注解开发AOP" class="headerlink" title="基于注解开发AOP"></a>基于注解开发AOP</h3><ol><li><p>目标类、切面类</p></li><li><p>配置目标类、切面类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;target&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Target</span> <span class="keyword">implements</span> <span class="title">TargetInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;myAspect&quot;)</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//标注当前是一个切面类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.myspring.aop.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置增强。。。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>配置applicationContext.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注解开发组件扫描 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.myspring.aop&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- aop自动代理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="切点表达式抽取"><a href="#切点表达式抽取" class="headerlink" title="切点表达式抽取"></a>切点表达式抽取</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;myAspect&quot;)</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//标注当前是一个切面类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Before(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置增强。。。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义切点表达式</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.myspring.aop.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointCut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="事务控制"><a href="#事务控制" class="headerlink" title="事务控制"></a>事务控制</h2><p><a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=136">黑马程序员最全SSM框架教程|Spring+SpringMVC+MyBatis全覆盖_SSM整合_哔哩哔哩_bilibili</a></p>]]></content>
      
      
      <categories>
          
          <category> ssm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 学习 </tag>
            
            <tag> ssm </tag>
            
            <tag> javaEE </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【集训】Servlet</title>
      <link href="/2021/07/11/ji-xun-servlet/"/>
      <url>/2021/07/11/ji-xun-servlet/</url>
      
        <content type="html"><![CDATA[<h2 id="什么是Servlet？"><a href="#什么是Servlet？" class="headerlink" title="什么是Servlet？"></a>什么是Servlet？</h2><blockquote><p>Servlet 是运行在 Web 服务器或应用服务器上的<strong>java程序</strong>，是Java EE规范之一（一种接口）。</p><p>它是作为来自 Web 浏览器或其他 HTTP 客户端的请求和 HTTP 服务器上的数据库或应用程序之间的中间层，即<strong>接收客户端发送过来的请求并且响应数据给客户端</strong>。</p><p>使用 Servlet，您可以收集来自网页表单的用户输入，呈现来自数据库或者其他源的记录，还可以动态创建网页。</p><p><img src="https://www.runoob.com/wp-content/uploads/2014/07/servlet-arch.jpg" class="lazyload" data-srcset="https://www.runoob.com/wp-content/uploads/2014/07/servlet-arch.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Servlet 架构"></p></blockquote><h2 id="💡配置Servlet"><a href="#💡配置Servlet" class="headerlink" title="💡配置Servlet"></a>💡配置Servlet</h2><ul><li><p>创建一个Java类并实现Servlet接口（一般通过继承HTTPServlet类去实现servlet）</p></li><li><p>重写方法，实现逻辑操作</p></li><li><p>在web.xml中配置这个servlet的访问地址</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 给tomcat配置servlet相关信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 写明servlet的名字（一般使用类名即可） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 写明servlet的全类名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.MyServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 给servlet配置访问地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 写明需要配置访问地址的servlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>MyServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 写明为该servlet配置的访问地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/myServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;url-pattern&gt;/myServlet&lt;/url-pattern&gt;</code>标签中 <code>/</code> 的作用：相当于拼接到 <code>http://ip:port/工程路径</code>后，即<code>http://ip:port/工程路径/myServlet</code></p></li></ul><h2 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h2><h3 id="什么是HTTP协议"><a href="#什么是HTTP协议" class="headerlink" title="什么是HTTP协议"></a>什么是HTTP协议</h3><blockquote><p>HTTP协议（HyperText Transfer Protocol，超文本传输协议）是因特网上应用最为广泛的一种网络传输协议，所有的WWW文件都必须遵守这个标准，即客户端与服务器之间通信、传输数据需要遵守的规则。</p><p>HTTP是一个基于TCP/IP通信协议来传递数据（HTML 文件, 图片文件, 查询结果等）。</p></blockquote><h3 id="请求与响应"><a href="#请求与响应" class="headerlink" title="请求与响应"></a>请求与响应</h3><ul><li>客户端给服务器发送数据为请求，请求分为GET、POST请求</li><li>服务器给客户端回传数据为响应</li></ul><h3 id="💡HTTP协议内容"><a href="#💡HTTP协议内容" class="headerlink" title="💡HTTP协议内容"></a>💡HTTP协议内容</h3><blockquote><p>请求/响应行</p><p>请求/响应头：<br>    属性名：属性值</p><p>请求/响应体：</p></blockquote><p>重要，自行阅读学习</p><h3 id="常见响应码"><a href="#常见响应码" class="headerlink" title="常见响应码"></a>常见响应码</h3><ul><li>200：表示请求成功</li><li>302：表示请求重定向</li><li>404：表示服务器找不到该请求地址（地址有错）</li><li>500：表示服务器内部错误（代码有错）</li></ul><h2 id="💡表单处理、常用API"><a href="#💡表单处理、常用API" class="headerlink" title="💡表单处理、常用API"></a>💡表单处理、常用API</h2><table><thead><tr><th>request对象常用方法</th><th>方法介绍</th></tr></thead><tbody><tr><td>getParameter(String name)</td><td>返回name指定参数的参数值</td></tr><tr><td>getParameterValues(String name)</td><td>返回包含参数name的所有值的数组</td></tr><tr><td>setAttribute(String,Object)</td><td>存储此请求中的属性</td></tr><tr><td>getAttribute(String name)</td><td>返回指定属性的属性值</td></tr><tr><td>getContextPath()</td><td>返回当前WEB项目相对路径</td></tr><tr><td>getMethod()</td><td>获取请求类型</td></tr><tr><td>getSession()</td><td>获取Session对象</td></tr><tr><td>getCookies()</td><td>获取所有Cookie,返回一个Cookie数组</td></tr></tbody></table><table><thead><tr><th>request对象常用方法</th><th>方法介绍</th></tr></thead><tbody><tr><td>setHeader()</td><td>设置消息头</td></tr><tr><td>setStatus()</td><td>设置状态码</td></tr><tr><td>addCookie()</td><td>添加Cookie</td></tr><tr><td>getWriter()</td><td>获取通向浏览器的字符流</td></tr></tbody></table><h3 id="获取-回传数据"><a href="#获取-回传数据" class="headerlink" title="获取/回传数据"></a>获取/回传数据</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://localhost:8080/jsp_war_exploded/myServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    兴趣爱好：</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;画画&quot;</span>&gt;</span>画画</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;打篮球&quot;</span>&gt;</span>打篮球</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;敲代码&quot;</span>&gt;</span>敲代码</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">String password = req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">String[] hobby = req.getParameterValues(<span class="string">&quot;hobby&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;用户名：&quot;</span>+username+<span class="string">&quot;,密码：&quot;</span>+password);</span><br><span class="line">System.out.println(Arrays.toString(hobby));</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resp.getWriter().println(<span class="string">&quot;&lt;div&gt;这是一个div&lt;/div&gt;&quot;</span>);</span><br></pre></td></tr></table></figure><p><code>http://localhost:8080/jsp_war_exploded/myServlet?username=111&amp;password=222</code>使用?传递参数</p><h3 id="请求转发与重定向"><a href="#请求转发与重定向" class="headerlink" title="请求转发与重定向"></a>请求转发与重定向</h3><p><img src="https://gitee.com/ReRia/images/raw/master/img/image-20210712161839745.png" class="lazyload" data-srcset="https://gitee.com/ReRia/images/raw/master/img/image-20210712161839745.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210712161839745"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">req.setAttribute(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;MyServlet处理的信息:&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;MyServlet中的request获得的数据&quot;</span>+username);</span><br><span class="line">req.getRequestDispatcher(<span class="string">&quot;/myServlet2&quot;</span>).forward(req, resp);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String username = req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;MyServlet2中的request获得的数据:&quot;</span>+username);</span><br><span class="line">System.out.println(<span class="string">&quot;MyServlet2中显示之前处理并保存的数据:&quot;</span>+req.getAttribute(<span class="string">&quot;key&quot;</span>));</span><br></pre></td></tr></table></figure><p>请求转发的特点：</p><ol><li>浏览器地址栏没有变化</li><li>一次请求</li><li>共享request中的数据</li><li>可以转发到WEB-INF目录下（工程路径下）</li></ol><p><img src="https://gitee.com/ReRia/images/raw/master/img/image-20210712185234093.png" class="lazyload" data-srcset="https://gitee.com/ReRia/images/raw/master/img/image-20210712185234093.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210712185234093"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">resp.sendRedirect(req.getContextPath()+<span class="string">&quot;/myServlet2&quot;</span>);</span><br><span class="line"><span class="comment">// req.getContextPath()获得当前WEB项目相对路径</span></span><br><span class="line">resp.sendRedirect(<span class="string">&quot;http://www.baidu.com&quot;</span>);</span><br><span class="line"><span class="comment">// 访问外部资源必写http</span></span><br></pre></td></tr></table></figure><p>重定向的特点：</p><ol><li>浏览器地址栏发生变化</li><li>两次请求</li><li>不共享request中的数据</li><li>不能访问WEB-INF目录下资源</li><li>可以访问工程外的资源</li></ol><h2 id="💡Filter过滤器"><a href="#💡Filter过滤器" class="headerlink" title="💡Filter过滤器"></a>💡Filter过滤器</h2><p>自行学习</p><h2 id="中文乱码问题"><a href="#中文乱码问题" class="headerlink" title="中文乱码问题"></a>中文乱码问题</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="相关阅读材料"><a href="#相关阅读材料" class="headerlink" title="相关阅读材料"></a>相关阅读材料</h2><ul><li><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1255945497738400">Web开发 - 廖雪峰的官方网站 (liaoxuefeng.com)</a></li><li><a href="https://www.bilibili.com/video/BV1Y7411K7zz?from=search&seid=11129268525882330054">尚硅谷最新版JavaWeb全套教程,java web零基础入门完整版_哔哩哔哩_bilibili</a></li></ul><h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><ul><li><p>熟悉servlet、jsp并实现一些功能，并写一篇博文。</p></li><li><p>博文内容要求（<strong>必须要求</strong>）：</p><p><strong>写一篇博文记录你使用servlet、jsp实现功能时遇到了哪些困难、不理解、不知道该如何实现的地方，以及写上解决的过程与结果（未解决的也可以写上有哪些疑惑），或者学习笔记等等皆可。</strong></p></li><li><p>功能实例（<strong>仅参考，不是最低/最高标准</strong>）：</p><ol><li>含有登陆/注册页面、其他页面。</li><li>登录功能：手动输入信息，符合已存在的用户信息则成功登录。</li><li>注册功能：手动输入信息，不能重复注册已存在的用户名，否则注册失败。</li><li>用户展示：在页面上展示所有已经注册的用户的信息。</li><li>登陆过滤：其他页面，只有登陆成功后才可访问，否则跳转至登陆页面。</li><li>其他页面：利用循环控制语句或其他工具功能输出由后台传递而来的数据。</li><li>等等</li></ol></li><li><p>提交内容与时间：</p><ul><li><p>提交内容：程序源码+博文链接</p></li><li><p>提交时间：7.27日晚零点前，将压缩包命名为<strong>班级+姓名+学号</strong>发送至<a href="mailto:&#55;&#48;&#55;&#x38;&#50;&#x33;&#x38;&#x31;&#52;&#64;&#113;&#x71;&#x2e;&#x63;&#x6f;&#x6d;">&#55;&#48;&#55;&#x38;&#50;&#x33;&#x38;&#x31;&#52;&#64;&#113;&#x71;&#x2e;&#x63;&#x6f;&#x6d;</a></p></li></ul></li><li><p><strong>可能时间太短无法实现太多功能，没有关系，程序源码附上自己实现了的东西就行，没有实现完整也没关系，实现了更多功能也挺好，这个作业打分主要看你的博文里面写的记录内容，程序主要是用来练习以熟悉servlet和jsp的，毕竟大作业会用到。</strong></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaWeb </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 集训 </tag>
            
            <tag> JavaWeb </tag>
            
            <tag> Servlet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【集训】jsp</title>
      <link href="/2021/07/11/ji-xun-jsp/"/>
      <url>/2021/07/11/ji-xun-jsp/</url>
      
        <content type="html"><![CDATA[<h2 id="什么是JSP"><a href="#什么是JSP" class="headerlink" title="什么是JSP"></a>什么是JSP</h2><blockquote><ul><li>JSP 与 PHP、ASP、ASP.NET 等语言类似，<strong>运行在服务端</strong>的语言。</li><li>JSP全称Java Server Pages，是建立在JAVA基础上的一种网络编程语言，<strong>JSP是一种Java servlet（JSP在执行前首先被编译成一个Servlet）</strong>，主要用于实现Java web应用程序的用户界面部分。</li><li>网页开发者们通过结合HTML代码、XHTML代码、XML元素以及嵌入JSP操作和命令来编写JSP。</li></ul></blockquote><h2 id="jsp-lt-gt-java-servlet"><a href="#jsp-lt-gt-java-servlet" class="headerlink" title="jsp &lt;-&gt; java(servlet)"></a>jsp &lt;-&gt; java(servlet)</h2><p><code>C:\Users\卢荟\AppData\Local\JetBrains\IntelliJIdea2021.1\tomcat\20e10a3d-4da9-4eee-b7fa-327b2feb3d84\work\Catalina\localhost\jsp_war_exploded\org\apache\jsp</code></p><p>类似于上述文件目录（tomcat下的webapp目录下存放工程项目，只不过现在tomcat在idea里用）即找到生成的java文件。</p><p>可见JSP本质上就是一个Servlet，只不过无需配置映射路径，Web Server会根据路径查找对应的<code>.jsp</code>文件，如果找到了，就自动编译成Servlet再执行。</p><h2 id="JSP语法"><a href="#JSP语法" class="headerlink" title="JSP语法"></a>JSP语法</h2><h3 id="JSP注释"><a href="#JSP注释" class="headerlink" title="JSP注释"></a>JSP注释</h3><table><thead><tr><th align="left"><strong>语法</strong></th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">&lt;%– 注释 –%&gt;</td><td align="left">JSP注释，注释内容不会被发送至浏览器甚至不会被编译</td></tr><tr><td align="left"><!-- 注释 --></td><td align="left">HTML注释，通过浏览器查看网页源代码时可以看见注释内容</td></tr></tbody></table><h3 id="💡脚本（在JSP中编写Java代码）"><a href="#💡脚本（在JSP中编写Java代码）" class="headerlink" title="💡脚本（在JSP中编写Java代码）"></a>💡脚本（在JSP中编写Java代码）</h3><p>先<strong>导入jsp-api.jar和servlet-api.jar</strong>（tomcat自带，但是IDE并无提示会报红）</p><table><thead><tr><th align="left"><strong>语法</strong></th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">&lt;%  代码片段  %&gt;</td><td align="left">一般定义变量和编写语句。</td></tr><tr><td align="left">&lt;%!  声明代码  %&gt;</td><td align="left">可以声明常量，编写方法，编写类</td></tr><tr><td align="left">&lt;%=  表达式  %&gt;</td><td align="left"><strong>表达式被转化成String，然后插入到表达式出现的地方</strong></td></tr></tbody></table><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMath</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a,b;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyMath</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.a = a;</span><br><span class="line">            <span class="keyword">this</span>.b = b;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">doMath</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> a+b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">out.println(<span class="string">&quot;打印语句&quot;</span>);</span><br><span class="line">    MyMath myMath = <span class="keyword">new</span> MyMath(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> num = myMath.doMath();</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt; 和为&lt;%= num %&gt; &lt;/h1&gt;</span><br><span class="line">&lt;div&gt; &lt;%= <span class="string">&quot;&lt;h2&gt;这是一个标签&lt;/h2&gt;&quot;</span> %&gt; &lt;/div&gt;</span><br></pre></td></tr></table></figure><p>对于流程控制语句的编写可能稍微繁琐</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="keyword">int</span> day = <span class="number">1</span> %&gt;</span><br><span class="line">&lt;% <span class="keyword">if</span> (day == <span class="number">1</span> || day == <span class="number">7</span>) &#123; %&gt;</span><br><span class="line">&lt;p&gt;今天是周末&lt;/p&gt;</span><br><span class="line">&lt;% &#125; <span class="keyword">else</span> &#123; %&gt;</span><br><span class="line">&lt;p&gt;今天不是周末&lt;/p&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">    </span><br><span class="line">&lt;%<span class="keyword">for</span> ( <span class="keyword">int</span> fontSize = <span class="number">1</span>; fontSize &lt;= <span class="number">3</span>; fontSize++)&#123; %&gt;</span><br><span class="line">   &lt;font color=<span class="string">&quot;green&quot;</span> size=<span class="string">&quot;&lt;%= fontSize %&gt;&quot;</span>&gt;</span><br><span class="line">    菜鸟教程</span><br><span class="line">   &lt;/font&gt;&lt;br /&gt;</span><br><span class="line">&lt;%&#125;%&gt;</span><br></pre></td></tr></table></figure><p>当然也可以用out对象输出</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">int</span> fontSize;</span><br><span class="line">    <span class="keyword">for</span> ( fontSize = <span class="number">10</span>; fontSize &lt;= <span class="number">13</span>; fontSize++) &#123;</span><br><span class="line">        out.write(<span class="string">&quot;&lt;div&gt;&quot;</span>);</span><br><span class="line">        out.write(fontSize+<span class="string">&quot;&quot;</span>);</span><br><span class="line">        out.write(<span class="string">&quot;&lt;/div&gt;&lt;br&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><h3 id="JSP指令"><a href="#JSP指令" class="headerlink" title="JSP指令"></a>JSP指令</h3><p>JSP指令用来设置与整个JSP页面相关的属性。</p><table><thead><tr><th align="left"><strong>JSP指令</strong></th><th align="left"><strong>描述</strong></th></tr></thead><tbody><tr><td align="left">&lt;%@ page     属性名=”属性值” %&gt;</td><td align="left">定义页面的依赖属性，导包</td></tr><tr><td align="left">&lt;%@ include 属性名=”属性值” %&gt;</td><td align="left">包含其他文件（静态包含）</td></tr><tr><td align="left">&lt;%@ taglib    属性名=”属性值” %&gt;</td><td align="left">引入标签库的定义，可以是自定义标签</td></tr></tbody></table><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot; &quot;</span> %&gt;</span><br><span class="line">&lt;%@ include file=<span class="string">&quot; &quot;</span>%&gt;</span><br></pre></td></tr></table></figure><h3 id="JSP行为"><a href="#JSP行为" class="headerlink" title="JSP行为"></a>JSP行为</h3><p>自行学习</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:行为名 属性名=<span class="string">&quot;属性值&quot;</span> /&gt;</span><br></pre></td></tr></table></figure><h3 id="中文编码问题"><a href="#中文编码问题" class="headerlink" title="中文编码问题"></a>中文编码问题</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br></pre></td></tr></table></figure><h2 id="💡JSP九大内置对象与四大作用域"><a href="#💡JSP九大内置对象与四大作用域" class="headerlink" title="💡JSP九大内置对象与四大作用域"></a>💡JSP九大内置对象与四大作用域</h2><h3 id="四大域对象"><a href="#四大域对象" class="headerlink" title="四大域对象"></a>四大域对象</h3><table><thead><tr><th>对象</th><th>作用域</th><th>变化操作</th></tr></thead><tbody><tr><td>pageContext</td><td>当前页面有效，当当前页面关闭或转到其他页面时，page对象将在响应回馈给客户端后释放。</td><td>跳转页面</td></tr><tr><td>request</td><td>当次请求有效，可以跨越forward()不重定向跳转前后的两页，可以通过setAttribute()方法实现页面中的信息传递。</td><td>两次请求</td></tr><tr><td>session</td><td>当前会话有效，指从用户打开浏览器开始，到用户关闭浏览器这中间的过程。这个过程可能包含多个请求响应</td><td>关闭浏览器</td></tr><tr><td>application</td><td>所有应用程序中有效，整个应用是指从应用启动，到应用结束。我们没有说“从服务器启动，到服务器关闭”是因为一个服务器可能部署多个应用，当然你关闭了服务器，就会把上面所有的应用都关闭了。</td><td>关闭服务器</td></tr></tbody></table><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">pageContext.setAttribute(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;pageContext&quot;</span>);</span><br><span class="line">request.setAttribute(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;request&quot;</span>);</span><br><span class="line">session.setAttribute(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;session&quot;</span>);</span><br><span class="line">application.setAttribute(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;application&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">pageContext的值：&lt;%=pageContext.getAttribute(<span class="string">&quot;key&quot;</span>) %&gt;&lt;br&gt;</span><br><span class="line">request的值：&lt;%=request.getAttribute(<span class="string">&quot;key&quot;</span>) %&gt;&lt;br&gt;</span><br><span class="line">session的值：&lt;%=session.getAttribute(<span class="string">&quot;key&quot;</span>) %&gt;&lt;br&gt;</span><br><span class="line">application的值：&lt;%=application.getAttribute(<span class="string">&quot;key&quot;</span>) %&gt;&lt;br&gt;</span><br></pre></td></tr></table></figure><h3 id="九大内置对象"><a href="#九大内置对象" class="headerlink" title="九大内置对象"></a>九大内置对象</h3><p>在生成的java文件中可以找到</p><p><img src="https://gitee.com/ReRia/images/raw/master/img/image-20210712103659945.png" class="lazyload" data-srcset="https://gitee.com/ReRia/images/raw/master/img/image-20210712103659945.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210712103659945"></p><table><thead><tr><th align="left"><strong>对象</strong></th><th align="left"><strong>描述</strong></th><th>作用域</th></tr></thead><tbody><tr><td align="left"><strong>request</strong></td><td align="left">javax.servlet.http.HttpServletRequest 类的实例</td><td>request</td></tr><tr><td align="left"><strong>response</strong></td><td align="left">javax.servlet.http.HttpServletResponse类的实例</td><td>pageContext</td></tr><tr><td align="left"><strong>out</strong></td><td align="left">javax.servlet.jsp.JspWriter 类的实例，用来在response对象中写入内容。</td><td>pageContext</td></tr><tr><td align="left"><strong>session</strong></td><td align="left">javax.servlet.http.HttpSession 类的实例</td><td>session</td></tr><tr><td align="left">application</td><td align="left">javax.servlet.ServletContext 类的实例。与应用上下文有关</td><td>application</td></tr><tr><td align="left">config</td><td align="left">javax.servlet.ServletConfig 类的实例。这个对象允许开发者访问Servlet或者JSP引擎的初始化参数，比如文件路径等。</td><td>pageContext</td></tr><tr><td align="left">pageContext</td><td align="left">javax.servlet.jsp.PageContext 类的实例，提供对JSP页面所有对象以及命名空间的访问</td><td>pageContext</td></tr><tr><td align="left">page</td><td align="left">指向当前JSP对象</td><td>pageContext</td></tr><tr><td align="left">exception</td><td align="left">exception 类的对象，代表发生错误的 JSP 页面中对应的异常对象，&lt;%@ page …… isErrorPage=”true” %&gt;</td><td>pageContext</td></tr></tbody></table><h2 id="EL表达式与JSTL标准标签库"><a href="#EL表达式与JSTL标准标签库" class="headerlink" title="EL表达式与JSTL标准标签库"></a>EL表达式与JSTL标准标签库</h2><p>自行学习</p><h2 id="💡MVC框架"><a href="#💡MVC框架" class="headerlink" title="💡MVC框架"></a>💡MVC框架</h2><p>MVC是三个单词的首字母缩写，它们是Model（模型）、View（视图）和Controller（控制）。</p><ul><li>Model（模型）：如一个存取数据的对象或 JavaBean</li><li>View（视图）：如jsp动态页面</li><li>Controller（控制器）：控制数据流向模型对象，并在数据变化时更新视图，使视图与模型分离开，如servlet</li></ul><p>MVC重要特点就是两种分离：</p><ol><li>视图和数据模型的分离：使用不同的视图对相同的数据进行展示；分离可视和不可视的组件，能够对模型进行独立测试。因为分离了可视组件减少了外部（数据库也是一种外部组件）依赖利于测试。</li><li>视图和表现逻辑(Controller)的分离：Controller是一个表现逻辑的组件，并非一个业务逻辑组件。MVC可以作为表现模式也可以作为建构模式，意味这Controller也可以是业务逻辑。分离逻辑和具体展示，能够对逻辑进行独立测试。</li></ol><p>MVC优缺点： </p><ul><li>优点：低耦合、重用性高、生命周期成本低、部署快、可维护性高</li><li>缺点：没有明确的定义、不适合小、中型应用程序、增加系统结构和实现的复杂性、视图对模型数据的低效率访问</li></ul><h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><p>在上一个文档中已经声明，这两节课只要交一个作业就行。</p>]]></content>
      
      
      <categories>
          
          <category> JavaWeb </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 集训 </tag>
            
            <tag> JavaWeb </tag>
            
            <tag> jsp </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
